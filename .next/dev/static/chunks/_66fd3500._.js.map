{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/types.ts"],"sourcesContent":["\nexport enum ViewMode {\n  EDITOR = 'EDITOR',\n  CANVAS = 'CANVAS',\n  GRAPH = 'GRAPH',\n  SIEVE = 'SIEVE',\n  ADMIN = 'ADMIN'\n}\n\n// Global Tag for management\nexport interface Tag {\n  id: string;\n  name: string;\n  color: string;\n  createdAt: number;\n}\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\n// Connection between specific text selections within notes\nexport interface TextConnection {\n  id: string;\n  // Source text info\n  sourceBlockId: string;\n  sourceText: string; // The actual selected text (for matching)\n  // Target text info (can be in same or different block)\n  targetBlockId: string;\n  targetText: string; // The target text to connect to\n  targetNoteId?: string; // If connecting to another note\n  // Visual properties\n  color: string;\n  createdAt: number;\n}\n\n// Available connection colors\nexport const CONNECTION_COLORS = [\n  '#ef4444', // red\n  '#f97316', // orange\n  '#eab308', // yellow\n  '#22c55e', // green\n  '#06b6d4', // cyan\n  '#3b82f6', // blue\n  '#8b5cf6', // purple\n  '#ec4899', // pink\n];\n\nexport interface NoteBlock {\n  id: string;\n  type: 'paragraph' | 'heading' | 'todo' | 'bullet' | 'blockquote' | 'code' | 'image';\n  content: string;\n  checked?: boolean;\n  highlightColor?: string;\n  textConnections?: TextConnection[]; // Connections from text in this block\n}\n\nexport interface Note {\n  id: string;\n  title: string;\n  blocks: NoteBlock[];\n  position: Point; // For Canvas view\n  connections: string[]; // IDs of connected notes\n  color?: string; // Hex code for note color\n  tags?: string[]; // Array of tag strings\n  createdAt: number;\n}\n\nexport interface User {\n  id: string;\n  email: string;\n  role: 'USER' | 'ADMIN';\n  createdAt: number;\n  name?: string;\n  image?: string;\n}\n\n// Manually defining d3 simulation types to avoid namespace errors if d3 types aren't global\nexport interface SimulationNodeDatum {\n  index?: number;\n  x?: number;\n  y?: number;\n  vx?: number;\n  vy?: number;\n  fx?: number | null;\n  fy?: number | null;\n}\n\nexport interface SimulationLinkDatum<NodeDatum> {\n  source: string | number | NodeDatum;\n  target: string | number | NodeDatum;\n  index?: number;\n}\n\nexport interface GraphNode extends SimulationNodeDatum {\n  id: string;\n  title: string;\n  group: number;\n  color?: string;\n}\n\nexport interface GraphLink extends SimulationLinkDatum<GraphNode> {\n  source: string | GraphNode;\n  target: string | GraphNode;\n}"],"names":[],"mappings":";;;;;;AACO,IAAA,AAAK,kCAAA;;;;;;WAAA;;AAqCL,MAAM,oBAAoB;IAC/B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/layout/Sidebar.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { ViewMode } from '../../types';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Type, Grid, Share2, PlusCircle, Search, Undo2, Redo2, Sparkles, Hash, X, Moon, Sun, Box, Settings } from 'lucide-react';\nimport Link from 'next/link';\n\ninterface SidebarProps {\n  currentView: ViewMode;\n  onViewChange: (view: ViewMode) => void;\n  onCreateNote: () => void;\n  onAiCreate: () => void;\n  onUndo: () => void;\n  onRedo: () => void;\n  canUndo: boolean;\n  canRedo: boolean;\n  onSearch: () => void;\n  allTags: string[];\n  selectedTag: string | null;\n  onSelectTag: (tag: string | null) => void;\n  isDarkMode: boolean;\n  onToggleTheme: () => void;\n}\n\nexport const Sidebar: React.FC<SidebarProps> = ({\n  currentView,\n  onViewChange,\n  onCreateNote,\n  onAiCreate,\n  onUndo,\n  onRedo,\n  canUndo,\n  canRedo,\n  onSearch,\n  allTags,\n  selectedTag,\n  onSelectTag,\n  isDarkMode,\n  onToggleTheme\n}) => {\n  const [tagMenuOpen, setTagMenuOpen] = useState(false);\n\n  const navItems = [\n    { id: ViewMode.EDITOR, icon: <Type size={20} />, label: 'Editor' },\n    { id: ViewMode.CANVAS, icon: <Grid size={20} />, label: 'Canvas' },\n    { id: ViewMode.GRAPH, icon: <Share2 size={20} />, label: 'Graph' },\n    { id: ViewMode.SIEVE, icon: <Box size={20} />, label: 'Sieve AI' },\n  ];\n\n  return (\n    <motion.div\n      initial={{ x: -100 }}\n      animate={{ x: 0 }}\n      className=\"w-20 h-screen bg-white dark:bg-black border-r border-gray-100 dark:border-neutral-800 flex flex-col items-center py-8 z-50 fixed left-0 top-0 transition-colors\"\n    >\n      <div className=\"mb-12 w-10 h-10 bg-black dark:bg-white flex items-center justify-center text-white dark:text-black font-black text-xl rounded-sm\">\n        N\n      </div>\n\n      <div className=\"flex flex-col gap-8 flex-1\">\n        {navItems.map((item) => (\n          <button\n            key={item.id}\n            onClick={() => onViewChange(item.id)}\n            className=\"relative group flex items-center justify-center w-10 h-10 outline-none\"\n            aria-label={item.label}\n          >\n            {currentView === item.id && (\n              <motion.div\n                layoutId=\"activeNav\"\n                className=\"absolute inset-0 bg-black dark:bg-white rounded-lg\"\n                transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n              />\n            )}\n            <span className={`relative z-10 transition-colors duration-200 ${currentView === item.id ? 'text-white dark:text-black' : 'text-gray-400 hover:text-black dark:hover:text-white'}`}>\n              {item.icon}\n            </span>\n\n            {/* Tooltip */}\n            <span className=\"absolute left-12 opacity-0 group-hover:opacity-100 transition-opacity bg-black dark:bg-white text-white dark:text-black text-xs px-2 py-1 rounded whitespace-nowrap pointer-events-none z-[60]\">\n              {item.label}\n            </span>\n          </button>\n        ))}\n      </div>\n\n      <div className=\"flex flex-col gap-4 mb-6\">\n        <motion.button\n          whileHover={{ scale: 1.1, rotate: -10 }}\n          whileTap={{ scale: 0.9 }}\n          onClick={onUndo}\n          disabled={!canUndo}\n          className={`flex items-center justify-center w-10 h-10 rounded-lg transition-colors ${canUndo ? 'text-black dark:text-white hover:bg-gray-100 dark:hover:bg-neutral-800' : 'text-gray-200 dark:text-neutral-700 cursor-not-allowed'}`}\n          title=\"Undo (Cmd+Z)\"\n        >\n          <Undo2 size={18} />\n        </motion.button>\n        <motion.button\n          whileHover={{ scale: 1.1, rotate: 10 }}\n          whileTap={{ scale: 0.9 }}\n          onClick={onRedo}\n          disabled={!canRedo}\n          className={`flex items-center justify-center w-10 h-10 rounded-lg transition-colors ${canRedo ? 'text-black dark:text-white hover:bg-gray-100 dark:hover:bg-neutral-800' : 'text-gray-200 dark:text-neutral-700 cursor-not-allowed'}`}\n          title=\"Redo (Cmd+Shift+Z)\"\n        >\n          <Redo2 size={18} />\n        </motion.button>\n      </div>\n\n      <div className=\"flex flex-col gap-6 mt-auto\">\n        {/* Theme Toggle */}\n        <motion.button\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n          onClick={onToggleTheme}\n          className=\"text-gray-400 hover:text-black dark:hover:text-white transition-colors w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-800\"\n          title={isDarkMode ? \"Switch to Light Mode\" : \"Switch to Dark Mode\"}\n        >\n          {isDarkMode ? <Sun size={20} /> : <Moon size={20} />}\n        </motion.button>\n\n        {/* Tag Filter Button */}\n        <div className=\"relative\">\n          <motion.button\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n            onClick={() => setTagMenuOpen(!tagMenuOpen)}\n            className={`w-10 h-10 flex items-center justify-center rounded-lg transition-colors ${selectedTag || tagMenuOpen ? 'bg-gray-100 dark:bg-neutral-800 text-black dark:text-white' : 'text-gray-400 hover:text-black dark:hover:text-white hover:bg-gray-50 dark:hover:bg-neutral-800'}`}\n            title=\"Filter by Tag\"\n          >\n            <Hash size={20} />\n            {selectedTag && (\n              <span className=\"absolute top-1 right-1 w-2 h-2 bg-blue-500 rounded-full\" />\n            )}\n          </motion.button>\n\n          <AnimatePresence>\n            {tagMenuOpen && (\n              <>\n                <div className=\"fixed inset-0 z-[55]\" onClick={() => setTagMenuOpen(false)} />\n                <motion.div\n                  initial={{ opacity: 0, x: 10, scale: 0.95 }}\n                  animate={{ opacity: 1, x: 20, scale: 1 }}\n                  exit={{ opacity: 0, x: 10, scale: 0.95 }}\n                  className=\"absolute left-full bottom-0 w-48 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 shadow-xl rounded-lg p-2 z-[60] flex flex-col gap-1\"\n                >\n                  <div className=\"flex items-center justify-between px-2 py-1 border-b border-gray-100 dark:border-neutral-700 mb-1\">\n                    <span className=\"text-[10px] font-bold uppercase text-gray-400 dark:text-neutral-500\">Filter Tags</span>\n                    {selectedTag && (\n                      <button onClick={() => onSelectTag(null)} className=\"text-[10px] text-red-500 hover:underline\">\n                        Clear\n                      </button>\n                    )}\n                  </div>\n                  <div className=\"max-h-60 overflow-y-auto custom-scrollbar\">\n                    {allTags.length === 0 ? (\n                      <div className=\"p-2 text-xs text-gray-400 italic text-center\">No tags found</div>\n                    ) : (\n                      allTags.map(tag => (\n                        <button\n                          key={tag}\n                          onClick={() => {\n                            onSelectTag(selectedTag === tag ? null : tag);\n                          }}\n                          className={`w-full text-left px-2 py-1.5 rounded text-xs font-bold flex items-center justify-between ${selectedTag === tag ? 'bg-black dark:bg-white text-white dark:text-black' : 'text-gray-600 dark:text-neutral-400 hover:bg-gray-100 dark:hover:bg-neutral-800'}`}\n                        >\n                          <span>#{tag}</span>\n                          {selectedTag === tag && <X size={10} />}\n                        </button>\n                      ))\n                    )}\n                  </div>\n                </motion.div>\n              </>\n            )}\n          </AnimatePresence>\n        </div>\n\n        {/* Admin/Tag Management Link */}\n        <Link href=\"/admin\">\n          <motion.div\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n            className=\"w-10 h-10 flex items-center justify-center rounded-lg text-gray-400 hover:text-black dark:hover:text-white hover:bg-gray-50 dark:hover:bg-neutral-800 transition-colors cursor-pointer\"\n            title=\"Tag Management (Admin)\"\n          >\n            <Settings size={20} />\n          </motion.div>\n        </Link>\n\n        <motion.button\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n          onClick={onSearch}\n          className=\"text-gray-400 hover:text-black dark:hover:text-white transition-colors w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-800\"\n          title=\"Search (Cmd+K)\"\n        >\n          <Search size={20} />\n        </motion.button>\n\n        <div className=\"flex flex-col gap-3 items-center\">\n          <motion.button\n            whileHover={{ scale: 1.1, rotate: 180 }}\n            transition={{ type: 'spring', stiffness: 200, damping: 10 }}\n            onClick={onAiCreate}\n            className=\"text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 w-10 h-10 flex items-center justify-center rounded-lg\"\n            title=\"Magic Create with Gemini\"\n          >\n            <Sparkles size={20} />\n          </motion.button>\n\n          <motion.button\n            whileHover={{ scale: 1.15 }}\n            whileTap={{ scale: 0.9 }}\n            onClick={onCreateNote}\n            className=\"text-black dark:text-white\"\n            title=\"Create Note\"\n          >\n            <PlusCircle size={28} strokeWidth={1.5} />\n          </motion.button>\n        </div>\n      </div>\n    </motion.div>\n  );\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 549, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IAqTsB,UAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 564, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/constants.ts"],"sourcesContent":["\nimport { Note, NoteBlock } from './types';\n\nexport const APP_NAME = \"NOTATIONS\";\n\nexport const NOTE_COLORS = [\n  { id: 'default', value: '#000000', label: 'Black' },\n  { id: 'red', value: '#ef4444', label: 'Red' },\n  { id: 'orange', value: '#f97316', label: 'Orange' },\n  { id: 'yellow', value: '#eab308', label: 'Yellow' },\n  { id: 'green', value: '#22c55e', label: 'Green' },\n  { id: 'blue', value: '#3b82f6', label: 'Blue' },\n  { id: 'purple', value: '#a855f7', label: 'Purple' },\n];\n\n// Highlight colors for individual content blocks (vibrant, readable versions)\nexport const BLOCK_HIGHLIGHT_COLORS = [\n  { id: 'none', value: 'transparent', label: 'No Highlight' },\n  { id: 'red', value: 'rgba(239, 68, 68, 0.35)', label: 'Red' },\n  { id: 'orange', value: 'rgba(249, 115, 22, 0.35)', label: 'Orange' },\n  { id: 'yellow', value: 'rgba(250, 204, 21, 0.4)', label: 'Yellow' },\n  { id: 'green', value: 'rgba(34, 197, 94, 0.35)', label: 'Green' },\n  { id: 'blue', value: 'rgba(59, 130, 246, 0.35)', label: 'Blue' },\n  { id: 'purple', value: 'rgba(168, 85, 247, 0.4)', label: 'Purple' },\n  { id: 'pink', value: 'rgba(236, 72, 153, 0.35)', label: 'Pink' },\n  { id: 'cyan', value: 'rgba(6, 182, 212, 0.35)', label: 'Cyan' },\n];\n\nexport const MOCK_NOTES: Note[] = [\n  {\n    id: '1',\n    title: 'Project Manifesto',\n    blocks: [\n      { id: 'b1', type: 'heading', content: 'The Vision' },\n      { id: 'b2', type: 'paragraph', content: 'A unified interface for thought.' },\n      { id: 'b3', type: 'todo', content: 'Integrate Gemini AI', checked: false }\n    ],\n    position: { x: 100, y: 100 },\n    connections: ['2', '3'],\n    color: '#000000',\n    tags: ['vision', 'strategy'],\n    createdAt: Date.now()\n  },\n  {\n    id: '2',\n    title: 'Design System',\n    blocks: [\n      { id: 'b4', type: 'heading', content: 'Monochrome' },\n      { id: 'b5', type: 'paragraph', content: 'Strict black and white palette. No greys unless necessary for hierarchy.' }\n    ],\n    position: { x: 400, y: 200 },\n    connections: ['1'],\n    color: '#3b82f6',\n    tags: ['design', 'ui'],\n    createdAt: Date.now()\n  },\n  {\n    id: '3',\n    title: 'Tech Stack',\n    blocks: [\n      { id: 'b6', type: 'paragraph', content: 'React, D3, Framer Motion, Google GenAI.' }\n    ],\n    position: { x: 200, y: 400 },\n    connections: ['1'],\n    color: '#ef4444',\n    tags: ['dev', 'stack'],\n    createdAt: Date.now()\n  }\n];"],"names":[],"mappings":";;;;;;;;;;AAGO,MAAM,WAAW;AAEjB,MAAM,cAAc;IACzB;QAAE,IAAI;QAAW,OAAO;QAAW,OAAO;IAAQ;IAClD;QAAE,IAAI;QAAO,OAAO;QAAW,OAAO;IAAM;IAC5C;QAAE,IAAI;QAAU,OAAO;QAAW,OAAO;IAAS;IAClD;QAAE,IAAI;QAAU,OAAO;QAAW,OAAO;IAAS;IAClD;QAAE,IAAI;QAAS,OAAO;QAAW,OAAO;IAAQ;IAChD;QAAE,IAAI;QAAQ,OAAO;QAAW,OAAO;IAAO;IAC9C;QAAE,IAAI;QAAU,OAAO;QAAW,OAAO;IAAS;CACnD;AAGM,MAAM,yBAAyB;IACpC;QAAE,IAAI;QAAQ,OAAO;QAAe,OAAO;IAAe;IAC1D;QAAE,IAAI;QAAO,OAAO;QAA2B,OAAO;IAAM;IAC5D;QAAE,IAAI;QAAU,OAAO;QAA4B,OAAO;IAAS;IACnE;QAAE,IAAI;QAAU,OAAO;QAA2B,OAAO;IAAS;IAClE;QAAE,IAAI;QAAS,OAAO;QAA2B,OAAO;IAAQ;IAChE;QAAE,IAAI;QAAQ,OAAO;QAA4B,OAAO;IAAO;IAC/D;QAAE,IAAI;QAAU,OAAO;QAA2B,OAAO;IAAS;IAClE;QAAE,IAAI;QAAQ,OAAO;QAA4B,OAAO;IAAO;IAC/D;QAAE,IAAI;QAAQ,OAAO;QAA2B,OAAO;IAAO;CAC/D;AAEM,MAAM,aAAqB;IAChC;QACE,IAAI;QACJ,OAAO;QACP,QAAQ;YACN;gBAAE,IAAI;gBAAM,MAAM;gBAAW,SAAS;YAAa;YACnD;gBAAE,IAAI;gBAAM,MAAM;gBAAa,SAAS;YAAmC;YAC3E;gBAAE,IAAI;gBAAM,MAAM;gBAAQ,SAAS;gBAAuB,SAAS;YAAM;SAC1E;QACD,UAAU;YAAE,GAAG;YAAK,GAAG;QAAI;QAC3B,aAAa;YAAC;YAAK;SAAI;QACvB,OAAO;QACP,MAAM;YAAC;YAAU;SAAW;QAC5B,WAAW,KAAK,GAAG;IACrB;IACA;QACE,IAAI;QACJ,OAAO;QACP,QAAQ;YACN;gBAAE,IAAI;gBAAM,MAAM;gBAAW,SAAS;YAAa;YACnD;gBAAE,IAAI;gBAAM,MAAM;gBAAa,SAAS;YAA2E;SACpH;QACD,UAAU;YAAE,GAAG;YAAK,GAAG;QAAI;QAC3B,aAAa;YAAC;SAAI;QAClB,OAAO;QACP,MAAM;YAAC;YAAU;SAAK;QACtB,WAAW,KAAK,GAAG;IACrB;IACA;QACE,IAAI;QACJ,OAAO;QACP,QAAQ;YACN;gBAAE,IAAI;gBAAM,MAAM;gBAAa,SAAS;YAA0C;SACnF;QACD,UAAU;YAAE,GAAG;YAAK,GAAG;QAAI;QAC3B,aAAa;YAAC;SAAI;QAClB,OAAO;QACP,MAAM;YAAC;YAAO;SAAQ;QACtB,WAAW,KAAK,GAAG;IACrB;CACD"}},
    {"offset": {"line": 757, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/services/geminiService.ts"],"sourcesContent":["'use server';\n\nimport { GoogleGenAI, Type } from \"@google/genai\";\n\nconst getClient = () => {\n  const apiKey = process.env.GEMINI_API_KEY;\n  if (!apiKey) {\n    console.warn(\"API Key not found\");\n    return null;\n  }\n  return new GoogleGenAI({ apiKey });\n};\n\nexport const expandNoteWithAI = async (currentContent: string): Promise<string> => {\n  const ai = getClient();\n  if (!ai) return \"Error: API Key missing.\";\n\n  try {\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-pro',\n      contents: `You are a minimalist productivity assistant. \n      Take the following note content and expand upon it with 3 actionable bullet points \n      or a brief summary paragraph. Keep the tone strict, professional, and concise.\n      \n      Input: \"${currentContent}\"`,\n    });\n\n    return response.text || \"No response generated.\";\n  } catch (error) {\n    console.error(\"Gemini API Error:\", error);\n    return \"Failed to generate insight.\";\n  }\n};\n\nexport const generateConnections = async (notes: { id: string, title: string }[]) => {\n  const ai = getClient();\n  if (!ai) return [];\n\n  try {\n    // Logic to suggest connections between notes based on titles\n    // Placeholder for advanced graph RAG\n    return [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport const generateNoteFromPrompt = async (prompt: string): Promise<{ title: string; content: string } | null> => {\n  const ai = getClient();\n  if (!ai) return null;\n\n  try {\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-pro',\n      contents: `Generate a creative and structured note based on the following user prompt: \"${prompt}\". \n        The title should be concise and catchy. The content should be a well-structured starting point (e.g., a list, a summary, or a draft).`,\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: Type.OBJECT,\n          properties: {\n            title: { type: Type.STRING },\n            content: { type: Type.STRING }\n          },\n          required: [\"title\", \"content\"]\n        }\n      }\n    });\n\n    const text = response.text;\n    if (text) {\n      return JSON.parse(text);\n    }\n    return null;\n  } catch (e) {\n    console.error(\"Gemini Magic Create Error:\", e);\n    return null;\n  }\n}"],"names":[],"mappings":";;;;;;;IAaa,mBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 772, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/ContentBlock.tsx"],"sourcesContent":["\nimport React, { useRef, useEffect, useMemo } from 'react';\n\ninterface ContentBlockProps {\n  id: string;\n  html: string;\n  tagName: string;\n  className?: string;\n  onChange: (id: string, html: string) => void;\n  onKeyDown: (e: React.KeyboardEvent, id: string) => void;\n  placeholder?: string;\n  autoFocus?: boolean;\n  onFocus?: (id: string) => void;\n}\n\nexport const ContentBlock = React.memo<ContentBlockProps>(({\n  id,\n  html,\n  tagName,\n  className = '',\n  onChange,\n  onKeyDown,\n  placeholder,\n  autoFocus,\n  onFocus\n}) => {\n  const contentEditableRef = useRef<HTMLElement>(null);\n\n  // 1. Track the content we believe is in the DOM (user's typing + external updates)\n  const lastHtmlRef = useRef(html);\n\n  // 2. Track the content we want React to use for rendering.\n  // We separate this to control WHEN React updates the DOM.\n  const renderHtmlRef = useRef(html);\n\n  // 3. Reconcile Props vs Local State\n  // If 'html' (prop) differs from 'lastHtmlRef' (local), it is an EXTERNAL change \n  // (like Undo, Redo, AI, or loading a new note). We must apply it.\n  if (html !== lastHtmlRef.current) {\n    lastHtmlRef.current = html;\n    renderHtmlRef.current = html;\n  }\n  // If 'html' === 'lastHtmlRef', it is a LOOPBACK (User typed -> State updated -> Prop passed back).\n  // We do NOT update 'renderHtmlRef' in this case.\n\n  // 4. Memoize the innerHTML object.\n  // React checks if props have changed. If we pass the exact same object reference \n  // for dangerouslySetInnerHTML, React skips the DOM update entirely.\n  // We rely on 'renderHtmlRef.current' staying stable during loopbacks.\n  const innerHTML = useMemo(() => ({ __html: renderHtmlRef.current }), [renderHtmlRef.current]);\n\n  // Handle AutoFocus\n  useEffect(() => {\n    if (autoFocus && contentEditableRef.current) {\n      contentEditableRef.current.focus();\n      // Move cursor to end safely\n      const range = document.createRange();\n      const sel = window.getSelection();\n      if (sel) {\n        range.selectNodeContents(contentEditableRef.current);\n        range.collapse(false);\n        sel.removeAllRanges();\n        sel.addRange(range);\n      }\n    }\n  }, [autoFocus]);\n\n  const handleInput = (e: React.FormEvent<HTMLElement>) => {\n    let newHtml = e.currentTarget.innerHTML;\n\n    // Clean up empty or broken anchor tags\n    // Remove anchor tags with empty or whitespace-only content\n    newHtml = newHtml.replace(/<a[^>]*>(\\s*)<\\/a>/gi, '$1');\n    // Remove anchor tags with only formatting tags but no text\n    newHtml = newHtml.replace(/<a[^>]*>(<(strong|em|span|b|i)[^>]*>\\s*<\\/\\2>)*<\\/a>/gi, '');\n\n    // Platform links should be ATOMIC - any modification removes the entire link\n    // These are platform links that should be deleted entirely if edited at all\n    const platformLinkClasses = ['twitter-mention-link', 'youtube-link', 'instagram-link', 'github-link', 'linkedin-link', 'tiktok-link', 'spotify-link', 'reddit-link', 'generic-link'];\n\n    // Create a temporary element to parse and clean the HTML\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = newHtml;\n\n    // Find all anchor tags and check if they're platform links that have been modified\n    const anchors = tempDiv.querySelectorAll('a');\n    anchors.forEach(anchor => {\n      const classList = anchor.className;\n      const isPlatformLink = platformLinkClasses.some(cls => classList.includes(cls));\n\n      if (isPlatformLink) {\n        // Check if the link structure is intact - platform links must have:\n        // 1. A .link-logo span with an SVG inside\n        // 2. A .link-text span \n        // 3. A strong tag inside .link-text\n        // 4. A .link-separator span (the Â· character)\n        // 5. A .link-platform span\n        const hasLinkLogo = anchor.querySelector('.link-logo') !== null;\n        const hasLinkText = anchor.querySelector('.link-text') !== null;\n        const hasStrong = anchor.querySelector('.link-text strong') !== null;\n        const hasSeparator = anchor.querySelector('.link-separator') !== null;\n        const hasPlatform = anchor.querySelector('.link-platform') !== null;\n        const hasSvg = anchor.querySelector('svg') !== null;\n\n        // If ANY required component is missing, the link was edited - delete it entirely\n        const isIntact = hasLinkLogo && hasLinkText && hasStrong && hasSeparator && hasPlatform && hasSvg;\n\n        if (!isIntact) {\n          // Remove the entire anchor - don't leave any text behind\n          anchor.remove();\n        }\n      }\n    });\n\n    newHtml = tempDiv.innerHTML;\n\n    // Remove twitter preview cards that are orphaned (outside of anchor)\n    newHtml = newHtml.replace(/<div class=\"twitter-preview-card\"[^>]*>[\\s\\S]*?<\\/div>\\s*<\\/div>\\s*<\\/div>\\s*<\\/div>/gi, '');\n\n    // Update local tracker immediately so next render knows it matches\n    lastHtmlRef.current = newHtml;\n    onChange(id, newHtml);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    // Rich Text Shortcuts\n    if ((e.metaKey || e.ctrlKey) && !e.shiftKey) {\n      if (e.key === 'b') { e.preventDefault(); document.execCommand('bold'); }\n      else if (e.key === 'i') { e.preventDefault(); document.execCommand('italic'); }\n      else if (e.key === 'u') { e.preventDefault(); document.execCommand('underline'); }\n    }\n    onKeyDown(e, id);\n  };\n\n  // Handle clicks on links inside contentEditable\n  const handleClick = (e: React.MouseEvent) => {\n    const target = e.target as HTMLElement;\n    const anchor = target.closest('a');\n    if (anchor && anchor.href) {\n      e.preventDefault();\n      e.stopPropagation();\n      window.open(anchor.href, '_blank', 'noopener,noreferrer');\n    }\n  };\n\n  const Tag = tagName as React.ElementType;\n\n  return (\n    <Tag\n      ref={contentEditableRef}\n      className={`outline-none empty:before:content-[attr(data-placeholder)] empty:before:text-gray-300 ${className}`}\n      contentEditable\n      suppressContentEditableWarning={true}\n      onInput={handleInput}\n      onKeyDown={handleKeyDown}\n      onClick={handleClick}\n      onFocus={() => onFocus?.(id)}\n      data-placeholder={placeholder}\n      dangerouslySetInnerHTML={innerHTML}\n    />\n  );\n});\n\nContentBlock.displayName = 'ContentBlock';\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 940, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/ImageBlock.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Trash2 } from 'lucide-react';\r\n\r\ninterface ImageBlockProps {\r\n    id: string;\r\n    src: string;\r\n    onDelete?: (id: string) => void;\r\n    className?: string;\r\n}\r\n\r\nexport const ImageBlock = React.memo<ImageBlockProps>(({ id, src, onDelete, className = '' }) => {\r\n    return (\r\n        <div className={`relative group/image ${className} my-4`}>\r\n            <img\r\n                src={src}\r\n                alt=\"Note attachment\"\r\n                className=\"max-w-full rounded-lg border border-gray-200 dark:border-neutral-800 shadow-sm\"\r\n                loading=\"lazy\"\r\n            />\r\n            {onDelete && (\r\n                <button\r\n                    onClick={() => onDelete(id)}\r\n                    className=\"absolute top-2 right-2 p-1.5 bg-white/80 dark:bg-black/80 hover:bg-red-500 hover:text-white rounded-full text-gray-600 dark:text-gray-300 transition-all opacity-0 group-hover/image:opacity-100 backdrop-blur-sm\"\r\n                    title=\"Remove image\"\r\n                >\r\n                    <Trash2 size={16} />\r\n                </button>\r\n            )}\r\n        </div>\r\n    );\r\n});\r\n\r\nImageBlock.displayName = 'ImageBlock';\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AASO,MAAM,2BAAa,wKAAK,CAAC,IAAI,MAAkB,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAE;IACxF,qBACI,6LAAC;QAAI,WAAW,CAAC,qBAAqB,EAAE,UAAU,KAAK,CAAC;;0BACpD,6LAAC;gBACG,KAAK;gBACL,KAAI;gBACJ,WAAU;gBACV,SAAQ;;;;;;YAEX,0BACG,6LAAC;gBACG,SAAS,IAAM,SAAS;gBACxB,WAAU;gBACV,OAAM;0BAEN,cAAA,6LAAC,uNAAM;oBAAC,MAAM;;;;;;;;;;;;;;;;;AAKlC;;AAEA,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 999, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/ui/ConfirmationModal.tsx"],"sourcesContent":["import React from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Trash2 } from 'lucide-react';\n\ninterface ConfirmationModalProps {\n  isOpen: boolean;\n  title: string;\n  message: string;\n  onConfirm: () => void;\n  onCancel: () => void;\n}\n\nexport const ConfirmationModal: React.FC<ConfirmationModalProps> = ({\n  isOpen,\n  title,\n  message,\n  onConfirm,\n  onCancel\n}) => {\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-white/90 dark:bg-black/90 backdrop-blur-sm z-[100]\"\n            onClick={onCancel}\n          />\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white dark:bg-neutral-900 border-2 border-black dark:border-neutral-600 p-8 z-[101] shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] dark:shadow-[8px_8px_0px_0px_rgba(255,255,255,0.1)]\"\n          >\n            <div className=\"flex justify-between items-start mb-6\">\n               <div className=\"flex items-center gap-3 text-black dark:text-white\">\n                  <Trash2 size={24} strokeWidth={2} />\n                  <h2 className=\"text-xl font-black uppercase tracking-wide\">{title}</h2>\n               </div>\n            </div>\n\n            <p className=\"text-gray-600 dark:text-neutral-400 font-medium mb-10 leading-relaxed\">\n              {message}\n            </p>\n\n            <div className=\"flex gap-4\">\n              <button \n                onClick={onCancel}\n                className=\"flex-1 py-3 border-2 border-gray-200 dark:border-neutral-700 font-bold hover:bg-gray-50 dark:hover:bg-neutral-800 transition-colors text-sm uppercase tracking-wider text-black dark:text-white\"\n              >\n                Cancel\n              </button>\n              <button \n                onClick={onConfirm}\n                className=\"flex-1 py-3 bg-black dark:bg-white text-white dark:text-black font-bold border-2 border-black dark:border-white hover:bg-gray-900 dark:hover:bg-gray-200 transition-colors text-sm uppercase tracking-wider\"\n              >\n                Confirm Delete\n              </button>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};"],"names":[],"mappings":";;;;;AACA;AAAA;AACA;;;;AAUO,MAAM,oBAAsD,CAAC,EAClE,MAAM,EACN,KAAK,EACL,OAAO,EACP,SAAS,EACT,QAAQ,EACT;IACC,qBACE,6LAAC,+MAAe;kBACb,wBACC;;8BACE,6LAAC,uMAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;oBAAE;oBACtB,SAAS;wBAAE,SAAS;oBAAE;oBACtB,MAAM;wBAAE,SAAS;oBAAE;oBACnB,WAAU;oBACV,SAAS;;;;;;8BAEX,6LAAC,uMAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBAC1C,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAG,GAAG;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBACvC,WAAU;;sCAEV,6LAAC;4BAAI,WAAU;sCACZ,cAAA,6LAAC;gCAAI,WAAU;;kDACZ,6LAAC,uNAAM;wCAAC,MAAM;wCAAI,aAAa;;;;;;kDAC/B,6LAAC;wCAAG,WAAU;kDAA8C;;;;;;;;;;;;;;;;;sCAIlE,6LAAC;4BAAE,WAAU;sCACV;;;;;;sCAGH,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;8CAGD,6LAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;;;AASf;KAtDa"}},
    {"offset": {"line": 1140, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/TextConnectorMenu.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { MoreVertical, Link2, X } from 'lucide-react';\r\n\r\ninterface TextConnectorMenuProps {\r\n    position: { top: number; left: number } | null;\r\n    onStartLinking: () => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const TextConnectorMenu: React.FC<TextConnectorMenuProps> = ({\r\n    position,\r\n    onStartLinking,\r\n    onClose\r\n}) => {\r\n    const [isExpanded, setIsExpanded] = React.useState(false);\r\n\r\n    if (!position) return null;\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            <motion.div\r\n                initial={{ opacity: 0, scale: 0.8 }}\r\n                animate={{ opacity: 1, scale: 1 }}\r\n                exit={{ opacity: 0, scale: 0.8 }}\r\n                transition={{ duration: 0.15, ease: 'easeOut' }}\r\n                className=\"connector-menu-container\"\r\n                style={{\r\n                    position: 'fixed',\r\n                    top: position.top,\r\n                    left: position.left + 8,\r\n                    zIndex: 100,\r\n                }}\r\n            >\r\n                {/* Main 3-dot button */}\r\n                <motion.button\r\n                    onClick={() => setIsExpanded(!isExpanded)}\r\n                    className=\"connector-menu-trigger\"\r\n                    whileHover={{ scale: 1.1 }}\r\n                    whileTap={{ scale: 0.95 }}\r\n                >\r\n                    <MoreVertical size={16} />\r\n                </motion.button>\r\n\r\n                {/* Expanded Menu */}\r\n                <AnimatePresence>\r\n                    {isExpanded && (\r\n                        <motion.div\r\n                            initial={{ opacity: 0, x: -10, scale: 0.9 }}\r\n                            animate={{ opacity: 1, x: 0, scale: 1 }}\r\n                            exit={{ opacity: 0, x: -10, scale: 0.9 }}\r\n                            transition={{ duration: 0.15 }}\r\n                            className=\"connector-menu-dropdown\"\r\n                        >\r\n                            <button\r\n                                onClick={() => {\r\n                                    onStartLinking();\r\n                                    setIsExpanded(false);\r\n                                }}\r\n                                className=\"connector-menu-item\"\r\n                            >\r\n                                <Link2 size={14} />\r\n                                <span>Interligar informaÃ§Ãµes</span>\r\n                            </button>\r\n                            <button\r\n                                onClick={() => {\r\n                                    onClose();\r\n                                    setIsExpanded(false);\r\n                                }}\r\n                                className=\"connector-menu-item connector-menu-item-cancel\"\r\n                            >\r\n                                <X size={14} />\r\n                                <span>Cancelar</span>\r\n                            </button>\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </motion.div>\r\n        </AnimatePresence>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AAAA;AAAA;;;AAJA;;;;AAYO,MAAM,oBAAsD,CAAC,EAChE,QAAQ,EACR,cAAc,EACd,OAAO,EACV;;IACG,MAAM,CAAC,YAAY,cAAc,GAAG,wKAAK,CAAC,QAAQ,CAAC;IAEnD,IAAI,CAAC,UAAU,OAAO;IAEtB,qBACI,6LAAC,+MAAe;kBACZ,cAAA,6LAAC,uMAAM,CAAC,GAAG;YACP,SAAS;gBAAE,SAAS;gBAAG,OAAO;YAAI;YAClC,SAAS;gBAAE,SAAS;gBAAG,OAAO;YAAE;YAChC,MAAM;gBAAE,SAAS;gBAAG,OAAO;YAAI;YAC/B,YAAY;gBAAE,UAAU;gBAAM,MAAM;YAAU;YAC9C,WAAU;YACV,OAAO;gBACH,UAAU;gBACV,KAAK,SAAS,GAAG;gBACjB,MAAM,SAAS,IAAI,GAAG;gBACtB,QAAQ;YACZ;;8BAGA,6LAAC,uMAAM,CAAC,MAAM;oBACV,SAAS,IAAM,cAAc,CAAC;oBAC9B,WAAU;oBACV,YAAY;wBAAE,OAAO;oBAAI;oBACzB,UAAU;wBAAE,OAAO;oBAAK;8BAExB,cAAA,6LAAC,6OAAY;wBAAC,MAAM;;;;;;;;;;;8BAIxB,6LAAC,+MAAe;8BACX,4BACG,6LAAC,uMAAM,CAAC,GAAG;wBACP,SAAS;4BAAE,SAAS;4BAAG,GAAG,CAAC;4BAAI,OAAO;wBAAI;wBAC1C,SAAS;4BAAE,SAAS;4BAAG,GAAG;4BAAG,OAAO;wBAAE;wBACtC,MAAM;4BAAE,SAAS;4BAAG,GAAG,CAAC;4BAAI,OAAO;wBAAI;wBACvC,YAAY;4BAAE,UAAU;wBAAK;wBAC7B,WAAU;;0CAEV,6LAAC;gCACG,SAAS;oCACL;oCACA,cAAc;gCAClB;gCACA,WAAU;;kDAEV,6LAAC,oNAAK;wCAAC,MAAM;;;;;;kDACb,6LAAC;kDAAK;;;;;;;;;;;;0CAEV,6LAAC;gCACG,SAAS;oCACL;oCACA,cAAc;gCAClB;gCACA,WAAU;;kDAEV,6LAAC,oMAAC;wCAAC,MAAM;;;;;;kDACT,6LAAC;kDAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQtC;GAtEa;KAAA"}},
    {"offset": {"line": 1318, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/BlockLinkingMode.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useRef, useCallback } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Check, Link2 } from 'lucide-react';\r\nimport { createPortal } from 'react-dom';\r\nimport { CONNECTION_COLORS } from '../../types';\r\n\r\ninterface BlockLinkingModeProps {\r\n    isActive: boolean;\r\n    sourceBlockId: string;\r\n    sourceNoteId: string;\r\n    selectedBlocks: Array<{ blockId: string; noteId: string }>;\r\n    onSelectBlock: (blockId: string, noteId: string) => void;\r\n    onConfirm: () => void;\r\n    onCancel: () => void;\r\n    currentColor: string;\r\n    onColorChange: (color: string) => void;\r\n}\r\n\r\nexport const BlockLinkingMode: React.FC<BlockLinkingModeProps> = ({\r\n    isActive,\r\n    sourceBlockId,\r\n    sourceNoteId,\r\n    selectedBlocks,\r\n    onSelectBlock,\r\n    onConfirm,\r\n    onCancel,\r\n    currentColor,\r\n    onColorChange\r\n}) => {\r\n    const svgRef = useRef<SVGSVGElement>(null);\r\n\r\n    // Draw connection lines between blocks\r\n    const drawConnections = useCallback(() => {\r\n        if (!svgRef.current || !isActive) return;\r\n\r\n        const svg = svgRef.current;\r\n        // Clear existing lines\r\n        while (svg.firstChild) {\r\n            svg.removeChild(svg.firstChild);\r\n        }\r\n\r\n        const sourceEl = document.getElementById(`block-${sourceBlockId}`);\r\n        if (!sourceEl) return;\r\n\r\n        const sourceRect = sourceEl.getBoundingClientRect();\r\n        const sourceX = sourceRect.left;\r\n        const sourceY = sourceRect.top + sourceRect.height / 2;\r\n\r\n        selectedBlocks.forEach(({ blockId }) => {\r\n            const targetEl = document.getElementById(`block-${blockId}`);\r\n            if (!targetEl || blockId === sourceBlockId) return;\r\n\r\n            const targetRect = targetEl.getBoundingClientRect();\r\n            const targetX = targetRect.left;\r\n            const targetY = targetRect.top + targetRect.height / 2;\r\n\r\n            // Create curved line\r\n            const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n            const midX = (sourceX + targetX) / 2;\r\n            const controlOffset = Math.abs(targetY - sourceY) * 0.3;\r\n\r\n            const d = `M ${sourceX} ${sourceY} \r\n                 C ${sourceX - controlOffset} ${sourceY}, \r\n                   ${targetX - controlOffset} ${targetY}, \r\n                   ${targetX} ${targetY}`;\r\n\r\n            line.setAttribute('d', d);\r\n            line.setAttribute('stroke', currentColor);\r\n            line.setAttribute('stroke-width', '2');\r\n            line.setAttribute('fill', 'none');\r\n            line.setAttribute('stroke-linecap', 'round');\r\n            line.setAttribute('class', 'connection-line-preview');\r\n\r\n            // Add animation\r\n            line.style.strokeDasharray = '1000';\r\n            line.style.strokeDashoffset = '1000';\r\n            line.style.animation = 'drawLine 0.5s ease forwards';\r\n\r\n            svg.appendChild(line);\r\n        });\r\n    }, [isActive, sourceBlockId, selectedBlocks, currentColor]);\r\n\r\n    useEffect(() => {\r\n        drawConnections();\r\n\r\n        // Redraw on scroll/resize\r\n        const handleUpdate = () => drawConnections();\r\n        window.addEventListener('scroll', handleUpdate, true);\r\n        window.addEventListener('resize', handleUpdate);\r\n\r\n        return () => {\r\n            window.removeEventListener('scroll', handleUpdate, true);\r\n            window.removeEventListener('resize', handleUpdate);\r\n        };\r\n    }, [drawConnections]);\r\n\r\n    // Handle escape key\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (e.key === 'Escape') onCancel();\r\n            if (e.key === 'Enter') onConfirm();\r\n        };\r\n\r\n        if (isActive) {\r\n            window.addEventListener('keydown', handleKeyDown);\r\n            return () => window.removeEventListener('keydown', handleKeyDown);\r\n        }\r\n    }, [isActive, onCancel, onConfirm]);\r\n\r\n    if (!isActive) return null;\r\n\r\n    return createPortal(\r\n        <>\r\n            {/* SVG overlay for connection lines */}\r\n            <svg\r\n                ref={svgRef}\r\n                className=\"block-linking-svg-overlay\"\r\n                style={{\r\n                    position: 'fixed',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: '100vw',\r\n                    height: '100vh',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 90,\r\n                }}\r\n            />\r\n\r\n            {/* Top bar with controls */}\r\n            <AnimatePresence>\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: -20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    exit={{ opacity: 0, y: -20 }}\r\n                    className=\"block-linking-toolbar\"\r\n                >\r\n                    <div className=\"block-linking-toolbar-content\">\r\n                        <div className=\"block-linking-info\">\r\n                            <Link2 size={16} className=\"text-white\" />\r\n                            <span>Modo de ligaÃ§Ã£o ativo</span>\r\n                            <span className=\"block-linking-count\">\r\n                                {selectedBlocks.length} bloco{selectedBlocks.length !== 1 ? 's' : ''} selecionado{selectedBlocks.length !== 1 ? 's' : ''}\r\n                            </span>\r\n                        </div>\r\n\r\n                        {/* Color picker */}\r\n                        <div className=\"block-linking-colors\">\r\n                            {CONNECTION_COLORS.map((color) => (\r\n                                <button\r\n                                    key={color}\r\n                                    onClick={() => onColorChange(color)}\r\n                                    className={`block-linking-color-btn ${currentColor === color ? 'active' : ''}`}\r\n                                    style={{ backgroundColor: color }}\r\n                                />\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div className=\"block-linking-actions\">\r\n                            <button\r\n                                onClick={onCancel}\r\n                                className=\"block-linking-btn block-linking-btn-cancel\"\r\n                            >\r\n                                <X size={16} />\r\n                                <span>Cancelar</span>\r\n                            </button>\r\n                            <button\r\n                                onClick={onConfirm}\r\n                                disabled={selectedBlocks.length === 0}\r\n                                className=\"block-linking-btn block-linking-btn-confirm\"\r\n                            >\r\n                                <Check size={16} />\r\n                                <span>Confirmar ({selectedBlocks.length})</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </motion.div>\r\n            </AnimatePresence>\r\n\r\n            {/* Hint at bottom */}\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                className=\"block-linking-hint\"\r\n            >\r\n                Clique nos blocos que deseja conectar â¢ <kbd>Enter</kbd> confirmar â¢ <kbd>Esc</kbd> cancelar\r\n            </motion.div>\r\n        </>,\r\n        document.body\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1651, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/BlockConnectionLines.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useRef, useCallback, useState } from 'react';\r\nimport { NoteBlock } from '../../types';\r\n\r\ninterface BlockConnectionLinesProps {\r\n    blocks: NoteBlock[];\r\n    containerRef: React.RefObject<HTMLDivElement | null>;\r\n}\r\n\r\nexport const BlockConnectionLines: React.FC<BlockConnectionLinesProps> = ({\r\n    blocks,\r\n    containerRef\r\n}) => {\r\n    const svgRef = useRef<SVGSVGElement>(null);\r\n    const [, setUpdateTrigger] = useState(0);\r\n\r\n    const drawConnections = useCallback(() => {\r\n        if (!svgRef.current || !containerRef.current) return;\r\n\r\n        const svg = svgRef.current;\r\n        const container = containerRef.current;\r\n        const containerRect = container.getBoundingClientRect();\r\n\r\n        // Clear existing lines\r\n        while (svg.firstChild) {\r\n            svg.removeChild(svg.firstChild);\r\n        }\r\n\r\n        // Draw connections for each block\r\n        blocks.forEach(block => {\r\n            if (!block.blockConnections || block.blockConnections.length === 0) return;\r\n\r\n            const sourceEl = document.getElementById(`block-${block.id}`);\r\n            if (!sourceEl) return;\r\n\r\n            const sourceRect = sourceEl.getBoundingClientRect();\r\n            // Position relative to container\r\n            const sourceX = sourceRect.left - containerRect.left - 12; // Left side with offset\r\n            const sourceY = sourceRect.top - containerRect.top + sourceRect.height / 2;\r\n\r\n            block.blockConnections.forEach(connection => {\r\n                const targetEl = document.getElementById(`block-${connection.targetBlockId}`);\r\n                if (!targetEl) return;\r\n\r\n                const targetRect = targetEl.getBoundingClientRect();\r\n                const targetX = targetRect.left - containerRect.left - 12;\r\n                const targetY = targetRect.top - containerRect.top + targetRect.height / 2;\r\n\r\n                // Create a group for the connection\r\n                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n\r\n                // Create curved line\r\n                const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n\r\n                // Calculate control points for a nice curve\r\n                const midY = (sourceY + targetY) / 2;\r\n                const curveOffset = Math.min(40, Math.abs(targetY - sourceY) * 0.3);\r\n\r\n                const d = `M ${sourceX} ${sourceY} \r\n                   C ${sourceX - curveOffset} ${sourceY}, \r\n                     ${targetX - curveOffset} ${targetY}, \r\n                     ${targetX} ${targetY}`;\r\n\r\n                line.setAttribute('d', d);\r\n                line.setAttribute('stroke', connection.color);\r\n                line.setAttribute('stroke-width', '2');\r\n                line.setAttribute('fill', 'none');\r\n                line.setAttribute('stroke-linecap', 'round');\r\n                line.setAttribute('class', 'permanent-connection-line');\r\n                line.style.filter = `drop-shadow(0 0 3px ${connection.color}40)`;\r\n\r\n                // Add dots at connection points\r\n                const sourceDot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n                sourceDot.setAttribute('cx', String(sourceX));\r\n                sourceDot.setAttribute('cy', String(sourceY));\r\n                sourceDot.setAttribute('r', '4');\r\n                sourceDot.setAttribute('fill', connection.color);\r\n                sourceDot.style.filter = `drop-shadow(0 0 4px ${connection.color})`;\r\n\r\n                const targetDot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n                targetDot.setAttribute('cx', String(targetX));\r\n                targetDot.setAttribute('cy', String(targetY));\r\n                targetDot.setAttribute('r', '4');\r\n                targetDot.setAttribute('fill', connection.color);\r\n                targetDot.style.filter = `drop-shadow(0 0 4px ${connection.color})`;\r\n\r\n                group.appendChild(line);\r\n                group.appendChild(sourceDot);\r\n                group.appendChild(targetDot);\r\n                svg.appendChild(group);\r\n            });\r\n        });\r\n    }, [blocks, containerRef]);\r\n\r\n    // Redraw on mount and when blocks change\r\n    useEffect(() => {\r\n        // Small delay to ensure DOM elements are rendered\r\n        const timeoutId = setTimeout(() => {\r\n            drawConnections();\r\n        }, 100);\r\n\r\n        return () => clearTimeout(timeoutId);\r\n    }, [drawConnections]);\r\n\r\n    // Redraw on scroll and resize\r\n    useEffect(() => {\r\n        const handleUpdate = () => {\r\n            setUpdateTrigger(prev => prev + 1);\r\n            drawConnections();\r\n        };\r\n\r\n        window.addEventListener('scroll', handleUpdate, true);\r\n        window.addEventListener('resize', handleUpdate);\r\n\r\n        // Also use ResizeObserver for container changes\r\n        const resizeObserver = new ResizeObserver(handleUpdate);\r\n        if (containerRef.current) {\r\n            resizeObserver.observe(containerRef.current);\r\n        }\r\n\r\n        return () => {\r\n            window.removeEventListener('scroll', handleUpdate, true);\r\n            window.removeEventListener('resize', handleUpdate);\r\n            resizeObserver.disconnect();\r\n        };\r\n    }, [drawConnections, containerRef]);\r\n\r\n    // Check if there are any connections to render\r\n    const hasConnections = blocks.some(b => b.blockConnections && b.blockConnections.length > 0);\r\n\r\n    if (!hasConnections) return null;\r\n\r\n    return (\r\n        <svg\r\n            ref={svgRef}\r\n            className=\"block-connections-svg\"\r\n            style={{\r\n                position: 'absolute',\r\n                top: 0,\r\n                left: 0,\r\n                width: '100%',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                zIndex: 1,\r\n                overflow: 'visible',\r\n            }}\r\n        />\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1815, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/NoteSelectorModal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Note } from '../../types';\r\nimport { X, Link2, Search, StickyNote } from 'lucide-react';\r\n\r\ninterface NoteSelectorModalProps {\r\n    isOpen: boolean;\r\n    currentNoteId: string;\r\n    allNotes: Note[];\r\n    onSelectNote: (targetNoteId: string) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const NoteSelectorModal: React.FC<NoteSelectorModalProps> = ({\r\n    isOpen,\r\n    currentNoteId,\r\n    allNotes,\r\n    onSelectNote,\r\n    onClose\r\n}) => {\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n\r\n    // Filter out current note and apply search\r\n    const availableNotes = allNotes.filter(note => {\r\n        if (note.id === currentNoteId) return false;\r\n        if (!searchQuery) return true;\r\n\r\n        const titleMatch = note.title.toLowerCase().includes(searchQuery.toLowerCase());\r\n        const contentMatch = note.blocks.some(b =>\r\n            b.content.toLowerCase().includes(searchQuery.toLowerCase())\r\n        );\r\n        return titleMatch || contentMatch;\r\n    });\r\n\r\n    // Strip HTML for preview\r\n    const stripHtml = (html: string) => {\r\n        const tmp = document.createElement('div');\r\n        tmp.innerHTML = html;\r\n        return tmp.textContent || tmp.innerText || '';\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <>\r\n            {/* Backdrop */}\r\n            <motion.div\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n                className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[100]\"\r\n                onClick={onClose}\r\n            />\r\n\r\n            {/* Modal */}\r\n            <motion.div\r\n                initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[101] w-full max-w-md\"\r\n            >\r\n                <div className=\"bg-white dark:bg-neutral-900 rounded-2xl shadow-2xl border border-gray-200 dark:border-neutral-700 overflow-hidden\">\r\n                    {/* Header */}\r\n                    <div className=\"flex items-center justify-between p-4 border-b border-gray-100 dark:border-neutral-800\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg\">\r\n                                <Link2 size={18} className=\"text-blue-600 dark:text-blue-400\" />\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"font-bold text-lg text-black dark:text-white\">Conectar Nota</h2>\r\n                                <p className=\"text-xs text-gray-500 dark:text-neutral-400\">Selecione uma nota para conectar</p>\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded-lg transition-colors\"\r\n                        >\r\n                            <X size={18} className=\"text-gray-500 dark:text-neutral-400\" />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Search */}\r\n                    <div className=\"p-4 border-b border-gray-100 dark:border-neutral-800\">\r\n                        <div className=\"relative\">\r\n                            <Search size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-neutral-500\" />\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Buscar notas...\"\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                                className=\"w-full pl-10 pr-4 py-2.5 bg-gray-50 dark:bg-neutral-800 border border-gray-200 dark:border-neutral-700 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 text-black dark:text-white placeholder-gray-400 dark:placeholder-neutral-500\"\r\n                                autoFocus\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Notes List */}\r\n                    <div className=\"max-h-[300px] overflow-y-auto\">\r\n                        {availableNotes.length === 0 ? (\r\n                            <div className=\"p-8 text-center\">\r\n                                <StickyNote size={32} className=\"mx-auto text-gray-300 dark:text-neutral-600 mb-2\" />\r\n                                <p className=\"text-sm text-gray-500 dark:text-neutral-400\">\r\n                                    {searchQuery ? 'Nenhuma nota encontrada' : 'NÃ£o hÃ¡ outras notas disponÃ­veis'}\r\n                                </p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"p-2\">\r\n                                {availableNotes.map((note) => (\r\n                                    <motion.button\r\n                                        key={note.id}\r\n                                        whileHover={{ x: 4 }}\r\n                                        whileTap={{ scale: 0.98 }}\r\n                                        onClick={() => {\r\n                                            onSelectNote(note.id);\r\n                                            onClose();\r\n                                        }}\r\n                                        className=\"w-full p-3 flex items-start gap-3 hover:bg-gray-50 dark:hover:bg-neutral-800 rounded-xl transition-colors text-left group\"\r\n                                    >\r\n                                        {/* Color Indicator */}\r\n                                        <div\r\n                                            className=\"w-3 h-3 rounded-full flex-shrink-0 mt-1 ring-2 ring-offset-2 ring-offset-white dark:ring-offset-neutral-900 ring-transparent group-hover:ring-current transition-all\"\r\n                                            style={{ backgroundColor: note.color || '#6b7280' }}\r\n                                        />\r\n\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <h3\r\n                                                className=\"font-semibold text-sm text-black dark:text-white truncate\"\r\n                                                dangerouslySetInnerHTML={{ __html: stripHtml(note.title) || 'Untitled' }}\r\n                                            />\r\n                                            <p className=\"text-xs text-gray-500 dark:text-neutral-400 line-clamp-2 mt-0.5\">\r\n                                                {note.blocks[0] ? stripHtml(note.blocks[0].content).substring(0, 80) : 'No content'}\r\n                                                {note.blocks[0] && stripHtml(note.blocks[0].content).length > 80 ? '...' : ''}\r\n                                            </p>\r\n\r\n                                            {/* Tags */}\r\n                                            {note.tags && note.tags.length > 0 && (\r\n                                                <div className=\"flex gap-1 mt-1.5\">\r\n                                                    {note.tags.slice(0, 2).map(tag => (\r\n                                                        <span\r\n                                                            key={tag}\r\n                                                            className=\"text-[10px] font-medium bg-gray-100 dark:bg-neutral-700 text-gray-600 dark:text-neutral-300 px-1.5 py-0.5 rounded\"\r\n                                                        >\r\n                                                            #{tag}\r\n                                                        </span>\r\n                                                    ))}\r\n                                                    {note.tags.length > 2 && (\r\n                                                        <span className=\"text-[10px] text-gray-400 dark:text-neutral-500\">\r\n                                                            +{note.tags.length - 2}\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {/* Connection indicator if already connected */}\r\n                                        {note.connections?.length > 0 && (\r\n                                            <span className=\"text-[10px] font-medium text-gray-400 dark:text-neutral-500\">\r\n                                                {note.connections.length} conexÃµes\r\n                                            </span>\r\n                                        )}\r\n                                    </motion.button>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Footer hint */}\r\n                    <div className=\"p-3 border-t border-gray-100 dark:border-neutral-800 bg-gray-50 dark:bg-neutral-800/50\">\r\n                        <p className=\"text-[10px] text-center text-gray-400 dark:text-neutral-500\">\r\n                            A conexÃ£o aparecerÃ¡ no Canvas entre as notas\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n        </>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2177, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/EditorView.tsx"],"sourcesContent":["import React, { useState, useCallback, useEffect, useMemo, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Note, NoteBlock, Tag, BlockConnection, CONNECTION_COLORS } from '../../types';\nimport { getTags } from '../../app/actions';\nimport { NOTE_COLORS, BLOCK_HIGHLIGHT_COLORS } from '../../constants';\nimport {\n  Plus, Trash2, Sparkles,\n  Heading1, Type, List, CheckSquare, Quote, Code, Image as ImageIcon,\n  Bold, Italic, Strikethrough, Palette, Hash, X, Copy, Check, Save, Highlighter, Underline, Link as LinkIcon,\n  ChevronDown\n} from 'lucide-react';\nimport { expandNoteWithAI } from '../../services/geminiService';\nimport { HistoryMode } from '../../hooks/useHistory';\nimport { ContentBlock } from './ContentBlock';\nimport { ImageBlock } from './ImageBlock';\nimport { ConfirmationModal } from '../ui/ConfirmationModal';\nimport { TextConnectorMenu } from './TextConnectorMenu';\nimport { BlockLinkingMode } from './BlockLinkingMode';\nimport { BlockConnectionLines } from './BlockConnectionLines';\nimport { NoteSelectorModal } from './NoteSelectorModal';\n\ninterface EditorViewProps {\n  activeNote: Note | null;\n  onUpdateNote: (updatedNote: Note, mode?: HistoryMode) => void;\n  onDeleteNote: (id: string) => void;\n  hasUnsavedChanges: boolean;\n  onSave: () => void;\n  allNotes?: Note[]; // All notes for connection selector\n  onConnectNotes?: (sourceId: string, targetId: string) => void; // Connect notes function\n}\n\nexport const EditorView: React.FC<EditorViewProps> = ({\n  activeNote,\n  onUpdateNote,\n  onDeleteNote,\n  hasUnsavedChanges,\n  onSave,\n  allNotes = [],\n  onConnectNotes\n}) => {\n  const [isAiLoading, setIsAiLoading] = useState(false);\n  const editorRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const blocksContainerRef = useRef<HTMLDivElement>(null);\n\n  // Slash Menu State\n  const [slashMenuOpen, setSlashMenuOpen] = useState(false);\n  const [slashMenuPosition, setSlashMenuPosition] = useState({ top: 0, left: 0 });\n  const [slashBlockId, setSlashBlockId] = useState<string | null>(null);\n  const [slashFilter, setSlashFilter] = useState('');\n\n  // Formatting Toolbar State\n  const [formatToolbarPosition, setFormatToolbarPosition] = useState<{ top: number; left: number } | null>(null);\n\n  // Block Highlight Color Picker State\n  const [highlightPickerOpen, setHighlightPickerOpen] = useState(false);\n\n  // Color Picker State\n  const [colorPickerOpen, setColorPickerOpen] = useState(false);\n\n  // Tag Selector State\n  const [isTagSelectorOpen, setIsTagSelectorOpen] = useState(false);\n  const [availableTags, setAvailableTags] = useState<Tag[]>([]);\n\n  // Load available tags\n  useEffect(() => {\n    const loadTags = async () => {\n      const tags = await getTags();\n      setAvailableTags(tags);\n    };\n    loadTags();\n  }, []);\n\n  // Focus Management\n  const [focusedBlockId, setFocusedBlockId] = useState<string | null>(null);\n\n  // Copy Feedback State\n  const [copiedBlockId, setCopiedBlockId] = useState<string | null>(null);\n\n  // Image Deletion Modal State\n  const [imageToDelete, setImageToDelete] = useState<string | null>(null);\n\n  // Link Paste Modal State\n  const [linkPasteModal, setLinkPasteModal] = useState<{\n    url: string;\n    position: { top: number; left: number };\n    blockId: string;\n  } | null>(null);\n\n  // Font Selector State\n  const [fontDropdownOpen, setFontDropdownOpen] = useState(false);\n\n  // Connector Menu State\n  const [connectorMenuPosition, setConnectorMenuPosition] = useState<{ top: number; left: number } | null>(null);\n\n  // Note Selector Modal State (for connecting notes)\n  const [isNoteSelectorOpen, setIsNoteSelectorOpen] = useState(false);\n\n  // Block Linking Mode State (legacy - keeping for potential future use)\n  const [isBlockLinkingMode, setIsBlockLinkingMode] = useState(false);\n  const [sourceBlockForLinking, setSourceBlockForLinking] = useState<string | null>(null);\n  const [selectedBlocksForLinking, setSelectedBlocksForLinking] = useState<Array<{ blockId: string; noteId: string }>>([]);\n  const [currentLinkColor, setCurrentLinkColor] = useState(CONNECTION_COLORS[0]);\n\n  // Available fonts\n  const AVAILABLE_FONTS = [\n    { name: 'Inter', value: 'var(--font-inter), sans-serif' },\n    { name: 'Montserrat', value: 'var(--font-montserrat), sans-serif' },\n    { name: 'Poppins', value: 'var(--font-poppins), sans-serif' },\n    { name: 'Open Sans', value: 'var(--font-open-sans), sans-serif' },\n    { name: 'Roboto', value: 'var(--font-roboto), sans-serif' },\n    { name: 'Lato', value: 'var(--font-lato), sans-serif' },\n    { name: 'Playfair Display', value: 'var(--font-playfair), serif' },\n    { name: 'Raleway', value: 'var(--font-raleway), sans-serif' },\n    { name: 'Source Sans', value: 'var(--font-source-sans), sans-serif' },\n    { name: 'Nunito', value: 'var(--font-nunito), sans-serif' },\n    { name: 'Merriweather', value: 'var(--font-merriweather), serif' },\n  ];\n\n  // Typing detection refs\n  const isTypingRef = useRef(false);\n  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n\n  // Close menus on click outside\n  useEffect(() => {\n    const handleClick = (e: MouseEvent) => {\n      setSlashMenuOpen(false);\n      // Only close color picker if clicking outside the color picker UI\n      if (!(e.target as HTMLElement).closest('.color-picker-container')) {\n        setColorPickerOpen(false);\n      }\n      if (!(e.target as HTMLElement).closest('.tag-selector-container')) {\n        setIsTagSelectorOpen(false);\n      }\n      // Close font dropdown on outside click\n      if (!(e.target as HTMLElement).closest('.font-dropdown-container')) {\n        setFontDropdownOpen(false);\n      }\n    };\n    window.addEventListener('click', handleClick);\n    return () => window.removeEventListener('click', handleClick);\n  }, []);\n\n  // Handle Selection for Formatting Toolbar\n  useEffect(() => {\n    const handleSelectionChange = () => {\n      const selection = window.getSelection();\n\n      // Validate selection\n      // Don't hide toolbar if font dropdown is open (keeps selection visible while choosing font)\n      if (!selection || selection.isCollapsed || !editorRef.current) {\n        // Only hide if font dropdown is not open\n        if (!fontDropdownOpen) {\n          setFormatToolbarPosition(null);\n        }\n        return;\n      }\n\n      // Check if selection anchor is descendant of editor\n      let node = selection.anchorNode;\n      let isInside = false;\n      while (node) {\n        if (node === editorRef.current) {\n          isInside = true;\n          break;\n        }\n        node = node.parentNode;\n      }\n\n      if (!isInside) {\n        setFormatToolbarPosition(null);\n        return;\n      }\n\n      const range = selection.getRangeAt(0);\n      const rect = range.getBoundingClientRect();\n\n      // Only show if we have a visible width and aren't in a menu interaction\n      if (rect.width > 1 && !slashMenuOpen && !isBlockLinkingMode) {\n        setFormatToolbarPosition({\n          // Ensure it doesn't go off-screen top\n          top: Math.max(10, rect.top - 60),\n          left: rect.left + rect.width / 2\n        });\n        // Also set connector menu position (to the right of selection)\n        setConnectorMenuPosition({\n          top: rect.top + rect.height / 2 - 14,\n          left: rect.right + 4\n        });\n      } else {\n        setFormatToolbarPosition(null);\n        setConnectorMenuPosition(null);\n      }\n    };\n\n    document.addEventListener('selectionchange', handleSelectionChange);\n    document.addEventListener('scroll', handleSelectionChange, true);\n\n    return () => {\n      document.removeEventListener('selectionchange', handleSelectionChange);\n      document.removeEventListener('scroll', handleSelectionChange, true);\n    };\n  }, [slashMenuOpen, fontDropdownOpen, isBlockLinkingMode]);\n\n\n\n  if (!activeNote) {\n    return (\n      <div className=\"h-full flex items-center justify-center text-muted-foreground dark:text-neutral-400\">\n        <p>Select a note from the canvas or graph to edit.</p>\n      </div>\n    );\n  }\n\n  // --- Note Connection Functions ---\n\n  const handleStartNoteConnection = () => {\n    setConnectorMenuPosition(null);\n    setFormatToolbarPosition(null);\n    setIsNoteSelectorOpen(true);\n  };\n\n  const handleConnectToNote = (targetNoteId: string) => {\n    if (onConnectNotes && activeNote) {\n      onConnectNotes(activeNote.id, targetNoteId);\n    }\n    setIsNoteSelectorOpen(false);\n  };\n\n  // --- Block Linking Functions (legacy) ---\n\n  const handleStartBlockLinking = () => {\n    if (!focusedBlockId) return;\n    setIsBlockLinkingMode(true);\n    setSourceBlockForLinking(focusedBlockId);\n    setSelectedBlocksForLinking([]);\n    setConnectorMenuPosition(null);\n    setFormatToolbarPosition(null);\n  };\n\n  const handleBlockClickForLinking = (blockId: string) => {\n    if (!isBlockLinkingMode || blockId === sourceBlockForLinking) return;\n\n    const isSelected = selectedBlocksForLinking.some(b => b.blockId === blockId);\n    if (isSelected) {\n      setSelectedBlocksForLinking(prev => prev.filter(b => b.blockId !== blockId));\n    } else {\n      setSelectedBlocksForLinking(prev => [...prev, { blockId, noteId: activeNote.id }]);\n    }\n  };\n\n  const handleConfirmBlockLinking = () => {\n    if (!sourceBlockForLinking || selectedBlocksForLinking.length === 0) {\n      handleCancelBlockLinking();\n      return;\n    }\n\n    // Create connections from source to all selected blocks\n    const newConnections: BlockConnection[] = selectedBlocksForLinking.map(target => ({\n      id: crypto.randomUUID(),\n      targetBlockId: target.blockId,\n      targetNoteId: target.noteId !== activeNote.id ? target.noteId : undefined,\n      color: currentLinkColor,\n      createdAt: Date.now()\n    }));\n\n    // Update the source block with new connections\n    const newBlocks = activeNote.blocks.map(block => {\n      if (block.id === sourceBlockForLinking) {\n        return {\n          ...block,\n          blockConnections: [...(block.blockConnections || []), ...newConnections]\n        };\n      }\n      return block;\n    });\n\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n    handleCancelBlockLinking();\n  };\n\n  const handleCancelBlockLinking = () => {\n    setIsBlockLinkingMode(false);\n    setSourceBlockForLinking(null);\n    setSelectedBlocksForLinking([]);\n  };\n\n\n  // --- Helper Functions ---\n\n  const handleTextChange = (updater: (n: Note) => Note) => {\n    const mode: HistoryMode = isTypingRef.current ? 'REPLACE' : 'PUSH';\n    if (timeoutRef.current) clearTimeout(timeoutRef.current);\n    isTypingRef.current = true;\n    timeoutRef.current = setTimeout(() => {\n      isTypingRef.current = false;\n    }, 1000);\n    onUpdateNote(updater(activeNote), mode);\n  };\n\n  const updateBlockContent = useCallback((id: string, html: string) => {\n    // Check for Slash Command\n    if (html.endsWith('/')) {\n      const selection = window.getSelection();\n      if (selection && selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const rect = range.getBoundingClientRect();\n        setSlashMenuPosition({ top: rect.bottom + window.scrollY, left: rect.left + window.scrollX });\n        setSlashMenuOpen(true);\n        setSlashBlockId(id);\n        setSlashFilter('');\n      }\n    } else if (slashMenuOpen) {\n      // Update filter if menu is open\n      const text = html.replace(/<[^>]*>?/gm, '');\n      const parts = text.split('/');\n      setSlashFilter(parts[parts.length - 1] || '');\n    }\n\n    // We can't use handleTextChange directly inside useCallback if it's not stable.\n    // But handleTextChange depends on activeNote, so it changes every render.\n    // To make updateBlockContent stable, we need to avoid closing over unstable deps.\n    // However, for now, let's just use the functional update pattern where possible.\n\n    if (!activeNote) return;\n\n    const newBlocks = activeNote.blocks.map(b =>\n      b.id === id ? { ...b, content: html } : b\n    );\n\n    // Optimization: Only update if content actually changed\n    const block = activeNote.blocks.find(b => b.id === id);\n    if (block && block.content === html) return;\n\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n  }, [activeNote, onUpdateNote, slashMenuOpen]);\n\n  const updateBlockType = (id: string, type: NoteBlock['type']) => {\n    handleTextChange(note => ({\n      ...note,\n      blocks: note.blocks.map(b => {\n        if (b.id === id) {\n          const cleanContent = b.content.replace(/\\/[\\w]*$/, '');\n          return { ...b, type, content: cleanContent };\n        }\n        return b;\n      })\n    }));\n    setSlashMenuOpen(false);\n    setTimeout(() => {\n      document.getElementById(`block-${id}`)?.focus();\n    }, 0);\n  };\n\n  const addBlock = useCallback((afterId: string, type: NoteBlock['type'] = 'paragraph') => {\n    if (!activeNote) return;\n    const newBlock: NoteBlock = {\n      id: crypto.randomUUID(),\n      type,\n      content: ''\n    };\n    const index = activeNote.blocks.findIndex(b => b.id === afterId);\n    const newBlocks = [...activeNote.blocks];\n    newBlocks.splice(index + 1, 0, newBlock);\n\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n    setFocusedBlockId(newBlock.id);\n  }, [activeNote, onUpdateNote]);\n\n  const deleteBlock = useCallback((id: string) => {\n    if (!activeNote) return;\n    const index = activeNote.blocks.findIndex(b => b.id === id);\n    const prevBlock = activeNote.blocks[index - 1];\n    let newBlocks = activeNote.blocks.filter(b => b.id !== id);\n\n    // If we deleted the last block, add an empty paragraph\n    if (newBlocks.length === 0) {\n      const newId = crypto.randomUUID();\n      newBlocks = [{\n        id: newId,\n        type: 'paragraph',\n        content: ''\n      }];\n      // Focus the new empty block\n      setTimeout(() => setFocusedBlockId(newId), 0);\n    }\n\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n\n    if (prevBlock) {\n      setFocusedBlockId(prevBlock.id);\n    }\n  }, [activeNote, onUpdateNote]);\n\n  const handleBlockKeyDown = useCallback((e: React.KeyboardEvent, id: string) => {\n    if (!activeNote) return;\n\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      const currentBlock = activeNote.blocks.find(b => b.id === id);\n      const nextType = currentBlock?.type === 'bullet' ? 'bullet' : 'paragraph';\n      addBlock(id, nextType);\n      setSlashMenuOpen(false);\n    } else if (e.key === 'Backspace') {\n      const element = e.currentTarget as HTMLElement;\n      const selection = window.getSelection();\n      if (!selection || selection.rangeCount === 0) return;\n\n      const range = selection.getRangeAt(0);\n      // Check if collapsed is usually enough, but we want to be sure we are at the start.\n      if (!range.collapsed) return;\n\n      // Check if cursor is at the start of the block content\n      const rangeCopy = range.cloneRange();\n      rangeCopy.selectNodeContents(element);\n      rangeCopy.setEnd(range.startContainer, range.startOffset);\n      const isAtStart = rangeCopy.toString().length === 0;\n\n      if (isAtStart) {\n        const index = activeNote.blocks.findIndex(b => b.id === id);\n        // Only merge/delete if not the first block\n        if (index > 0) {\n          e.preventDefault();\n          const currentBlock = activeNote.blocks[index];\n          const prevBlock = activeNote.blocks[index - 1];\n\n          // Merge current block content into previous block\n          const newContent = prevBlock.content + currentBlock.content;\n\n          const newBlocks = [...activeNote.blocks];\n          newBlocks[index - 1] = { ...prevBlock, content: newContent };\n          newBlocks.splice(index, 1);\n\n          onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n          setFocusedBlockId(prevBlock.id);\n        }\n      }\n    }\n  }, [activeNote, addBlock, onUpdateNote]);\n\n  const handleTitleChange = (html: string) => {\n    handleTextChange(note => ({ ...note, title: html }));\n  };\n\n  const handleAiEnhance = async () => {\n    setIsAiLoading(true);\n\n    const selection = window.getSelection();\n    const selectedText = selection ? selection.toString() : '';\n    const hasSelection = selectedText.trim().length > 0;\n\n    const context = hasSelection\n      ? selectedText\n      : activeNote.blocks.map(b => b.content).join('\\n');\n\n    const result = await expandNoteWithAI(context);\n\n    const newBlock: NoteBlock = {\n      id: crypto.randomUUID(),\n      type: 'paragraph',\n      content: result\n    };\n\n    let newBlocks = [...activeNote.blocks];\n\n    // If text was selected, insert the expanded content after the focused block\n    if (hasSelection && focusedBlockId) {\n      const index = newBlocks.findIndex(b => b.id === focusedBlockId);\n      if (index !== -1) {\n        newBlocks.splice(index + 1, 0, newBlock);\n      } else {\n        newBlocks.push(newBlock);\n      }\n    } else {\n      newBlocks.push(newBlock);\n    }\n\n    onUpdateNote({\n      ...activeNote,\n      blocks: newBlocks\n    }, 'PUSH');\n    setIsAiLoading(false);\n  };\n\n  const formatText = (command: string) => {\n    document.execCommand(command);\n  };\n\n  const handleColorChange = (color: string) => {\n    onUpdateNote({ ...activeNote, color }, 'PUSH');\n    setColorPickerOpen(false);\n  };\n\n  const handleBlockHighlightChange = (blockId: string, highlightColor: string) => {\n    const newBlocks = activeNote.blocks.map(b =>\n      b.id === blockId ? { ...b, highlightColor: highlightColor === 'transparent' ? undefined : highlightColor } : b\n    );\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n    setHighlightPickerOpen(false);\n  };\n\n  const handleSelectTag = (tagName: string) => {\n    const currentTags = activeNote.tags || [];\n    if (!currentTags.includes(tagName)) {\n      const updatedTags = [...currentTags, tagName];\n      onUpdateNote({ ...activeNote, tags: updatedTags }, 'PUSH');\n    }\n    setIsTagSelectorOpen(false);\n  };\n\n  const handleRemoveTag = (tagToRemove: string) => {\n    const updatedTags = activeNote.tags?.filter(t => t !== tagToRemove) || [];\n    onUpdateNote({ ...activeNote, tags: updatedTags }, 'PUSH');\n  };\n\n  const handleCopyBlock = (id: string, htmlContent: string) => {\n    const temp = document.createElement('div');\n    temp.innerHTML = htmlContent;\n    const text = temp.textContent || temp.innerText || \"\";\n    navigator.clipboard.writeText(text);\n    setCopiedBlockId(id);\n    setTimeout(() => setCopiedBlockId(null), 2000);\n  };\n\n  const handleFileUpload = useCallback(async (file: File, targetBlockId?: string) => {\n    // 1. Create optimistic block with local preview\n    const objectUrl = URL.createObjectURL(file);\n    const tempId = crypto.randomUUID();\n\n    const newBlock: NoteBlock = {\n      id: tempId,\n      type: 'image',\n      content: objectUrl\n    };\n\n    // 2. Insert immediately\n    // We need to use the functional update form of onUpdateNote if possible, or access the latest activeNote.\n    // Since onUpdateNote doesn't support functional update for the whole note in this props interface,\n    // we rely on activeNote being fresh.\n    if (!activeNote) return;\n\n    let newBlocks = [...activeNote.blocks];\n    if (targetBlockId) {\n      newBlocks = newBlocks.map(b => b.id === targetBlockId ? newBlock : b);\n    } else if (focusedBlockId) {\n      const index = newBlocks.findIndex(b => b.id === focusedBlockId);\n      if (index !== -1) {\n        newBlocks.splice(index + 1, 0, newBlock);\n      } else {\n        newBlocks.push(newBlock);\n      }\n    } else {\n      newBlocks.push(newBlock);\n    }\n\n    // Update UI immediately with local preview\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n\n    // 3. Upload in background\n    const formData = new FormData();\n    formData.append('file', file);\n\n    try {\n      const res = await fetch('/api/upload', {\n        method: 'POST',\n        body: formData\n      });\n      const data = await res.json();\n\n      if (data.url) {\n        // 4. Update block with real URL\n        // We need to find the block again in the *latest* state.\n        // Since we can't easily access the latest state here without a ref or functional update,\n        // we will do our best with the captured scope, but this is a known limitation without a refactor.\n        // Ideally, we would use a ref for activeNote.\n\n        // However, for the purpose of this task (performance), the optimistic UI is key.\n        // The risk of overwriting is low if the user isn't typing furiously *exactly* when the upload finishes.\n\n        const updatedBlocks = newBlocks.map(b =>\n          b.id === tempId ? { ...b, content: data.url } : b\n        );\n\n        onUpdateNote({ ...activeNote, blocks: updatedBlocks }, 'PUSH');\n      }\n    } catch (e) {\n      console.error('Upload failed', e);\n      // Optionally show error state on block\n    } finally {\n      URL.revokeObjectURL(objectUrl);\n    }\n  }, [activeNote, focusedBlockId, onUpdateNote]);\n\n  const handlePaste = (e: React.ClipboardEvent) => {\n    // Check for images first\n    if (e.clipboardData.files.length > 0) {\n      const files = Array.from(e.clipboardData.files).filter(f => f.type.startsWith('image/'));\n      if (files.length > 0) {\n        e.preventDefault();\n        files.forEach(file => handleFileUpload(file, focusedBlockId || undefined));\n        return;\n      }\n    }\n\n    // Check for URL in pasted text\n    const text = e.clipboardData.getData('text/plain');\n    const urlRegex = /^(https?:\\/\\/[^\\s]+)$/i;\n\n    if (urlRegex.test(text.trim())) {\n      e.preventDefault();\n\n      let modalTop = 200;\n      let modalLeft = 400;\n\n      // Try to get position from selection\n      const selection = window.getSelection();\n      if (selection && selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const rect = range.getBoundingClientRect();\n\n        // Check if we got a valid position from the range\n        if (rect.top > 0 && rect.left > 0) {\n          modalTop = rect.bottom + 20;\n          modalLeft = rect.right + 30;\n        } else {\n          // Fallback 1: Try to use the active element (where cursor is)\n          const activeElement = document.activeElement;\n          if (activeElement && activeElement instanceof HTMLElement) {\n            const activeRect = activeElement.getBoundingClientRect();\n            if (activeRect.top > 0 && activeRect.left > 0) {\n              modalTop = activeRect.bottom + 20;\n              modalLeft = activeRect.right + 30;\n            }\n          }\n\n          // Fallback 2: If still no valid position, use anchor node's parent\n          if (modalTop === 200 && selection.anchorNode) {\n            const parentElement = selection.anchorNode.nodeType === Node.TEXT_NODE\n              ? selection.anchorNode.parentElement\n              : selection.anchorNode as HTMLElement;\n            if (parentElement) {\n              const parentRect = parentElement.getBoundingClientRect();\n              if (parentRect.top > 0 || parentRect.left > 0) {\n                modalTop = parentRect.bottom + 20;\n                modalLeft = parentRect.right + 30;\n              }\n            }\n          }\n        }\n      }\n\n      setLinkPasteModal({\n        url: text.trim(),\n        position: {\n          top: modalTop,\n          left: modalLeft\n        },\n        blockId: focusedBlockId || ''\n      });\n    }\n  };\n\n  // Handle link paste option selection\n  const handleLinkPasteOption = async (option: 'mention' | 'embed' | 'bookmark' | 'url') => {\n    if (!linkPasteModal || !activeNote) return;\n\n    const { url, blockId } = linkPasteModal;\n    let content = '';\n\n    // YouTube API key\n    const YOUTUBE_API_KEY = 'AIzaSyB2BmcpR3bhQGSlWZeYkDW5sfjPOSdVpUA';\n\n    // Helper to extract YouTube video ID from URL\n    const getYouTubeVideoId = (youtubeUrl: string): string | null => {\n      try {\n        const urlObj = new URL(youtubeUrl);\n        if (urlObj.hostname.includes('youtu.be')) {\n          return urlObj.pathname.slice(1);\n        }\n        if (urlObj.hostname.includes('youtube.com')) {\n          return urlObj.searchParams.get('v');\n        }\n      } catch { }\n      return null;\n    };\n\n    // Helper to fetch YouTube video title\n    const fetchYouTubeTitle = async (videoId: string): Promise<string> => {\n      try {\n        const response = await fetch(\n          `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${YOUTUBE_API_KEY}`\n        );\n        const data = await response.json();\n        if (data.items && data.items.length > 0) {\n          return data.items[0].snippet.title;\n        }\n      } catch (error) {\n        console.error('Failed to fetch YouTube title:', error);\n      }\n      return 'Video';\n    };\n\n    // Helper to extract Twitter/X username from URL\n    const getTwitterUsername = (twitterUrl: string): string | null => {\n      try {\n        const urlObj = new URL(twitterUrl);\n        const pathParts = urlObj.pathname.split('/').filter(Boolean);\n        if (pathParts.length > 0 && pathParts[0] !== 'status') {\n          return pathParts[0];\n        }\n      } catch { }\n      return null;\n    };\n\n    // Helper to get platform info from URL\n    const getPlatformInfo = async (linkUrl: string): Promise<{ logo: string; name: string; platform: string; cssClass: string }> => {\n      try {\n        const urlObj = new URL(linkUrl);\n        const hostname = urlObj.hostname.replace('www.', '');\n        const pathParts = urlObj.pathname.split('/').filter(Boolean);\n\n        // Platform SVG icons (inline, compact)\n        const icons = {\n          twitter: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\"/></svg>',\n          youtube: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#ff0000\"><path d=\"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z\"/></svg>',\n          instagram: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#E4405F\"><path d=\"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z\"/></svg>',\n          github: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"/></svg>',\n          linkedin: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#0A66C2\"><path d=\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\"/></svg>',\n          tiktok: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z\"/></svg>',\n          spotify: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#1DB954\"><path d=\"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z\"/></svg>',\n          reddit: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#FF4500\"><path d=\"M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z\"/></svg>',\n          generic: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg>'\n        };\n\n        // Twitter/X\n        if (hostname.includes('twitter.com') || hostname.includes('x.com')) {\n          const username = pathParts.length > 0 && pathParts[0] !== 'status' ? pathParts[0] : 'post';\n          return { logo: icons.twitter, name: `@${username}`, platform: 'X', cssClass: 'twitter-mention-link' };\n        }\n\n        // YouTube - Fetch actual video title\n        if (hostname.includes('youtube.com') || hostname.includes('youtu.be')) {\n          const videoId = getYouTubeVideoId(linkUrl);\n          let videoTitle = 'Video';\n          if (videoId) {\n            videoTitle = await fetchYouTubeTitle(videoId);\n            // Truncate title if too long\n            if (videoTitle.length > 50) {\n              videoTitle = videoTitle.substring(0, 47) + '...';\n            }\n          } else if (pathParts[0] === 'channel' || pathParts[0] === 'c' || pathParts[0] === '@') {\n            videoTitle = pathParts[1] || pathParts[0];\n          }\n          return { logo: icons.youtube, name: videoTitle, platform: 'YouTube', cssClass: 'youtube-link' };\n        }\n\n        // Instagram\n        if (hostname.includes('instagram.com')) {\n          const username = pathParts[0] || 'post';\n          return { logo: icons.instagram, name: `@${username}`, platform: 'Instagram', cssClass: 'instagram-link' };\n        }\n\n        // GitHub\n        if (hostname.includes('github.com')) {\n          const repoName = pathParts.slice(0, 2).join('/') || 'repo';\n          return { logo: icons.github, name: repoName, platform: 'GitHub', cssClass: 'github-link' };\n        }\n\n        // LinkedIn\n        if (hostname.includes('linkedin.com')) {\n          return { logo: icons.linkedin, name: 'Post', platform: 'LinkedIn', cssClass: 'linkedin-link' };\n        }\n\n        // TikTok\n        if (hostname.includes('tiktok.com')) {\n          const username = pathParts[0]?.startsWith('@') ? pathParts[0] : `@${pathParts[0] || 'video'}`;\n          return { logo: icons.tiktok, name: username, platform: 'TikTok', cssClass: 'tiktok-link' };\n        }\n\n        // Spotify\n        if (hostname.includes('spotify.com')) {\n          return { logo: icons.spotify, name: 'Track', platform: 'Spotify', cssClass: 'spotify-link' };\n        }\n\n        // Reddit\n        if (hostname.includes('reddit.com')) {\n          const subreddit = pathParts[0] === 'r' ? `r/${pathParts[1]}` : pathParts[0] || 'post';\n          return { logo: icons.reddit, name: subreddit, platform: 'Reddit', cssClass: 'reddit-link' };\n        }\n\n        // Generic/default\n        return { logo: icons.generic, name: hostname, platform: 'Link', cssClass: 'generic-link' };\n      } catch {\n        const icons = { generic: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg>' };\n        return { logo: icons.generic, name: 'link', platform: 'Link', cssClass: 'generic-link' };\n      }\n    };\n\n    const platformInfo = await getPlatformInfo(url);\n\n    switch (option) {\n      case 'mention':\n      case 'embed':\n        // Clean format: [icon] name Â· platform\n        content = `<a href=\"${url}\" class=\"${platformInfo.cssClass}\" target=\"_blank\" rel=\"noopener noreferrer\"><span class=\"link-logo\">${platformInfo.logo}</span><span class=\"link-text\"><strong>${platformInfo.name}</strong><span class=\"link-separator\">Â·</span><span class=\"link-platform\">${platformInfo.platform}</span></span></a>`;\n        break;\n      case 'bookmark':\n        // Bookmark style\n        content = `<a href=\"${url}\" class=\"${platformInfo.cssClass} bookmark-style\" target=\"_blank\" rel=\"noopener noreferrer\"><span class=\"link-logo\">${platformInfo.logo}</span><span class=\"link-text\"><strong>${platformInfo.name}</strong><span class=\"link-separator\">Â·</span><span class=\"link-platform\">${platformInfo.platform}</span></span></a>`;\n        break;\n      case 'url':\n      default:\n        // Plain URL format\n        content = `<a href=\"${url}\" class=\"${platformInfo.cssClass}\" target=\"_blank\" rel=\"noopener noreferrer\"><span class=\"link-logo\">${platformInfo.logo}</span><span class=\"link-text\"><strong>${platformInfo.name}</strong><span class=\"link-separator\">Â·</span><span class=\"link-platform\">${platformInfo.platform}</span></span></a>`;\n        break;\n    }\n\n    // Insert content at cursor or append to block\n    const block = activeNote.blocks.find(b => b.id === blockId);\n    if (block) {\n      const newContent = block.content + content;\n      const newBlocks = activeNote.blocks.map(b =>\n        b.id === blockId ? { ...b, content: newContent } : b\n      );\n      onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n    }\n\n    setLinkPasteModal(null);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    if (e.dataTransfer.files.length > 0) {\n      const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));\n      files.forEach(file => handleFileUpload(file));\n    }\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      handleFileUpload(e.target.files[0], slashBlockId || undefined);\n    }\n    // Reset input\n    if (fileInputRef.current) fileInputRef.current.value = '';\n  };\n\n  return (\n    <motion.div\n      ref={editorRef}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0 }}\n      className=\"max-w-3xl mx-auto pt-12 pb-32 px-8 relative text-foreground\"\n      onPaste={handlePaste}\n      onDrop={handleDrop}\n      onDragOver={(e) => e.preventDefault()}\n    >\n      <input\n        type=\"file\"\n        ref={fileInputRef}\n        className=\"hidden\"\n        accept=\"image/*\"\n        onChange={handleFileSelect}\n      />\n      {/* Header */}\n      <div className=\"flex items-start gap-4 mb-4 relative\">\n        <motion.div\n          initial={{ opacity: 0, y: 15 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.4, ease: \"easeOut\", delay: 0.1 }}\n          className=\"flex-1\"\n        >\n          <ContentBlock\n            id=\"note-title\"\n            html={activeNote.title}\n            tagName=\"h1\"\n            className=\"text-5xl font-black bg-transparent border-none outline-none placeholder-gray-300 dark:placeholder-neutral-700 empty:before:content-[attr(data-placeholder)] empty:before:text-gray-300 dark:empty:before:text-neutral-700 text-black dark:text-white\"\n            placeholder=\"Untitled\"\n            onChange={(id, html) => handleTitleChange(html)}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter') {\n                e.preventDefault();\n                document.getElementById(`block-${activeNote.blocks[0]?.id}`)?.focus();\n              }\n            }}\n          />\n        </motion.div>\n\n        {/* Header Actions (Always visible for better UX) */}\n        <div className=\"flex items-center gap-1\">\n          {/* Save Button */}\n          <button\n            onClick={onSave}\n            className={`p-2 rounded-md transition-all duration-300 ${hasUnsavedChanges ? 'bg-black dark:bg-white text-white dark:text-black shadow-lg scale-110' : 'hover:bg-gray-100 dark:hover:bg-neutral-800 text-gray-500 dark:text-neutral-400'}`}\n            title={hasUnsavedChanges ? \"Save Changes\" : \"Saved\"}\n          >\n            <Save size={20} className={hasUnsavedChanges ? \"animate-pulse\" : \"\"} />\n          </button>\n\n          <div className=\"relative color-picker-container\">\n            <button\n              onClick={() => setColorPickerOpen(!colorPickerOpen)}\n              className={`p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded-md transition-colors ${activeNote.color && activeNote.color !== '#000000' ? 'ring-2 ring-offset-1 dark:ring-offset-neutral-900' : ''}`}\n              style={{ borderColor: activeNote.color || 'transparent' }}\n              title=\"Note Color\"\n            >\n              <Palette\n                size={20}\n                style={{ color: activeNote.color && activeNote.color !== '#000000' ? activeNote.color : 'currentColor' }}\n                className=\"text-gray-500 dark:text-neutral-400\"\n              />\n            </button>\n\n            <AnimatePresence>\n              {colorPickerOpen && (\n                <motion.div\n                  initial={{ opacity: 0, scale: 0.9, y: 10 }}\n                  animate={{ opacity: 1, scale: 1, y: 0 }}\n                  exit={{ opacity: 0, scale: 0.9, y: 10 }}\n                  className=\"absolute right-0 top-full mt-2 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 shadow-xl rounded-lg p-3 flex gap-2 z-50 w-48 flex-wrap\"\n                >\n                  {NOTE_COLORS.map((color) => (\n                    <button\n                      key={color.id}\n                      onClick={() => handleColorChange(color.value)}\n                      className={`w-8 h-8 rounded-full border border-gray-200 dark:border-neutral-600 transition-transform hover:scale-110 ${activeNote.color === color.value ? 'ring-2 ring-black dark:ring-white ring-offset-2 dark:ring-offset-neutral-900' : ''}`}\n                      style={{ backgroundColor: color.value }}\n                      title={color.label}\n                    />\n                  ))}\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n\n          <button\n            onMouseDown={(e) => {\n              e.preventDefault();\n              document.execCommand('bold');\n            }}\n            className=\"p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 text-gray-500 dark:text-neutral-400 hover:text-black dark:hover:text-white rounded-md transition-colors\"\n            title=\"Bold Title\"\n          >\n            <Bold size={20} />\n          </button>\n          <button\n            onClick={() => onDeleteNote(activeNote.id)}\n            className=\"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 text-gray-500 dark:text-neutral-400 rounded-md transition-colors\"\n            title=\"Delete Note\"\n          >\n            <Trash2 size={20} />\n          </button>\n        </div>\n      </div>\n\n      {/* Tag Section */}\n      <div className=\"mb-8 flex flex-wrap items-center gap-2 tag-container min-h-[28px]\">\n        <AnimatePresence>\n          {activeNote.tags?.map(tag => (\n            <motion.div\n              key={tag}\n              layout\n              initial={{ opacity: 0, scale: 0.8 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, scale: 0.8 }}\n              className=\"bg-gray-100 dark:bg-neutral-800 text-black dark:text-neutral-300 text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1 group border border-gray-200 dark:border-neutral-700\"\n            >\n              <span className=\"opacity-60\">#</span>\n              {tag}\n              <button\n                onClick={() => handleRemoveTag(tag)}\n                className=\"w-4 h-4 flex items-center justify-center rounded-full hover:bg-gray-300 dark:hover:bg-neutral-600 opacity-0 group-hover:opacity-100 transition-all ml-1\"\n              >\n                <X size={10} />\n              </button>\n            </motion.div>\n          ))}\n        </AnimatePresence>\n\n        <div className=\"relative flex items-center tag-selector-container\">\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsTagSelectorOpen(!isTagSelectorOpen);\n            }}\n            className=\"text-gray-400 dark:text-neutral-500 hover:text-black dark:hover:text-white hover:bg-gray-100 dark:hover:bg-neutral-800 transition-all text-xs font-bold flex items-center gap-1 py-1.5 px-2 rounded-lg\"\n          >\n            <Hash size={12} />\n            Add Tag\n          </button>\n\n          <AnimatePresence>\n            {isTagSelectorOpen && (\n              <motion.div\n                initial={{ opacity: 0, y: -10, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                exit={{ opacity: 0, y: -10, scale: 0.95 }}\n                transition={{ type: 'spring', stiffness: 400, damping: 25 }}\n                className=\"absolute top-full left-0 mt-2 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 rounded-xl shadow-2xl overflow-hidden z-50 min-w-[200px]\"\n              >\n                <div className=\"p-2 border-b border-gray-100 dark:border-neutral-800\">\n                  <p className=\"text-xs font-medium text-gray-400 dark:text-neutral-500\">Select a tag</p>\n                </div>\n                <div className=\"max-h-48 overflow-y-auto p-1\">\n                  {availableTags.filter(tag => !activeNote.tags?.includes(tag.name)).length === 0 ? (\n                    <div className=\"p-4 text-center\">\n                      <p className=\"text-xs text-gray-400 dark:text-neutral-500\">\n                        {availableTags.length === 0 ? 'No tags available' : 'All tags added'}\n                      </p>\n                      <p className=\"text-xs text-gray-300 dark:text-neutral-600 mt-1\">\n                        Create tags in Settings\n                      </p>\n                    </div>\n                  ) : (\n                    availableTags\n                      .filter(tag => !activeNote.tags?.includes(tag.name))\n                      .map(tag => (\n                        <motion.button\n                          key={tag.id}\n                          whileHover={{ x: 2 }}\n                          onClick={() => handleSelectTag(tag.name)}\n                          className=\"w-full flex items-center gap-3 px-3 py-2.5 hover:bg-gray-50 dark:hover:bg-neutral-800 rounded-lg transition-colors text-left\"\n                        >\n                          <div\n                            className=\"w-3 h-3 rounded-full flex-shrink-0\"\n                            style={{ backgroundColor: tag.color }}\n                          />\n                          <span className=\"text-sm font-medium text-black dark:text-white\">\n                            #{tag.name}\n                          </span>\n                        </motion.button>\n                      ))\n                  )}\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </div>\n\n      {/* Blocks */}\n      <div className=\"space-y-2 relative\" ref={blocksContainerRef}>\n        {/* Permanent Connection Lines */}\n        <BlockConnectionLines\n          blocks={activeNote.blocks}\n          containerRef={blocksContainerRef}\n        />\n\n        <AnimatePresence initial={false}>\n          {activeNote.blocks.map((block) => {\n            const isSourceBlock = sourceBlockForLinking === block.id;\n            const isSelected = selectedBlocksForLinking.some(b => b.blockId === block.id);\n            const hasConnections = block.blockConnections && block.blockConnections.length > 0;\n\n            return (\n              <motion.div\n                key={block.id}\n                initial={{ opacity: 0, x: -10 }}\n                animate={{ opacity: 1, x: 0 }}\n                onClick={() => isBlockLinkingMode && handleBlockClickForLinking(block.id)}\n                className={`group flex items-start gap-2 relative\n                ${isBlockLinkingMode ? 'block-linkable' : ''}\n                ${isSourceBlock ? 'source' : ''}\n                ${isSelected ? 'selected' : ''}\n                ${hasConnections ? 'block-has-connections' : ''}\n              `}\n                style={{\n                  '--link-color': currentLinkColor,\n                  '--connection-color': block.blockConnections?.[0]?.color,\n                } as React.CSSProperties}\n              >\n                {/* Hover Handle */}\n                <div className=\"mt-2 opacity-0 group-hover:opacity-20 transition-opacity absolute -left-6 cursor-grab\">\n                  <div className=\"w-1.5 h-1.5 bg-black dark:bg-white rounded-full\" />\n                </div>\n\n                <div\n                  className=\"w-full relative group/content rounded-lg transition-all duration-200\"\n                  style={{\n                    backgroundColor: block.highlightColor || 'transparent',\n                  }}\n                >\n                  <div className={`flex items-start w-full ${block.type === 'bullet' ? 'gap-3' : 'gap-2'} ${block.highlightColor ? 'px-3 py-2' : ''}`}>\n                    {block.type === 'bullet' && (\n                      <span className=\"text-2xl leading-6 select-none dark:text-white\">â¢</span>\n                    )}\n                    {block.type === 'todo' && (\n                      <div\n                        className={`mt-1.5 w-5 h-5 border-2 border-black dark:border-white cursor-pointer transition-colors flex-shrink-0 rounded ${block.checked ? 'bg-black dark:bg-white' : 'bg-transparent'}`}\n                        contentEditable={false}\n                        onClick={() => {\n                          handleTextChange(note => ({\n                            ...note,\n                            blocks: note.blocks.map(b => b.id === block.id ? { ...b, checked: !b.checked } : b)\n                          }));\n                        }}\n                      />\n                    )}\n\n                    {block.type !== 'image' && (\n                      <ContentBlock\n                        id={block.id}\n                        html={block.content}\n                        tagName={block.type === 'heading' ? 'h1' : 'div'}\n                        className={`w-full outline-none resize-none overflow-hidden text-black dark:text-white transition-all\n                            ${block.type === 'heading' ? 'text-3xl font-bold mb-4 mt-6' : ''}\n                            ${block.type === 'paragraph' ? 'text-lg leading-relaxed mb-2' : ''}\n                            ${block.type === 'todo' ? (block.checked ? 'text-lg line-through text-gray-400 dark:text-neutral-600' : 'text-lg') : ''}\n                            ${block.type === 'bullet' ? 'text-lg leading-relaxed' : ''}\n                            ${block.type === 'blockquote' ? 'text-xl italic border-l-4 border-black dark:border-white pl-4 py-2 text-gray-600 dark:text-neutral-400 my-4' : ''}\n                            ${block.type === 'code' ? 'font-mono text-sm bg-gray-50 dark:bg-neutral-900 p-4 rounded-md text-gray-800 dark:text-neutral-200 my-2 whitespace-pre-wrap' : ''}\n`}\n                        placeholder={block.type === 'paragraph' ? \"Type '/' for commands\" : \"Type something...\"}\n                        onChange={updateBlockContent}\n                        onKeyDown={handleBlockKeyDown}\n                        autoFocus={focusedBlockId === block.id}\n                        onFocus={setFocusedBlockId}\n                      />\n                    )}\n                    {block.type === 'image' && (\n                      <ImageBlock\n                        id={block.id}\n                        src={block.content}\n                        onDelete={(id) => setImageToDelete(id)}\n                        className=\"w-full\"\n                      />\n                    )}\n                  </div>\n\n                  {/* Block Actions Container */}\n                  <div className=\"absolute -right-10 top-1/2 -translate-y-1/2 flex flex-col gap-1 opacity-0 group-hover/content:opacity-100 transition-all\">\n                    {/* Highlight Color Picker Button */}\n                    {block.type !== 'image' && block.type !== 'code' && (\n                      <div className=\"relative\">\n                        <button\n                          onClick={() => {\n                            setFocusedBlockId(block.id);\n                            setHighlightPickerOpen(highlightPickerOpen && focusedBlockId === block.id ? false : true);\n                          }}\n                          className={`p-1.5 rounded-md transition-colors ${block.highlightColor ? 'bg-gray-200 dark:bg-neutral-700' : 'hover:bg-gray-100 dark:hover:bg-neutral-800'}`}\n                          title=\"Highlight Color\"\n                          style={{ borderLeft: block.highlightColor ? `3px solid ${block.highlightColor.replace('0.15', '0.8').replace('0.2', '0.8')}` : undefined }}\n                        >\n                          <Highlighter size={14} className=\"text-gray-500 dark:text-neutral-400\" />\n                        </button>\n\n                        {/* Highlight Color Dropdown */}\n                        <AnimatePresence>\n                          {highlightPickerOpen && focusedBlockId === block.id && (\n                            <motion.div\n                              initial={{ opacity: 0, scale: 0.9, x: 10 }}\n                              animate={{ opacity: 1, scale: 1, x: 0 }}\n                              exit={{ opacity: 0, scale: 0.9, x: 10 }}\n                              className=\"absolute right-full mr-2 top-0 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 shadow-xl rounded-lg p-2 flex flex-wrap gap-1.5 z-50 w-32\"\n                            >\n                              {BLOCK_HIGHLIGHT_COLORS.map((color) => (\n                                <button\n                                  key={color.id}\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    handleBlockHighlightChange(block.id, color.value);\n                                  }}\n                                  className={`w-6 h-6 rounded-md border border-gray-300 dark:border-neutral-600 transition-transform hover:scale-110 ${block.highlightColor === color.value ? 'ring-2 ring-black dark:ring-white ring-offset-1 dark:ring-offset-neutral-900' : ''}`}\n                                  style={{ backgroundColor: color.id === 'none' ? 'transparent' : color.value.replace('0.15', '0.5').replace('0.2', '0.5') }}\n                                  title={color.label}\n                                >\n                                  {color.id === 'none' && <X size={12} className=\"mx-auto text-gray-400\" />}\n                                </button>\n                              ))}\n                            </motion.div>\n                          )}\n                        </AnimatePresence>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Copy Button for Code Blocks */}\n                  {block.type === 'code' && (\n                    <button\n                      onClick={() => handleCopyBlock(block.id, block.content)}\n                      className=\"absolute top-2 right-2 p-1.5 bg-gray-200 dark:bg-neutral-800 hover:bg-gray-300 dark:hover:bg-neutral-700 rounded text-gray-600 dark:text-neutral-300 transition-all opacity-0 group-hover/content:opacity-100\"\n                      title=\"Copy to clipboard\"\n                    >\n                      {copiedBlockId === block.id ? <Check size={14} className=\"text-green-600\" /> : <Copy size={14} />}\n                    </button>\n                  )}\n                </div>\n              </motion.div>\n            );\n          })}\n        </AnimatePresence>\n      </div>\n\n      {/* Bottom Controls */}\n      <div className=\"mt-8 flex gap-2 group opacity-50 hover:opacity-100 transition-opacity\">\n        <button onClick={() => addBlock(activeNote.blocks[activeNote.blocks.length - 1]?.id || '0')} className=\"flex items-center gap-2 text-sm font-medium hover:bg-muted dark:hover:bg-neutral-800 px-3 py-1.5 rounded-md transition-colors\">\n          <Plus size={16} /> Add Block\n        </button>\n        <button\n          onMouseDown={(e) => { e.preventDefault(); handleAiEnhance(); }}\n          disabled={isAiLoading}\n          className=\"flex items-center gap-2 text-sm font-medium hover:bg-muted dark:hover:bg-neutral-800 px-3 py-1.5 rounded-md transition-colors text-purple-900 dark:text-purple-300\"\n        >\n          <Sparkles size={16} className={isAiLoading ? \"animate-spin\" : \"\"} />\n          {isAiLoading ? \"Thinking...\" : \"Gemini Expand\"}\n        </button>\n      </div>\n\n      {/* Slash Menu */}\n      <AnimatePresence>\n        {slashMenuOpen && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.9 }}\n            style={{ top: slashMenuPosition.top, left: slashMenuPosition.left }}\n            className=\"absolute z-50 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 shadow-xl rounded-lg w-48 overflow-hidden flex flex-col py-1\"\n          >\n            <div className=\"px-3 py-2 text-xs font-bold text-gray-400 dark:text-neutral-500 uppercase tracking-wider border-b border-gray-100 dark:border-neutral-800\">\n              Basic Blocks\n            </div>\n            {[\n              { type: 'paragraph', label: 'Paragraph', icon: Type },\n              { type: 'heading', label: 'Heading 1', icon: Heading1 },\n              { type: 'bullet', label: 'Bulleted List', icon: List },\n              { type: 'todo', label: 'To-do List', icon: CheckSquare },\n              { type: 'blockquote', label: 'Quote', icon: Quote },\n              { type: 'code', label: 'Code Block', icon: Code },\n              { type: 'image', label: 'Image', icon: ImageIcon },\n            ].filter(item => item.label.toLowerCase().includes(slashFilter.toLowerCase())).map(item => (\n              <button\n                key={item.type}\n                onClick={(e) => {\n                  e.stopPropagation();\n                  if (item.type === 'image') {\n                    fileInputRef.current?.click();\n                    setSlashMenuOpen(false);\n                  } else if (slashBlockId) {\n                    updateBlockType(slashBlockId, item.type as any);\n                  }\n                }}\n                className=\"flex items-center gap-3 px-3 py-2 hover:bg-gray-50 dark:hover:bg-neutral-800 transition-colors text-left\"\n              >\n                <item.icon size={16} className=\"text-gray-500 dark:text-neutral-400\" />\n                <span className=\"text-sm font-medium text-black dark:text-neutral-200\">{item.label}</span>\n              </button>\n            ))}\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Formatting Toolbar - Portaled for z-index safety */}\n      {createPortal(\n        <AnimatePresence>\n          {formatToolbarPosition && (\n            <motion.div\n              key=\"format-toolbar\"\n              role=\"toolbar\"\n              aria-label=\"Text formatting\"\n              initial={{ opacity: 0, scale: 0.85, y: 15 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.85, y: 15 }}\n              transition={{ type: \"spring\", stiffness: 500, damping: 30, mass: 0.8 }}\n              style={{\n                top: formatToolbarPosition.top,\n                left: formatToolbarPosition.left,\n                translateX: \"-50%\"\n              }}\n              className=\"fixed z-[9999] bg-black/95 dark:bg-white/95 backdrop-blur-xl text-white dark:text-black rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0.4)] dark:shadow-[0_8px_32px_rgba(0,0,0,0.15)] px-2 py-2 flex items-center gap-1 border border-white/10 dark:border-black/10 pointer-events-auto\"\n            >\n              {/* Arrow pointer */}\n              <div className=\"absolute -bottom-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-black/95 dark:bg-white/95 rotate-45 border-r border-b border-white/10 dark:border-black/10\" />\n\n              {/* Text Style Group */}\n              <div className=\"flex items-center gap-0.5 bg-white/5 dark:bg-black/5 rounded-xl p-1\">\n                {/* Bold Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Bold\"\n                    aria-keyshortcuts=\"Meta+B Ctrl+B\"\n                    onMouseDown={(e) => { e.preventDefault(); formatText('bold'); }}\n                    className=\"p-2 hover:bg-white/20 dark:hover:bg-black/15 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none\"\n                  >\n                    <Bold size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Bold\n                    <span className=\"ml-1.5 text-gray-400 dark:text-gray-500\">âB</span>\n                  </div>\n                </div>\n\n                {/* Italic Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Italic\"\n                    aria-keyshortcuts=\"Meta+I Ctrl+I\"\n                    onMouseDown={(e) => { e.preventDefault(); formatText('italic'); }}\n                    className=\"p-2 hover:bg-white/20 dark:hover:bg-black/15 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none\"\n                  >\n                    <Italic size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Italic\n                    <span className=\"ml-1.5 text-gray-400 dark:text-gray-500\">âI</span>\n                  </div>\n                </div>\n\n                {/* Underline Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Underline\"\n                    aria-keyshortcuts=\"Meta+U Ctrl+U\"\n                    onMouseDown={(e) => { e.preventDefault(); formatText('underline'); }}\n                    className=\"p-2 hover:bg-white/20 dark:hover:bg-black/15 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none\"\n                  >\n                    <Underline size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Underline\n                    <span className=\"ml-1.5 text-gray-400 dark:text-gray-500\">âU</span>\n                  </div>\n                </div>\n\n                {/* Strikethrough Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Strikethrough\"\n                    onMouseDown={(e) => { e.preventDefault(); formatText('strikeThrough'); }}\n                    className=\"p-2 hover:bg-white/20 dark:hover:bg-black/15 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none\"\n                  >\n                    <Strikethrough size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Strikethrough\n                  </div>\n                </div>\n\n                {/* Separator */}\n                <div className=\"w-px h-4 bg-white/20 dark:bg-black/20 mx-0.5\" />\n\n                {/* Link Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Insert Link\"\n                    onMouseDown={(e) => {\n                      e.preventDefault();\n                      const selection = window.getSelection();\n                      const selectedText = selection?.toString() || '';\n                      const url = prompt('Enter URL:', selectedText.startsWith('http') ? selectedText : 'https://');\n                      if (url) {\n                        document.execCommand('createLink', false, url);\n                      }\n                    }}\n                    className=\"p-2 hover:bg-white/20 dark:hover:bg-black/15 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none\"\n                  >\n                    <LinkIcon size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Insert Link\n                    <span className=\"ml-1.5 text-gray-400 dark:text-gray-500\">âK</span>\n                  </div>\n                </div>\n\n                {/* Font Selector */}\n                <div className=\"relative group/btn font-dropdown-container\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Change Font\"\n                    onMouseDown={(e) => {\n                      e.preventDefault();\n                      setFontDropdownOpen(!fontDropdownOpen);\n                    }}\n                    className=\"p-2 hover:bg-white/20 dark:hover:bg-black/15 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none flex items-center gap-1\"\n                  >\n                    <Type size={16} strokeWidth={2.5} />\n                    <ChevronDown size={12} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Font\n                  </div>\n\n                  {/* Font Dropdown */}\n                  <AnimatePresence>\n                    {fontDropdownOpen && (\n                      <motion.div\n                        initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                        animate={{ opacity: 1, y: 0, scale: 1 }}\n                        exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                        transition={{ duration: 0.15 }}\n                        className=\"absolute top-full left-1/2 -translate-x-1/2 mt-2 bg-neutral-900 dark:bg-white border border-neutral-700 dark:border-neutral-300 rounded-xl shadow-2xl p-1 min-w-[160px] max-h-[250px] overflow-y-auto z-50 font-dropdown-container\"\n                      >\n                        {AVAILABLE_FONTS.map((font) => (\n                          <button\n                            key={font.name}\n                            onMouseDown={(e) => {\n                              e.preventDefault();\n                              e.stopPropagation();\n                              // Apply font to selected text\n                              const selection = window.getSelection();\n                              if (selection && selection.rangeCount > 0) {\n                                const range = selection.getRangeAt(0);\n                                if (!range.collapsed) {\n                                  const span = document.createElement('span');\n                                  span.style.fontFamily = font.value;\n                                  try {\n                                    range.surroundContents(span);\n                                  } catch {\n                                    // If surrounding fails (crosses element boundaries), use execCommand fallback\n                                    document.execCommand('fontName', false, font.value);\n                                  }\n                                }\n                              }\n                              setFontDropdownOpen(false);\n                            }}\n                            className=\"w-full px-3 py-2 text-left text-sm text-white dark:text-black hover:bg-neutral-700 dark:hover:bg-neutral-200 rounded-lg transition-colors\"\n                            style={{ fontFamily: font.value }}\n                          >\n                            {font.name}\n                          </button>\n                        ))}\n                      </motion.div>\n                    )}\n                  </AnimatePresence>\n                </div>\n              </div>\n\n              <div className=\"w-px h-6 bg-white/20 dark:bg-black/20 mx-0.5\" role=\"separator\" aria-orientation=\"vertical\" />\n\n              {/* Text Highlight Colors */}\n              <div className=\"flex items-center gap-1 bg-white/5 dark:bg-black/5 rounded-xl p-1\">\n                <Highlighter size={14} className=\"text-gray-400 dark:text-gray-500 mx-1\" />\n                {[\n                  { color: '#facc15', label: 'Yellow' },\n                  { color: '#4ade80', label: 'Green' },\n                  { color: '#ff0000ff', label: 'Blood Red' },\n                  { color: '#60a5fa', label: 'Blue' },\n                  { color: '#f87171', label: 'Coral Red' },\n                  { color: '#c084fc', label: 'Purple' },\n                ].map((item) => (\n                  <div key={item.color} className=\"relative group/color\">\n                    <button\n                      type=\"button\"\n                      aria-label={`Highlight ${item.label}`}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        document.execCommand('hiliteColor', false, item.color);\n                      }}\n                      className=\"w-5 h-5 rounded-full border-2 border-white/30 dark:border-black/30 hover:scale-125 active:scale-95 transition-all shadow-inner\"\n                      style={{ backgroundColor: item.color }}\n                    />\n                    {/* Tooltip Overlay */}\n                    <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2.5 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/color:opacity-100 transition-opacity pointer-events-none shadow-xl z-10\">\n                      {item.label}\n                      <div className=\"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-800 dark:border-t-gray-200\" />\n                    </div>\n                  </div>\n                ))}\n                <div className=\"w-px h-4 bg-white/20 dark:bg-black/20 mx-0.5\" />\n                <div className=\"relative group/color\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Remove Highlight\"\n                    onMouseDown={(e) => {\n                      e.preventDefault();\n                      document.execCommand('hiliteColor', false, 'transparent');\n                    }}\n                    className=\"w-5 h-5 rounded-full border-2 border-white/30 dark:border-black/30 hover:scale-125 active:scale-95 transition-all flex items-center justify-center bg-gray-700 dark:bg-gray-400\"\n                  >\n                    <X size={10} className=\"text-white dark:text-black\" />\n                  </button>\n                  {/* Tooltip Overlay */}\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2.5 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/color:opacity-100 transition-opacity pointer-events-none shadow-xl z-10\">\n                    Remove\n                    <div className=\"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-800 dark:border-t-gray-200\" />\n                  </div>\n                </div>\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>,\n        document.body\n      )}\n\n      <ConfirmationModal\n        isOpen={!!imageToDelete}\n        title=\"Delete Image?\"\n        message=\"Are you sure you want to delete this image? This action cannot be undone.\"\n        onConfirm={() => {\n          if (imageToDelete) {\n            deleteBlock(imageToDelete);\n            setImageToDelete(null);\n          }\n        }}\n        onCancel={() => setImageToDelete(null)}\n      />\n\n      {/* Link Paste Modal */}\n      <AnimatePresence>\n        {linkPasteModal && (\n          <motion.div\n            initial={{ opacity: 0, y: -10, scale: 0.95 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: -10, scale: 0.95 }}\n            transition={{ type: \"spring\", stiffness: 400, damping: 25 }}\n            style={{\n              position: 'fixed',\n              top: linkPasteModal.position.top,\n              left: linkPasteModal.position.left,\n              zIndex: 9999\n            }}\n            className=\"bg-neutral-900 dark:bg-neutral-800 rounded-xl shadow-2xl border border-neutral-700 overflow-hidden min-w-[200px]\"\n          >\n            {/* Header */}\n            <div className=\"px-4 py-2 border-b border-neutral-700 text-sm text-neutral-400 font-medium\">\n              Colar como\n            </div>\n\n            {/* Options */}\n            <div className=\"py-1\">\n              <button\n                onClick={() => handleLinkPasteOption('mention')}\n                className=\"w-full px-4 py-2.5 text-left text-white hover:bg-neutral-700 transition-colors flex items-center gap-3\"\n              >\n                <span className=\"text-blue-400\">@</span>\n                <span>MenÃ§Ã£o</span>\n              </button>\n\n              <button\n                onClick={() => handleLinkPasteOption('embed')}\n                className=\"w-full px-4 py-2.5 text-left text-white hover:bg-neutral-700 transition-colors flex items-center gap-3\"\n              >\n                <span className=\"text-purple-400\">â</span>\n                <span>Integrar tweet</span>\n              </button>\n\n              <button\n                onClick={() => handleLinkPasteOption('bookmark')}\n                className=\"w-full px-4 py-2.5 text-left text-white hover:bg-neutral-700 transition-colors flex items-center gap-3\"\n              >\n                <span className=\"text-yellow-400\">ð</span>\n                <span>Criar marcador</span>\n              </button>\n\n              <button\n                onClick={() => handleLinkPasteOption('url')}\n                className=\"w-full px-4 py-2.5 text-left text-white hover:bg-neutral-700 transition-colors flex items-center gap-3\"\n              >\n                <LinkIcon size={16} className=\"text-neutral-400\" />\n                <span>URL</span>\n              </button>\n            </div>\n\n            {/* URL Preview */}\n            <div className=\"px-4 py-2 border-t border-neutral-700 text-xs text-neutral-500 truncate max-w-[300px]\">\n              {linkPasteModal.url}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Click outside to close link paste modal */}\n      {linkPasteModal && (\n        <div\n          className=\"fixed inset-0 z-[9998]\"\n          onClick={() => setLinkPasteModal(null)}\n        />\n      )}\n\n      {/* Text Connector Menu */}\n      <TextConnectorMenu\n        position={connectorMenuPosition}\n        onStartLinking={handleStartNoteConnection}\n        onClose={() => setConnectorMenuPosition(null)}\n      />\n\n      {/* Note Selector Modal */}\n      <AnimatePresence>\n        {isNoteSelectorOpen && (\n          <NoteSelectorModal\n            isOpen={isNoteSelectorOpen}\n            currentNoteId={activeNote.id}\n            allNotes={allNotes}\n            onSelectNote={handleConnectToNote}\n            onClose={() => setIsNoteSelectorOpen(false)}\n          />\n        )}\n      </AnimatePresence>\n\n      {/* Block Linking Mode Overlay (legacy - not used for note connections) */}\n      <BlockLinkingMode\n        isActive={isBlockLinkingMode}\n        sourceBlockId={sourceBlockForLinking || ''}\n        sourceNoteId={activeNote.id}\n        selectedBlocks={selectedBlocksForLinking}\n        onSelectBlock={handleBlockClickForLinking}\n        onConfirm={handleConfirmBlockLinking}\n        onCancel={handleCancelBlockLinking}\n        currentColor={currentLinkColor}\n        onColorChange={setCurrentLinkColor}\n      />\n    </motion.div>\n  );\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4800, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/canvas/CanvasView.tsx"],"sourcesContent":["import React, { useRef, useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Note } from '../../types';\nimport { StickyNote, MousePointer2, Link2, X, ExternalLink } from 'lucide-react';\nimport { NOTE_COLORS } from '../../constants';\n\n// SVG Noise Texture for paper feel\nconst PAPER_TEXTURE = `url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E\")`;\n\nconst NOTE_WIDTH = 256;\nconst NOTE_HEIGHT_ESTIMATE = 80; // Approximate center for connection anchor\n\ninterface CanvasViewProps {\n  notes: Note[];\n  onNoteSelect: (noteId: string) => void;\n  onNoteMove: (noteId: string, position: { x: number; y: number }) => void;\n  onConnectNotes: (sourceId: string, targetId: string) => void;\n  onDeleteNote: (noteId: string) => void;\n  isDarkMode: boolean;\n}\n\ntype CanvasTool = 'SELECT' | 'CONNECT';\n\nexport const CanvasView: React.FC<CanvasViewProps> = ({\n  notes,\n  onNoteSelect,\n  onNoteMove,\n  onConnectNotes,\n  onDeleteNote,\n  isDarkMode\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Viewport State\n  const [pan, setPan] = useState({ x: 0, y: 0 });\n  const [isDraggingCanvas, setIsDraggingCanvas] = useState(false);\n\n  // Tool State\n  const [activeTool, setActiveTool] = useState<CanvasTool>('SELECT');\n  const [connectionSourceId, setConnectionSourceId] = useState<string | null>(null);\n  const [mousePos, setMousePos] = useState({ x: 0, y: 0 });\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    // Only pan if clicking directly on background\n    if (e.target === containerRef.current && activeTool === 'SELECT') {\n      setIsDraggingCanvas(true);\n    }\n    // If clicking background in connect mode, cancel connection source but keep tool active\n    // FIX: Only cancel if clicking the background, not if clicking a note (which bubbles here)\n    if (activeTool === 'CONNECT' && e.target === containerRef.current) {\n      setConnectionSourceId(null);\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    if (isDraggingCanvas) {\n      setPan(prev => ({ x: prev.x + e.movementX, y: prev.y + e.movementY }));\n    }\n\n    // Update mouse pos for drawing the temporary connection line\n    if (activeTool === 'CONNECT') {\n      // Calculate relative position inside the panned container\n      const rect = containerRef.current?.getBoundingClientRect();\n      if (rect) {\n        setMousePos({\n          x: e.clientX - rect.left - pan.x,\n          y: e.clientY - rect.top - pan.y\n        });\n      }\n    }\n  };\n\n  const handleMouseUp = () => {\n    setIsDraggingCanvas(false);\n  };\n\n  const handleNoteInteraction = (noteId: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    if (activeTool === 'CONNECT') {\n      if (connectionSourceId === null) {\n        // Start connection\n        setConnectionSourceId(noteId);\n      } else {\n        // If clicking same node, toggle off selection\n        if (connectionSourceId === noteId) {\n          setConnectionSourceId(null);\n        } else {\n          // Complete connection\n          onConnectNotes(connectionSourceId, noteId);\n          setConnectionSourceId(null);\n        }\n      }\n    } else {\n      // Normal selection\n      onNoteSelect(noteId);\n    }\n  };\n\n  const toggleTool = (tool: CanvasTool) => {\n    if (activeTool === tool) {\n      // Toggle off if clicking same tool\n      if (tool === 'CONNECT') {\n        setActiveTool('SELECT');\n        setConnectionSourceId(null);\n      }\n    } else {\n      setActiveTool(tool);\n      setConnectionSourceId(null);\n    }\n  };\n\n  return (\n    <div\n      className={`w-full h-full bg-[#fcfcfc] dark:bg-[#0a0a0a] relative overflow-hidden transition-colors duration-300 ${activeTool === 'CONNECT' ? 'cursor-crosshair' : 'cursor-grab active:cursor-grabbing'}`}\n      ref={containerRef}\n      onMouseDown={handleMouseDown}\n      onMouseMove={handleMouseMove}\n      onMouseUp={handleMouseUp}\n      onMouseLeave={handleMouseUp}\n    >\n      {/* Toolbar */}\n      <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 z-50 bg-white dark:bg-neutral-900 border border-black dark:border-neutral-700 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] dark:shadow-[4px_4px_0px_0px_rgba(255,255,255,0.1)] px-2 py-2 rounded-full flex gap-2\">\n        <button\n          onClick={() => toggleTool('SELECT')}\n          className={`p-2 rounded-full transition-all ${activeTool === 'SELECT' ? 'bg-black text-white dark:bg-white dark:text-black' : 'hover:bg-gray-100 dark:hover:bg-neutral-800 text-black dark:text-white'}`}\n          title=\"Select / Move Tool\"\n        >\n          <MousePointer2 size={18} />\n        </button>\n        <button\n          onClick={() => toggleTool('CONNECT')}\n          className={`p-2 rounded-full transition-all ${activeTool === 'CONNECT' ? 'bg-black text-white dark:bg-white dark:text-black' : 'hover:bg-gray-100 dark:hover:bg-neutral-800 text-black dark:text-white'}`}\n          title=\"Connect Notes Tool\"\n        >\n          <Link2 size={18} />\n        </button>\n      </div>\n\n      {/* Grid Pattern */}\n      <div\n        className=\"absolute inset-0 pointer-events-none opacity-10 dark:opacity-20\"\n        style={{\n          backgroundImage: `radial-gradient(${isDarkMode ? '#ffffff' : '#000000'} 1px, transparent 1px)`,\n          backgroundSize: '24px 24px',\n          transform: `translate(${pan.x}px, ${pan.y}px)`\n        }}\n      />\n\n      <motion.div\n        className=\"absolute inset-0 origin-top-left\"\n        style={{ x: pan.x, y: pan.y }}\n      >\n        {/* Connections Layer */}\n        <svg className=\"absolute top-0 left-0 w-[5000px] h-[5000px] pointer-events-none overflow-visible\">\n          <defs>\n            <marker id=\"arrowhead-pulse\" markerWidth=\"10\" markerHeight=\"7\" refX=\"10\" refY=\"3.5\" orient=\"auto\">\n              <polygon points=\"0 0, 10 3.5, 0 7\" fill={isDarkMode ? \"white\" : \"black\"} className=\"animate-pulse\" />\n            </marker>\n\n            {/* Dynamic Colored Arrowheads */}\n            {NOTE_COLORS.map(c => (\n              <marker\n                key={c.id}\n                id={`arrowhead-${c.value.replace('#', '')}`}\n                markerWidth=\"10\"\n                markerHeight=\"7\"\n                refX=\"10\"\n                refY=\"3.5\"\n                orient=\"auto\"\n              >\n                <polygon points=\"0 0, 10 3.5, 0 7\" fill={c.value} opacity=\"0.8\" />\n              </marker>\n            ))}\n\n            <style>\n              {`\n                    @keyframes flowAnimation {\n                        from { stroke-dashoffset: 16; }\n                        to { stroke-dashoffset: 0; }\n                    }\n                    .connection-line-animated {\n                        animation: flowAnimation 2s linear infinite;\n                    }\n                `}\n            </style>\n          </defs>\n\n          {/* Existing Connections */}\n          {notes.map(note =>\n            note.connections.map(targetId => {\n              const target = notes.find(n => n.id === targetId);\n              if (!target) return null;\n\n              const sourceColor = note.color || (isDarkMode ? '#ffffff' : '#000000');\n              const targetColor = target.color || (isDarkMode ? '#ffffff' : '#000000');\n              const targetColorClean = targetColor.replace('#', '');\n              const gradientId = `grad-${note.id}-${target.id}`;\n\n              const x1 = note.position.x + NOTE_WIDTH / 2;\n              const y1 = note.position.y + NOTE_HEIGHT_ESTIMATE;\n              const x2 = target.position.x + NOTE_WIDTH / 2;\n              const y2 = target.position.y + NOTE_HEIGHT_ESTIMATE;\n\n              return (\n                <React.Fragment key={`${note.id}-${target.id}`}>\n                  <defs>\n                    <linearGradient\n                      id={gradientId}\n                      gradientUnits=\"userSpaceOnUse\"\n                      x1={x1} y1={y1}\n                      x2={x2} y2={y2}\n                    >\n                      <stop offset=\"0%\" stopColor={sourceColor} />\n                      <stop offset=\"100%\" stopColor={targetColor} />\n                    </linearGradient>\n                  </defs>\n                  <line\n                    x1={x1}\n                    y1={y1}\n                    x2={x2}\n                    y2={y2}\n                    stroke={`url(#${gradientId})`}\n                    strokeWidth=\"1.5\"\n                    strokeDasharray=\"8,8\"\n                    className=\"connection-line-animated opacity-60\"\n                    markerEnd={`url(#arrowhead-${targetColorClean})`}\n                  />\n                </React.Fragment>\n              )\n            })\n          )}\n\n          {/* Temporary Connection Line */}\n          {activeTool === 'CONNECT' && connectionSourceId && (\n            (() => {\n              const source = notes.find(n => n.id === connectionSourceId);\n              if (!source) return null;\n              const sourceColor = source.color || (isDarkMode ? '#ffffff' : '#000000');\n\n              return (\n                <line\n                  x1={source.position.x + NOTE_WIDTH / 2}\n                  y1={source.position.y + NOTE_HEIGHT_ESTIMATE}\n                  x2={mousePos.x}\n                  y2={mousePos.y}\n                  stroke={sourceColor}\n                  strokeWidth=\"2\"\n                  strokeDasharray=\"4,4\"\n                  markerEnd=\"url(#arrowhead-pulse)\"\n                  className=\"animate-pulse opacity-60\"\n                />\n              )\n            })()\n          )}\n        </svg>\n\n        {notes.map((note) => (\n          <DraggableNote\n            key={note.id}\n            note={note}\n            activeTool={activeTool}\n            isConnectionSource={note.id === connectionSourceId}\n            onClick={(e) => handleNoteInteraction(note.id, e)}\n            onMove={(pos) => onNoteMove(note.id, pos)}\n            onDelete={() => onDeleteNote(note.id)}\n            isDarkMode={isDarkMode}\n          />\n        ))}\n      </motion.div>\n\n      {/* Mode Indicator */}\n      <AnimatePresence>\n        {activeTool === 'CONNECT' && (\n          <motion.div\n            initial={{ y: -20, opacity: 0 }}\n            animate={{ y: 0, opacity: 1 }}\n            exit={{ y: -20, opacity: 0 }}\n            className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-black dark:bg-white text-white dark:text-black px-4 py-2 text-xs font-bold uppercase tracking-widest rounded shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)] pointer-events-none flex items-center gap-2\"\n          >\n            <Link2 size={12} />\n            {connectionSourceId ? \"Click target note\" : \"Select source note\"}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n\ninterface DraggableNoteProps {\n  note: Note;\n  activeTool: CanvasTool;\n  isConnectionSource: boolean;\n  onClick: (e: React.MouseEvent) => void;\n  onMove: (p: { x: number, y: number }) => void;\n  onDelete: () => void;\n  isDarkMode: boolean;\n}\n\nconst DraggableNote: React.FC<DraggableNoteProps> = ({\n  note,\n  activeTool,\n  isConnectionSource,\n  onClick,\n  onMove,\n  onDelete,\n  isDarkMode\n}) => {\n  // Safely parse HTML for preview\n  const stripHtml = (html: string) => {\n    const tmp = document.createElement(\"DIV\");\n    tmp.innerHTML = html;\n    return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  // Detect links\n  const linkData = useMemo(() => {\n    for (const block of note.blocks) {\n      const text = stripHtml(block.content);\n      const match = text.match(/(https?:\\/\\/[^\\s]+)/);\n      if (match) {\n        try {\n          const url = new URL(match[0]);\n          return { url: match[0], hostname: url.hostname };\n        } catch (e) { continue; }\n      }\n    }\n    return null;\n  }, [note.blocks]);\n\n  // Sticky Note Theme: Random rotation and imperfect edges (Sketchy Border)\n  const randomRotate = useMemo(() => (Math.random() * 2 - 1), []);\n  const organicRadius = useMemo(() => {\n    const v1 = 2 + Math.random() * 2;\n    const v2 = 2 + Math.random() * 3;\n    const v3 = 2 + Math.random() * 2;\n    const v4 = 2 + Math.random() * 3;\n    return `${v1}px ${v2}px ${v3}px ${v4}px`;\n  }, []);\n\n  const noteColor = note.color && note.color !== '#000000' ? note.color : null;\n\n  // Expanded Preview Logic\n  const previewText = useMemo(() => {\n    const segments: string[] = [];\n    let charCount = 0;\n\n    for (const block of note.blocks) {\n      if (charCount > 200) break; // Stop if we have enough text\n      if (block.type === 'image') {\n        segments.push('[Image]');\n        charCount += 7;\n        continue;\n      }\n\n      const text = stripHtml(block.content).trim();\n      if (!text) continue;\n\n      let formatted = text;\n      if (block.type === 'bullet') formatted = `â¢ ${text}`;\n      if (block.type === 'todo') formatted = `- ${text}`;\n\n      segments.push(formatted);\n      charCount += formatted.length;\n    }\n\n    return segments.join(' ');\n  }, [note.blocks]);\n\n  const boxShadow = isConnectionSource\n    ? `0 0 0 4px ${noteColor || (isDarkMode ? '#fff' : '#000')}, 8px 8px 12px rgba(0,0,0,0.2)`\n    : \"2px 3px 8px rgba(0,0,0,0.08)\";\n\n  return (\n    <motion.div\n      drag={activeTool === 'SELECT'}\n      dragMomentum={false}\n      initial={{ x: note.position.x, y: note.position.y, opacity: 0, scale: 0.8 }}\n      animate={{\n        x: note.position.x,\n        y: note.position.y,\n        opacity: 1,\n        rotate: isConnectionSource ? 0 : randomRotate,\n        scale: isConnectionSource ? 1.05 : 1,\n        boxShadow,\n        borderColor: noteColor || (isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)')\n      }}\n      onDragEnd={(e, info) => {\n        onMove({ x: note.position.x + info.offset.x, y: note.position.y + info.offset.y });\n      }}\n      onClick={onClick}\n      whileHover={{\n        scale: 1.03,\n        rotate: 0,\n        boxShadow: \"4px 8px 12px rgba(0,0,0,0.15)\",\n        zIndex: 10\n      }}\n      transition={{ type: \"spring\", stiffness: 400, damping: 25 }}\n      className={`group absolute flex flex-col gap-2 ${activeTool === 'CONNECT' ? 'cursor-crosshair' : 'cursor-pointer'}`}\n      style={{\n        width: NOTE_WIDTH,\n        backgroundColor: isDarkMode ? '#1a1a1a' : '#fff',\n        color: isDarkMode ? '#eee' : '#000',\n        backgroundImage: PAPER_TEXTURE,\n        borderRadius: organicRadius,\n        border: noteColor ? `2px solid ${noteColor}` : `1px solid ${isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'}`\n      }}\n    >\n      {activeTool === 'SELECT' && (\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            onDelete();\n          }}\n          className=\"absolute -top-2 -right-2 bg-white dark:bg-neutral-800 border border-black dark:border-neutral-600 rounded-full p-1 opacity-0 group-hover:opacity-100 transition-all duration-200 hover:bg-red-50 dark:hover:bg-red-900/30 hover:scale-110 z-10 shadow-sm text-black dark:text-white\"\n          title=\"Delete Note\"\n        >\n          <X size={12} />\n        </button>\n      )}\n\n      {/* Note Content Container */}\n      <div className=\"p-4 flex flex-col gap-2 pt-2\">\n        <div className=\"flex items-center justify-between border-b border-gray-100/50 dark:border-neutral-800 pb-2\">\n          <h3\n            className=\"font-bold text-sm truncate pr-4 text-black/90 dark:text-white/90\"\n            dangerouslySetInnerHTML={{ __html: note.title || \"Untitled\" }}\n          />\n          <StickyNote size={14} className=\"text-gray-400 dark:text-neutral-600 flex-shrink-0\" style={{ color: noteColor || undefined }} />\n        </div>\n        <p className=\"text-xs text-gray-600 dark:text-neutral-400 line-clamp-5 leading-relaxed min-h-[1.5em] font-medium\">\n          {previewText || (linkData ? \"\" : \"No content.\")}\n        </p>\n\n        {/* Tags */}\n        {note.tags && note.tags.length > 0 && (\n          <div className=\"flex flex-wrap gap-1 mt-1\">\n            {note.tags.slice(0, 3).map(tag => (\n              <span key={tag} className=\"text-[10px] font-bold bg-gray-100 dark:bg-neutral-800 text-gray-600 dark:text-neutral-300 px-1.5 py-0.5 rounded-sm\">\n                #{tag}\n              </span>\n            ))}\n            {note.tags.length > 3 && (\n              <span className=\"text-[10px] font-bold text-gray-400 dark:text-neutral-600\">+{note.tags.length - 3}</span>\n            )}\n          </div>\n        )}\n\n        {linkData && (\n          <div className=\"mt-2 flex items-center gap-2 bg-black/5 dark:bg-white/5 p-2 rounded border border-black/5 dark:border-white/5 hover:bg-black/10 dark:hover:bg-white/10 transition-colors\">\n            <img\n              src={`https://www.google.com/s2/favicons?domain=${linkData.hostname}&sz=32`}\n              alt=\"favicon\"\n              className=\"w-4 h-4 rounded-sm\"\n              onError={(e) => {\n                (e.target as HTMLImageElement).style.display = 'none';\n              }}\n            />\n            <span className=\"text-[10px] font-medium text-gray-700 dark:text-gray-300 truncate flex-1\">\n              {linkData.hostname}\n            </span>\n            <ExternalLink size={10} className=\"text-gray-500 dark:text-gray-400\" />\n          </div>\n        )}\n      </div>\n\n      {isConnectionSource && (\n        <motion.div\n          initial={{ opacity: 0, y: 5 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold bg-black dark:bg-white text-white dark:text-black px-2 py-0.5 rounded shadow-sm whitespace-nowrap\"\n          style={{ backgroundColor: noteColor || undefined }}\n        >\n          SOURCE SELECTED\n        </motion.div>\n      )}\n    </motion.div>\n  );\n}"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;AAEA,mCAAmC;AACnC,MAAM,gBAAgB,CAAC,qUAAqU,CAAC;AAE7V,MAAM,aAAa;AACnB,MAAM,uBAAuB,IAAI,2CAA2C;AAarE,MAAM,aAAwC,CAAC,EACpD,KAAK,EACL,YAAY,EACZ,UAAU,EACV,cAAc,EACd,YAAY,EACZ,UAAU,EACX;;IACC,MAAM,eAAe,IAAA,uKAAM,EAAiB;IAE5C,iBAAiB;IACjB,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,yKAAQ,EAAC;QAAE,GAAG;QAAG,GAAG;IAAE;IAC5C,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yKAAQ,EAAC;IAEzD,aAAa;IACb,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAa;IACzD,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,yKAAQ,EAAgB;IAC5E,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;QAAE,GAAG;QAAG,GAAG;IAAE;IAEtD,MAAM,kBAAkB,CAAC;QACvB,8CAA8C;QAC9C,IAAI,EAAE,MAAM,KAAK,aAAa,OAAO,IAAI,eAAe,UAAU;YAChE,oBAAoB;QACtB;QACA,wFAAwF;QACxF,2FAA2F;QAC3F,IAAI,eAAe,aAAa,EAAE,MAAM,KAAK,aAAa,OAAO,EAAE;YACjE,sBAAsB;QACxB;IACF;IAEA,MAAM,kBAAkB,CAAC;QACvB,IAAI,kBAAkB;YACpB,OAAO,CAAA,OAAQ,CAAC;oBAAE,GAAG,KAAK,CAAC,GAAG,EAAE,SAAS;oBAAE,GAAG,KAAK,CAAC,GAAG,EAAE,SAAS;gBAAC,CAAC;QACtE;QAEA,6DAA6D;QAC7D,IAAI,eAAe,WAAW;YAC5B,0DAA0D;YAC1D,MAAM,OAAO,aAAa,OAAO,EAAE;YACnC,IAAI,MAAM;gBACR,YAAY;oBACV,GAAG,EAAE,OAAO,GAAG,KAAK,IAAI,GAAG,IAAI,CAAC;oBAChC,GAAG,EAAE,OAAO,GAAG,KAAK,GAAG,GAAG,IAAI,CAAC;gBACjC;YACF;QACF;IACF;IAEA,MAAM,gBAAgB;QACpB,oBAAoB;IACtB;IAEA,MAAM,wBAAwB,CAAC,QAAgB;QAC7C,EAAE,eAAe;QAEjB,IAAI,eAAe,WAAW;YAC5B,IAAI,uBAAuB,MAAM;gBAC/B,mBAAmB;gBACnB,sBAAsB;YACxB,OAAO;gBACL,8CAA8C;gBAC9C,IAAI,uBAAuB,QAAQ;oBACjC,sBAAsB;gBACxB,OAAO;oBACL,sBAAsB;oBACtB,eAAe,oBAAoB;oBACnC,sBAAsB;gBACxB;YACF;QACF,OAAO;YACL,mBAAmB;YACnB,aAAa;QACf;IACF;IAEA,MAAM,aAAa,CAAC;QAClB,IAAI,eAAe,MAAM;YACvB,mCAAmC;YACnC,IAAI,SAAS,WAAW;gBACtB,cAAc;gBACd,sBAAsB;YACxB;QACF,OAAO;YACL,cAAc;YACd,sBAAsB;QACxB;IACF;IAEA,qBACE,6LAAC;QACC,WAAW,CAAC,qGAAqG,EAAE,eAAe,YAAY,qBAAqB,sCAAsC;QACzM,KAAK;QACL,aAAa;QACb,aAAa;QACb,WAAW;QACX,cAAc;;0BAGd,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,SAAS,IAAM,WAAW;wBAC1B,WAAW,CAAC,gCAAgC,EAAE,eAAe,WAAW,sDAAsD,0EAA0E;wBACxM,OAAM;kCAEN,cAAA,6LAAC,gPAAa;4BAAC,MAAM;;;;;;;;;;;kCAEvB,6LAAC;wBACC,SAAS,IAAM,WAAW;wBAC1B,WAAW,CAAC,gCAAgC,EAAE,eAAe,YAAY,sDAAsD,0EAA0E;wBACzM,OAAM;kCAEN,cAAA,6LAAC,oNAAK;4BAAC,MAAM;;;;;;;;;;;;;;;;;0BAKjB,6LAAC;gBACC,WAAU;gBACV,OAAO;oBACL,iBAAiB,CAAC,gBAAgB,EAAE,aAAa,YAAY,UAAU,sBAAsB,CAAC;oBAC9F,gBAAgB;oBAChB,WAAW,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,GAAG,CAAC;gBAChD;;;;;;0BAGF,6LAAC,uMAAM,CAAC,GAAG;gBACT,WAAU;gBACV,OAAO;oBAAE,GAAG,IAAI,CAAC;oBAAE,GAAG,IAAI,CAAC;gBAAC;;kCAG5B,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;;kDACC,6LAAC;wCAAO,IAAG;wCAAkB,aAAY;wCAAK,cAAa;wCAAI,MAAK;wCAAK,MAAK;wCAAM,QAAO;kDACzF,cAAA,6LAAC;4CAAQ,QAAO;4CAAmB,MAAM,aAAa,UAAU;4CAAS,WAAU;;;;;;;;;;;oCAIpF,2HAAW,CAAC,GAAG,CAAC,CAAA,kBACf,6LAAC;4CAEC,IAAI,CAAC,UAAU,EAAE,EAAE,KAAK,CAAC,OAAO,CAAC,KAAK,KAAK;4CAC3C,aAAY;4CACZ,cAAa;4CACb,MAAK;4CACL,MAAK;4CACL,QAAO;sDAEP,cAAA,6LAAC;gDAAQ,QAAO;gDAAmB,MAAM,EAAE,KAAK;gDAAE,SAAQ;;;;;;2CARrD,EAAE,EAAE;;;;;kDAYb,6LAAC;kDACE,CAAC;;;;;;;;gBAQA,CAAC;;;;;;;;;;;;4BAKN,MAAM,GAAG,CAAC,CAAA,OACT,KAAK,WAAW,CAAC,GAAG,CAAC,CAAA;oCACnB,MAAM,SAAS,MAAM,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;oCACxC,IAAI,CAAC,QAAQ,OAAO;oCAEpB,MAAM,cAAc,KAAK,KAAK,IAAI,CAAC,aAAa,YAAY,SAAS;oCACrE,MAAM,cAAc,OAAO,KAAK,IAAI,CAAC,aAAa,YAAY,SAAS;oCACvE,MAAM,mBAAmB,YAAY,OAAO,CAAC,KAAK;oCAClD,MAAM,aAAa,CAAC,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;oCAEjD,MAAM,KAAK,KAAK,QAAQ,CAAC,CAAC,GAAG,aAAa;oCAC1C,MAAM,KAAK,KAAK,QAAQ,CAAC,CAAC,GAAG;oCAC7B,MAAM,KAAK,OAAO,QAAQ,CAAC,CAAC,GAAG,aAAa;oCAC5C,MAAM,KAAK,OAAO,QAAQ,CAAC,CAAC,GAAG;oCAE/B,qBACE,6LAAC,wKAAK,CAAC,QAAQ;;0DACb,6LAAC;0DACC,cAAA,6LAAC;oDACC,IAAI;oDACJ,eAAc;oDACd,IAAI;oDAAI,IAAI;oDACZ,IAAI;oDAAI,IAAI;;sEAEZ,6LAAC;4DAAK,QAAO;4DAAK,WAAW;;;;;;sEAC7B,6LAAC;4DAAK,QAAO;4DAAO,WAAW;;;;;;;;;;;;;;;;;0DAGnC,6LAAC;gDACC,IAAI;gDACJ,IAAI;gDACJ,IAAI;gDACJ,IAAI;gDACJ,QAAQ,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC;gDAC7B,aAAY;gDACZ,iBAAgB;gDAChB,WAAU;gDACV,WAAW,CAAC,eAAe,EAAE,iBAAiB,CAAC,CAAC;;;;;;;uCArB/B,GAAG,KAAK,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,EAAE;;;;;gCAyBlD;4BAID,eAAe,aAAa,sBAC3B,CAAC;gCACC,MAAM,SAAS,MAAM,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;gCACxC,IAAI,CAAC,QAAQ,OAAO;gCACpB,MAAM,cAAc,OAAO,KAAK,IAAI,CAAC,aAAa,YAAY,SAAS;gCAEvE,qBACE,6LAAC;oCACC,IAAI,OAAO,QAAQ,CAAC,CAAC,GAAG,aAAa;oCACrC,IAAI,OAAO,QAAQ,CAAC,CAAC,GAAG;oCACxB,IAAI,SAAS,CAAC;oCACd,IAAI,SAAS,CAAC;oCACd,QAAQ;oCACR,aAAY;oCACZ,iBAAgB;oCAChB,WAAU;oCACV,WAAU;;;;;;4BAGhB,CAAC;;;;;;;oBAIJ,MAAM,GAAG,CAAC,CAAC,qBACV,6LAAC;4BAEC,MAAM;4BACN,YAAY;4BACZ,oBAAoB,KAAK,EAAE,KAAK;4BAChC,SAAS,CAAC,IAAM,sBAAsB,KAAK,EAAE,EAAE;4BAC/C,QAAQ,CAAC,MAAQ,WAAW,KAAK,EAAE,EAAE;4BACrC,UAAU,IAAM,aAAa,KAAK,EAAE;4BACpC,YAAY;2BAPP,KAAK,EAAE;;;;;;;;;;;0BAalB,6LAAC,+MAAe;0BACb,eAAe,2BACd,6LAAC,uMAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,GAAG,CAAC;wBAAI,SAAS;oBAAE;oBAC9B,SAAS;wBAAE,GAAG;wBAAG,SAAS;oBAAE;oBAC5B,MAAM;wBAAE,GAAG,CAAC;wBAAI,SAAS;oBAAE;oBAC3B,WAAU;;sCAEV,6LAAC,oNAAK;4BAAC,MAAM;;;;;;wBACZ,qBAAqB,sBAAsB;;;;;;;;;;;;;;;;;;AAMxD;GAxQa;KAAA;AAoRb,MAAM,gBAA8C,CAAC,EACnD,IAAI,EACJ,UAAU,EACV,kBAAkB,EAClB,OAAO,EACP,MAAM,EACN,QAAQ,EACR,UAAU,EACX;;IACC,gCAAgC;IAChC,MAAM,YAAY,CAAC;QACjB,MAAM,MAAM,SAAS,aAAa,CAAC;QACnC,IAAI,SAAS,GAAG;QAChB,OAAO,IAAI,WAAW,IAAI,IAAI,SAAS,IAAI;IAC7C;IAEA,eAAe;IACf,MAAM,WAAW,IAAA,wKAAO;2CAAC;YACvB,KAAK,MAAM,SAAS,KAAK,MAAM,CAAE;gBAC/B,MAAM,OAAO,UAAU,MAAM,OAAO;gBACpC,MAAM,QAAQ,KAAK,KAAK,CAAC;gBACzB,IAAI,OAAO;oBACT,IAAI;wBACF,MAAM,MAAM,IAAI,IAAI,KAAK,CAAC,EAAE;wBAC5B,OAAO;4BAAE,KAAK,KAAK,CAAC,EAAE;4BAAE,UAAU,IAAI,QAAQ;wBAAC;oBACjD,EAAE,OAAO,GAAG;wBAAE;oBAAU;gBAC1B;YACF;YACA,OAAO;QACT;0CAAG;QAAC,KAAK,MAAM;KAAC;IAEhB,0EAA0E;IAC1E,MAAM,eAAe,IAAA,wKAAO;+CAAC,IAAO,KAAK,MAAM,KAAK,IAAI;8CAAI,EAAE;IAC9D,MAAM,gBAAgB,IAAA,wKAAO;gDAAC;YAC5B,MAAM,KAAK,IAAI,KAAK,MAAM,KAAK;YAC/B,MAAM,KAAK,IAAI,KAAK,MAAM,KAAK;YAC/B,MAAM,KAAK,IAAI,KAAK,MAAM,KAAK;YAC/B,MAAM,KAAK,IAAI,KAAK,MAAM,KAAK;YAC/B,OAAO,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,EAAE,GAAG,GAAG,EAAE,GAAG,EAAE,CAAC;QAC1C;+CAAG,EAAE;IAEL,MAAM,YAAY,KAAK,KAAK,IAAI,KAAK,KAAK,KAAK,YAAY,KAAK,KAAK,GAAG;IAExE,yBAAyB;IACzB,MAAM,cAAc,IAAA,wKAAO;8CAAC;YAC1B,MAAM,WAAqB,EAAE;YAC7B,IAAI,YAAY;YAEhB,KAAK,MAAM,SAAS,KAAK,MAAM,CAAE;gBAC/B,IAAI,YAAY,KAAK,OAAO,8BAA8B;gBAC1D,IAAI,MAAM,IAAI,KAAK,SAAS;oBAC1B,SAAS,IAAI,CAAC;oBACd,aAAa;oBACb;gBACF;gBAEA,MAAM,OAAO,UAAU,MAAM,OAAO,EAAE,IAAI;gBAC1C,IAAI,CAAC,MAAM;gBAEX,IAAI,YAAY;gBAChB,IAAI,MAAM,IAAI,KAAK,UAAU,YAAY,CAAC,EAAE,EAAE,MAAM;gBACpD,IAAI,MAAM,IAAI,KAAK,QAAQ,YAAY,CAAC,EAAE,EAAE,MAAM;gBAElD,SAAS,IAAI,CAAC;gBACd,aAAa,UAAU,MAAM;YAC/B;YAEA,OAAO,SAAS,IAAI,CAAC;QACvB;6CAAG;QAAC,KAAK,MAAM;KAAC;IAEhB,MAAM,YAAY,qBACd,CAAC,UAAU,EAAE,aAAa,CAAC,aAAa,SAAS,MAAM,EAAE,8BAA8B,CAAC,GACxF;IAEJ,qBACE,6LAAC,uMAAM,CAAC,GAAG;QACT,MAAM,eAAe;QACrB,cAAc;QACd,SAAS;YAAE,GAAG,KAAK,QAAQ,CAAC,CAAC;YAAE,GAAG,KAAK,QAAQ,CAAC,CAAC;YAAE,SAAS;YAAG,OAAO;QAAI;QAC1E,SAAS;YACP,GAAG,KAAK,QAAQ,CAAC,CAAC;YAClB,GAAG,KAAK,QAAQ,CAAC,CAAC;YAClB,SAAS;YACT,QAAQ,qBAAqB,IAAI;YACjC,OAAO,qBAAqB,OAAO;YACnC;YACA,aAAa,aAAa,CAAC,aAAa,0BAA0B,iBAAiB;QACrF;QACA,WAAW,CAAC,GAAG;YACb,OAAO;gBAAE,GAAG,KAAK,QAAQ,CAAC,CAAC,GAAG,KAAK,MAAM,CAAC,CAAC;gBAAE,GAAG,KAAK,QAAQ,CAAC,CAAC,GAAG,KAAK,MAAM,CAAC,CAAC;YAAC;QAClF;QACA,SAAS;QACT,YAAY;YACV,OAAO;YACP,QAAQ;YACR,WAAW;YACX,QAAQ;QACV;QACA,YAAY;YAAE,MAAM;YAAU,WAAW;YAAK,SAAS;QAAG;QAC1D,WAAW,CAAC,mCAAmC,EAAE,eAAe,YAAY,qBAAqB,kBAAkB;QACnH,OAAO;YACL,OAAO;YACP,iBAAiB,aAAa,YAAY;YAC1C,OAAO,aAAa,SAAS;YAC7B,iBAAiB;YACjB,cAAc;YACd,QAAQ,YAAY,CAAC,UAAU,EAAE,WAAW,GAAG,CAAC,UAAU,EAAE,aAAa,0BAA0B,mBAAmB;QACxH;;YAEC,eAAe,0BACd,6LAAC;gBACC,SAAS,CAAC;oBACR,EAAE,eAAe;oBACjB;gBACF;gBACA,WAAU;gBACV,OAAM;0BAEN,cAAA,6LAAC,oMAAC;oBAAC,MAAM;;;;;;;;;;;0BAKb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,WAAU;gCACV,yBAAyB;oCAAE,QAAQ,KAAK,KAAK,IAAI;gCAAW;;;;;;0CAE9D,6LAAC,mOAAU;gCAAC,MAAM;gCAAI,WAAU;gCAAoD,OAAO;oCAAE,OAAO,aAAa;gCAAU;;;;;;;;;;;;kCAE7H,6LAAC;wBAAE,WAAU;kCACV,eAAe,CAAC,WAAW,KAAK,aAAa;;;;;;oBAI/C,KAAK,IAAI,IAAI,KAAK,IAAI,CAAC,MAAM,GAAG,mBAC/B,6LAAC;wBAAI,WAAU;;4BACZ,KAAK,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAA,oBACzB,6LAAC;oCAAe,WAAU;;wCAAqH;wCAC3I;;mCADO;;;;;4BAIZ,KAAK,IAAI,CAAC,MAAM,GAAG,mBAClB,6LAAC;gCAAK,WAAU;;oCAA4D;oCAAE,KAAK,IAAI,CAAC,MAAM,GAAG;;;;;;;;;;;;;oBAKtG,0BACC,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,KAAK,CAAC,0CAA0C,EAAE,SAAS,QAAQ,CAAC,MAAM,CAAC;gCAC3E,KAAI;gCACJ,WAAU;gCACV,SAAS,CAAC;oCACP,EAAE,MAAM,CAAsB,KAAK,CAAC,OAAO,GAAG;gCACjD;;;;;;0CAEF,6LAAC;gCAAK,WAAU;0CACb,SAAS,QAAQ;;;;;;0CAEpB,6LAAC,yOAAY;gCAAC,MAAM;gCAAI,WAAU;;;;;;;;;;;;;;;;;;YAKvC,oCACC,6LAAC,uMAAM,CAAC,GAAG;gBACT,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAE;gBAC5B,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAE;gBAC5B,WAAU;gBACV,OAAO;oBAAE,iBAAiB,aAAa;gBAAU;0BAClD;;;;;;;;;;;;AAMT;IAnLM;MAAA"}},
    {"offset": {"line": 5491, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/graph/GraphView.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport { Note, GraphNode, GraphLink } from '../../types';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { Trash2, X } from 'lucide-react';\n\ninterface GraphViewProps {\n  notes: Note[];\n  onNoteSelect: (noteId: string) => void;\n  onDeleteNote: (noteId: string) => void;\n  isDarkMode: boolean;\n}\n\ninterface ContextMenuState {\n  x: number;\n  y: number;\n  nodeId: string;\n}\n\nexport const GraphView: React.FC<GraphViewProps> = ({ notes, onNoteSelect, onDeleteNote, isDarkMode }) => {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const [contextMenu, setContextMenu] = useState<ContextMenuState | null>(null);\n\n  const stripHtml = (html: string) => {\n    const tmp = document.createElement(\"DIV\");\n    tmp.innerHTML = html;\n    return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  useEffect(() => {\n    const handleClickOutside = () => setContextMenu(null);\n    window.addEventListener('click', handleClickOutside);\n    return () => window.removeEventListener('click', handleClickOutside);\n  }, []);\n\n  useEffect(() => {\n    if (!svgRef.current) return;\n\n    const width = svgRef.current.clientWidth;\n    const height = svgRef.current.clientHeight;\n\n    // Colors\n    const bgColor = isDarkMode ? \"#0a0a0a\" : \"#fff\";\n    const defaultNodeColor = isDarkMode ? \"#ffffff\" : \"#000000\";\n    const strokeColor = isDarkMode ? \"#404040\" : \"#e5e5e5\";\n    const textStrokeColor = isDarkMode ? \"#0a0a0a\" : \"#fff\";\n    const nodeStrokeColor = isDarkMode ? \"#0a0a0a\" : \"#fff\";\n\n    // Transform notes to graph data\n    const nodes: GraphNode[] = notes.map(n => ({\n      id: n.id,\n      title: n.title,\n      group: 1,\n      x: Math.random() * width,\n      y: Math.random() * height,\n      color: n.color\n    }));\n\n    const links: GraphLink[] = [];\n    notes.forEach(source => {\n      source.connections.forEach(targetId => {\n        if (notes.find(n => n.id === targetId)) {\n          links.push({ source: source.id, target: targetId });\n        }\n      });\n    });\n\n    // Clear previous\n    d3.select(svgRef.current).selectAll(\"*\").remove();\n\n    const svg = d3.select(svgRef.current)\n      .attr(\"viewBox\", [0, 0, width, height])\n      .style(\"background-color\", bgColor);\n\n    // Simulation\n    const simulation = d3.forceSimulation(nodes)\n      .force(\"link\", d3.forceLink(links).id((d: any) => d.id).distance(150))\n      .force(\"charge\", d3.forceManyBody().strength(-300))\n      .force(\"center\", d3.forceCenter(width / 2, height / 2))\n      .force(\"collide\", d3.forceCollide().radius(40));\n\n    // Draw Lines\n    const link = svg.append(\"g\")\n      .attr(\"stroke\", strokeColor)\n      .attr(\"stroke-opacity\", 0.8)\n      .selectAll(\"line\")\n      .data(links)\n      .join(\"line\")\n      .attr(\"stroke-width\", 2);\n\n    // Draw Nodes\n    const node = svg.append(\"g\")\n      .selectAll(\"g\")\n      .data(nodes)\n      .join(\"g\")\n      .attr(\"cursor\", \"pointer\")\n      .call(d3.drag<SVGGElement, GraphNode>()\n        .on(\"start\", dragstarted)\n        .on(\"drag\", dragged)\n        .on(\"end\", dragended) as any)\n      .on(\"click\", (event, d) => {\n        event.stopPropagation();\n        onNoteSelect(d.id);\n      })\n      .on(\"contextmenu\", (event, d) => {\n        event.preventDefault();\n        event.stopPropagation();\n        setContextMenu({\n          x: event.pageX,\n          y: event.pageY,\n          nodeId: d.id\n        });\n      });\n\n    // Circle\n    node.append(\"circle\")\n      .attr(\"r\", 10)\n      .attr(\"fill\", d => d.color && d.color !== '#000000' ? d.color : defaultNodeColor)\n      .attr(\"stroke\", nodeStrokeColor)\n      .attr(\"stroke-width\", 2);\n\n    // Labels\n    node.append(\"text\")\n      .attr(\"x\", 14)\n      .attr(\"y\", 4)\n      .text(d => stripHtml(d.title || \"Untitled\"))\n      .style(\"font-family\", \"Inter\")\n      .style(\"font-size\", \"12px\")\n      .style(\"font-weight\", \"500\")\n      .attr(\"fill\", isDarkMode ? \"#eee\" : \"#000\")\n      .clone(true).lower()\n      .attr(\"fill\", \"none\")\n      .attr(\"stroke\", textStrokeColor)\n      .attr(\"stroke-width\", 3);\n\n    simulation.on(\"tick\", () => {\n      link\n        .attr(\"x1\", (d: any) => d.source.x)\n        .attr(\"y1\", (d: any) => d.source.y)\n        .attr(\"x2\", (d: any) => d.target.x)\n        .attr(\"y2\", (d: any) => d.target.y);\n\n      node\n        .attr(\"transform\", (d: any) => `translate(${d.x},${d.y})`);\n    });\n\n    function dragstarted(event: any, d: any) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(event: any, d: any) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n\n    function dragended(event: any, d: any) {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n\n    return () => {\n      simulation.stop();\n    };\n  }, [notes, onNoteSelect, isDarkMode]);\n\n  return (\n    <div className=\"w-full h-full relative\">\n      <svg ref={svgRef} className=\"w-full h-full block transition-colors duration-300\" />\n      <div className=\"absolute bottom-8 right-8 bg-black dark:bg-white text-white dark:text-black px-4 py-2 shadow-xl rounded-none text-xs font-bold pointer-events-none\">\n        KNOWLEDGE GRAPH\n      </div>\n\n      {/* Context Menu */}\n      <AnimatePresence>\n        {contextMenu && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9, x: -10 }}\n            animate={{ opacity: 1, scale: 1, x: 0 }}\n            exit={{ opacity: 0, scale: 0.9 }}\n            style={{ top: contextMenu.y, left: contextMenu.x }}\n            className=\"fixed z-50 bg-white dark:bg-neutral-900 border-2 border-black dark:border-neutral-600 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] dark:shadow-[4px_4px_0px_0px_rgba(255,255,255,0.1)] p-1 min-w-[120px]\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <button\n              onClick={() => {\n                onDeleteNote(contextMenu.nodeId);\n                setContextMenu(null);\n              }}\n              className=\"w-full flex items-center gap-2 px-3 py-2 text-xs font-bold text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors uppercase tracking-wide\"\n            >\n              <Trash2 size={14} />\n              Delete Note\n            </button>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;;;;;;;AAeO,MAAM,YAAsC,CAAC,EAAE,KAAK,EAAE,YAAY,EAAE,YAAY,EAAE,UAAU,EAAE;;IACnG,MAAM,SAAS,IAAA,uKAAM,EAAgB;IACrC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAA0B;IAExE,MAAM,YAAY,CAAC;QACjB,MAAM,MAAM,SAAS,aAAa,CAAC;QACnC,IAAI,SAAS,GAAG;QAChB,OAAO,IAAI,WAAW,IAAI,IAAI,SAAS,IAAI;IAC7C;IAEA,IAAA,0KAAS;+BAAC;YACR,MAAM;0DAAqB,IAAM,eAAe;;YAChD,OAAO,gBAAgB,CAAC,SAAS;YACjC;uCAAO,IAAM,OAAO,mBAAmB,CAAC,SAAS;;QACnD;8BAAG,EAAE;IAEL,IAAA,0KAAS;+BAAC;YACR,IAAI,CAAC,OAAO,OAAO,EAAE;YAErB,MAAM,QAAQ,OAAO,OAAO,CAAC,WAAW;YACxC,MAAM,SAAS,OAAO,OAAO,CAAC,YAAY;YAE1C,SAAS;YACT,MAAM,UAAU,aAAa,YAAY;YACzC,MAAM,mBAAmB,aAAa,YAAY;YAClD,MAAM,cAAc,aAAa,YAAY;YAC7C,MAAM,kBAAkB,aAAa,YAAY;YACjD,MAAM,kBAAkB,aAAa,YAAY;YAEjD,gCAAgC;YAChC,MAAM,QAAqB,MAAM,GAAG;6CAAC,CAAA,IAAK,CAAC;wBACzC,IAAI,EAAE,EAAE;wBACR,OAAO,EAAE,KAAK;wBACd,OAAO;wBACP,GAAG,KAAK,MAAM,KAAK;wBACnB,GAAG,KAAK,MAAM,KAAK;wBACnB,OAAO,EAAE,KAAK;oBAChB,CAAC;;YAED,MAAM,QAAqB,EAAE;YAC7B,MAAM,OAAO;uCAAC,CAAA;oBACZ,OAAO,WAAW,CAAC,OAAO;+CAAC,CAAA;4BACzB,IAAI,MAAM,IAAI;uDAAC,CAAA,IAAK,EAAE,EAAE,KAAK;uDAAW;gCACtC,MAAM,IAAI,CAAC;oCAAE,QAAQ,OAAO,EAAE;oCAAE,QAAQ;gCAAS;4BACnD;wBACF;;gBACF;;YAEA,iBAAiB;YACjB,kMAAS,CAAC,OAAO,OAAO,EAAE,SAAS,CAAC,KAAK,MAAM;YAE/C,MAAM,MAAM,kMAAS,CAAC,OAAO,OAAO,EACjC,IAAI,CAAC,WAAW;gBAAC;gBAAG;gBAAG;gBAAO;aAAO,EACrC,KAAK,CAAC,oBAAoB;YAE7B,aAAa;YACb,MAAM,aAAa,oNAAkB,CAAC,OACnC,KAAK,CAAC,QAAQ,kMAAY,CAAC,OAAO,EAAE;kDAAC,CAAC,IAAW,EAAE,EAAE;iDAAE,QAAQ,CAAC,MAChE,KAAK,CAAC,UAAU,8MAAgB,GAAG,QAAQ,CAAC,CAAC,MAC7C,KAAK,CAAC,UAAU,wMAAc,CAAC,QAAQ,GAAG,SAAS,IACnD,KAAK,CAAC,WAAW,2MAAe,GAAG,MAAM,CAAC;YAE7C,aAAa;YACb,MAAM,OAAO,IAAI,MAAM,CAAC,KACrB,IAAI,CAAC,UAAU,aACf,IAAI,CAAC,kBAAkB,KACvB,SAAS,CAAC,QACV,IAAI,CAAC,OACL,IAAI,CAAC,QACL,IAAI,CAAC,gBAAgB;YAExB,aAAa;YACb,MAAM,OAAO,IAAI,MAAM,CAAC,KACrB,SAAS,CAAC,KACV,IAAI,CAAC,OACL,IAAI,CAAC,KACL,IAAI,CAAC,UAAU,WACf,IAAI,CAAC,uLAAO,GACV,EAAE,CAAC,SAAS,aACZ,EAAE,CAAC,QAAQ,SACX,EAAE,CAAC,OAAO,YACZ,EAAE,CAAC;4CAAS,CAAC,OAAO;oBACnB,MAAM,eAAe;oBACrB,aAAa,EAAE,EAAE;gBACnB;2CACC,EAAE,CAAC;4CAAe,CAAC,OAAO;oBACzB,MAAM,cAAc;oBACpB,MAAM,eAAe;oBACrB,eAAe;wBACb,GAAG,MAAM,KAAK;wBACd,GAAG,MAAM,KAAK;wBACd,QAAQ,EAAE,EAAE;oBACd;gBACF;;YAEF,SAAS;YACT,KAAK,MAAM,CAAC,UACT,IAAI,CAAC,KAAK,IACV,IAAI,CAAC;uCAAQ,CAAA,IAAK,EAAE,KAAK,IAAI,EAAE,KAAK,KAAK,YAAY,EAAE,KAAK,GAAG;sCAC/D,IAAI,CAAC,UAAU,iBACf,IAAI,CAAC,gBAAgB;YAExB,SAAS;YACT,KAAK,MAAM,CAAC,QACT,IAAI,CAAC,KAAK,IACV,IAAI,CAAC,KAAK,GACV,IAAI;uCAAC,CAAA,IAAK,UAAU,EAAE,KAAK,IAAI;sCAC/B,KAAK,CAAC,eAAe,SACrB,KAAK,CAAC,aAAa,QACnB,KAAK,CAAC,eAAe,OACrB,IAAI,CAAC,QAAQ,aAAa,SAAS,QACnC,KAAK,CAAC,MAAM,KAAK,GACjB,IAAI,CAAC,QAAQ,QACb,IAAI,CAAC,UAAU,iBACf,IAAI,CAAC,gBAAgB;YAExB,WAAW,EAAE,CAAC;uCAAQ;oBACpB,KACG,IAAI,CAAC;+CAAM,CAAC,IAAW,EAAE,MAAM,CAAC,CAAC;8CACjC,IAAI,CAAC;+CAAM,CAAC,IAAW,EAAE,MAAM,CAAC,CAAC;8CACjC,IAAI,CAAC;+CAAM,CAAC,IAAW,EAAE,MAAM,CAAC,CAAC;8CACjC,IAAI,CAAC;+CAAM,CAAC,IAAW,EAAE,MAAM,CAAC,CAAC;;oBAEpC,KACG,IAAI,CAAC;+CAAa,CAAC,IAAW,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC;;gBAC7D;;YAEA,SAAS,YAAY,KAAU,EAAE,CAAM;gBACrC,IAAI,CAAC,MAAM,MAAM,EAAE,WAAW,WAAW,CAAC,KAAK,OAAO;gBACtD,EAAE,EAAE,GAAG,EAAE,CAAC;gBACV,EAAE,EAAE,GAAG,EAAE,CAAC;YACZ;YAEA,SAAS,QAAQ,KAAU,EAAE,CAAM;gBACjC,EAAE,EAAE,GAAG,MAAM,CAAC;gBACd,EAAE,EAAE,GAAG,MAAM,CAAC;YAChB;YAEA,SAAS,UAAU,KAAU,EAAE,CAAM;gBACnC,IAAI,CAAC,MAAM,MAAM,EAAE,WAAW,WAAW,CAAC;gBAC1C,EAAE,EAAE,GAAG;gBACP,EAAE,EAAE,GAAG;YACT;YAEA;uCAAO;oBACL,WAAW,IAAI;gBACjB;;QACF;8BAAG;QAAC;QAAO;QAAc;KAAW;IAEpC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,KAAK;gBAAQ,WAAU;;;;;;0BAC5B,6LAAC;gBAAI,WAAU;0BAAqJ;;;;;;0BAKpK,6LAAC,+MAAe;0BACb,6BACC,6LAAC,uMAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAK,GAAG,CAAC;oBAAG;oBAC1C,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAG,GAAG;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,OAAO;oBAAI;oBAC/B,OAAO;wBAAE,KAAK,YAAY,CAAC;wBAAE,MAAM,YAAY,CAAC;oBAAC;oBACjD,WAAU;oBACV,SAAS,CAAC,IAAM,EAAE,eAAe;8BAEjC,cAAA,6LAAC;wBACC,SAAS;4BACP,aAAa,YAAY,MAAM;4BAC/B,eAAe;wBACjB;wBACA,WAAU;;0CAEV,6LAAC,uNAAM;gCAAC,MAAM;;;;;;4BAAM;;;;;;;;;;;;;;;;;;;;;;;AAQlC;GAtLa;KAAA"}},
    {"offset": {"line": 5743, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/ui/UnsavedChangesModal.tsx"],"sourcesContent":["import React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { AlertTriangle, Save, X, Trash2 } from 'lucide-react';\r\n\r\ninterface UnsavedChangesModalProps {\r\n    isOpen: boolean;\r\n    onSaveAndLeave: () => void;\r\n    onDiscardAndLeave: () => void;\r\n    onCancel: () => void;\r\n}\r\n\r\nexport const UnsavedChangesModal: React.FC<UnsavedChangesModalProps> = ({\r\n    isOpen,\r\n    onSaveAndLeave,\r\n    onDiscardAndLeave,\r\n    onCancel\r\n}) => {\r\n    return (\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <>\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"fixed inset-0 bg-white/90 dark:bg-black/90 backdrop-blur-sm z-[100]\"\r\n                        onClick={onCancel}\r\n                    />\r\n                    <motion.div\r\n                        initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                        animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                        exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                        className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white dark:bg-neutral-900 border-2 border-black dark:border-neutral-600 p-8 z-[101] shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] dark:shadow-[8px_8px_0px_0px_rgba(255,255,255,0.1)]\"\r\n                    >\r\n                        <div className=\"flex justify-between items-start mb-6\">\r\n                            <div className=\"flex items-center gap-3 text-black dark:text-white\">\r\n                                <AlertTriangle size={24} strokeWidth={2} className=\"text-yellow-500\" />\r\n                                <h2 className=\"text-xl font-black uppercase tracking-wide\">Unsaved Changes</h2>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <p className=\"text-gray-600 dark:text-neutral-400 font-medium mb-10 leading-relaxed\">\r\n                            You have unsaved changes in this note. If you leave now, your changes will be lost.\r\n                        </p>\r\n\r\n                        <div className=\"flex flex-col gap-3\">\r\n                            <button\r\n                                onClick={onSaveAndLeave}\r\n                                className=\"w-full py-3 bg-black dark:bg-white text-white dark:text-black font-bold border-2 border-black dark:border-white hover:bg-gray-900 dark:hover:bg-gray-200 transition-colors text-sm uppercase tracking-wider flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Save size={16} />\r\n                                Save & Leave\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={onDiscardAndLeave}\r\n                                className=\"w-full py-3 border-2 border-red-500 text-red-600 dark:text-red-400 font-bold hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-sm uppercase tracking-wider flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Trash2 size={16} />\r\n                                Discard Changes\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={onCancel}\r\n                                className=\"w-full py-3 text-gray-500 dark:text-neutral-500 font-bold hover:text-black dark:hover:text-white transition-colors text-sm uppercase tracking-wider flex items-center justify-center gap-2\"\r\n                            >\r\n                                <X size={16} />\r\n                                Cancel\r\n                            </button>\r\n                        </div>\r\n                    </motion.div>\r\n                </>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;AAAA;AACA;AAAA;AAAA;AAAA;;;;AASO,MAAM,sBAA0D,CAAC,EACpE,MAAM,EACN,cAAc,EACd,iBAAiB,EACjB,QAAQ,EACX;IACG,qBACI,6LAAC,+MAAe;kBACX,wBACG;;8BACI,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,SAAS;oBAAE;oBACtB,SAAS;wBAAE,SAAS;oBAAE;oBACtB,MAAM;wBAAE,SAAS;oBAAE;oBACnB,WAAU;oBACV,SAAS;;;;;;8BAEb,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBAC1C,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAG,GAAG;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBACvC,WAAU;;sCAEV,6LAAC;4BAAI,WAAU;sCACX,cAAA,6LAAC;gCAAI,WAAU;;kDACX,6LAAC,4OAAa;wCAAC,MAAM;wCAAI,aAAa;wCAAG,WAAU;;;;;;kDACnD,6LAAC;wCAAG,WAAU;kDAA6C;;;;;;;;;;;;;;;;;sCAInE,6LAAC;4BAAE,WAAU;sCAAwE;;;;;;sCAIrF,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCACG,SAAS;oCACT,WAAU;;sDAEV,6LAAC,6MAAI;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAItB,6LAAC;oCACG,SAAS;oCACT,WAAU;;sDAEV,6LAAC,uNAAM;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAIxB,6LAAC;oCACG,SAAS;oCACT,WAAU;;sDAEV,6LAAC,oMAAC;4CAAC,MAAM;;;;;;wCAAM;;;;;;;;;;;;;;;;;;;;;;;;;;AAS/C;KAhEa"}},
    {"offset": {"line": 5924, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/hooks/useHistory.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\n\nexport type HistoryMode = 'PUSH' | 'REPLACE';\n\ninterface HistoryState<T> {\n  past: T[];\n  present: T;\n  future: T[];\n}\n\nexport function useHistory<T>(initialPresent: T) {\n  const [state, setState] = useState<HistoryState<T>>({\n    past: [],\n    present: initialPresent,\n    future: [],\n  });\n\n  const canUndo = state.past.length > 0;\n  const canRedo = state.future.length > 0;\n\n  const undo = useCallback(() => {\n    setState((currentState) => {\n      if (currentState.past.length === 0) return currentState;\n\n      const previous = currentState.past[currentState.past.length - 1];\n      const newPast = currentState.past.slice(0, currentState.past.length - 1);\n\n      return {\n        past: newPast,\n        present: previous,\n        future: [currentState.present, ...currentState.future],\n      };\n    });\n  }, []);\n\n  const redo = useCallback(() => {\n    setState((currentState) => {\n      if (currentState.future.length === 0) return currentState;\n\n      const next = currentState.future[0];\n      const newFuture = currentState.future.slice(1);\n\n      return {\n        past: [...currentState.past, currentState.present],\n        present: next,\n        future: newFuture,\n      };\n    });\n  }, []);\n\n  const set = useCallback((newPresent: T, mode: HistoryMode = 'PUSH') => {\n    setState((currentState) => {\n      // Prevent pushing if state hasn't effectively changed, though strict equality might not be enough for objects\n      // We assume caller handles significant changes\n      if (mode === 'REPLACE') {\n        return { ...currentState, present: newPresent };\n      }\n      return {\n        past: [...currentState.past, currentState.present],\n        present: newPresent,\n        future: [],\n      };\n    });\n  }, []);\n\n  return { \n    state: state.present, \n    set, \n    undo, \n    redo, \n    canUndo, \n    canRedo \n  };\n}"],"names":[],"mappings":";;;;AAAA;;;AAUO,SAAS,WAAc,cAAiB;;IAC7C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAkB;QAClD,MAAM,EAAE;QACR,SAAS;QACT,QAAQ,EAAE;IACZ;IAEA,MAAM,UAAU,MAAM,IAAI,CAAC,MAAM,GAAG;IACpC,MAAM,UAAU,MAAM,MAAM,CAAC,MAAM,GAAG;IAEtC,MAAM,OAAO,IAAA,4KAAW;wCAAC;YACvB;gDAAS,CAAC;oBACR,IAAI,aAAa,IAAI,CAAC,MAAM,KAAK,GAAG,OAAO;oBAE3C,MAAM,WAAW,aAAa,IAAI,CAAC,aAAa,IAAI,CAAC,MAAM,GAAG,EAAE;oBAChE,MAAM,UAAU,aAAa,IAAI,CAAC,KAAK,CAAC,GAAG,aAAa,IAAI,CAAC,MAAM,GAAG;oBAEtE,OAAO;wBACL,MAAM;wBACN,SAAS;wBACT,QAAQ;4BAAC,aAAa,OAAO;+BAAK,aAAa,MAAM;yBAAC;oBACxD;gBACF;;QACF;uCAAG,EAAE;IAEL,MAAM,OAAO,IAAA,4KAAW;wCAAC;YACvB;gDAAS,CAAC;oBACR,IAAI,aAAa,MAAM,CAAC,MAAM,KAAK,GAAG,OAAO;oBAE7C,MAAM,OAAO,aAAa,MAAM,CAAC,EAAE;oBACnC,MAAM,YAAY,aAAa,MAAM,CAAC,KAAK,CAAC;oBAE5C,OAAO;wBACL,MAAM;+BAAI,aAAa,IAAI;4BAAE,aAAa,OAAO;yBAAC;wBAClD,SAAS;wBACT,QAAQ;oBACV;gBACF;;QACF;uCAAG,EAAE;IAEL,MAAM,MAAM,IAAA,4KAAW;uCAAC,CAAC,YAAe,OAAoB,MAAM;YAChE;+CAAS,CAAC;oBACR,8GAA8G;oBAC9G,+CAA+C;oBAC/C,IAAI,SAAS,WAAW;wBACtB,OAAO;4BAAE,GAAG,YAAY;4BAAE,SAAS;wBAAW;oBAChD;oBACA,OAAO;wBACL,MAAM;+BAAI,aAAa,IAAI;4BAAE,aAAa,OAAO;yBAAC;wBAClD,SAAS;wBACT,QAAQ,EAAE;oBACZ;gBACF;;QACF;sCAAG,EAAE;IAEL,OAAO;QACL,OAAO,MAAM,OAAO;QACpB;QACA;QACA;QACA;QACA;IACF;AACF;GA/DgB"}},
    {"offset": {"line": 6019, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/ui/SearchPalette.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Search, FileText, CornerDownLeft, X } from 'lucide-react';\nimport { Note } from '../../types';\n\ninterface SearchPaletteProps {\n  isOpen: boolean;\n  onClose: () => void;\n  notes: Note[];\n  onSelectNote: (noteId: string) => void;\n}\n\nexport const SearchPalette: React.FC<SearchPaletteProps> = ({\n  isOpen,\n  onClose,\n  notes,\n  onSelectNote\n}) => {\n  const [query, setQuery] = useState('');\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      setTimeout(() => inputRef.current?.focus(), 100);\n      setQuery('');\n      setSelectedIndex(0);\n    }\n  }, [isOpen]);\n\n  // Filtering Logic\n  const filteredNotes = notes.filter(note => {\n    if (!query) return true;\n    const lowerQuery = query.toLowerCase();\n    // Naive stripping for search comparison\n    const cleanTitle = (note.title || \"\").replace(/<[^>]*>?/gm, '').toLowerCase();\n    const tagsMatch = note.tags?.some(t => t.toLowerCase().includes(lowerQuery));\n    \n    return (\n      cleanTitle.includes(lowerQuery) ||\n      tagsMatch ||\n      note.blocks.some(b => b.content.toLowerCase().includes(lowerQuery))\n    );\n  }).slice(0, 5); // Limit to 5 results for clean UI\n\n  // Keyboard Navigation\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (!isOpen) return;\n\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSelectedIndex(prev => (prev + 1) % filteredNotes.length);\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSelectedIndex(prev => (prev - 1 + filteredNotes.length) % filteredNotes.length);\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        if (filteredNotes[selectedIndex]) {\n          onSelectNote(filteredNotes[selectedIndex].id);\n          onClose();\n        }\n      } else if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, filteredNotes, selectedIndex, onSelectNote, onClose]);\n\n  const stripHtml = (html: string) => {\n     const tmp = document.createElement(\"DIV\");\n     tmp.innerHTML = html;\n     return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 bg-white/80 dark:bg-black/80 backdrop-blur-sm z-[60]\"\n          />\n          \n          {/* Palette Container */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: -20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: -20 }}\n            transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n            className=\"fixed top-32 left-1/2 -translate-x-1/2 w-full max-w-xl z-[70] px-4 pointer-events-none\"\n          >\n             <div className=\"bg-white dark:bg-neutral-900 border-2 border-black dark:border-neutral-600 shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] dark:shadow-[8px_8px_0px_0px_rgba(255,255,255,0.1)] pointer-events-auto overflow-hidden flex flex-col\">\n                {/* Search Input */}\n                <div className=\"flex items-center border-b-2 border-black/5 dark:border-white/5 px-4 py-4\">\n                    <Search className=\"text-black dark:text-white w-5 h-5 mr-3\" strokeWidth={3} />\n                    <input\n                        ref={inputRef}\n                        type=\"text\"\n                        value={query}\n                        onChange={(e) => {\n                            setQuery(e.target.value);\n                            setSelectedIndex(0);\n                        }}\n                        placeholder=\"Search notes or #tags...\"\n                        className=\"flex-1 bg-transparent text-xl font-bold placeholder:text-gray-300 dark:placeholder:text-neutral-700 outline-none text-black dark:text-white\"\n                    />\n                    <button onClick={onClose} className=\"text-gray-400 dark:text-neutral-500 hover:text-black dark:hover:text-white transition-transform hover:scale-110\">\n                        <X size={20} />\n                    </button>\n                </div>\n\n                {/* Results List */}\n                <div className=\"max-h-[400px] overflow-y-auto custom-scrollbar p-2 space-y-1\">\n                    {filteredNotes.length === 0 ? (\n                         <div className=\"py-8 text-center text-gray-400 dark:text-neutral-600 font-medium\">\n                             No results found.\n                         </div>\n                    ) : (\n                        filteredNotes.map((note, index) => (\n                            <motion.div\n                                key={note.id}\n                                layout\n                                initial={{ opacity: 0, x: -10 }}\n                                animate={{ \n                                    opacity: 1, \n                                    x: index === selectedIndex ? 6 : 0,\n                                    scale: index === selectedIndex ? 1.02 : 1,\n                                    backgroundColor: index === selectedIndex ? '#000000' : 'transparent',\n                                    color: index === selectedIndex ? '#ffffff' : 'inherit'\n                                }}\n                                style={index !== selectedIndex ? { \n                                    backgroundColor: 'transparent',\n                                    color: 'inherit'\n                                } : undefined}\n                                whileHover={{ scale: 1.02, x: 6 }}\n                                transition={{ type: 'spring', stiffness: 400, damping: 25 }}\n                                onClick={() => {\n                                    onSelectNote(note.id);\n                                    onClose();\n                                }}\n                                onMouseEnter={() => setSelectedIndex(index)}\n                                className={`flex items-center justify-between p-3 rounded-lg cursor-pointer ${index === selectedIndex ? 'dark:bg-white dark:text-black' : 'text-black dark:text-neutral-300'}`}\n                            >\n                                <div className=\"flex items-center gap-3 overflow-hidden\">\n                                    <FileText size={18} className={`flex-shrink-0 transition-colors ${index === selectedIndex ? 'text-white dark:text-black' : 'text-gray-400 dark:text-neutral-600'}`} />\n                                    <div className=\"flex flex-col overflow-hidden\">\n                                        <div className=\"flex items-center gap-2\">\n                                            <span \n                                                className=\"font-bold truncate\"\n                                                dangerouslySetInnerHTML={{ __html: note.title || \"Untitled\" }}\n                                            />\n                                            {note.tags && note.tags.length > 0 && (\n                                                <div className=\"flex gap-1\">\n                                                    {note.tags.map(tag => (\n                                                        <span \n                                                            key={tag} \n                                                            className={`text-[9px] px-1.5 rounded-sm font-bold uppercase ${\n                                                                index === selectedIndex \n                                                                    ? 'bg-white/20 text-white dark:bg-black/20 dark:text-black' \n                                                                    : 'bg-gray-100 dark:bg-neutral-800 text-gray-500 dark:text-neutral-400'\n                                                            }`}\n                                                        >\n                                                            #{tag}\n                                                        </span>\n                                                    ))}\n                                                </div>\n                                            )}\n                                        </div>\n                                        <span className={`text-xs truncate transition-colors ${index === selectedIndex ? 'text-gray-400 dark:text-neutral-500' : 'text-gray-500 dark:text-neutral-500'}`}>\n                                            {stripHtml(note.blocks.find(b => b.content)?.content || \"\") || \"Empty note\"}\n                                        </span>\n                                    </div>\n                                </div>\n                                {index === selectedIndex && (\n                                    <motion.div\n                                        initial={{ opacity: 0, x: -5 }}\n                                        animate={{ opacity: 1, x: 0 }}\n                                    >\n                                        <CornerDownLeft size={16} className=\"text-gray-500 dark:text-neutral-400 flex-shrink-0\" />\n                                    </motion.div>\n                                )}\n                            </motion.div>\n                        ))\n                    )}\n                </div>\n                \n                {/* Footer */}\n                <div className=\"bg-gray-50 dark:bg-neutral-800 px-4 py-2 flex justify-between text-[10px] text-gray-400 dark:text-neutral-500 font-mono uppercase tracking-wider border-t border-black/5 dark:border-white/5\">\n                     <span>Pro Tip: Use arrow keys to navigate</span>\n                     <span>ESC to close</span>\n                </div>\n             </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6398, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/ui/AIMagicModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Sparkles, X, ArrowRight } from 'lucide-react';\n\ninterface AIMagicModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onGenerate: (prompt: string) => void;\n  isGenerating: boolean;\n}\n\nexport const AIMagicModal: React.FC<AIMagicModalProps> = ({\n  isOpen,\n  onClose,\n  onGenerate,\n  isGenerating\n}) => {\n  const [prompt, setPrompt] = useState('');\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      setTimeout(() => inputRef.current?.focus(), 100);\n      setPrompt('');\n    }\n  }, [isOpen]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (prompt.trim() && !isGenerating) {\n      onGenerate(prompt);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit(e);\n    }\n    if (e.key === 'Escape') {\n        onClose();\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={!isGenerating ? onClose : undefined}\n            className=\"fixed inset-0 bg-white/90 dark:bg-black/90 backdrop-blur-sm z-[100]\"\n          />\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg bg-white dark:bg-neutral-900 border-2 border-black dark:border-neutral-600 p-0 z-[101] shadow-[12px_12px_0px_0px_rgba(0,0,0,1)] dark:shadow-[12px_12px_0px_0px_rgba(255,255,255,0.1)]\"\n          >\n            <div className=\"bg-black dark:bg-white text-white dark:text-black p-4 flex justify-between items-center\">\n                <div className=\"flex items-center gap-2\">\n                    <Sparkles size={18} className=\"animate-pulse\" />\n                    <span className=\"font-bold tracking-wider text-sm uppercase\">Gemini Magic Create</span>\n                </div>\n                <button onClick={onClose} disabled={isGenerating} className=\"hover:text-gray-300 dark:hover:text-gray-600 disabled:opacity-50\">\n                    <X size={18} />\n                </button>\n            </div>\n\n            <div className=\"p-6\">\n                <p className=\"text-sm text-gray-500 dark:text-neutral-400 font-mono mb-4 uppercase tracking-wide\">\n                    Describe your thought, project, or idea...\n                </p>\n                \n                <textarea\n                    ref={inputRef}\n                    value={prompt}\n                    onChange={(e) => setPrompt(e.target.value)}\n                    onKeyDown={handleKeyDown}\n                    disabled={isGenerating}\n                    placeholder=\"e.g., A marketing plan for a coffee shop in Tokyo...\"\n                    className=\"w-full h-32 text-xl font-bold resize-none outline-none placeholder:text-gray-200 dark:placeholder:text-neutral-700 bg-transparent text-black dark:text-white\"\n                />\n\n                <div className=\"flex justify-end mt-6\">\n                    <button\n                        onClick={handleSubmit}\n                        disabled={!prompt.trim() || isGenerating}\n                        className=\"bg-black dark:bg-white text-white dark:text-black px-6 py-3 font-bold flex items-center gap-3 hover:bg-gray-800 dark:hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95\"\n                    >\n                        {isGenerating ? (\n                            <>\n                                <span className=\"w-4 h-4 border-2 border-white dark:border-black border-t-transparent rounded-full animate-spin\" />\n                                Creating...\n                            </>\n                        ) : (\n                            <>\n                                GENERATE\n                                <ArrowRight size={16} />\n                            </>\n                        )}\n                    </button>\n                </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;AAAA;AAAA;;;;;;AASO,MAAM,eAA4C,CAAC,EACxD,MAAM,EACN,OAAO,EACP,UAAU,EACV,YAAY,EACb;;IACC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,WAAW,IAAA,uKAAM,EAAsB;IAE7C,IAAA,0KAAS;kCAAC;YACR,IAAI,QAAQ;gBACV;8CAAW,IAAM,SAAS,OAAO,EAAE;6CAAS;gBAC5C,UAAU;YACZ;QACF;iCAAG;QAAC;KAAO;IAEX,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,IAAI,OAAO,IAAI,MAAM,CAAC,cAAc;YAClC,WAAW;QACb;IACF;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,QAAQ,EAAE;YACpC,EAAE,cAAc;YAChB,aAAa;QACf;QACA,IAAI,EAAE,GAAG,KAAK,UAAU;YACpB;QACJ;IACF;IAEA,qBACE,6LAAC,+MAAe;kBACb,wBACC;;8BACE,6LAAC,uMAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;oBAAE;oBACtB,SAAS;wBAAE,SAAS;oBAAE;oBACtB,MAAM;wBAAE,SAAS;oBAAE;oBACnB,SAAS,CAAC,eAAe,UAAU;oBACnC,WAAU;;;;;;8BAEZ,6LAAC,uMAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBAC1C,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAG,GAAG;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBACvC,WAAU;;sCAEV,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAI,WAAU;;sDACX,6LAAC,yNAAQ;4CAAC,MAAM;4CAAI,WAAU;;;;;;sDAC9B,6LAAC;4CAAK,WAAU;sDAA6C;;;;;;;;;;;;8CAEjE,6LAAC;oCAAO,SAAS;oCAAS,UAAU;oCAAc,WAAU;8CACxD,cAAA,6LAAC,oMAAC;wCAAC,MAAM;;;;;;;;;;;;;;;;;sCAIjB,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAE,WAAU;8CAAqF;;;;;;8CAIlG,6LAAC;oCACG,KAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;oCACzC,WAAW;oCACX,UAAU;oCACV,aAAY;oCACZ,WAAU;;;;;;8CAGd,6LAAC;oCAAI,WAAU;8CACX,cAAA,6LAAC;wCACG,SAAS;wCACT,UAAU,CAAC,OAAO,IAAI,MAAM;wCAC5B,WAAU;kDAET,6BACG;;8DACI,6LAAC;oDAAK,WAAU;;;;;;gDAAmG;;yEAIvH;;gDAAE;8DAEE,6LAAC,mOAAU;oDAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWlD;GApGa;KAAA"}},
    {"offset": {"line": 6627, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/services/geminiService.ts"],"sourcesContent":["'use server';\n\nimport { GoogleGenAI, Type } from \"@google/genai\";\n\nconst getClient = () => {\n  const apiKey = process.env.GEMINI_API_KEY;\n  if (!apiKey) {\n    console.warn(\"API Key not found\");\n    return null;\n  }\n  return new GoogleGenAI({ apiKey });\n};\n\nexport const expandNoteWithAI = async (currentContent: string): Promise<string> => {\n  const ai = getClient();\n  if (!ai) return \"Error: API Key missing.\";\n\n  try {\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-pro',\n      contents: `You are a minimalist productivity assistant. \n      Take the following note content and expand upon it with 3 actionable bullet points \n      or a brief summary paragraph. Keep the tone strict, professional, and concise.\n      \n      Input: \"${currentContent}\"`,\n    });\n\n    return response.text || \"No response generated.\";\n  } catch (error) {\n    console.error(\"Gemini API Error:\", error);\n    return \"Failed to generate insight.\";\n  }\n};\n\nexport const generateConnections = async (notes: { id: string, title: string }[]) => {\n  const ai = getClient();\n  if (!ai) return [];\n\n  try {\n    // Logic to suggest connections between notes based on titles\n    // Placeholder for advanced graph RAG\n    return [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport const generateNoteFromPrompt = async (prompt: string): Promise<{ title: string; content: string } | null> => {\n  const ai = getClient();\n  if (!ai) return null;\n\n  try {\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-pro',\n      contents: `Generate a creative and structured note based on the following user prompt: \"${prompt}\". \n        The title should be concise and catchy. The content should be a well-structured starting point (e.g., a list, a summary, or a draft).`,\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: Type.OBJECT,\n          properties: {\n            title: { type: Type.STRING },\n            content: { type: Type.STRING }\n          },\n          required: [\"title\", \"content\"]\n        }\n      }\n    });\n\n    const text = response.text;\n    if (text) {\n      return JSON.parse(text);\n    }\n    return null;\n  } catch (e) {\n    console.error(\"Gemini Magic Create Error:\", e);\n    return null;\n  }\n}"],"names":[],"mappings":";;;;;;;IA+Ca,yBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 6642, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IAuJsB,WAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 6657, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IAsLsB,WAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 6672, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IA6NsB,mBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 6687, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IAkJsB,gBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 6702, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IA6GsB,oBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 6717, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/auth/AvatarFrame.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface AvatarFrameProps {\r\n    role?: 'USER' | 'ADMIN';\r\n    children: React.ReactNode;\r\n    className?: string;\r\n}\r\n\r\nexport const AvatarFrame = ({ role = 'USER', children, className = '' }: AvatarFrameProps) => {\r\n    if (role === 'ADMIN') {\r\n        return (\r\n            <div className={`relative flex items-center justify-center ${className}`}>\r\n                {/* Admin: Cyber Shield / Glitch Core */}\r\n\r\n                {/* Rotating Outer Hexagon */}\r\n                <motion.div\r\n                    animate={{ rotate: 360 }}\r\n                    transition={{ duration: 20, repeat: Infinity, ease: \"linear\" }}\r\n                    className=\"absolute inset-[-8px] border-2 border-red-500/30 rounded-[30%] opacity-60\"\r\n                    style={{ clipPath: 'polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)' }}\r\n                />\r\n\r\n                {/* Counter-Rotating Inner Hexagon */}\r\n                <motion.div\r\n                    animate={{ rotate: -360 }}\r\n                    transition={{ duration: 15, repeat: Infinity, ease: \"linear\" }}\r\n                    className=\"absolute inset-[-4px] border border-yellow-500/40 rounded-[30%] opacity-80\"\r\n                    style={{ clipPath: 'polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)' }}\r\n                />\r\n\r\n                {/* Glitch Spikes */}\r\n                <motion.div\r\n                    animate={{\r\n                        scale: [1, 1.1, 1],\r\n                        opacity: [0.5, 0.8, 0.5],\r\n                        rotate: [0, 5, -5, 0]\r\n                    }}\r\n                    transition={{ duration: 0.2, repeat: Infinity, repeatDelay: 3 }}\r\n                    className=\"absolute inset-[-12px] border-t-2 border-b-2 border-red-600/60 rounded-full\"\r\n                />\r\n\r\n                {/* Core Glow */}\r\n                <div className=\"absolute inset-0 bg-red-500/10 blur-xl rounded-full\" />\r\n\r\n                {/* Content Container */}\r\n                <div className=\"relative z-10 w-full h-full rounded-full overflow-hidden border-2 border-red-500/50 shadow-[0_0_15px_rgba(239,68,68,0.4)] bg-black\">\r\n                    {children}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // User: Holographic Gyroscope\r\n    return (\r\n        <div className={`relative flex items-center justify-center ${className}`}>\r\n            {/* Outer Ring - Slow */}\r\n            <motion.div\r\n                animate={{ rotateX: 360, rotateY: 180 }}\r\n                transition={{ duration: 10, repeat: Infinity, ease: \"linear\" }}\r\n                className=\"absolute inset-[-8px] rounded-full border border-blue-400/30 border-dashed\"\r\n                style={{ perspective: 1000 }}\r\n            />\r\n\r\n            {/* Middle Ring - Medium */}\r\n            <motion.div\r\n                animate={{ rotateY: -360, rotateZ: 45 }}\r\n                transition={{ duration: 7, repeat: Infinity, ease: \"linear\" }}\r\n                className=\"absolute inset-[-4px] rounded-full border border-purple-400/40\"\r\n            />\r\n\r\n            {/* Inner Ring - Fast */}\r\n            <motion.div\r\n                animate={{ rotateZ: 360 }}\r\n                transition={{ duration: 4, repeat: Infinity, ease: \"linear\" }}\r\n                className=\"absolute inset-0 rounded-full border-t-2 border-b-2 border-cyan-400/60\"\r\n            />\r\n\r\n            {/* Ambient Glow */}\r\n            <div className=\"absolute inset-0 bg-blue-500/10 blur-lg rounded-full\" />\r\n\r\n            {/* Content Container */}\r\n            <div className=\"relative z-10 w-full h-full rounded-full overflow-hidden border border-white/10 shadow-[0_0_15px_rgba(59,130,246,0.3)] bg-black\">\r\n                {children}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAWO,MAAM,cAAc,CAAC,EAAE,OAAO,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAoB;IACrF,IAAI,SAAS,SAAS;QAClB,qBACI,6LAAC;YAAI,WAAW,CAAC,0CAA0C,EAAE,WAAW;;8BAIpE,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,QAAQ;oBAAI;oBACvB,YAAY;wBAAE,UAAU;wBAAI,QAAQ;wBAAU,MAAM;oBAAS;oBAC7D,WAAU;oBACV,OAAO;wBAAE,UAAU;oBAAgE;;;;;;8BAIvF,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,QAAQ,CAAC;oBAAI;oBACxB,YAAY;wBAAE,UAAU;wBAAI,QAAQ;wBAAU,MAAM;oBAAS;oBAC7D,WAAU;oBACV,OAAO;wBAAE,UAAU;oBAAgE;;;;;;8BAIvF,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBACL,OAAO;4BAAC;4BAAG;4BAAK;yBAAE;wBAClB,SAAS;4BAAC;4BAAK;4BAAK;yBAAI;wBACxB,QAAQ;4BAAC;4BAAG;4BAAG,CAAC;4BAAG;yBAAE;oBACzB;oBACA,YAAY;wBAAE,UAAU;wBAAK,QAAQ;wBAAU,aAAa;oBAAE;oBAC9D,WAAU;;;;;;8BAId,6LAAC;oBAAI,WAAU;;;;;;8BAGf,6LAAC;oBAAI,WAAU;8BACV;;;;;;;;;;;;IAIjB;IAEA,8BAA8B;IAC9B,qBACI,6LAAC;QAAI,WAAW,CAAC,0CAA0C,EAAE,WAAW;;0BAEpE,6LAAC,uMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS;oBAAK,SAAS;gBAAI;gBACtC,YAAY;oBAAE,UAAU;oBAAI,QAAQ;oBAAU,MAAM;gBAAS;gBAC7D,WAAU;gBACV,OAAO;oBAAE,aAAa;gBAAK;;;;;;0BAI/B,6LAAC,uMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS,CAAC;oBAAK,SAAS;gBAAG;gBACtC,YAAY;oBAAE,UAAU;oBAAG,QAAQ;oBAAU,MAAM;gBAAS;gBAC5D,WAAU;;;;;;0BAId,6LAAC,uMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS;gBAAI;gBACxB,YAAY;oBAAE,UAAU;oBAAG,QAAQ;oBAAU,MAAM;gBAAS;gBAC5D,WAAU;;;;;;0BAId,6LAAC;gBAAI,WAAU;;;;;;0BAGf,6LAAC;gBAAI,WAAU;0BACV;;;;;;;;;;;;AAIjB;KA9Ea"}},
    {"offset": {"line": 6905, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/auth/UserProfile.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { User, Settings, LogOut, Camera, X, Save, Shield, User as UserIcon, Check } from 'lucide-react';\r\nimport { signOutAction, updateUserProfile } from '../../app/actions';\r\nimport { useSession } from 'next-auth/react';\r\nimport { AvatarFrame } from './AvatarFrame';\r\n\r\ninterface UserProfileProps {\r\n    user: {\r\n        name?: string;\r\n        email?: string;\r\n        image?: string;\r\n        role?: 'USER' | 'ADMIN';\r\n    };\r\n}\r\n\r\nexport const UserProfile = ({ user }: UserProfileProps) => {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [name, setName] = useState(user.name || '');\r\n    const [image, setImage] = useState(user.image || '');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [showSuccessMessage, setShowSuccessMessage] = useState(false);\r\n    const { update } = useSession();\r\n    const menuRef = useRef<HTMLDivElement>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Close on click outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n                setIsEditing(false);\r\n                setShowSuccessMessage(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (file) {\r\n            if (file.size > 2 * 1024 * 1024) { // 2MB limit\r\n                alert(\"File size too large. Please upload an image smaller than 2MB.\");\r\n                return;\r\n            }\r\n\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => {\r\n                setImage(reader.result as string);\r\n            };\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setIsLoading(true);\r\n        const result = await updateUserProfile(name, image);\r\n        if (result.success) {\r\n            await update({ name, image });\r\n            setShowSuccessMessage(true);\r\n            setIsEditing(false);\r\n        }\r\n        setIsLoading(false);\r\n    };\r\n\r\n    const initials = user.name\r\n        ? user.name.substring(0, 2).toUpperCase()\r\n        : user.email?.substring(0, 2).toUpperCase() || 'U';\r\n\r\n    const renderMedia = (src: string, className: string) => {\r\n        const isVideo = src.startsWith('data:video') || src.endsWith('.mp4') || src.endsWith('.webm');\r\n        if (isVideo) {\r\n            return (\r\n                <video\r\n                    src={src}\r\n                    className={className}\r\n                    autoPlay\r\n                    loop\r\n                    muted\r\n                    playsInline\r\n                    style={{ objectFit: 'cover' }}\r\n                />\r\n            );\r\n        }\r\n        return <img src={src} alt=\"Profile\" className={className} />;\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed top-4 right-4 z-50\" ref={menuRef}>\r\n            {/* Trigger */}\r\n            <motion.button\r\n                whileHover={{ scale: 1.05 }}\r\n                whileTap={{ scale: 0.95 }}\r\n                onClick={() => setIsOpen(!isOpen)}\r\n                className=\"relative w-12 h-12 flex items-center justify-center group focus:outline-none\"\r\n            >\r\n                <AvatarFrame role={user.role} className=\"w-10 h-10\">\r\n                    {image ? (\r\n                        renderMedia(image, \"w-full h-full\")\r\n                    ) : (\r\n                        <div className=\"w-full h-full flex items-center justify-center bg-black\">\r\n                            <span className=\"text-xs font-bold text-white\">{initials}</span>\r\n                        </div>\r\n                    )}\r\n                </AvatarFrame>\r\n            </motion.button>\r\n\r\n            {/* Dropdown / Modal */}\r\n            <AnimatePresence>\r\n                {isOpen && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: -10, scale: 0.95 }}\r\n                        animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                        exit={{ opacity: 0, y: -10, scale: 0.95 }}\r\n                        transition={{ type: 'spring', duration: 0.3 }}\r\n                        className=\"absolute top-16 right-0 w-80 bg-[#0a0a0a]/90 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl overflow-hidden\"\r\n                    >\r\n                        {/* Header Background */}\r\n                        <div className=\"h-24 bg-gradient-to-r from-blue-600/20 to-purple-600/20 relative overflow-hidden\">\r\n                            <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20\" />\r\n                            {user.role === 'ADMIN' && (\r\n                                <div className=\"absolute top-2 right-2 px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-[10px] font-bold text-red-400 flex items-center gap-1\">\r\n                                    <Shield size={10} /> ADMIN\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Profile Content */}\r\n                        <div className=\"px-6 pb-6 -mt-12 relative flex flex-col items-center\">\r\n                            {/* Avatar */}\r\n                            <div className=\"mb-4 relative\">\r\n                                <AvatarFrame role={user.role} className=\"w-24 h-24\">\r\n                                    {image ? (\r\n                                        renderMedia(image, \"w-full h-full\")\r\n                                    ) : (\r\n                                        <div className=\"w-full h-full flex items-center justify-center bg-[#1a1a1a]\">\r\n                                            <span className=\"text-3xl font-bold text-gray-500\">{initials}</span>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {/* Edit Overlay */}\r\n                                    {(isEditing) && (\r\n                                        <button\r\n                                            onClick={() => fileInputRef.current?.click()}\r\n                                            className=\"absolute inset-0 bg-black/60 flex flex-col items-center justify-center gap-1 cursor-pointer hover:bg-black/70 transition-colors z-20\"\r\n                                        >\r\n                                            <Camera size={24} className=\"text-white/80\" />\r\n                                            <span className=\"text-[8px] text-white/60 uppercase font-bold tracking-wider\">Change</span>\r\n                                        </button>\r\n                                    )}\r\n\r\n                                    <input\r\n                                        type=\"file\"\r\n                                        ref={fileInputRef}\r\n                                        className=\"hidden\"\r\n                                        accept=\"image/*,video/mp4,video/webm\"\r\n                                        onChange={handleFileChange}\r\n                                    />\r\n                                </AvatarFrame>\r\n                            </div>\r\n\r\n                            {/* Success Message */}\r\n                            <AnimatePresence>\r\n                                {showSuccessMessage && (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0, height: 0, marginBottom: 0 }}\r\n                                        animate={{ opacity: 1, height: 'auto', marginBottom: 16 }}\r\n                                        exit={{ opacity: 0, height: 0, marginBottom: 0 }}\r\n                                        className=\"overflow-hidden w-full\"\r\n                                    >\r\n                                        <div className=\"bg-green-500/10 border border-green-500/30 rounded-xl p-3 flex flex-col gap-2\">\r\n                                            <div className=\"flex items-center gap-2 text-green-400 font-bold text-sm\">\r\n                                                <div className=\"p-1 bg-green-500/20 rounded-full\">\r\n                                                    <Check size={12} strokeWidth={3} />\r\n                                                </div>\r\n                                                PROFILE UPDATED\r\n                                            </div>\r\n                                            <p className=\"text-[10px] text-green-300/80 leading-relaxed\">\r\n                                                Your neural identity has been rewritten. <br />\r\n                                                <span className=\"text-white font-bold\">Please refresh the page</span> or <span className=\"text-white font-bold\">re-login</span> to see changes take full effect.\r\n                                            </p>\r\n                                        </div>\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n\r\n                            {/* Info */}\r\n                            <div className=\"space-y-4 w-full\">\r\n                                {!isEditing ? (\r\n                                    <div className=\"text-center\">\r\n                                        <h3 className=\"text-lg font-bold text-white\">{user.name || 'User'}</h3>\r\n                                        <p className=\"text-xs text-gray-500\">{user.email}</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"space-y-3\">\r\n                                        <div className=\"space-y-1\">\r\n                                            <label className=\"text-[10px] font-bold text-gray-500 uppercase\">Display Name</label>\r\n                                            <input\r\n                                                value={name}\r\n                                                onChange={(e) => setName(e.target.value)}\r\n                                                className=\"w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-blue-500 transition-colors\"\r\n                                                placeholder=\"Your Name\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"space-y-1\">\r\n                                            <label className=\"text-[10px] font-bold text-gray-500 uppercase\">Avatar URL</label>\r\n                                            <input\r\n                                                value={image}\r\n                                                onChange={(e) => setImage(e.target.value)}\r\n                                                className=\"w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-blue-500 transition-colors\"\r\n                                                placeholder=\"https://...\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Actions */}\r\n                                <div className=\"pt-4 border-t border-white/5 space-y-2\">\r\n                                    {!isEditing ? (\r\n                                        <button\r\n                                            onClick={() => setIsEditing(true)}\r\n                                            className=\"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-400 hover:text-white hover:bg-white/5 transition-colors\"\r\n                                        >\r\n                                            <Settings size={16} /> Settings\r\n                                        </button>\r\n                                    ) : (\r\n                                        <div className=\"flex gap-2\">\r\n                                            <button\r\n                                                onClick={() => setIsEditing(false)}\r\n                                                className=\"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm text-gray-400 hover:text-white hover:bg-white/5 transition-colors\"\r\n                                            >\r\n                                                <X size={16} /> Cancel\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={handleSave}\r\n                                                disabled={isLoading}\r\n                                                className=\"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm bg-blue-600 text-white hover:bg-blue-500 transition-colors disabled:opacity-50\"\r\n                                            >\r\n                                                {isLoading ? <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" /> : <Save size={16} />}\r\n                                                Save\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    <button\r\n                                        onClick={() => signOutAction()}\r\n                                        className=\"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 transition-colors\"\r\n                                    >\r\n                                        <LogOut size={16} /> Sign Out\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7514, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/services/sieveService.ts"],"sourcesContent":["export interface SieveJob {\r\n    id: string;\r\n    status: 'processing' | 'finished' | 'error';\r\n    output?: any;\r\n    error?: string;\r\n}\r\n\r\nexport async function pushSieveJob(functionName: string, inputs: any): Promise<SieveJob | null> {\r\n    try {\r\n        const response = await fetch('/api/sieve', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ functionName, inputs }),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            console.error('Failed to push job');\r\n            return null;\r\n        }\r\n\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error('Error pushing job:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function getSieveJob(jobId: string): Promise<SieveJob | null> {\r\n    try {\r\n        const response = await fetch(`/api/sieve?jobId=${jobId}`);\r\n        if (!response.ok) return null;\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error('Error fetching job:', error);\r\n        return null;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAOO,eAAe,aAAa,YAAoB,EAAE,MAAW;IAChE,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,cAAc;YACvC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAc;YAAO;QAChD;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,QAAQ,KAAK,CAAC;YACd,OAAO;QACX;QAEA,OAAO,MAAM,SAAS,IAAI;IAC9B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO;IACX;AACJ;AAEO,eAAe,YAAY,KAAa;IAC3C,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,CAAC,iBAAiB,EAAE,OAAO;QACxD,IAAI,CAAC,SAAS,EAAE,EAAE,OAAO;QACzB,OAAO,MAAM,SAAS,IAAI;IAC9B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;IACX;AACJ"}},
    {"offset": {"line": 7559, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/sieve/SieveView.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Play, Loader2, CheckCircle, AlertCircle, Terminal } from 'lucide-react';\r\nimport { pushSieveJob, getSieveJob, SieveJob } from '../../services/sieveService';\r\n\r\nexport const SieveView = () => {\r\n    const [functionName, setFunctionName] = useState('sieve/stable-diffusion-xl');\r\n    const [inputs, setInputs] = useState('{\\n  \"prompt\": \"A futuristic city with neon lights, cyberpunk style\"\\n}');\r\n    const [activeJob, setActiveJob] = useState<SieveJob | null>(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [logs, setLogs] = useState<string[]>([]);\r\n\r\n    const addLog = (msg: string) => setLogs(prev => [`[${new Date().toLocaleTimeString()}] ${msg}`, ...prev]);\r\n\r\n    const handleRun = async () => {\r\n        try {\r\n            const parsedInputs = JSON.parse(inputs);\r\n            setIsLoading(true);\r\n            addLog(`Pushing job to ${functionName}...`);\r\n\r\n            const job = await pushSieveJob(functionName, parsedInputs);\r\n\r\n            if (job && job.id) {\r\n                setActiveJob(job);\r\n                addLog(`Job started: ${job.id}`);\r\n            } else {\r\n                addLog('Failed to start job.');\r\n                setIsLoading(false);\r\n            }\r\n        } catch (e) {\r\n            addLog('Invalid JSON inputs.');\r\n            alert('Invalid JSON in inputs field');\r\n        }\r\n    };\r\n\r\n    // Polling\r\n    useEffect(() => {\r\n        let interval: NodeJS.Timeout;\r\n        if (activeJob && activeJob.status !== 'finished' && activeJob.status !== 'error') {\r\n            interval = setInterval(async () => {\r\n                const updatedJob = await getSieveJob(activeJob.id);\r\n                if (updatedJob) {\r\n                    setActiveJob(updatedJob);\r\n                    if (updatedJob.status === 'finished') {\r\n                        addLog('Job finished successfully!');\r\n                        setIsLoading(false);\r\n                    } else if (updatedJob.status === 'error') {\r\n                        addLog(`Job failed: ${updatedJob.error}`);\r\n                        setIsLoading(false);\r\n                    }\r\n                }\r\n            }, 2000);\r\n        }\r\n        return () => clearInterval(interval);\r\n    }, [activeJob]);\r\n\r\n    return (\r\n        <div className=\"h-full w-full p-8 bg-gray-50 dark:bg-[#0a0a0a] text-black dark:text-white overflow-y-auto\">\r\n            <div className=\"max-w-4xl mx-auto space-y-8\">\r\n\r\n                {/* Header */}\r\n                <div className=\"flex items-center gap-4 mb-8\">\r\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-pink-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/20\">\r\n                        <Terminal className=\"text-white\" size={24} />\r\n                    </div>\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-black tracking-tight\">Sieve Console</h1>\r\n                        <p className=\"text-gray-500 dark:text-gray-400\">Run AI models directly from your workspace.</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Input Section */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-bold uppercase text-gray-500\">Function Name</label>\r\n                            <input\r\n                                value={functionName}\r\n                                onChange={(e) => setFunctionName(e.target.value)}\r\n                                className=\"w-full bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-lg px-4 py-3 font-mono text-sm focus:ring-2 focus:ring-purple-500 outline-none transition-all\"\r\n                                placeholder=\"e.g. sieve/stable-diffusion-xl\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-bold uppercase text-gray-500\">Inputs (JSON)</label>\r\n                            <textarea\r\n                                value={inputs}\r\n                                onChange={(e) => setInputs(e.target.value)}\r\n                                className=\"w-full h-64 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-lg px-4 py-3 font-mono text-sm focus:ring-2 focus:ring-purple-500 outline-none transition-all resize-none\"\r\n                                placeholder=\"{}\"\r\n                            />\r\n                        </div>\r\n                        <motion.button\r\n                            whileHover={{ scale: 1.02 }}\r\n                            whileTap={{ scale: 0.98 }}\r\n                            onClick={handleRun}\r\n                            disabled={isLoading}\r\n                            className={`w-full py-4 rounded-xl font-bold text-white flex items-center justify-center gap-2 shadow-lg transition-all ${isLoading ? 'bg-gray-400 cursor-not-allowed' : 'bg-black dark:bg-white dark:text-black hover:shadow-purple-500/25'}`}\r\n                        >\r\n                            {isLoading ? <Loader2 className=\"animate-spin\" /> : <Play size={18} fill=\"currentColor\" />}\r\n                            {isLoading ? 'Running...' : 'Run Function'}\r\n                        </motion.button>\r\n                    </div>\r\n\r\n                    {/* Output Section */}\r\n                    <div className=\"space-y-4 flex flex-col h-full\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <label className=\"text-xs font-bold uppercase text-gray-500\">Output & Logs</label>\r\n                            {activeJob && (\r\n                                <span className={`text-xs px-2 py-1 rounded font-bold uppercase ${activeJob.status === 'finished' ? 'bg-green-100 text-green-600' :\r\n                                        activeJob.status === 'error' ? 'bg-red-100 text-red-600' :\r\n                                            'bg-blue-100 text-blue-600 animate-pulse'\r\n                                    }`}>\r\n                                    {activeJob.status}\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 bg-black rounded-xl p-4 font-mono text-xs text-green-400 overflow-y-auto custom-scrollbar border border-gray-800 shadow-inner min-h-[300px]\">\r\n                            {logs.length === 0 && <span className=\"text-gray-600 opacity-50\">Waiting for jobs...</span>}\r\n                            {logs.map((log, i) => (\r\n                                <div key={i} className=\"mb-1 opacity-80\">{log}</div>\r\n                            ))}\r\n\r\n                            {activeJob?.status === 'finished' && activeJob.output && (\r\n                                <div className=\"mt-4 pt-4 border-t border-gray-800\">\r\n                                    <div className=\"text-white font-bold mb-2\">RESULT:</div>\r\n                                    <pre className=\"whitespace-pre-wrap text-gray-300\">\r\n                                        {JSON.stringify(activeJob.output, null, 2)}\r\n                                    </pre>\r\n                                    {/* Try to render image if output looks like a URL */}\r\n                                    {typeof activeJob.output === 'object' && activeJob.output.data && (\r\n                                        <img src={activeJob.output.data} alt=\"Result\" className=\"mt-4 rounded-lg border border-gray-700 max-w-full\" />\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7907, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/NotationsApp.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useCallback, useEffect, useMemo, useRef } from 'react';\nimport { Sidebar } from './layout/Sidebar';\nimport { EditorView } from './editor/EditorView';\nimport { CanvasView } from './canvas/CanvasView';\nimport { GraphView } from './graph/GraphView';\nimport { ViewMode, Note } from '../types';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { ConfirmationModal } from './ui/ConfirmationModal';\nimport { UnsavedChangesModal } from './ui/UnsavedChangesModal';\nimport { useHistory, HistoryMode } from '../hooks/useHistory';\nimport { SearchPalette } from './ui/SearchPalette';\nimport { AIMagicModal } from './ui/AIMagicModal';\nimport { generateNoteFromPrompt } from '../services/geminiService';\nimport { getNotes, saveNote, deleteNoteAction, getTags } from '../app/actions';\nimport { User } from '../types';\nimport { UserProfile } from './auth/UserProfile';\nimport { SieveView } from './sieve/SieveView';\n\ninterface NotationsAppProps {\n  user?: Partial<User> | null;\n}\n\nconst NotationsApp: React.FC<NotationsAppProps> = ({ user }) => {\n  const [view, setView] = useState<ViewMode>(ViewMode.CANVAS);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Theme State\n  const [isDarkMode, setIsDarkMode] = useState(false);\n\n  // Replaced standard state with History Hook\n  const {\n    state: notes,\n    set: setNotes,\n    undo,\n    redo,\n    canUndo,\n    canRedo\n  } = useHistory<Note[]>([]);\n\n  const [activeNoteId, setActiveNoteId] = useState<string | null>(null);\n\n  // Unsaved Changes State\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n  const [pendingNavigation, setPendingNavigation] = useState<(() => void) | null>(null);\n  const [unsavedModalOpen, setUnsavedModalOpen] = useState(false);\n\n  // Filter State\n  const [selectedTag, setSelectedTag] = useState<string | null>(null);\n\n  // Delete Modal State\n  const [deleteModalOpen, setDeleteModalOpen] = useState(false);\n  const [noteToDelete, setNoteToDelete] = useState<string | null>(null);\n\n  // Search State\n  const [searchOpen, setSearchOpen] = useState(false);\n\n  // AI Magic Modal State\n  const [aiModalOpen, setAiModalOpen] = useState(false);\n  const [isAiGenerating, setIsAiGenerating] = useState(false);\n\n  // Load Notes from DB and Local Backup\n  useEffect(() => {\n    const loadNotes = async () => {\n      const fetchedNotes = await getNotes();\n\n      // Local Backup Check\n      const localBackup = localStorage.getItem('notations_backup');\n      if (localBackup) {\n        try {\n          const parsedBackup: Note[] = JSON.parse(localBackup);\n          // Simple conflict resolution: If local has more notes or different data, we could prompt.\n          // For now, we'll merge: if local has notes not in DB (offline created), add them.\n          // If DB is empty but local has data, restore local.\n\n          if (fetchedNotes.length === 0 && parsedBackup.length > 0) {\n            console.log(\"Restoring from local backup...\");\n            setNotes(parsedBackup, 'REPLACE');\n            // Trigger sync to server\n            parsedBackup.forEach(n => saveNote(n));\n            setIsLoading(false);\n            return;\n          }\n\n          // If both have data, we prefer server for now but could implement smarter merge.\n          // A simple \"Safety Net\" is: if server fails to load, use local.\n        } catch (e) {\n          console.error(\"Failed to parse local backup\", e);\n        }\n      }\n\n      setNotes(fetchedNotes, 'REPLACE');\n      if (fetchedNotes.length > 0 && !activeNoteId) {\n        // Don't auto-select first note to avoid confusion with navigation trap immediately\n        // setActiveNoteId(fetchedNotes[0].id);\n      }\n      setIsLoading(false);\n    };\n    loadNotes();\n  }, []);\n\n  // Local Backup Effect\n  useEffect(() => {\n    if (notes.length > 0) {\n      localStorage.setItem('notations_backup', JSON.stringify(notes));\n    }\n  }, [notes]);\n\n  // Initialize Theme\n  useEffect(() => {\n    const storedTheme = localStorage.getItem('theme');\n    if (storedTheme === 'dark') {\n      setIsDarkMode(true);\n      document.documentElement.classList.add('dark');\n    } else if (!storedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n      setIsDarkMode(true);\n      document.documentElement.classList.add('dark');\n    } else {\n      setIsDarkMode(false);\n      document.documentElement.classList.remove('dark');\n    }\n  }, []);\n\n  const toggleTheme = () => {\n    const newMode = !isDarkMode;\n    setIsDarkMode(newMode);\n    if (newMode) {\n      document.documentElement.classList.add('dark');\n      localStorage.setItem('theme', 'dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n      localStorage.setItem('theme', 'light');\n    }\n  };\n\n  const activeNote = notes.find(n => n.id === activeNoteId) || null;\n\n  // Computed filtered notes\n  const filteredNotes = useMemo(() => {\n    if (!selectedTag) return notes;\n    return notes.filter(n => n.tags?.includes(selectedTag));\n  }, [notes, selectedTag]);\n\n  // Compute unique tags for Sidebar (from DB + notes)\n  const [globalTags, setGlobalTags] = useState<string[]>([]);\n\n  useEffect(() => {\n    const loadGlobalTags = async () => {\n      const dbTags = await getTags();\n      setGlobalTags(dbTags.map(t => t.name));\n    };\n    loadGlobalTags();\n  }, []);\n\n  const uniqueTags = useMemo(() => {\n    // Merge global tags from DB with tags from notes\n    const allTags = new Set<string>(globalTags);\n    notes.forEach(note => {\n      note.tags?.forEach(tag => allTags.add(tag));\n    });\n    return Array.from(allTags).sort();\n  }, [notes, globalTags]);\n\n  // Keyboard Shortcuts: Undo/Redo, Search, and Magic Create\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Undo: Cmd+Z / Ctrl+Z\n      if ((e.metaKey || e.ctrlKey) && e.key === 'z' && !e.shiftKey) {\n        e.preventDefault();\n        undo();\n      }\n      // Redo: Cmd+Shift+Z / Ctrl+Shift+Z / Ctrl+Y\n      if (\n        ((e.metaKey || e.ctrlKey) && e.shiftKey && e.key === 'z') ||\n        ((e.metaKey || e.ctrlKey) && e.key === 'y')\n      ) {\n        e.preventDefault();\n        redo();\n      }\n      // Search: Cmd+K / Ctrl+K\n      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {\n        e.preventDefault();\n        setSearchOpen(true);\n      }\n      // Save: Cmd+S / Ctrl+S\n      if ((e.metaKey || e.ctrlKey) && e.key === 's') {\n        e.preventDefault();\n        if (activeNoteId) handleManualSave();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [undo, redo, activeNoteId, notes]);\n\n\n  // --- SECURITY: Prevent Unsaved Data Loss (F5, Close, etc.) ---\n  useEffect(() => {\n    const handleBeforeUnload = (e: BeforeUnloadEvent) => {\n      if (hasUnsavedChanges) {\n        e.preventDefault();\n        e.returnValue = ''; // Chrome requires returnValue to be set\n      }\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\n  }, [hasUnsavedChanges]);\n\n  // --- Auto-Save Mechanism ---\n  useEffect(() => {\n    if (!hasUnsavedChanges || !activeNoteId) return;\n\n    const timeoutId = setTimeout(() => {\n      // console.log(\"Auto-saving...\");\n      handleManualSave();\n    }, 2000); // Auto-save after 2 seconds of inactivity\n\n    return () => clearTimeout(timeoutId);\n  }, [notes, hasUnsavedChanges, activeNoteId]);\n\n\n  const handleNoteUpdate = async (updatedNote: Note, mode: HistoryMode = 'PUSH') => {\n    const newNotes = notes.map(n => n.id === updatedNote.id ? updatedNote : n);\n    setNotes(newNotes, mode);\n    setHasUnsavedChanges(true);\n    // Removed auto-save: await saveNote(updatedNote);\n  };\n\n  const handleManualSave = async () => {\n    if (activeNote) {\n      await saveNote(activeNote);\n      setHasUnsavedChanges(false);\n    }\n  };\n\n  // Navigation Interception Logic\n  const attemptNavigation = (action: () => void) => {\n    if (hasUnsavedChanges) {\n      setPendingNavigation(() => action);\n      setUnsavedModalOpen(true);\n    } else {\n      action();\n    }\n  };\n\n  const handleSaveAndLeave = async () => {\n    await handleManualSave();\n    setUnsavedModalOpen(false);\n    if (pendingNavigation) {\n      pendingNavigation();\n      setPendingNavigation(null);\n    }\n  };\n\n  const handleDiscardAndLeave = async () => {\n    // Revert changes by reloading from DB or just proceeding (since we didn't save)\n    // Ideally we should revert local state to last saved state, but for now just proceeding\n    // effectively discards the changes since they weren't persisted to DB.\n    // However, local state 'notes' still has the changes. We should probably reload or revert.\n    // For simplicity in this step, we'll just proceed, but the in-memory notes will still be dirty\n    // until a refresh. To do it right, we should re-fetch or undo.\n    // Let's re-fetch this specific note or all notes to be safe.\n\n    const fetchedNotes = await getNotes();\n    setNotes(fetchedNotes, 'REPLACE');\n\n    setHasUnsavedChanges(false);\n    setUnsavedModalOpen(false);\n    if (pendingNavigation) {\n      pendingNavigation();\n      setPendingNavigation(null);\n    }\n  };\n\n  const handleCancelNavigation = () => {\n    setUnsavedModalOpen(false);\n    setPendingNavigation(null);\n  };\n\n\n  const handleNoteSelect = useCallback((id: string) => {\n    attemptNavigation(() => {\n      setActiveNoteId(id);\n      setView(ViewMode.EDITOR);\n    });\n  }, [hasUnsavedChanges]);\n\n  const handleCreateNote = async () => {\n    attemptNavigation(async () => {\n      const newNote: Note = {\n        id: crypto.randomUUID(),\n        title: '',\n        blocks: [{ id: '1', type: 'paragraph', content: '' }],\n        position: { x: Math.random() * 500, y: Math.random() * 500 },\n        connections: [],\n        tags: [],\n        createdAt: Date.now()\n      };\n      setNotes([...notes, newNote], 'PUSH');\n      setActiveNoteId(newNote.id);\n      setView(ViewMode.EDITOR);\n      await saveNote(newNote); // Initial save is fine\n      setHasUnsavedChanges(false);\n    });\n  };\n\n  const handleAiCreate = async (prompt: string) => {\n    setIsAiGenerating(true);\n    const result = await generateNoteFromPrompt(prompt);\n\n    if (result) {\n      const newNote: Note = {\n        id: crypto.randomUUID(),\n        title: result.title,\n        blocks: [{ id: '1', type: 'paragraph', content: result.content }],\n        position: { x: Math.random() * 500, y: Math.random() * 500 },\n        connections: [],\n        tags: [],\n        createdAt: Date.now()\n      };\n\n      attemptNavigation(async () => {\n        setNotes([...notes, newNote], 'PUSH');\n        setActiveNoteId(newNote.id);\n        setView(ViewMode.EDITOR);\n        setAiModalOpen(false);\n        await saveNote(newNote);\n        setHasUnsavedChanges(false);\n      });\n    }\n    setIsAiGenerating(false);\n  };\n\n  const handleNoteMove = async (id: string, pos: { x: number, y: number }) => {\n    const note = notes.find(n => n.id === id);\n    if (note) {\n      const updatedNote = { ...note, position: pos };\n      const newNotes = notes.map(n => n.id === id ? updatedNote : n);\n      setNotes(newNotes, 'PUSH');\n      await saveNote(updatedNote); // Canvas moves can still auto-save or be separate\n    }\n  };\n\n  const handleConnectNotes = async (sourceId: string, targetId: string) => {\n    if (sourceId === targetId) return;\n\n    const sourceNote = notes.find(n => n.id === sourceId);\n    if (!sourceNote) return;\n\n    if (sourceNote.connections.includes(targetId)) return;\n\n    const updatedSource = { ...sourceNote, connections: [...sourceNote.connections, targetId] };\n\n    const newNotes = notes.map(n =>\n      n.id === sourceId\n        ? updatedSource\n        : n\n    );\n\n    setNotes(newNotes, 'PUSH');\n    await saveNote(updatedSource);\n  };\n\n  const handleRequestDelete = (noteId: string) => {\n    setNoteToDelete(noteId);\n    setDeleteModalOpen(true);\n  };\n\n  const confirmDelete = async () => {\n    if (noteToDelete) {\n      const updatedNotes: Note[] = [];\n\n      const newNotes = notes\n        .filter(n => n.id !== noteToDelete)\n        .map(n => {\n          if (n.connections.includes(noteToDelete)) {\n            const updated = { ...n, connections: n.connections.filter(cId => cId !== noteToDelete) };\n            updatedNotes.push(updated);\n            return updated;\n          }\n          return n;\n        });\n\n      setNotes(newNotes, 'PUSH');\n\n      if (activeNoteId === noteToDelete) {\n        setActiveNoteId(null);\n        setView(ViewMode.CANVAS);\n        setHasUnsavedChanges(false); // Deleted note doesn't have unsaved changes\n      }\n      setNoteToDelete(null);\n\n      // DB Updates\n      await deleteNoteAction(noteToDelete);\n      for (const note of updatedNotes) {\n        await saveNote(note);\n      }\n    }\n    setDeleteModalOpen(false);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"h-screen w-screen flex items-center justify-center bg-white dark:bg-black transition-colors\">\n        <div className=\"flex flex-col items-center gap-4\">\n          <div className=\"w-8 h-8 border-2 border-black dark:border-white border-t-transparent rounded-full animate-spin\" />\n          <p className=\"text-xs font-bold uppercase tracking-widest animate-pulse text-black dark:text-white\">Connecting to Neural DB...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-screen w-screen bg-background text-foreground font-sans transition-colors duration-300\">\n      <Sidebar\n        currentView={view}\n        onViewChange={(newView) => attemptNavigation(() => setView(newView))}\n        onCreateNote={handleCreateNote}\n        onAiCreate={() => setAiModalOpen(true)}\n        onUndo={undo}\n        onRedo={redo}\n        canUndo={canUndo}\n        canRedo={canRedo}\n        onSearch={() => setSearchOpen(true)}\n        allTags={uniqueTags}\n        selectedTag={selectedTag}\n        onSelectTag={setSelectedTag}\n        isDarkMode={isDarkMode}\n        onToggleTheme={toggleTheme}\n      />\n\n      <main className=\"flex-1 ml-20 relative h-full overflow-hidden\">\n        <AnimatePresence mode=\"wait\">\n          {view === ViewMode.EDITOR && (\n            <motion.div\n              key=\"editor\"\n              initial={{ opacity: 0, filter: 'blur(10px)' }}\n              animate={{ opacity: 1, filter: 'blur(0px)' }}\n              exit={{ opacity: 0, filter: 'blur(10px)' }}\n              className=\"h-full overflow-y-auto custom-scrollbar bg-white dark:bg-[#0a0a0a]\"\n            >\n              <EditorView\n                activeNote={activeNote}\n                onUpdateNote={handleNoteUpdate}\n                onDeleteNote={handleRequestDelete}\n                hasUnsavedChanges={hasUnsavedChanges}\n                onSave={handleManualSave}\n                allNotes={notes}\n                onConnectNotes={handleConnectNotes}\n              />\n            </motion.div>\n          )}\n\n          {view === ViewMode.CANVAS && (\n            <motion.div\n              key=\"canvas\"\n              initial={{ opacity: 0, scale: 0.95 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, scale: 1.05 }}\n              className=\"h-full w-full\"\n            >\n              <CanvasView\n                notes={filteredNotes}\n                onNoteSelect={handleNoteSelect}\n                onNoteMove={handleNoteMove}\n                onConnectNotes={handleConnectNotes}\n                onDeleteNote={handleRequestDelete}\n                isDarkMode={isDarkMode}\n              />\n            </motion.div>\n          )}\n\n          {view === ViewMode.GRAPH && (\n            <motion.div\n              key=\"graph\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"h-full w-full\"\n            >\n              <GraphView\n                notes={filteredNotes}\n                onNoteSelect={handleNoteSelect}\n                onDeleteNote={handleRequestDelete}\n                isDarkMode={isDarkMode}\n              />\n            </motion.div>\n          )}\n\n          {view === ViewMode.SIEVE && (\n            <motion.div\n              key=\"sieve\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -20 }}\n              className=\"h-full w-full\"\n            >\n              <SieveView />\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {user && <UserProfile user={user} />}\n\n        {/* Context Indicator */}\n        <div className=\"fixed top-20 right-8 flex flex-col items-end pointer-events-none z-40\">\n          <h1 className=\"text-xs font-bold tracking-[0.3em] uppercase opacity-30 dark:text-white dark:opacity-20\">NOTATIONS v1.0</h1>\n          <div className=\"flex items-center gap-2 mt-1\">\n            {selectedTag && (\n              <span className=\"text-[10px] bg-black dark:bg-white text-white dark:text-black px-2 py-0.5 rounded-full font-bold\">\n                FILTER: #{selectedTag}\n              </span>\n            )}\n            <span className=\"text-[10px] text-gray-400 dark:text-gray-500 font-mono\">\n              {activeNoteId ? `ACTIVE: ${notes.find(n => n.id === activeNoteId)?.title || 'UNTITLED'}` : 'NO SELECTION'}\n            </span>\n          </div>\n        </div>\n      </main>\n\n      <ConfirmationModal\n        isOpen={deleteModalOpen}\n        title=\"Delete Note?\"\n        message=\"Are you sure you want to delete this note? This action cannot be undone.\"\n        onConfirm={confirmDelete}\n        onCancel={() => setDeleteModalOpen(false)}\n      />\n\n      <UnsavedChangesModal\n        isOpen={unsavedModalOpen}\n        onSaveAndLeave={handleSaveAndLeave}\n        onDiscardAndLeave={handleDiscardAndLeave}\n        onCancel={handleCancelNavigation}\n      />\n\n      <SearchPalette\n        isOpen={searchOpen}\n        onClose={() => setSearchOpen(false)}\n        notes={filteredNotes}\n        onSelectNote={handleNoteSelect}\n      />\n\n      <AIMagicModal\n        isOpen={aiModalOpen}\n        onClose={() => setAiModalOpen(false)}\n        onGenerate={handleAiCreate}\n        isGenerating={isAiGenerating}\n      />\n    </div>\n  );\n};\n\nexport default NotationsApp;"],"names":[],"mappings":"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"}}]
}