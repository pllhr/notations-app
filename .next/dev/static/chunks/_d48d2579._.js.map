{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/types.ts"],"sourcesContent":["\nexport enum ViewMode {\n  EDITOR = 'EDITOR',\n  CANVAS = 'CANVAS',\n  GRAPH = 'GRAPH',\n  ADMIN = 'ADMIN'\n}\n\n// Global Tag for management\nexport interface Tag {\n  id: string;\n  name: string;\n  color: string;\n  createdAt: number;\n}\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\n// Connection between specific text selections within notes\nexport interface TextConnection {\n  id: string;\n  // Source text info\n  sourceBlockId: string;\n  sourceText: string; // The actual selected text (for matching)\n  // Target text info (can be in same or different block)\n  targetBlockId: string;\n  targetText: string; // The target text to connect to\n  targetNoteId?: string; // If connecting to another note\n  // Visual properties\n  color: string;\n  createdAt: number;\n}\n\n// Available connection colors\nexport const CONNECTION_COLORS = [\n  '#ef4444', // red\n  '#f97316', // orange\n  '#eab308', // yellow\n  '#22c55e', // green\n  '#06b6d4', // cyan\n  '#3b82f6', // blue\n  '#8b5cf6', // purple\n  '#ec4899', // pink\n];\n\nexport interface NoteBlock {\n  id: string;\n  type: 'paragraph' | 'heading' | 'todo' | 'bullet' | 'blockquote' | 'code' | 'image';\n  content: string;\n  checked?: boolean;\n  highlightColor?: string;\n  textConnections?: TextConnection[]; // Connections from text in this block\n}\n\nexport interface Note {\n  id: string;\n  title: string;\n  blocks: NoteBlock[];\n  position: Point; // For Canvas view\n  connections: string[]; // IDs of connected notes\n  color?: string; // Hex code for note color\n  tags?: string[]; // Array of tag strings\n  createdAt: number;\n}\n\nexport interface User {\n  id: string;\n  email: string;\n  role: 'USER' | 'ADMIN';\n  createdAt: number;\n  name?: string;\n  image?: string;\n}\n\n// Manually defining d3 simulation types to avoid namespace errors if d3 types aren't global\nexport interface SimulationNodeDatum {\n  index?: number;\n  x?: number;\n  y?: number;\n  vx?: number;\n  vy?: number;\n  fx?: number | null;\n  fy?: number | null;\n}\n\nexport interface SimulationLinkDatum<NodeDatum> {\n  source: string | number | NodeDatum;\n  target: string | number | NodeDatum;\n  index?: number;\n}\n\nexport interface GraphNode extends SimulationNodeDatum {\n  id: string;\n  title: string;\n  group: number;\n  color?: string;\n}\n\nexport interface GraphLink extends SimulationLinkDatum<GraphNode> {\n  source: string | GraphNode;\n  target: string | GraphNode;\n}"],"names":[],"mappings":";;;;;;AACO,IAAA,AAAK,kCAAA;;;;;WAAA;;AAoCL,MAAM,oBAAoB;IAC/B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/layout/Sidebar.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { ViewMode } from '../../types';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Type, Grid, Share2, PlusCircle, Search, Undo2, Redo2, Sparkles, Hash, X, Moon, Sun, Settings } from 'lucide-react';\nimport Link from 'next/link';\n\ninterface SidebarProps {\n  currentView: ViewMode;\n  onViewChange: (view: ViewMode) => void;\n  onCreateNote: () => void;\n  onAiCreate: () => void;\n  onUndo: () => void;\n  onRedo: () => void;\n  canUndo: boolean;\n  canRedo: boolean;\n  onSearch: () => void;\n  allTags: string[];\n  selectedTag: string | null;\n  onSelectTag: (tag: string | null) => void;\n  isDarkMode: boolean;\n  onToggleTheme: () => void;\n}\n\nexport const Sidebar: React.FC<SidebarProps> = ({\n  currentView,\n  onViewChange,\n  onCreateNote,\n  onAiCreate,\n  onUndo,\n  onRedo,\n  canUndo,\n  canRedo,\n  onSearch,\n  allTags,\n  selectedTag,\n  onSelectTag,\n  isDarkMode,\n  onToggleTheme\n}) => {\n  const [tagMenuOpen, setTagMenuOpen] = useState(false);\n\n  const navItems = [\n    { id: ViewMode.EDITOR, icon: <Type size={20} />, label: 'Editor' },\n    { id: ViewMode.CANVAS, icon: <Grid size={20} />, label: 'Canvas' },\n    { id: ViewMode.GRAPH, icon: <Share2 size={20} />, label: 'Graph' },\n  ];\n\n  return (\n    <motion.div\n      initial={{ x: -100 }}\n      animate={{ x: 0 }}\n      className=\"w-20 h-screen bg-white dark:bg-black border-r border-gray-100 dark:border-neutral-800 flex flex-col items-center py-8 z-50 fixed left-0 top-0 transition-colors\"\n    >\n      <div className=\"mb-12 w-10 h-10 bg-black dark:bg-white flex items-center justify-center text-white dark:text-black font-black text-xl rounded-sm\">\n        N\n      </div>\n\n      <div className=\"flex flex-col gap-8 flex-1\">\n        {navItems.map((item) => (\n          <button\n            key={item.id}\n            onClick={() => onViewChange(item.id)}\n            className=\"relative group flex items-center justify-center w-10 h-10 outline-none\"\n            aria-label={item.label}\n          >\n            {currentView === item.id && (\n              <motion.div\n                layoutId=\"activeNav\"\n                className=\"absolute inset-0 bg-black dark:bg-white rounded-lg\"\n                transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n              />\n            )}\n            <span className={`relative z-10 transition-colors duration-200 ${currentView === item.id ? 'text-white dark:text-black' : 'text-gray-400 hover:text-black dark:hover:text-white'}`}>\n              {item.icon}\n            </span>\n\n            {/* Tooltip */}\n            <span className=\"absolute left-12 opacity-0 group-hover:opacity-100 transition-opacity bg-black dark:bg-white text-white dark:text-black text-xs px-2 py-1 rounded whitespace-nowrap pointer-events-none z-[60]\">\n              {item.label}\n            </span>\n          </button>\n        ))}\n      </div>\n\n      <div className=\"flex flex-col gap-4 mb-6\">\n        <motion.button\n          whileHover={{ scale: 1.1, rotate: -10 }}\n          whileTap={{ scale: 0.9 }}\n          onClick={onUndo}\n          disabled={!canUndo}\n          className={`flex items-center justify-center w-10 h-10 rounded-lg transition-colors ${canUndo ? 'text-black dark:text-white hover:bg-gray-100 dark:hover:bg-neutral-800' : 'text-gray-200 dark:text-neutral-700 cursor-not-allowed'}`}\n          title=\"Undo (Cmd+Z)\"\n        >\n          <Undo2 size={18} />\n        </motion.button>\n        <motion.button\n          whileHover={{ scale: 1.1, rotate: 10 }}\n          whileTap={{ scale: 0.9 }}\n          onClick={onRedo}\n          disabled={!canRedo}\n          className={`flex items-center justify-center w-10 h-10 rounded-lg transition-colors ${canRedo ? 'text-black dark:text-white hover:bg-gray-100 dark:hover:bg-neutral-800' : 'text-gray-200 dark:text-neutral-700 cursor-not-allowed'}`}\n          title=\"Redo (Cmd+Shift+Z)\"\n        >\n          <Redo2 size={18} />\n        </motion.button>\n      </div>\n\n      <div className=\"flex flex-col gap-6 mt-auto\">\n        {/* Theme Toggle */}\n        <motion.button\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n          onClick={onToggleTheme}\n          className=\"text-gray-400 hover:text-black dark:hover:text-white transition-colors w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-800\"\n          title={isDarkMode ? \"Switch to Light Mode\" : \"Switch to Dark Mode\"}\n        >\n          {isDarkMode ? <Sun size={20} /> : <Moon size={20} />}\n        </motion.button>\n\n        {/* Tag Filter Button */}\n        <div className=\"relative\">\n          <motion.button\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n            onClick={() => setTagMenuOpen(!tagMenuOpen)}\n            className={`w-10 h-10 flex items-center justify-center rounded-lg transition-colors ${selectedTag || tagMenuOpen ? 'bg-gray-100 dark:bg-neutral-800 text-black dark:text-white' : 'text-gray-400 hover:text-black dark:hover:text-white hover:bg-gray-50 dark:hover:bg-neutral-800'}`}\n            title=\"Filter by Tag\"\n          >\n            <Hash size={20} />\n            {selectedTag && (\n              <span className=\"absolute top-1 right-1 w-2 h-2 bg-blue-500 rounded-full\" />\n            )}\n          </motion.button>\n\n          <AnimatePresence>\n            {tagMenuOpen && (\n              <>\n                <div className=\"fixed inset-0 z-[55]\" onClick={() => setTagMenuOpen(false)} />\n                <motion.div\n                  initial={{ opacity: 0, x: 10, scale: 0.95 }}\n                  animate={{ opacity: 1, x: 20, scale: 1 }}\n                  exit={{ opacity: 0, x: 10, scale: 0.95 }}\n                  className=\"absolute left-full bottom-0 w-48 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 shadow-xl rounded-lg p-2 z-[60] flex flex-col gap-1\"\n                >\n                  <div className=\"flex items-center justify-between px-2 py-1 border-b border-gray-100 dark:border-neutral-700 mb-1\">\n                    <span className=\"text-[10px] font-bold uppercase text-gray-400 dark:text-neutral-500\">Filter Tags</span>\n                    {selectedTag && (\n                      <button onClick={() => onSelectTag(null)} className=\"text-[10px] text-red-500 hover:underline\">\n                        Clear\n                      </button>\n                    )}\n                  </div>\n                  <div className=\"max-h-60 overflow-y-auto custom-scrollbar\">\n                    {allTags.length === 0 ? (\n                      <div className=\"p-2 text-xs text-gray-400 italic text-center\">No tags found</div>\n                    ) : (\n                      allTags.map(tag => (\n                        <button\n                          key={tag}\n                          onClick={() => {\n                            onSelectTag(selectedTag === tag ? null : tag);\n                          }}\n                          className={`w-full text-left px-2 py-1.5 rounded text-xs font-bold flex items-center justify-between ${selectedTag === tag ? 'bg-black dark:bg-white text-white dark:text-black' : 'text-gray-600 dark:text-neutral-400 hover:bg-gray-100 dark:hover:bg-neutral-800'}`}\n                        >\n                          <span>#{tag}</span>\n                          {selectedTag === tag && <X size={10} />}\n                        </button>\n                      ))\n                    )}\n                  </div>\n                </motion.div>\n              </>\n            )}\n          </AnimatePresence>\n        </div>\n\n        {/* Admin/Tag Management Link */}\n        <Link href=\"/admin\">\n          <motion.div\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n            className=\"w-10 h-10 flex items-center justify-center rounded-lg text-gray-400 hover:text-black dark:hover:text-white hover:bg-gray-50 dark:hover:bg-neutral-800 transition-colors cursor-pointer\"\n            title=\"Tag Management (Admin)\"\n          >\n            <Settings size={20} />\n          </motion.div>\n        </Link>\n\n        <motion.button\n          whileHover={{ scale: 1.1 }}\n          whileTap={{ scale: 0.9 }}\n          onClick={onSearch}\n          className=\"text-gray-400 hover:text-black dark:hover:text-white transition-colors w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-800\"\n          title=\"Search (Cmd+K)\"\n        >\n          <Search size={20} />\n        </motion.button>\n\n        <div className=\"flex flex-col gap-3 items-center\">\n          <motion.button\n            whileHover={{ scale: 1.1, rotate: 180 }}\n            transition={{ type: 'spring', stiffness: 200, damping: 10 }}\n            onClick={onAiCreate}\n            className=\"text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 w-10 h-10 flex items-center justify-center rounded-lg\"\n            title=\"Magic Create with Gemini\"\n          >\n            <Sparkles size={20} />\n          </motion.button>\n\n          <motion.button\n            whileHover={{ scale: 1.15 }}\n            whileTap={{ scale: 0.9 }}\n            onClick={onCreateNote}\n            className=\"text-black dark:text-white\"\n            title=\"Create Note\"\n          >\n            <PlusCircle size={28} strokeWidth={1.5} />\n          </motion.button>\n        </div>\n      </div>\n    </motion.div>\n  );\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 536, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IAqTsB,UAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 551, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/constants.ts"],"sourcesContent":["\nimport { Note, NoteBlock } from './types';\n\nexport const APP_NAME = \"NOTATIONS\";\n\nexport const NOTE_COLORS = [\n  { id: 'default', value: '#000000', label: 'Black' },\n  { id: 'red', value: '#ef4444', label: 'Red' },\n  { id: 'orange', value: '#f97316', label: 'Orange' },\n  { id: 'yellow', value: '#eab308', label: 'Yellow' },\n  { id: 'green', value: '#22c55e', label: 'Green' },\n  { id: 'blue', value: '#3b82f6', label: 'Blue' },\n  { id: 'purple', value: '#a855f7', label: 'Purple' },\n];\n\n// Highlight colors for individual content blocks (vibrant, readable versions)\nexport const BLOCK_HIGHLIGHT_COLORS = [\n  { id: 'none', value: 'transparent', label: 'No Highlight' },\n  { id: 'red', value: 'rgba(239, 68, 68, 0.35)', label: 'Red' },\n  { id: 'orange', value: 'rgba(249, 115, 22, 0.35)', label: 'Orange' },\n  { id: 'yellow', value: 'rgba(250, 204, 21, 0.4)', label: 'Yellow' },\n  { id: 'green', value: 'rgba(34, 197, 94, 0.35)', label: 'Green' },\n  { id: 'blue', value: 'rgba(59, 130, 246, 0.35)', label: 'Blue' },\n  { id: 'purple', value: 'rgba(168, 85, 247, 0.4)', label: 'Purple' },\n  { id: 'pink', value: 'rgba(236, 72, 153, 0.35)', label: 'Pink' },\n  { id: 'cyan', value: 'rgba(6, 182, 212, 0.35)', label: 'Cyan' },\n];\n\nexport const MOCK_NOTES: Note[] = [\n  {\n    id: '1',\n    title: 'Project Manifesto',\n    blocks: [\n      { id: 'b1', type: 'heading', content: 'The Vision' },\n      { id: 'b2', type: 'paragraph', content: 'A unified interface for thought.' },\n      { id: 'b3', type: 'todo', content: 'Integrate Gemini AI', checked: false }\n    ],\n    position: { x: 100, y: 100 },\n    connections: ['2', '3'],\n    color: '#000000',\n    tags: ['vision', 'strategy'],\n    createdAt: Date.now()\n  },\n  {\n    id: '2',\n    title: 'Design System',\n    blocks: [\n      { id: 'b4', type: 'heading', content: 'Monochrome' },\n      { id: 'b5', type: 'paragraph', content: 'Strict black and white palette. No greys unless necessary for hierarchy.' }\n    ],\n    position: { x: 400, y: 200 },\n    connections: ['1'],\n    color: '#3b82f6',\n    tags: ['design', 'ui'],\n    createdAt: Date.now()\n  },\n  {\n    id: '3',\n    title: 'Tech Stack',\n    blocks: [\n      { id: 'b6', type: 'paragraph', content: 'React, D3, Framer Motion, Google GenAI.' }\n    ],\n    position: { x: 200, y: 400 },\n    connections: ['1'],\n    color: '#ef4444',\n    tags: ['dev', 'stack'],\n    createdAt: Date.now()\n  }\n];"],"names":[],"mappings":";;;;;;;;;;AAGO,MAAM,WAAW;AAEjB,MAAM,cAAc;IACzB;QAAE,IAAI;QAAW,OAAO;QAAW,OAAO;IAAQ;IAClD;QAAE,IAAI;QAAO,OAAO;QAAW,OAAO;IAAM;IAC5C;QAAE,IAAI;QAAU,OAAO;QAAW,OAAO;IAAS;IAClD;QAAE,IAAI;QAAU,OAAO;QAAW,OAAO;IAAS;IAClD;QAAE,IAAI;QAAS,OAAO;QAAW,OAAO;IAAQ;IAChD;QAAE,IAAI;QAAQ,OAAO;QAAW,OAAO;IAAO;IAC9C;QAAE,IAAI;QAAU,OAAO;QAAW,OAAO;IAAS;CACnD;AAGM,MAAM,yBAAyB;IACpC;QAAE,IAAI;QAAQ,OAAO;QAAe,OAAO;IAAe;IAC1D;QAAE,IAAI;QAAO,OAAO;QAA2B,OAAO;IAAM;IAC5D;QAAE,IAAI;QAAU,OAAO;QAA4B,OAAO;IAAS;IACnE;QAAE,IAAI;QAAU,OAAO;QAA2B,OAAO;IAAS;IAClE;QAAE,IAAI;QAAS,OAAO;QAA2B,OAAO;IAAQ;IAChE;QAAE,IAAI;QAAQ,OAAO;QAA4B,OAAO;IAAO;IAC/D;QAAE,IAAI;QAAU,OAAO;QAA2B,OAAO;IAAS;IAClE;QAAE,IAAI;QAAQ,OAAO;QAA4B,OAAO;IAAO;IAC/D;QAAE,IAAI;QAAQ,OAAO;QAA2B,OAAO;IAAO;CAC/D;AAEM,MAAM,aAAqB;IAChC;QACE,IAAI;QACJ,OAAO;QACP,QAAQ;YACN;gBAAE,IAAI;gBAAM,MAAM;gBAAW,SAAS;YAAa;YACnD;gBAAE,IAAI;gBAAM,MAAM;gBAAa,SAAS;YAAmC;YAC3E;gBAAE,IAAI;gBAAM,MAAM;gBAAQ,SAAS;gBAAuB,SAAS;YAAM;SAC1E;QACD,UAAU;YAAE,GAAG;YAAK,GAAG;QAAI;QAC3B,aAAa;YAAC;YAAK;SAAI;QACvB,OAAO;QACP,MAAM;YAAC;YAAU;SAAW;QAC5B,WAAW,KAAK,GAAG;IACrB;IACA;QACE,IAAI;QACJ,OAAO;QACP,QAAQ;YACN;gBAAE,IAAI;gBAAM,MAAM;gBAAW,SAAS;YAAa;YACnD;gBAAE,IAAI;gBAAM,MAAM;gBAAa,SAAS;YAA2E;SACpH;QACD,UAAU;YAAE,GAAG;YAAK,GAAG;QAAI;QAC3B,aAAa;YAAC;SAAI;QAClB,OAAO;QACP,MAAM;YAAC;YAAU;SAAK;QACtB,WAAW,KAAK,GAAG;IACrB;IACA;QACE,IAAI;QACJ,OAAO;QACP,QAAQ;YACN;gBAAE,IAAI;gBAAM,MAAM;gBAAa,SAAS;YAA0C;SACnF;QACD,UAAU;YAAE,GAAG;YAAK,GAAG;QAAI;QAC3B,aAAa;YAAC;SAAI;QAClB,OAAO;QACP,MAAM;YAAC;YAAO;SAAQ;QACtB,WAAW,KAAK,GAAG;IACrB;CACD"}},
    {"offset": {"line": 744, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/services/geminiService.ts"],"sourcesContent":["'use server';\n\nimport { GoogleGenAI, Type } from \"@google/genai\";\n\nconst getClient = () => {\n  const apiKey = process.env.GEMINI_API_KEY;\n  if (!apiKey) {\n    console.warn(\"API Key not found\");\n    return null;\n  }\n  return new GoogleGenAI({ apiKey });\n};\n\nexport const expandNoteWithAI = async (currentContent: string): Promise<string> => {\n  const ai = getClient();\n  if (!ai) return \"Error: API Key missing.\";\n\n  try {\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-pro',\n      contents: `You are a minimalist productivity assistant. \n      Take the following note content and expand upon it with 3 actionable bullet points \n      or a brief summary paragraph. Keep the tone strict, professional, and concise.\n      \n      Input: \"${currentContent}\"`,\n    });\n\n    return response.text || \"No response generated.\";\n  } catch (error) {\n    console.error(\"Gemini API Error:\", error);\n    return \"Failed to generate insight.\";\n  }\n};\n\nexport const generateConnections = async (notes: { id: string, title: string }[]) => {\n  const ai = getClient();\n  if (!ai) return [];\n\n  try {\n    // Logic to suggest connections between notes based on titles\n    // Placeholder for advanced graph RAG\n    return [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport const generateNoteFromPrompt = async (prompt: string): Promise<{ title: string; content: string } | null> => {\n  const ai = getClient();\n  if (!ai) return null;\n\n  try {\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-pro',\n      contents: `Generate a creative and structured note based on the following user prompt: \"${prompt}\". \n        The title should be concise and catchy. The content should be a well-structured starting point (e.g., a list, a summary, or a draft).`,\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: Type.OBJECT,\n          properties: {\n            title: { type: Type.STRING },\n            content: { type: Type.STRING }\n          },\n          required: [\"title\", \"content\"]\n        }\n      }\n    });\n\n    const text = response.text;\n    if (text) {\n      return JSON.parse(text);\n    }\n    return null;\n  } catch (e) {\n    console.error(\"Gemini Magic Create Error:\", e);\n    return null;\n  }\n}"],"names":[],"mappings":";;;;;;;IAaa,mBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 759, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/ContentBlock.tsx"],"sourcesContent":["\nimport React, { useRef, useEffect, useMemo } from 'react';\n\ninterface ContentBlockProps {\n  id: string;\n  html: string;\n  tagName: string;\n  className?: string;\n  onChange: (id: string, html: string) => void;\n  onKeyDown: (e: React.KeyboardEvent, id: string) => void;\n  placeholder?: string;\n  autoFocus?: boolean;\n  onFocus?: (id: string) => void;\n}\n\nexport const ContentBlock = React.memo<ContentBlockProps>(({\n  id,\n  html,\n  tagName,\n  className = '',\n  onChange,\n  onKeyDown,\n  placeholder,\n  autoFocus,\n  onFocus\n}) => {\n  const contentEditableRef = useRef<HTMLElement>(null);\n\n  // 1. Track the content we believe is in the DOM (user's typing + external updates)\n  const lastHtmlRef = useRef(html);\n\n  // 2. Track the content we want React to use for rendering.\n  // We separate this to control WHEN React updates the DOM.\n  const renderHtmlRef = useRef(html);\n\n  // 3. Reconcile Props vs Local State\n  // If 'html' (prop) differs from 'lastHtmlRef' (local), it is an EXTERNAL change \n  // (like Undo, Redo, AI, or loading a new note). We must apply it.\n  if (html !== lastHtmlRef.current) {\n    lastHtmlRef.current = html;\n    renderHtmlRef.current = html;\n  }\n  // If 'html' === 'lastHtmlRef', it is a LOOPBACK (User typed -> State updated -> Prop passed back).\n  // We do NOT update 'renderHtmlRef' in this case.\n\n  // 4. Memoize the innerHTML object.\n  // React checks if props have changed. If we pass the exact same object reference \n  // for dangerouslySetInnerHTML, React skips the DOM update entirely.\n  // We rely on 'renderHtmlRef.current' staying stable during loopbacks.\n  const innerHTML = useMemo(() => ({ __html: renderHtmlRef.current }), [renderHtmlRef.current]);\n\n  // Handle AutoFocus\n  useEffect(() => {\n    if (autoFocus && contentEditableRef.current) {\n      contentEditableRef.current.focus();\n      // Move cursor to end safely\n      const range = document.createRange();\n      const sel = window.getSelection();\n      if (sel) {\n        range.selectNodeContents(contentEditableRef.current);\n        range.collapse(false);\n        sel.removeAllRanges();\n        sel.addRange(range);\n      }\n    }\n  }, [autoFocus]);\n\n  const handleInput = (e: React.FormEvent<HTMLElement>) => {\n    let newHtml = e.currentTarget.innerHTML;\n\n    // Clean up empty or broken anchor tags\n    // Remove anchor tags with empty or whitespace-only content\n    newHtml = newHtml.replace(/<a[^>]*>(\\s*)<\\/a>/gi, '$1');\n    // Remove anchor tags with only formatting tags but no text\n    newHtml = newHtml.replace(/<a[^>]*>(<(strong|em|span|b|i)[^>]*>\\s*<\\/\\2>)*<\\/a>/gi, '');\n\n    // Platform links should be ATOMIC - any modification removes the entire link\n    // These are platform links that should be deleted entirely if edited at all\n    const platformLinkClasses = ['twitter-mention-link', 'youtube-link', 'instagram-link', 'github-link', 'linkedin-link', 'tiktok-link', 'spotify-link', 'reddit-link', 'generic-link'];\n\n    // Create a temporary element to parse and clean the HTML\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = newHtml;\n\n    // Find all anchor tags and check if they're platform links that have been modified\n    const anchors = tempDiv.querySelectorAll('a');\n    anchors.forEach(anchor => {\n      const classList = anchor.className;\n      const isPlatformLink = platformLinkClasses.some(cls => classList.includes(cls));\n\n      if (isPlatformLink) {\n        // Check if the link structure is intact - platform links must have:\n        // 1. A .link-logo span with an SVG inside\n        // 2. A .link-text span \n        // 3. A strong tag inside .link-text\n        // 4. A .link-separator span (the Â· character)\n        // 5. A .link-platform span\n        const hasLinkLogo = anchor.querySelector('.link-logo') !== null;\n        const hasLinkText = anchor.querySelector('.link-text') !== null;\n        const hasStrong = anchor.querySelector('.link-text strong') !== null;\n        const hasSeparator = anchor.querySelector('.link-separator') !== null;\n        const hasPlatform = anchor.querySelector('.link-platform') !== null;\n        const hasSvg = anchor.querySelector('svg') !== null;\n\n        // If ANY required component is missing, the link was edited - delete it entirely\n        const isIntact = hasLinkLogo && hasLinkText && hasStrong && hasSeparator && hasPlatform && hasSvg;\n\n        if (!isIntact) {\n          // Remove the entire anchor - don't leave any text behind\n          anchor.remove();\n        }\n      }\n    });\n\n    newHtml = tempDiv.innerHTML;\n\n    // Remove twitter preview cards that are orphaned (outside of anchor)\n    newHtml = newHtml.replace(/<div class=\"twitter-preview-card\"[^>]*>[\\s\\S]*?<\\/div>\\s*<\\/div>\\s*<\\/div>\\s*<\\/div>/gi, '');\n\n    // Update local tracker immediately so next render knows it matches\n    lastHtmlRef.current = newHtml;\n    onChange(id, newHtml);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    // Rich Text Shortcuts\n    if ((e.metaKey || e.ctrlKey) && !e.shiftKey) {\n      if (e.key === 'b') { e.preventDefault(); document.execCommand('bold'); }\n      else if (e.key === 'i') { e.preventDefault(); document.execCommand('italic'); }\n      else if (e.key === 'u') { e.preventDefault(); document.execCommand('underline'); }\n    }\n    onKeyDown(e, id);\n  };\n\n  // Handle clicks on links inside contentEditable\n  const handleClick = (e: React.MouseEvent) => {\n    const target = e.target as HTMLElement;\n    const anchor = target.closest('a');\n    if (anchor && anchor.href) {\n      e.preventDefault();\n      e.stopPropagation();\n      window.open(anchor.href, '_blank', 'noopener,noreferrer');\n    }\n  };\n\n  const Tag = tagName as React.ElementType;\n\n  return (\n    <Tag\n      ref={contentEditableRef}\n      className={`outline-none empty:before:content-[attr(data-placeholder)] empty:before:text-gray-300 ${className}`}\n      contentEditable\n      suppressContentEditableWarning={true}\n      onInput={handleInput}\n      onKeyDown={handleKeyDown}\n      onClick={handleClick}\n      onFocus={() => onFocus?.(id)}\n      data-placeholder={placeholder}\n      dangerouslySetInnerHTML={innerHTML}\n    />\n  );\n});\n\nContentBlock.displayName = 'ContentBlock';\n"],"names":[],"mappings":";;;;;AACA;;;;AAcO,MAAM,6BAAe,GAAA,wKAAK,CAAC,IAAI,SAAoB,CAAC,EACzD,EAAE,EACF,IAAI,EACJ,OAAO,EACP,YAAY,EAAE,EACd,QAAQ,EACR,SAAS,EACT,WAAW,EACX,SAAS,EACT,OAAO,EACR;;IACC,MAAM,qBAAqB,IAAA,uKAAM,EAAc;IAE/C,mFAAmF;IACnF,MAAM,cAAc,IAAA,uKAAM,EAAC;IAE3B,2DAA2D;IAC3D,0DAA0D;IAC1D,MAAM,gBAAgB,IAAA,uKAAM,EAAC;IAE7B,oCAAoC;IACpC,iFAAiF;IACjF,kEAAkE;IAClE,IAAI,SAAS,YAAY,OAAO,EAAE;QAChC,YAAY,OAAO,GAAG;QACtB,cAAc,OAAO,GAAG;IAC1B;IACA,mGAAmG;IACnG,iDAAiD;IAEjD,mCAAmC;IACnC,kFAAkF;IAClF,oEAAoE;IACpE,sEAAsE;IACtE,MAAM,YAAY,IAAA,wKAAO;2CAAC,IAAM,CAAC;gBAAE,QAAQ,cAAc,OAAO;YAAC,CAAC;0CAAG;QAAC,cAAc,OAAO;KAAC;IAE5F,mBAAmB;IACnB,IAAA,0KAAS;kCAAC;YACR,IAAI,aAAa,mBAAmB,OAAO,EAAE;gBAC3C,mBAAmB,OAAO,CAAC,KAAK;gBAChC,4BAA4B;gBAC5B,MAAM,QAAQ,SAAS,WAAW;gBAClC,MAAM,MAAM,OAAO,YAAY;gBAC/B,IAAI,KAAK;oBACP,MAAM,kBAAkB,CAAC,mBAAmB,OAAO;oBACnD,MAAM,QAAQ,CAAC;oBACf,IAAI,eAAe;oBACnB,IAAI,QAAQ,CAAC;gBACf;YACF;QACF;iCAAG;QAAC;KAAU;IAEd,MAAM,cAAc,CAAC;QACnB,IAAI,UAAU,EAAE,aAAa,CAAC,SAAS;QAEvC,uCAAuC;QACvC,2DAA2D;QAC3D,UAAU,QAAQ,OAAO,CAAC,wBAAwB;QAClD,2DAA2D;QAC3D,UAAU,QAAQ,OAAO,CAAC,0DAA0D;QAEpF,6EAA6E;QAC7E,4EAA4E;QAC5E,MAAM,sBAAsB;YAAC;YAAwB;YAAgB;YAAkB;YAAe;YAAiB;YAAe;YAAgB;YAAe;SAAe;QAEpL,yDAAyD;QACzD,MAAM,UAAU,SAAS,aAAa,CAAC;QACvC,QAAQ,SAAS,GAAG;QAEpB,mFAAmF;QACnF,MAAM,UAAU,QAAQ,gBAAgB,CAAC;QACzC,QAAQ,OAAO,CAAC,CAAA;YACd,MAAM,YAAY,OAAO,SAAS;YAClC,MAAM,iBAAiB,oBAAoB,IAAI,CAAC,CAAA,MAAO,UAAU,QAAQ,CAAC;YAE1E,IAAI,gBAAgB;gBAClB,oEAAoE;gBACpE,0CAA0C;gBAC1C,wBAAwB;gBACxB,oCAAoC;gBACpC,8CAA8C;gBAC9C,2BAA2B;gBAC3B,MAAM,cAAc,OAAO,aAAa,CAAC,kBAAkB;gBAC3D,MAAM,cAAc,OAAO,aAAa,CAAC,kBAAkB;gBAC3D,MAAM,YAAY,OAAO,aAAa,CAAC,yBAAyB;gBAChE,MAAM,eAAe,OAAO,aAAa,CAAC,uBAAuB;gBACjE,MAAM,cAAc,OAAO,aAAa,CAAC,sBAAsB;gBAC/D,MAAM,SAAS,OAAO,aAAa,CAAC,WAAW;gBAE/C,iFAAiF;gBACjF,MAAM,WAAW,eAAe,eAAe,aAAa,gBAAgB,eAAe;gBAE3F,IAAI,CAAC,UAAU;oBACb,yDAAyD;oBACzD,OAAO,MAAM;gBACf;YACF;QACF;QAEA,UAAU,QAAQ,SAAS;QAE3B,qEAAqE;QACrE,UAAU,QAAQ,OAAO,CAAC,0FAA0F;QAEpH,mEAAmE;QACnE,YAAY,OAAO,GAAG;QACtB,SAAS,IAAI;IACf;IAEA,MAAM,gBAAgB,CAAC;QACrB,sBAAsB;QACtB,IAAI,CAAC,EAAE,OAAO,IAAI,EAAE,OAAO,KAAK,CAAC,EAAE,QAAQ,EAAE;YAC3C,IAAI,EAAE,GAAG,KAAK,KAAK;gBAAE,EAAE,cAAc;gBAAI,SAAS,WAAW,CAAC;YAAS,OAClE,IAAI,EAAE,GAAG,KAAK,KAAK;gBAAE,EAAE,cAAc;gBAAI,SAAS,WAAW,CAAC;YAAW,OACzE,IAAI,EAAE,GAAG,KAAK,KAAK;gBAAE,EAAE,cAAc;gBAAI,SAAS,WAAW,CAAC;YAAc;QACnF;QACA,UAAU,GAAG;IACf;IAEA,gDAAgD;IAChD,MAAM,cAAc,CAAC;QACnB,MAAM,SAAS,EAAE,MAAM;QACvB,MAAM,SAAS,OAAO,OAAO,CAAC;QAC9B,IAAI,UAAU,OAAO,IAAI,EAAE;YACzB,EAAE,cAAc;YAChB,EAAE,eAAe;YACjB,OAAO,IAAI,CAAC,OAAO,IAAI,EAAE,UAAU;QACrC;IACF;IAEA,MAAM,MAAM;IAEZ,qBACE,6LAAC;QACC,KAAK;QACL,WAAW,CAAC,sFAAsF,EAAE,WAAW;QAC/G,eAAe;QACf,gCAAgC;QAChC,SAAS;QACT,WAAW;QACX,SAAS;QACT,SAAS,IAAM,UAAU;QACzB,oBAAkB;QAClB,yBAAyB;;;;;;AAG/B;;AAEA,aAAa,WAAW,GAAG"}},
    {"offset": {"line": 927, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/ImageBlock.tsx"],"sourcesContent":["import React, { useState, useCallback, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Trash2, Download, Maximize2, X, Loader2, ImageOff, ZoomIn, Copy, Check } from 'lucide-react';\r\n\r\ninterface ImageBlockProps {\r\n    id: string;\r\n    src: string;\r\n    onDelete?: (id: string) => void;\r\n    className?: string;\r\n    isLoading?: boolean;\r\n}\r\n\r\nexport const ImageBlock = React.memo<ImageBlockProps>(({ id, src, onDelete, className = '', isLoading = false }) => {\r\n    const [imageLoaded, setImageLoaded] = useState(false);\r\n    const [imageError, setImageError] = useState(false);\r\n    const [isFullscreen, setIsFullscreen] = useState(false);\r\n    const [showActions, setShowActions] = useState(false);\r\n    const [copied, setCopied] = useState(false);\r\n    const [imageDimensions, setImageDimensions] = useState({ width: 0, height: 0 });\r\n\r\n    // Determine if this is a blob URL (local preview)\r\n    const isLocalPreview = src.startsWith('blob:');\r\n\r\n    const handleLoad = useCallback((e: React.SyntheticEvent<HTMLImageElement>) => {\r\n        setImageLoaded(true);\r\n        setImageError(false);\r\n        const img = e.currentTarget;\r\n        setImageDimensions({ width: img.naturalWidth, height: img.naturalHeight });\r\n    }, []);\r\n\r\n    const handleError = useCallback(() => {\r\n        setImageLoaded(true);\r\n        setImageError(true);\r\n    }, []);\r\n\r\n    const handleDownload = useCallback(() => {\r\n        const link = document.createElement('a');\r\n        link.href = src;\r\n        link.download = `image-${id}.png`;\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n    }, [src, id]);\r\n\r\n    const handleCopyUrl = useCallback(async () => {\r\n        try {\r\n            await navigator.clipboard.writeText(src);\r\n            setCopied(true);\r\n            setTimeout(() => setCopied(false), 2000);\r\n        } catch (e) {\r\n            console.error('Failed to copy URL', e);\r\n        }\r\n    }, [src]);\r\n\r\n    // Close fullscreen on Escape\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (e.key === 'Escape' && isFullscreen) {\r\n                setIsFullscreen(false);\r\n            }\r\n        };\r\n        document.addEventListener('keydown', handleKeyDown);\r\n        return () => document.removeEventListener('keydown', handleKeyDown);\r\n    }, [isFullscreen]);\r\n\r\n    // Error state\r\n    if (imageError) {\r\n        return (\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                className={`relative my-4 ${className}`}\r\n            >\r\n                <div className=\"flex items-center gap-3 p-4 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800/50 rounded-xl\">\r\n                    <div className=\"p-2 bg-red-100 dark:bg-red-900/50 rounded-lg\">\r\n                        <ImageOff size={24} className=\"text-red-500\" />\r\n                    </div>\r\n                    <div className=\"flex-1\">\r\n                        <p className=\"text-sm font-semibold text-red-700 dark:text-red-300\">Failed to load image</p>\r\n                        <p className=\"text-xs text-red-500 dark:text-red-400 truncate max-w-[300px]\">{src}</p>\r\n                    </div>\r\n                    {onDelete && (\r\n                        <button\r\n                            onClick={() => onDelete(id)}\r\n                            className=\"p-2 hover:bg-red-200 dark:hover:bg-red-800/50 rounded-lg transition-colors\"\r\n                            title=\"Remove\"\r\n                        >\r\n                            <Trash2 size={16} className=\"text-red-600\" />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </motion.div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 20, scale: 0.95 }}\r\n                animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                transition={{ type: \"spring\", stiffness: 300, damping: 25 }}\r\n                className={`relative group/image my-4 ${className}`}\r\n                onMouseEnter={() => setShowActions(true)}\r\n                onMouseLeave={() => setShowActions(false)}\r\n            >\r\n                {/* Container with aspect ratio preservation */}\r\n                <div className=\"relative overflow-hidden rounded-xl bg-gradient-to-br from-gray-100 to-gray-50 dark:from-neutral-900 dark:to-neutral-950 border border-gray-200/50 dark:border-neutral-800\">\r\n\r\n                    {/* Loading skeleton */}\r\n                    <AnimatePresence>\r\n                        {(!imageLoaded || isLoading || isLocalPreview) && (\r\n                            <motion.div\r\n                                initial={{ opacity: 1 }}\r\n                                exit={{ opacity: 0 }}\r\n                                className=\"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200 dark:from-neutral-800 dark:to-neutral-900 z-10\"\r\n                            >\r\n                                <div className=\"flex flex-col items-center gap-3\">\r\n                                    {isLocalPreview && (\r\n                                        <motion.div\r\n                                            animate={{ rotate: 360 }}\r\n                                            transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\r\n                                        >\r\n                                            <Loader2 size={28} className=\"text-blue-500\" />\r\n                                        </motion.div>\r\n                                    )}\r\n                                    <div className=\"relative w-32 h-1 bg-gray-300 dark:bg-neutral-700 rounded-full overflow-hidden\">\r\n                                        <motion.div\r\n                                            className=\"absolute inset-y-0 left-0 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full\"\r\n                                            initial={{ width: \"0%\" }}\r\n                                            animate={{ width: isLocalPreview ? \"60%\" : \"100%\" }}\r\n                                            transition={{ duration: isLocalPreview ? 1 : 0.3 }}\r\n                                        />\r\n                                    </div>\r\n                                    <span className=\"text-xs font-medium text-gray-500 dark:text-neutral-500\">\r\n                                        {isLocalPreview ? \"Uploading...\" : \"Loading...\"}\r\n                                    </span>\r\n                                </div>\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n\r\n                    {/* Main image */}\r\n                    <motion.img\r\n                        src={src}\r\n                        alt=\"Note attachment\"\r\n                        className=\"w-full h-auto max-h-[500px] object-contain cursor-zoom-in\"\r\n                        loading=\"lazy\"\r\n                        onLoad={handleLoad}\r\n                        onError={handleError}\r\n                        onClick={() => setIsFullscreen(true)}\r\n                        initial={{ filter: \"blur(10px)\" }}\r\n                        animate={{ filter: imageLoaded ? \"blur(0px)\" : \"blur(10px)\" }}\r\n                        transition={{ duration: 0.4 }}\r\n                    />\r\n\r\n                    {/* Gradient overlay on hover */}\r\n                    <AnimatePresence>\r\n                        {showActions && imageLoaded && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0 }}\r\n                                animate={{ opacity: 1 }}\r\n                                exit={{ opacity: 0 }}\r\n                                className=\"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-black/20 pointer-events-none\"\r\n                            />\r\n                        )}\r\n                    </AnimatePresence>\r\n\r\n                    {/* Action buttons */}\r\n                    <AnimatePresence>\r\n                        {showActions && imageLoaded && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0, y: -10 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                exit={{ opacity: 0, y: -10 }}\r\n                                className=\"absolute top-3 right-3 flex gap-2\"\r\n                            >\r\n                                <button\r\n                                    onClick={() => setIsFullscreen(true)}\r\n                                    className=\"p-2 bg-white/90 dark:bg-black/80 hover:bg-white dark:hover:bg-black rounded-lg text-gray-700 dark:text-gray-200 transition-all shadow-lg backdrop-blur-sm hover:scale-110\"\r\n                                    title=\"View fullscreen\"\r\n                                >\r\n                                    <Maximize2 size={16} />\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleDownload}\r\n                                    className=\"p-2 bg-white/90 dark:bg-black/80 hover:bg-white dark:hover:bg-black rounded-lg text-gray-700 dark:text-gray-200 transition-all shadow-lg backdrop-blur-sm hover:scale-110\"\r\n                                    title=\"Download\"\r\n                                >\r\n                                    <Download size={16} />\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleCopyUrl}\r\n                                    className=\"p-2 bg-white/90 dark:bg-black/80 hover:bg-white dark:hover:bg-black rounded-lg text-gray-700 dark:text-gray-200 transition-all shadow-lg backdrop-blur-sm hover:scale-110\"\r\n                                    title=\"Copy URL\"\r\n                                >\r\n                                    {copied ? <Check size={16} className=\"text-green-500\" /> : <Copy size={16} />}\r\n                                </button>\r\n                                {onDelete && (\r\n                                    <button\r\n                                        onClick={() => onDelete(id)}\r\n                                        className=\"p-2 bg-red-500/90 hover:bg-red-600 rounded-lg text-white transition-all shadow-lg backdrop-blur-sm hover:scale-110\"\r\n                                        title=\"Remove image\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                )}\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n\r\n                    {/* Image dimensions badge */}\r\n                    <AnimatePresence>\r\n                        {showActions && imageLoaded && imageDimensions.width > 0 && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0, y: 10 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                exit={{ opacity: 0, y: 10 }}\r\n                                className=\"absolute bottom-3 left-3 px-2 py-1 bg-black/60 backdrop-blur-sm rounded-md text-[10px] font-mono text-white/80\"\r\n                            >\r\n                                {imageDimensions.width} Ã {imageDimensions.height}\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n\r\n                    {/* Zoom hint */}\r\n                    <AnimatePresence>\r\n                        {showActions && imageLoaded && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0, scale: 0.8 }}\r\n                                animate={{ opacity: 1, scale: 1 }}\r\n                                exit={{ opacity: 0, scale: 0.8 }}\r\n                                className=\"absolute bottom-3 right-3 flex items-center gap-1 px-2 py-1 bg-black/60 backdrop-blur-sm rounded-md text-[10px] font-medium text-white/80\"\r\n                            >\r\n                                <ZoomIn size={12} />\r\n                                Click to expand\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n                </div>\r\n            </motion.div>\r\n\r\n            {/* Fullscreen modal */}\r\n            <AnimatePresence>\r\n                {isFullscreen && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 backdrop-blur-xl\"\r\n                        onClick={() => setIsFullscreen(false)}\r\n                    >\r\n                        {/* Close button */}\r\n                        <motion.button\r\n                            initial={{ opacity: 0, y: -20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            exit={{ opacity: 0, y: -20 }}\r\n                            onClick={() => setIsFullscreen(false)}\r\n                            className=\"absolute top-6 right-6 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all hover:scale-110\"\r\n                        >\r\n                            <X size={24} />\r\n                        </motion.button>\r\n\r\n                        {/* Fullscreen image */}\r\n                        <motion.img\r\n                            initial={{ scale: 0.8, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            exit={{ scale: 0.8, opacity: 0 }}\r\n                            transition={{ type: \"spring\", stiffness: 300, damping: 25 }}\r\n                            src={src}\r\n                            alt=\"Note attachment\"\r\n                            className=\"max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl\"\r\n                            onClick={(e) => e.stopPropagation()}\r\n                        />\r\n\r\n                        {/* Dimensions in fullscreen */}\r\n                        {imageDimensions.width > 0 && (\r\n                            <motion.div\r\n                                initial={{ opacity: 0, y: 20 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                className=\"absolute bottom-6 left-1/2 -translate-x-1/2 px-4 py-2 bg-white/10 backdrop-blur-sm rounded-lg text-sm font-mono text-white/80\"\r\n                            >\r\n                                {imageDimensions.width} Ã {imageDimensions.height}\r\n                            </motion.div>\r\n                        )}\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </>\r\n    );\r\n});\r\n\r\nImageBlock.displayName = 'ImageBlock';\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1546, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/ui/ConfirmationModal.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Trash2, AlertTriangle, X, Loader2 } from 'lucide-react';\n\ninterface ConfirmationModalProps {\n  isOpen: boolean;\n  title: string;\n  message: string;\n  onConfirm: () => void;\n  onCancel: () => void;\n  variant?: 'danger' | 'warning' | 'info';\n  confirmText?: string;\n  cancelText?: string;\n}\n\nexport const ConfirmationModal: React.FC<ConfirmationModalProps> = ({\n  isOpen,\n  title,\n  message,\n  onConfirm,\n  onCancel,\n  variant = 'danger',\n  confirmText = 'Confirmar',\n  cancelText = 'Cancelar'\n}) => {\n  const [isConfirming, setIsConfirming] = useState(false);\n  const [showSuccess, setShowSuccess] = useState(false);\n\n  // Reset state when modal closes\n  useEffect(() => {\n    if (!isOpen) {\n      setIsConfirming(false);\n      setShowSuccess(false);\n    }\n  }, [isOpen]);\n\n  // Handle keyboard\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        onCancel();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, onCancel]);\n\n  const handleConfirm = async () => {\n    setIsConfirming(true);\n\n    // Show brief loading state\n    await new Promise(resolve => setTimeout(resolve, 200));\n\n    setShowSuccess(true);\n\n    // Execute after success animation\n    setTimeout(() => {\n      onConfirm();\n    }, 300);\n  };\n\n  const variantStyles = {\n    danger: {\n      iconBg: 'bg-gradient-to-br from-red-500/20 to-red-600/20',\n      iconColor: 'text-red-400',\n      confirmBg: 'bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700',\n      confirmShadow: 'shadow-red-500/30 hover:shadow-red-500/50',\n      glowColor: 'rgba(239, 68, 68, 0.3)',\n      Icon: Trash2\n    },\n    warning: {\n      iconBg: 'bg-gradient-to-br from-amber-500/20 to-orange-600/20',\n      iconColor: 'text-amber-400',\n      confirmBg: 'bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700',\n      confirmShadow: 'shadow-amber-500/30 hover:shadow-amber-500/50',\n      glowColor: 'rgba(245, 158, 11, 0.3)',\n      Icon: AlertTriangle\n    },\n    info: {\n      iconBg: 'bg-gradient-to-br from-blue-500/20 to-indigo-600/20',\n      iconColor: 'text-blue-400',\n      confirmBg: 'bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700',\n      confirmShadow: 'shadow-blue-500/30 hover:shadow-blue-500/50',\n      glowColor: 'rgba(59, 130, 246, 0.3)',\n      Icon: AlertTriangle\n    }\n  };\n\n  const style = variantStyles[variant];\n  const IconComponent = style.Icon;\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop with blur */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"fixed inset-0 bg-black/60 backdrop-blur-md z-[100]\"\n            onClick={onCancel}\n          />\n\n          {/* Modal Container */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9, y: 30 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 10 }}\n            transition={{\n              type: \"spring\",\n              stiffness: 400,\n              damping: 30,\n              mass: 0.8\n            }}\n            className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm z-[101]\"\n          >\n            <div\n              className=\"relative bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-2xl border border-white/10 overflow-hidden\"\n              style={{\n                boxShadow: `0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 40px ${style.glowColor}`\n              }}\n            >\n              {/* Animated glow border */}\n              <div className=\"absolute inset-0 rounded-2xl overflow-hidden pointer-events-none\">\n                <motion.div\n                  animate={{ rotate: 360 }}\n                  transition={{ duration: 8, repeat: Infinity, ease: \"linear\" }}\n                  className=\"absolute -inset-1/2 opacity-20\"\n                  style={{\n                    background: `conic-gradient(from 0deg, transparent 0%, ${style.glowColor}, transparent 30%)`\n                  }}\n                />\n              </div>\n\n              {/* Close button */}\n              <motion.button\n                whileHover={{ scale: 1.1, rotate: 90 }}\n                whileTap={{ scale: 0.9 }}\n                onClick={onCancel}\n                className=\"absolute top-4 right-4 p-2 rounded-full bg-white/5 hover:bg-white/10 transition-colors text-white/60 hover:text-white z-10\"\n              >\n                <X size={18} />\n              </motion.button>\n\n              {/* Content */}\n              <div className=\"relative p-6\">\n                {/* Icon with pulse animation */}\n                <div className=\"flex justify-center mb-5\">\n                  <motion.div\n                    initial={{ scale: 0 }}\n                    animate={{ scale: 1 }}\n                    transition={{ type: \"spring\", stiffness: 500, damping: 25, delay: 0.1 }}\n                    className={`relative w-16 h-16 rounded-2xl ${style.iconBg} flex items-center justify-center`}\n                  >\n                    {/* Pulse rings */}\n                    <motion.div\n                      animate={{ scale: [1, 1.3], opacity: [0.5, 0] }}\n                      transition={{ duration: 1.5, repeat: Infinity }}\n                      className={`absolute inset-0 rounded-2xl ${style.iconBg}`}\n                    />\n                    <motion.div\n                      animate={{ scale: [1, 1.5], opacity: [0.3, 0] }}\n                      transition={{ duration: 1.5, repeat: Infinity, delay: 0.3 }}\n                      className={`absolute inset-0 rounded-2xl ${style.iconBg}`}\n                    />\n\n                    <motion.div\n                      animate={showSuccess ? { rotate: -15, scale: 1.1 } : {}}\n                      transition={{ type: \"spring\", stiffness: 400 }}\n                    >\n                      <IconComponent size={28} className={style.iconColor} />\n                    </motion.div>\n                  </motion.div>\n                </div>\n\n                {/* Title */}\n                <motion.h2\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.15 }}\n                  className=\"text-xl font-bold text-center text-white mb-2\"\n                >\n                  {title}\n                </motion.h2>\n\n                {/* Message */}\n                <motion.p\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.2 }}\n                  className=\"text-sm text-center text-white/60 mb-6 leading-relaxed\"\n                >\n                  {message}\n                </motion.p>\n\n                {/* Actions */}\n                <motion.div\n                  initial={{ opacity: 0, y: 10 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: 0.25 }}\n                  className=\"flex gap-3\"\n                >\n                  {/* Cancel Button */}\n                  <motion.button\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    onClick={onCancel}\n                    disabled={isConfirming}\n                    className=\"flex-1 py-3 px-4 rounded-xl font-semibold text-sm bg-white/5 hover:bg-white/10 border border-white/10 text-white/80 hover:text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    {cancelText}\n                  </motion.button>\n\n                  {/* Confirm Button */}\n                  <motion.button\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    onClick={handleConfirm}\n                    disabled={isConfirming}\n                    className={`flex-1 py-3 px-4 rounded-xl font-semibold text-sm text-white ${style.confirmBg} shadow-lg ${style.confirmShadow} transition-all disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2`}\n                  >\n                    <AnimatePresence mode=\"wait\">\n                      {isConfirming ? (\n                        <motion.div\n                          key=\"loading\"\n                          initial={{ opacity: 0, scale: 0.5 }}\n                          animate={{ opacity: 1, scale: 1 }}\n                          exit={{ opacity: 0, scale: 0.5 }}\n                          className=\"flex items-center gap-2\"\n                        >\n                          <motion.div\n                            animate={{ rotate: 360 }}\n                            transition={{ duration: 0.6, repeat: Infinity, ease: \"linear\" }}\n                          >\n                            <Loader2 size={16} />\n                          </motion.div>\n                          <span>Removendo...</span>\n                        </motion.div>\n                      ) : showSuccess ? (\n                        <motion.div\n                          key=\"success\"\n                          initial={{ opacity: 0, scale: 0.5 }}\n                          animate={{ opacity: 1, scale: 1 }}\n                          className=\"flex items-center gap-2\"\n                        >\n                          <motion.span\n                            initial={{ scale: 0 }}\n                            animate={{ scale: 1 }}\n                            transition={{ type: \"spring\", stiffness: 500 }}\n                          >\n                            â\n                          </motion.span>\n                          <span>Removido!</span>\n                        </motion.div>\n                      ) : (\n                        <motion.span\n                          key=\"default\"\n                          initial={{ opacity: 0 }}\n                          animate={{ opacity: 1 }}\n                          exit={{ opacity: 0 }}\n                        >\n                          {confirmText}\n                        </motion.span>\n                      )}\n                    </AnimatePresence>\n                  </motion.button>\n                </motion.div>\n              </div>\n\n              {/* Bottom gradient line */}\n              <div\n                className=\"h-1 w-full\"\n                style={{\n                  background: `linear-gradient(90deg, transparent, ${style.glowColor}, transparent)`\n                }}\n              />\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2079, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/TextLinkingMode.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Check, Link2, ArrowRight, Sparkles, MousePointerClick } from 'lucide-react';\r\nimport { CONNECTION_COLORS } from '../../types';\r\n\r\ninterface TextLinkingModeProps {\r\n    isActive: boolean;\r\n    sourceText: string;\r\n    sourceBlockId: string;\r\n    currentColor: string;\r\n    onColorChange: (color: string) => void;\r\n    onSelectTarget: (targetText: string, targetBlockId: string) => void;\r\n    onCancel: () => void;\r\n}\r\n\r\nexport const TextLinkingMode: React.FC<TextLinkingModeProps> = ({\r\n    isActive,\r\n    sourceText,\r\n    sourceBlockId,\r\n    currentColor,\r\n    onColorChange,\r\n    onSelectTarget,\r\n    onCancel\r\n}) => {\r\n    const [selectedTargetText, setSelectedTargetText] = useState('');\r\n    const [selectedTargetBlockId, setSelectedTargetBlockId] = useState('');\r\n    const [isConnecting, setIsConnecting] = useState(false);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n    const toolbarRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Listen for text selection\r\n    useEffect(() => {\r\n        if (!isActive) return;\r\n\r\n        const handleMouseUp = (e: MouseEvent) => {\r\n            // Ignore clicks on the toolbar itself\r\n            if (toolbarRef.current?.contains(e.target as Node)) return;\r\n\r\n            const selection = window.getSelection();\r\n            if (!selection || selection.isCollapsed) return;\r\n\r\n            const selectedText = selection.toString().trim();\r\n            if (!selectedText) return;\r\n\r\n            // Don't allow connecting to the same text\r\n            if (selectedText === sourceText) return;\r\n\r\n            // Find the block containing the selection\r\n            let node = selection.anchorNode;\r\n            while (node && node !== document.body) {\r\n                if (node instanceof HTMLElement) {\r\n                    const blockId = node.id?.replace('block-', '');\r\n                    if (blockId && node.id?.startsWith('block-')) {\r\n                        // Don't allow connecting to same block same text\r\n                        if (blockId === sourceBlockId && selectedText === sourceText) return;\r\n\r\n                        setSelectedTargetText(selectedText);\r\n                        setSelectedTargetBlockId(blockId);\r\n                        break;\r\n                    }\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n        };\r\n\r\n        // Add slight delay to avoid interference with selection\r\n        const handler = (e: MouseEvent) => setTimeout(() => handleMouseUp(e), 10);\r\n        document.addEventListener('mouseup', handler as any);\r\n        return () => document.removeEventListener('mouseup', handler as any);\r\n    }, [isActive, sourceText, sourceBlockId]);\r\n\r\n    // Handle keyboard shortcuts\r\n    useEffect(() => {\r\n        if (!isActive) return;\r\n\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (e.key === 'Escape') {\r\n                e.preventDefault();\r\n                onCancel();\r\n            }\r\n            if (e.key === 'Enter' && selectedTargetText && selectedTargetBlockId) {\r\n                e.preventDefault();\r\n                handleConnect();\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [isActive, onCancel, selectedTargetText, selectedTargetBlockId]);\r\n\r\n    // Reset when mode deactivates\r\n    useEffect(() => {\r\n        if (!isActive) {\r\n            setSelectedTargetText('');\r\n            setSelectedTargetBlockId('');\r\n            setIsConnecting(false);\r\n            setShowSuccess(false);\r\n        }\r\n    }, [isActive]);\r\n\r\n    const handleConnect = useCallback(() => {\r\n        if (!selectedTargetText || !selectedTargetBlockId) return;\r\n\r\n        setIsConnecting(true);\r\n\r\n        // Show success animation then complete\r\n        setTimeout(() => {\r\n            setShowSuccess(true);\r\n            setTimeout(() => {\r\n                onSelectTarget(selectedTargetText, selectedTargetBlockId);\r\n            }, 400);\r\n        }, 200);\r\n    }, [selectedTargetText, selectedTargetBlockId, onSelectTarget]);\r\n\r\n    if (!isActive) return null;\r\n\r\n    const truncate = (text: string, max: number) =>\r\n        text.length > max ? text.slice(0, max) + '...' : text;\r\n\r\n    return createPortal(\r\n        <>\r\n            {/* Visual overlay backdrop - pointer-events: none to allow text selection */}\r\n            <motion.div\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n                className=\"fixed inset-0 bg-black/10 dark:bg-black/20 backdrop-blur-[1px] z-[98] pointer-events-none\"\r\n            />\r\n\r\n            {/* Main toolbar */}\r\n            <motion.div\r\n                ref={toolbarRef}\r\n                initial={{ opacity: 0, y: -30, scale: 0.95 }}\r\n                animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                exit={{ opacity: 0, y: -20, scale: 0.95 }}\r\n                transition={{ type: \"spring\", stiffness: 400, damping: 30 }}\r\n                className=\"fixed top-6 left-1/2 -translate-x-1/2 z-[100]\"\r\n            >\r\n                <div className=\"flex items-center gap-3 bg-gradient-to-r from-slate-900 to-slate-800 dark:from-neutral-900 dark:to-neutral-800 border border-white/10 rounded-2xl px-5 py-4 shadow-2xl\">\r\n\r\n                    {/* Connection visualization */}\r\n                    <div className=\"flex items-center gap-3\">\r\n                        {/* Source text badge */}\r\n                        <motion.div\r\n                            className=\"flex items-center gap-2\"\r\n                            initial={{ x: -10, opacity: 0 }}\r\n                            animate={{ x: 0, opacity: 1 }}\r\n                            transition={{ delay: 0.1 }}\r\n                        >\r\n                            <div\r\n                                className=\"w-3 h-3 rounded-full animate-pulse\"\r\n                                style={{ backgroundColor: currentColor, boxShadow: `0 0 10px ${currentColor}` }}\r\n                            />\r\n                            <div className=\"flex flex-col\">\r\n                                <span className=\"text-[10px] uppercase tracking-wider text-white/40 font-medium\">Origem</span>\r\n                                <span className=\"px-2 py-1 bg-white/10 rounded-lg text-sm font-bold text-white max-w-[140px] truncate\">\r\n                                    {truncate(sourceText, 18)}\r\n                                </span>\r\n                            </div>\r\n                        </motion.div>\r\n\r\n                        {/* Animated connection arrow */}\r\n                        <motion.div\r\n                            className=\"flex items-center\"\r\n                            initial={{ scale: 0 }}\r\n                            animate={{ scale: 1 }}\r\n                            transition={{ delay: 0.2, type: \"spring\" }}\r\n                        >\r\n                            <motion.div\r\n                                animate={{ x: [0, 5, 0] }}\r\n                                transition={{ duration: 1.5, repeat: Infinity, ease: \"easeInOut\" }}\r\n                            >\r\n                                <ArrowRight\r\n                                    size={20}\r\n                                    className=\"text-white/30\"\r\n                                    style={{ filter: `drop-shadow(0 0 4px ${currentColor})` }}\r\n                                />\r\n                            </motion.div>\r\n                        </motion.div>\r\n\r\n                        {/* Target text badge or placeholder */}\r\n                        <motion.div\r\n                            className=\"flex items-center gap-2\"\r\n                            initial={{ x: 10, opacity: 0 }}\r\n                            animate={{ x: 0, opacity: 1 }}\r\n                            transition={{ delay: 0.3 }}\r\n                        >\r\n                            <AnimatePresence mode=\"wait\">\r\n                                {selectedTargetText ? (\r\n                                    <motion.div\r\n                                        key=\"target\"\r\n                                        initial={{ scale: 0.8, opacity: 0 }}\r\n                                        animate={{ scale: 1, opacity: 1 }}\r\n                                        exit={{ scale: 0.8, opacity: 0 }}\r\n                                        className=\"flex flex-col\"\r\n                                    >\r\n                                        <span className=\"text-[10px] uppercase tracking-wider text-white/40 font-medium\">Destino</span>\r\n                                        <span\r\n                                            className=\"px-2 py-1 rounded-lg text-sm font-bold max-w-[140px] truncate\"\r\n                                            style={{\r\n                                                backgroundColor: currentColor + '30',\r\n                                                color: currentColor,\r\n                                                boxShadow: `0 0 12px ${currentColor}30`\r\n                                            }}\r\n                                        >\r\n                                            {truncate(selectedTargetText, 18)}\r\n                                        </span>\r\n                                    </motion.div>\r\n                                ) : (\r\n                                    <motion.div\r\n                                        key=\"placeholder\"\r\n                                        initial={{ opacity: 0 }}\r\n                                        animate={{ opacity: 1 }}\r\n                                        exit={{ opacity: 0 }}\r\n                                        className=\"flex items-center gap-2 px-3 py-2 border-2 border-dashed border-white/20 rounded-lg\"\r\n                                    >\r\n                                        <MousePointerClick size={14} className=\"text-white/40\" />\r\n                                        <span className=\"text-white/40 text-sm italic\">\r\n                                            Selecione texto...\r\n                                        </span>\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n\r\n                            {selectedTargetText && (\r\n                                <motion.div\r\n                                    className=\"w-3 h-3 rounded-full\"\r\n                                    style={{ backgroundColor: currentColor, boxShadow: `0 0 10px ${currentColor}` }}\r\n                                    initial={{ scale: 0 }}\r\n                                    animate={{ scale: [1, 1.2, 1] }}\r\n                                    transition={{ duration: 1, repeat: Infinity }}\r\n                                />\r\n                            )}\r\n                        </motion.div>\r\n                    </div>\r\n\r\n                    {/* Divider */}\r\n                    <div className=\"w-px h-10 bg-white/10\" />\r\n\r\n                    {/* Color picker */}\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <span className=\"text-[10px] uppercase tracking-wider text-white/40 font-medium\">Cor</span>\r\n                        <div className=\"flex items-center gap-1.5\">\r\n                            {CONNECTION_COLORS.map((color, index) => (\r\n                                <motion.button\r\n                                    key={color}\r\n                                    initial={{ scale: 0 }}\r\n                                    animate={{ scale: 1 }}\r\n                                    transition={{ delay: 0.1 * index }}\r\n                                    onClick={() => onColorChange(color)}\r\n                                    className={`relative w-6 h-6 rounded-full transition-all duration-200 hover:scale-110 ${currentColor === color\r\n                                        ? 'ring-2 ring-white ring-offset-2 ring-offset-slate-900 scale-110'\r\n                                        : 'hover:ring-1 hover:ring-white/30'\r\n                                        }`}\r\n                                    style={{\r\n                                        backgroundColor: color,\r\n                                        boxShadow: currentColor === color ? `0 0 16px ${color}` : `0 2px 4px ${color}40`\r\n                                    }}\r\n                                >\r\n                                    {currentColor === color && (\r\n                                        <motion.div\r\n                                            layoutId=\"colorRing\"\r\n                                            className=\"absolute inset-0 rounded-full\"\r\n                                            style={{\r\n                                                boxShadow: `0 0 0 3px ${color}50`\r\n                                            }}\r\n                                        />\r\n                                    )}\r\n                                </motion.button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Divider */}\r\n                    <div className=\"w-px h-10 bg-white/10\" />\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <motion.button\r\n                            whileHover={{ scale: 1.05 }}\r\n                            whileTap={{ scale: 0.95 }}\r\n                            onClick={onCancel}\r\n                            className=\"p-2 hover:bg-white/10 rounded-xl transition-colors text-white/60 hover:text-white\"\r\n                            title=\"Cancelar (Esc)\"\r\n                        >\r\n                            <X size={20} />\r\n                        </motion.button>\r\n\r\n                        <motion.button\r\n                            whileHover={{ scale: 1.03 }}\r\n                            whileTap={{ scale: 0.97 }}\r\n                            onClick={handleConnect}\r\n                            disabled={!selectedTargetText || !selectedTargetBlockId || isConnecting}\r\n                            className={`relative flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all overflow-hidden ${selectedTargetText && selectedTargetBlockId && !isConnecting\r\n                                ? 'bg-gradient-to-r from-emerald-500 to-green-500 text-white shadow-lg hover:shadow-emerald-500/30'\r\n                                : 'bg-white/10 text-white/30 cursor-not-allowed'\r\n                                }`}\r\n                        >\r\n                            <AnimatePresence mode=\"wait\">\r\n                                {showSuccess ? (\r\n                                    <motion.div\r\n                                        key=\"success\"\r\n                                        initial={{ scale: 0, rotate: -180 }}\r\n                                        animate={{ scale: 1, rotate: 0 }}\r\n                                        className=\"flex items-center gap-2\"\r\n                                    >\r\n                                        <Sparkles size={16} />\r\n                                        <span>Conectado!</span>\r\n                                    </motion.div>\r\n                                ) : isConnecting ? (\r\n                                    <motion.div\r\n                                        key=\"connecting\"\r\n                                        initial={{ opacity: 0 }}\r\n                                        animate={{ opacity: 1 }}\r\n                                        className=\"flex items-center gap-2\"\r\n                                    >\r\n                                        <motion.div\r\n                                            animate={{ rotate: 360 }}\r\n                                            transition={{ duration: 0.5, repeat: Infinity, ease: \"linear\" }}\r\n                                            className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full\"\r\n                                        />\r\n                                        <span>Conectando...</span>\r\n                                    </motion.div>\r\n                                ) : (\r\n                                    <motion.div\r\n                                        key=\"connect\"\r\n                                        initial={{ opacity: 0 }}\r\n                                        animate={{ opacity: 1 }}\r\n                                        exit={{ opacity: 0 }}\r\n                                        className=\"flex items-center gap-2\"\r\n                                    >\r\n                                        <Link2 size={16} />\r\n                                        <span>Conectar</span>\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n                        </motion.button>\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n\r\n            {/* Bottom hint card */}\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 30 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: 20 }}\r\n                transition={{ delay: 0.2 }}\r\n                className=\"fixed bottom-8 left-1/2 -translate-x-1/2 z-[100]\"\r\n            >\r\n                <div className=\"flex items-center gap-4 bg-slate-900/95 dark:bg-neutral-900/95 backdrop-blur-xl border border-white/10 rounded-xl px-5 py-3 shadow-xl\">\r\n                    <div className=\"flex items-center gap-2 text-white/50\">\r\n                        <MousePointerClick size={16} />\r\n                        <span className=\"text-sm\">Selecione outro texto na nota para conectar</span>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-3 text-white/40 text-xs\">\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <kbd className=\"px-2 py-0.5 bg-white/10 rounded text-white/60 font-mono\">Enter</kbd>\r\n                            <span>confirmar</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <kbd className=\"px-2 py-0.5 bg-white/10 rounded text-white/60 font-mono\">Esc</kbd>\r\n                            <span>cancelar</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </motion.div>\r\n\r\n            {/* Connection preview line animation */}\r\n            <AnimatePresence>\r\n                {selectedTargetText && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"fixed top-[90px] left-1/2 -translate-x-1/2 z-[100]\"\r\n                    >\r\n                        <motion.div\r\n                            initial={{ scaleX: 0 }}\r\n                            animate={{ scaleX: 1 }}\r\n                            className=\"h-1 w-32 rounded-full origin-left\"\r\n                            style={{\r\n                                background: `linear-gradient(90deg, ${currentColor}, ${currentColor}50)`,\r\n                                boxShadow: `0 0 12px ${currentColor}`\r\n                            }}\r\n                        />\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </>,\r\n        document.body\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2898, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/TextConnectionLines.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useRef, useMemo, useState } from 'react';\r\nimport { NoteBlock, TextConnection } from '../../types';\r\n\r\ninterface TextConnectionLinesProps {\r\n    blocks: NoteBlock[];\r\n    containerRef: React.RefObject<HTMLDivElement | null>;\r\n}\r\n\r\ninterface ConnectionData {\r\n    id: string;\r\n    sourceY: number;\r\n    targetY: number;\r\n    color: string;\r\n}\r\n\r\nexport const TextConnectionLines: React.FC<TextConnectionLinesProps> = ({\r\n    blocks,\r\n    containerRef\r\n}) => {\r\n    const [connections, setConnections] = useState<ConnectionData[]>([]);\r\n    const [containerHeight, setContainerHeight] = useState(0);\r\n    const updateTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n    const lastUpdateRef = useRef<number>(0);\r\n\r\n    // Collect all connections from blocks\r\n    const allConnections = useMemo(() => {\r\n        const result: { connection: TextConnection; blockId: string }[] = [];\r\n        blocks.forEach(block => {\r\n            if (block.textConnections && block.textConnections.length > 0) {\r\n                block.textConnections.forEach(conn => {\r\n                    result.push({ connection: conn, blockId: block.id });\r\n                });\r\n            }\r\n        });\r\n        return result;\r\n    }, [blocks]);\r\n\r\n    // Find text position within a block - returns Y coordinate\r\n    const findTextPosition = (blockEl: HTMLElement, searchText: string): number | null => {\r\n        if (!searchText || !blockEl) return null;\r\n\r\n        // Normalize search text\r\n        const normalizedSearch = searchText.trim().toLowerCase();\r\n\r\n        try {\r\n            const walker = document.createTreeWalker(blockEl, NodeFilter.SHOW_TEXT, null);\r\n            let node: Text | null;\r\n            let bestMatch: { y: number; score: number } | null = null;\r\n\r\n            while ((node = walker.nextNode() as Text | null)) {\r\n                const text = node.textContent || '';\r\n                const normalizedText = text.toLowerCase();\r\n\r\n                // Try exact match first\r\n                let index = text.indexOf(searchText);\r\n\r\n                // Try case-insensitive match\r\n                if (index === -1) {\r\n                    index = normalizedText.indexOf(normalizedSearch);\r\n                }\r\n\r\n                // Try partial match (first 10 chars)\r\n                if (index === -1 && normalizedSearch.length > 10) {\r\n                    const partialSearch = normalizedSearch.slice(0, 10);\r\n                    index = normalizedText.indexOf(partialSearch);\r\n                }\r\n\r\n                if (index !== -1) {\r\n                    try {\r\n                        const range = document.createRange();\r\n                        const endIndex = Math.min(index + searchText.length, text.length);\r\n                        range.setStart(node, index);\r\n                        range.setEnd(node, endIndex);\r\n                        const rect = range.getBoundingClientRect();\r\n\r\n                        if (rect.height > 0) {\r\n                            const y = rect.top + rect.height / 2;\r\n                            // Exact match gets higher score\r\n                            const score = text.indexOf(searchText) !== -1 ? 100 : 50;\r\n\r\n                            if (!bestMatch || score > bestMatch.score) {\r\n                                bestMatch = { y, score };\r\n                            }\r\n                        }\r\n                    } catch (e) {\r\n                        // Range creation failed, continue\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (bestMatch) {\r\n                return bestMatch.y;\r\n            }\r\n\r\n            // Fallback: use block's vertical center\r\n            const blockRect = blockEl.getBoundingClientRect();\r\n            if (blockRect.height > 0) {\r\n                return blockRect.top + blockRect.height / 2;\r\n            }\r\n        } catch (error) {\r\n            console.warn('Error finding text position:', error);\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    // Update connection positions\r\n    const updateConnections = () => {\r\n        const container = containerRef.current;\r\n        if (!container || allConnections.length === 0) {\r\n            setConnections([]);\r\n            return;\r\n        }\r\n\r\n        const containerRect = container.getBoundingClientRect();\r\n        setContainerHeight(container.scrollHeight);\r\n\r\n        const newConnections: ConnectionData[] = [];\r\n\r\n        allConnections.forEach((item) => {\r\n            const { connection, blockId } = item;\r\n\r\n            const sourceBlockEl = document.getElementById(`block-${blockId}`);\r\n            const targetBlockEl = document.getElementById(`block-${connection.targetBlockId}`);\r\n\r\n            if (!sourceBlockEl || !targetBlockEl) return;\r\n\r\n            const sourceY = findTextPosition(sourceBlockEl, connection.sourceText);\r\n            const targetY = findTextPosition(targetBlockEl, connection.targetText);\r\n\r\n            if (sourceY === null || targetY === null) return;\r\n\r\n            // Convert to container-relative positions\r\n            const relativeSourceY = sourceY - containerRect.top + container.scrollTop;\r\n            const relativeTargetY = targetY - containerRect.top + container.scrollTop;\r\n\r\n            newConnections.push({\r\n                id: connection.id,\r\n                sourceY: relativeSourceY,\r\n                targetY: relativeTargetY,\r\n                color: connection.color\r\n            });\r\n        });\r\n\r\n        setConnections(newConnections);\r\n    };\r\n\r\n    // Debounced update\r\n    const scheduleUpdate = () => {\r\n        const now = Date.now();\r\n        // Throttle updates to max once per 200ms\r\n        if (now - lastUpdateRef.current < 200) {\r\n            if (updateTimeoutRef.current) clearTimeout(updateTimeoutRef.current);\r\n            updateTimeoutRef.current = setTimeout(() => {\r\n                lastUpdateRef.current = Date.now();\r\n                updateConnections();\r\n            }, 200);\r\n            return;\r\n        }\r\n\r\n        lastUpdateRef.current = now;\r\n        updateConnections();\r\n    };\r\n\r\n    // Initial draw and updates\r\n    useEffect(() => {\r\n        // Initial delay for DOM to be ready\r\n        const initialTimeout = setTimeout(updateConnections, 300);\r\n\r\n        return () => {\r\n            clearTimeout(initialTimeout);\r\n            if (updateTimeoutRef.current) clearTimeout(updateTimeoutRef.current);\r\n        };\r\n    }, []);\r\n\r\n    // Redraw when blocks change\r\n    useEffect(() => {\r\n        scheduleUpdate();\r\n    }, [allConnections]);\r\n\r\n    // Handle scroll and resize\r\n    useEffect(() => {\r\n        const handleScroll = () => scheduleUpdate();\r\n\r\n        window.addEventListener('scroll', handleScroll, { passive: true, capture: true });\r\n        window.addEventListener('resize', handleScroll, { passive: true });\r\n\r\n        return () => {\r\n            window.removeEventListener('scroll', handleScroll, { capture: true });\r\n            window.removeEventListener('resize', handleScroll);\r\n        };\r\n    }, []);\r\n\r\n    // Don't render if no connections\r\n    if (connections.length === 0) return null;\r\n\r\n    const MARGIN_OFFSET = 24;\r\n    const LINE_SPACING = 12;\r\n\r\n    return (\r\n        <svg\r\n            aria-hidden=\"true\"\r\n            style={{\r\n                position: 'absolute',\r\n                top: 0,\r\n                left: 0,\r\n                width: '100%',\r\n                height: containerHeight || '100%',\r\n                pointerEvents: 'none',\r\n                zIndex: 10,\r\n                overflow: 'visible',\r\n            }}\r\n        >\r\n            <defs>\r\n                <style>{`\r\n                    .conn-path {\r\n                        fill: none;\r\n                        stroke-linecap: round;\r\n                        stroke-linejoin: round;\r\n                    }\r\n                    .conn-dot {\r\n                        transition: r 0.2s ease;\r\n                    }\r\n                `}</style>\r\n            </defs>\r\n\r\n            {/* Render paths first */}\r\n            {connections.map((conn, index) => {\r\n                const marginX = -(MARGIN_OFFSET + (index * LINE_SPACING));\r\n                const sourceEdge = 8;\r\n\r\n                // Create smooth bezier path\r\n                const path = `M ${sourceEdge} ${conn.sourceY} \r\n                              H ${marginX + 10} \r\n                              Q ${marginX} ${conn.sourceY} ${marginX} ${conn.sourceY + 10}\r\n                              V ${conn.targetY - 10}\r\n                              Q ${marginX} ${conn.targetY} ${marginX + 10} ${conn.targetY}\r\n                              H ${sourceEdge}`;\r\n\r\n                return (\r\n                    <g key={conn.id}>\r\n                        {/* Glow effect */}\r\n                        <path\r\n                            d={path}\r\n                            className=\"conn-path\"\r\n                            stroke={conn.color}\r\n                            strokeWidth={4}\r\n                            opacity={0.2}\r\n                            style={{ filter: `blur(4px)` }}\r\n                        />\r\n\r\n                        {/* Main line */}\r\n                        <path\r\n                            d={path}\r\n                            className=\"conn-path\"\r\n                            stroke={conn.color}\r\n                            strokeWidth={2}\r\n                            opacity={0.8}\r\n                        />\r\n                    </g>\r\n                );\r\n            })}\r\n\r\n            {/* Render dots separately with deduplication */}\r\n            {(() => {\r\n                // Collect all unique dot positions\r\n                const dotMap = new Map<string, { y: number; color: string }>();\r\n\r\n                connections.forEach((conn) => {\r\n                    // Use rounded Y to prevent near-duplicate dots\r\n                    const sourceKey = `${Math.round(conn.sourceY)}`;\r\n                    const targetKey = `${Math.round(conn.targetY)}`;\r\n\r\n                    // Only add if not already exists (first color wins)\r\n                    if (!dotMap.has(sourceKey)) {\r\n                        dotMap.set(sourceKey, { y: conn.sourceY, color: conn.color });\r\n                    }\r\n                    if (!dotMap.has(targetKey)) {\r\n                        dotMap.set(targetKey, { y: conn.targetY, color: conn.color });\r\n                    }\r\n                });\r\n\r\n                const sourceEdge = 8;\r\n\r\n                return Array.from(dotMap.entries()).map(([key, dot]) => (\r\n                    <circle\r\n                        key={`dot-${key}`}\r\n                        cx={sourceEdge - 2}\r\n                        cy={dot.y}\r\n                        r={5}\r\n                        fill={dot.color}\r\n                        className=\"conn-dot\"\r\n                        style={{ filter: `drop-shadow(0 0 3px ${dot.color})` }}\r\n                    />\r\n                ));\r\n            })()}\r\n        </svg>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3223, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/editor/EditorView.tsx"],"sourcesContent":["import React, { useState, useCallback, useEffect, useMemo, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Note, NoteBlock, Tag, TextConnection, CONNECTION_COLORS } from '../../types';\nimport { getTags } from '../../app/actions';\nimport { NOTE_COLORS, BLOCK_HIGHLIGHT_COLORS } from '../../constants';\nimport {\n  Plus, Trash2, Sparkles,\n  Heading1, Type, List, CheckSquare, Quote, Code, Image as ImageIcon,\n  Bold, Italic, Strikethrough, Palette, Hash, X, Copy, Check, Save, Highlighter, Underline, Link as LinkIcon,\n  ChevronDown, MoreVertical, CaseUpper, Paintbrush\n} from 'lucide-react';\nimport { expandNoteWithAI } from '../../services/geminiService';\nimport { HistoryMode } from '../../hooks/useHistory';\nimport { ContentBlock } from './ContentBlock';\nimport { ImageBlock } from './ImageBlock';\nimport { ConfirmationModal } from '../ui/ConfirmationModal';\nimport { TextLinkingMode } from './TextLinkingMode';\nimport { TextConnectionLines } from './TextConnectionLines';\n\ninterface EditorViewProps {\n  activeNote: Note | null;\n  onUpdateNote: (updatedNote: Note, mode?: HistoryMode) => void;\n  onDeleteNote: (id: string) => void;\n  hasUnsavedChanges: boolean;\n  onSave: () => void;\n}\n\nexport const EditorView: React.FC<EditorViewProps> = ({\n  activeNote,\n  onUpdateNote,\n  onDeleteNote,\n  hasUnsavedChanges,\n  onSave\n}) => {\n  const [isAiLoading, setIsAiLoading] = useState(false);\n  const editorRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const blocksContainerRef = useRef<HTMLDivElement>(null);\n\n  // Slash Menu State\n  const [slashMenuOpen, setSlashMenuOpen] = useState(false);\n  const [slashMenuPosition, setSlashMenuPosition] = useState({ top: 0, left: 0 });\n  const [slashBlockId, setSlashBlockId] = useState<string | null>(null);\n  const [slashFilter, setSlashFilter] = useState('');\n\n  // Formatting Toolbar State\n  const [formatToolbarPosition, setFormatToolbarPosition] = useState<{ top: number; left: number } | null>(null);\n\n  // Block Highlight Color Picker State\n  const [highlightPickerOpen, setHighlightPickerOpen] = useState(false);\n\n  // Color Picker State\n  const [colorPickerOpen, setColorPickerOpen] = useState(false);\n\n  // Tag Selector State\n  const [isTagSelectorOpen, setIsTagSelectorOpen] = useState(false);\n  const [availableTags, setAvailableTags] = useState<Tag[]>([]);\n\n  // Load available tags\n  useEffect(() => {\n    const loadTags = async () => {\n      const tags = await getTags();\n      setAvailableTags(tags);\n    };\n    loadTags();\n  }, []);\n\n  // Focus Management\n  const [focusedBlockId, setFocusedBlockId] = useState<string | null>(null);\n\n  // Copy Feedback State\n  const [copiedBlockId, setCopiedBlockId] = useState<string | null>(null);\n\n  // Save Success Animation State\n  const [saveSuccess, setSaveSuccess] = useState(false);\n\n  // Image Deletion Modal State\n  const [imageToDelete, setImageToDelete] = useState<string | null>(null);\n\n  // Link Paste Modal State\n  const [linkPasteModal, setLinkPasteModal] = useState<{\n    url: string;\n    position: { top: number; left: number };\n    blockId: string;\n  } | null>(null);\n\n  // Font Selector State\n  const [fontDropdownOpen, setFontDropdownOpen] = useState(false);\n\n  // Color Dropdown States\n  const [highlightDropdownOpen, setHighlightDropdownOpen] = useState(false);\n  const [textColorDropdownOpen, setTextColorDropdownOpen] = useState(false);\n\n  // Active Formatting States\n  const [activeFormats, setActiveFormats] = useState({\n    bold: false,\n    italic: false,\n    underline: false,\n    strikeThrough: false,\n    inlineCode: false,\n    uppercase: false,\n    currentFont: '',\n  });\n\n  // Text Linking Mode State (for text-to-text connections)\n  const [isTextLinkingMode, setIsTextLinkingMode] = useState(false);\n  const [sourceTextForLinking, setSourceTextForLinking] = useState('');\n  const [sourceBlockIdForLinking, setSourceBlockIdForLinking] = useState('');\n  const [currentLinkColor, setCurrentLinkColor] = useState(CONNECTION_COLORS[0]);\n\n  // Link Delete Confirmation Modal\n  const [linkDeleteModal, setLinkDeleteModal] = useState<{\n    linkId: string;\n    blockId: string;\n    linkName: string;\n    position: { x: number; y: number };\n  } | null>(null);\n\n  // Available fonts\n  const AVAILABLE_FONTS = [\n    { name: 'Inter', value: 'var(--font-inter), sans-serif' },\n    { name: 'Montserrat', value: 'var(--font-montserrat), sans-serif' },\n    { name: 'Poppins', value: 'var(--font-poppins), sans-serif' },\n    { name: 'Open Sans', value: 'var(--font-open-sans), sans-serif' },\n    { name: 'Roboto', value: 'var(--font-roboto), sans-serif' },\n    { name: 'Lato', value: 'var(--font-lato), sans-serif' },\n    { name: 'Playfair Display', value: 'var(--font-playfair), serif' },\n    { name: 'Raleway', value: 'var(--font-raleway), sans-serif' },\n    { name: 'Source Sans', value: 'var(--font-source-sans), sans-serif' },\n    { name: 'Nunito', value: 'var(--font-nunito), sans-serif' },\n    { name: 'Merriweather', value: 'var(--font-merriweather), serif' },\n  ];\n\n  // Typing detection refs\n  const isTypingRef = useRef(false);\n  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n\n  // Close menus on click outside\n  useEffect(() => {\n    const handleClick = (e: MouseEvent) => {\n      setSlashMenuOpen(false);\n      // Only close color picker if clicking outside the color picker UI\n      if (!(e.target as HTMLElement).closest('.color-picker-container')) {\n        setColorPickerOpen(false);\n      }\n      if (!(e.target as HTMLElement).closest('.tag-selector-container')) {\n        setIsTagSelectorOpen(false);\n      }\n      // Close font dropdown on outside click\n      if (!(e.target as HTMLElement).closest('.font-dropdown-container')) {\n        setFontDropdownOpen(false);\n      }\n    };\n    window.addEventListener('click', handleClick);\n    return () => window.removeEventListener('click', handleClick);\n  }, []);\n\n  // Handle Selection for Formatting Toolbar\n  useEffect(() => {\n    const handleSelectionChange = () => {\n      const selection = window.getSelection();\n\n      // Validate selection\n      // Don't hide toolbar if font dropdown is open (keeps selection visible while choosing font)\n      if (!selection || selection.isCollapsed || !editorRef.current) {\n        // Only hide if font dropdown is not open\n        if (!fontDropdownOpen) {\n          setFormatToolbarPosition(null);\n        }\n        return;\n      }\n\n      // Check if selection anchor is descendant of editor\n      let node = selection.anchorNode;\n      let isInside = false;\n      while (node) {\n        if (node === editorRef.current) {\n          isInside = true;\n          break;\n        }\n        node = node.parentNode;\n      }\n\n      if (!isInside) {\n        setFormatToolbarPosition(null);\n        return;\n      }\n\n      const range = selection.getRangeAt(0);\n      const rect = range.getBoundingClientRect();\n\n      // Only show if we have a visible width and aren't in a menu interaction\n      if (rect.width > 1 && !slashMenuOpen && !isTextLinkingMode) {\n        setFormatToolbarPosition({\n          // Ensure it doesn't go off-screen top\n          top: Math.max(10, rect.top - 60),\n          left: rect.left + rect.width / 2\n        });\n\n        // Check active formatting states\n        const selectedText = selection.toString();\n\n        // Check if inside inline code\n        let isInCode = false;\n        let node: Node | null = range.commonAncestorContainer;\n        while (node && node !== document.body) {\n          if (node instanceof HTMLElement && node.tagName === 'CODE' && node.classList.contains('inline-code')) {\n            isInCode = true;\n            break;\n          }\n          node = node.parentNode;\n        }\n\n        // Check if text is uppercase\n        const isUppercase = selectedText.length > 0 && selectedText === selectedText.toUpperCase() && selectedText !== selectedText.toLowerCase();\n\n        // Get current font\n        const currentFont = document.queryCommandValue('fontName').replace(/['\"]/g, '');\n\n        setActiveFormats({\n          bold: document.queryCommandState('bold'),\n          italic: document.queryCommandState('italic'),\n          underline: document.queryCommandState('underline'),\n          strikeThrough: document.queryCommandState('strikeThrough'),\n          inlineCode: isInCode,\n          uppercase: isUppercase,\n          currentFont: currentFont,\n        });\n      } else {\n        setFormatToolbarPosition(null);\n      }\n    };\n\n    document.addEventListener('selectionchange', handleSelectionChange);\n    document.addEventListener('scroll', handleSelectionChange, true);\n\n    return () => {\n      document.removeEventListener('selectionchange', handleSelectionChange);\n      document.removeEventListener('scroll', handleSelectionChange, true);\n    };\n  }, [slashMenuOpen, fontDropdownOpen, isTextLinkingMode]);\n\n  // Handle atomic link delete button clicks - show confirmation modal\n  useEffect(() => {\n    if (!activeNote) return;\n\n    const handleLinkDeleteClick = (e: MouseEvent) => {\n      const target = e.target as HTMLElement;\n\n      // Check if clicking on delete button\n      if (target.classList.contains('atomic-link-delete')) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        // Find the parent wrapper\n        const wrapper = target.closest('.atomic-link-wrapper') as HTMLElement;\n        if (!wrapper) return;\n\n        // Get the link ID and name\n        const linkId = wrapper.getAttribute('data-link-id');\n        const linkName = wrapper.querySelector('strong')?.textContent || 'Link';\n\n        if (!linkId) {\n          wrapper.remove();\n          return;\n        }\n\n        // Find the block containing this link\n        let blockEl: HTMLElement | null = wrapper.parentElement;\n        while (blockEl && !blockEl.id?.startsWith('block-')) {\n          blockEl = blockEl.parentElement;\n        }\n\n        if (!blockEl) {\n          wrapper.remove();\n          return;\n        }\n\n        const blockId = blockEl.id.replace('block-', '');\n        const rect = wrapper.getBoundingClientRect();\n\n        // Show confirmation modal\n        setLinkDeleteModal({\n          linkId,\n          blockId,\n          linkName,\n          position: { x: rect.left + rect.width / 2, y: rect.bottom + 8 }\n        });\n      }\n    };\n\n    const editorEl = editorRef.current;\n    if (editorEl) {\n      editorEl.addEventListener('click', handleLinkDeleteClick, true);\n      return () => editorEl.removeEventListener('click', handleLinkDeleteClick, true);\n    }\n  }, [activeNote]);\n\n  // Function to confirm and delete link\n  const handleConfirmLinkDelete = useCallback(() => {\n    if (!linkDeleteModal || !activeNote) return;\n\n    const { linkId, blockId } = linkDeleteModal;\n\n    // Find and animate the wrapper\n    const wrapper = document.querySelector(`[data-link-id=\"${linkId}\"]`) as HTMLElement;\n    if (wrapper) {\n      wrapper.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';\n      wrapper.style.opacity = '0';\n      wrapper.style.transform = 'scale(0.5) translateY(-10px)';\n      wrapper.style.pointerEvents = 'none';\n    }\n\n    // Close modal immediately\n    setLinkDeleteModal(null);\n\n    // Remove after animation\n    setTimeout(() => {\n      // Find the block element\n      const blockEl = document.getElementById(`block-${blockId}`);\n\n      if (wrapper) {\n        wrapper.remove();\n      }\n\n      // Sync the DOM content to state\n      if (blockEl) {\n        // Get the contenteditable element inside the block\n        const contentEl = blockEl.querySelector('[contenteditable=\"true\"]') || blockEl;\n        const newContent = contentEl.innerHTML || '';\n\n        const newBlocks = activeNote.blocks.map(b =>\n          b.id === blockId ? { ...b, content: newContent } : b\n        );\n\n        onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n      }\n    }, 300);\n  }, [linkDeleteModal, activeNote, onUpdateNote]);\n\n\n\n  if (!activeNote) {\n    return (\n      <div className=\"h-full flex items-center justify-center text-muted-foreground dark:text-neutral-400\">\n        <p>Select a note from the canvas or graph to edit.</p>\n      </div>\n    );\n  }\n\n  // --- Text Connection Functions ---\n\n  const handleStartTextLinking = () => {\n    // Get the currently selected text\n    const selection = window.getSelection();\n    if (!selection || selection.isCollapsed) return;\n\n    const selectedText = selection.toString().trim();\n    if (!selectedText) return;\n\n    // Find the block containing the selection\n    let node = selection.anchorNode;\n    let blockId = '';\n    while (node && node !== document.body) {\n      if (node instanceof HTMLElement) {\n        const id = node.id?.replace('block-', '');\n        if (id && node.id?.startsWith('block-')) {\n          blockId = id;\n          break;\n        }\n      }\n      node = node.parentNode;\n    }\n\n    if (!blockId) return;\n\n    setSourceTextForLinking(selectedText);\n    setSourceBlockIdForLinking(blockId);\n    setIsTextLinkingMode(true);\n    setFormatToolbarPosition(null);\n  };\n\n  const handleConfirmTextConnection = (targetText: string, targetBlockId: string) => {\n    if (!sourceTextForLinking || !sourceBlockIdForLinking) {\n      handleCancelTextLinking();\n      return;\n    }\n\n    // Create the connection\n    const newConnection: TextConnection = {\n      id: crypto.randomUUID(),\n      sourceBlockId: sourceBlockIdForLinking,\n      sourceText: sourceTextForLinking,\n      targetBlockId: targetBlockId,\n      targetText: targetText,\n      color: currentLinkColor,\n      createdAt: Date.now()\n    };\n\n    // Update the source block with the new connection\n    const newBlocks = activeNote.blocks.map(block => {\n      if (block.id === sourceBlockIdForLinking) {\n        return {\n          ...block,\n          textConnections: [...(block.textConnections || []), newConnection]\n        };\n      }\n      return block;\n    });\n\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n    handleCancelTextLinking();\n  };\n\n  const handleCancelTextLinking = () => {\n    setIsTextLinkingMode(false);\n    setSourceTextForLinking('');\n    setSourceBlockIdForLinking('');\n  };\n\n\n  // --- Helper Functions ---\n\n  const handleTextChange = (updater: (n: Note) => Note) => {\n    const mode: HistoryMode = isTypingRef.current ? 'REPLACE' : 'PUSH';\n    if (timeoutRef.current) clearTimeout(timeoutRef.current);\n    isTypingRef.current = true;\n    timeoutRef.current = setTimeout(() => {\n      isTypingRef.current = false;\n    }, 1000);\n    onUpdateNote(updater(activeNote), mode);\n  };\n\n  const updateBlockContent = useCallback((id: string, html: string) => {\n    // Check for Slash Command\n    if (html.endsWith('/')) {\n      const selection = window.getSelection();\n      if (selection && selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const rect = range.getBoundingClientRect();\n        setSlashMenuPosition({ top: rect.bottom + window.scrollY, left: rect.left + window.scrollX });\n        setSlashMenuOpen(true);\n        setSlashBlockId(id);\n        setSlashFilter('');\n      }\n    } else if (slashMenuOpen) {\n      // Update filter if menu is open\n      const text = html.replace(/<[^>]*>?/gm, '');\n      const parts = text.split('/');\n      setSlashFilter(parts[parts.length - 1] || '');\n    }\n\n    // We can't use handleTextChange directly inside useCallback if it's not stable.\n    // But handleTextChange depends on activeNote, so it changes every render.\n    // To make updateBlockContent stable, we need to avoid closing over unstable deps.\n    // However, for now, let's just use the functional update pattern where possible.\n\n    if (!activeNote) return;\n\n    const newBlocks = activeNote.blocks.map(b =>\n      b.id === id ? { ...b, content: html } : b\n    );\n\n    // Optimization: Only update if content actually changed\n    const block = activeNote.blocks.find(b => b.id === id);\n    if (block && block.content === html) return;\n\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n  }, [activeNote, onUpdateNote, slashMenuOpen]);\n\n  const updateBlockType = (id: string, type: NoteBlock['type']) => {\n    handleTextChange(note => ({\n      ...note,\n      blocks: note.blocks.map(b => {\n        if (b.id === id) {\n          const cleanContent = b.content.replace(/\\/[\\w]*$/, '');\n          return { ...b, type, content: cleanContent };\n        }\n        return b;\n      })\n    }));\n    setSlashMenuOpen(false);\n    setTimeout(() => {\n      document.getElementById(`block-${id}`)?.focus();\n    }, 0);\n  };\n\n  const addBlock = useCallback((afterId: string, type: NoteBlock['type'] = 'paragraph') => {\n    if (!activeNote) return;\n    const newBlock: NoteBlock = {\n      id: crypto.randomUUID(),\n      type,\n      content: ''\n    };\n    const index = activeNote.blocks.findIndex(b => b.id === afterId);\n    const newBlocks = [...activeNote.blocks];\n    newBlocks.splice(index + 1, 0, newBlock);\n\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n    setFocusedBlockId(newBlock.id);\n  }, [activeNote, onUpdateNote]);\n\n  const deleteBlock = useCallback((id: string) => {\n    if (!activeNote) return;\n    const index = activeNote.blocks.findIndex(b => b.id === id);\n    const prevBlock = activeNote.blocks[index - 1];\n    let newBlocks = activeNote.blocks.filter(b => b.id !== id);\n\n    // If we deleted the last block, add an empty paragraph\n    if (newBlocks.length === 0) {\n      const newId = crypto.randomUUID();\n      newBlocks = [{\n        id: newId,\n        type: 'paragraph',\n        content: ''\n      }];\n      // Focus the new empty block\n      setTimeout(() => setFocusedBlockId(newId), 0);\n    }\n\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n\n    if (prevBlock) {\n      setFocusedBlockId(prevBlock.id);\n    }\n  }, [activeNote, onUpdateNote]);\n\n  const handleBlockKeyDown = useCallback((e: React.KeyboardEvent, id: string) => {\n    if (!activeNote) return;\n\n    // Shift+Enter: Create new block\n    if (e.key === 'Enter' && e.shiftKey) {\n      e.preventDefault();\n      const currentBlock = activeNote.blocks.find(b => b.id === id);\n      const nextType = currentBlock?.type === 'bullet' ? 'bullet' : 'paragraph';\n      addBlock(id, nextType);\n      setSlashMenuOpen(false);\n    }\n    // Plain Enter: Insert line break (let browser handle it naturally)\n    // No preventDefault here, so <br> will be inserted by contentEditable\n    else if (e.key === 'Backspace') {\n      const element = e.currentTarget as HTMLElement;\n      const selection = window.getSelection();\n      if (!selection || selection.rangeCount === 0) return;\n\n      const range = selection.getRangeAt(0);\n      // Check if collapsed is usually enough, but we want to be sure we are at the start.\n      if (!range.collapsed) return;\n\n      // Check if cursor is at the start of the block content\n      const rangeCopy = range.cloneRange();\n      rangeCopy.selectNodeContents(element);\n      rangeCopy.setEnd(range.startContainer, range.startOffset);\n      const isAtStart = rangeCopy.toString().length === 0;\n\n      if (isAtStart) {\n        const index = activeNote.blocks.findIndex(b => b.id === id);\n        // Only merge/delete if not the first block\n        if (index > 0) {\n          e.preventDefault();\n          const currentBlock = activeNote.blocks[index];\n          const prevBlock = activeNote.blocks[index - 1];\n\n          // Merge current block content into previous block\n          const newContent = prevBlock.content + currentBlock.content;\n\n          const newBlocks = [...activeNote.blocks];\n          newBlocks[index - 1] = { ...prevBlock, content: newContent };\n          newBlocks.splice(index, 1);\n\n          onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n          setFocusedBlockId(prevBlock.id);\n        }\n      }\n    }\n  }, [activeNote, addBlock, onUpdateNote]);\n\n  const handleTitleChange = (html: string) => {\n    handleTextChange(note => ({ ...note, title: html }));\n  };\n\n  const handleAiEnhance = async () => {\n    setIsAiLoading(true);\n\n    const selection = window.getSelection();\n    const selectedText = selection ? selection.toString() : '';\n    const hasSelection = selectedText.trim().length > 0;\n\n    const context = hasSelection\n      ? selectedText\n      : activeNote.blocks.map(b => b.content).join('\\n');\n\n    const result = await expandNoteWithAI(context);\n\n    const newBlock: NoteBlock = {\n      id: crypto.randomUUID(),\n      type: 'paragraph',\n      content: result\n    };\n\n    let newBlocks = [...activeNote.blocks];\n\n    // If text was selected, insert the expanded content after the focused block\n    if (hasSelection && focusedBlockId) {\n      const index = newBlocks.findIndex(b => b.id === focusedBlockId);\n      if (index !== -1) {\n        newBlocks.splice(index + 1, 0, newBlock);\n      } else {\n        newBlocks.push(newBlock);\n      }\n    } else {\n      newBlocks.push(newBlock);\n    }\n\n    onUpdateNote({\n      ...activeNote,\n      blocks: newBlocks\n    }, 'PUSH');\n    setIsAiLoading(false);\n  };\n\n  const formatText = (command: string) => {\n    document.execCommand(command);\n\n    // Update active formats immediately after applying\n    requestAnimationFrame(() => {\n      setActiveFormats(prev => ({\n        ...prev,\n        bold: document.queryCommandState('bold'),\n        italic: document.queryCommandState('italic'),\n        underline: document.queryCommandState('underline'),\n        strikeThrough: document.queryCommandState('strikeThrough'),\n      }));\n    });\n  };\n\n  const handleColorChange = (color: string) => {\n    onUpdateNote({ ...activeNote, color }, 'PUSH');\n    setColorPickerOpen(false);\n  };\n\n  const handleBlockHighlightChange = (blockId: string, highlightColor: string) => {\n    const newBlocks = activeNote.blocks.map(b =>\n      b.id === blockId ? { ...b, highlightColor: highlightColor === 'transparent' ? undefined : highlightColor } : b\n    );\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n    setHighlightPickerOpen(false);\n  };\n\n  const handleSelectTag = (tagName: string) => {\n    const currentTags = activeNote.tags || [];\n    if (!currentTags.includes(tagName)) {\n      const updatedTags = [...currentTags, tagName];\n      onUpdateNote({ ...activeNote, tags: updatedTags }, 'PUSH');\n    }\n    setIsTagSelectorOpen(false);\n  };\n\n  const handleRemoveTag = (tagToRemove: string) => {\n    const updatedTags = activeNote.tags?.filter(t => t !== tagToRemove) || [];\n    onUpdateNote({ ...activeNote, tags: updatedTags }, 'PUSH');\n  };\n\n  const handleCopyBlock = (id: string, htmlContent: string) => {\n    const temp = document.createElement('div');\n    temp.innerHTML = htmlContent;\n    const text = temp.textContent || temp.innerText || \"\";\n    navigator.clipboard.writeText(text);\n    setCopiedBlockId(id);\n    setTimeout(() => setCopiedBlockId(null), 2000);\n  };\n\n  const handleFileUpload = useCallback(async (file: File, targetBlockId?: string) => {\n    // 1. Create optimistic block with local preview\n    const objectUrl = URL.createObjectURL(file);\n    const tempId = crypto.randomUUID();\n\n    const newBlock: NoteBlock = {\n      id: tempId,\n      type: 'image',\n      content: objectUrl\n    };\n\n    // 2. Insert immediately\n    // We need to use the functional update form of onUpdateNote if possible, or access the latest activeNote.\n    // Since onUpdateNote doesn't support functional update for the whole note in this props interface,\n    // we rely on activeNote being fresh.\n    if (!activeNote) return;\n\n    let newBlocks = [...activeNote.blocks];\n\n    // Determine insertion point - always insert AFTER the reference block, never replace\n    const insertionBlockId = targetBlockId || focusedBlockId;\n\n    if (insertionBlockId) {\n      const index = newBlocks.findIndex(b => b.id === insertionBlockId);\n      if (index !== -1) {\n        // Check if target block is an empty placeholder that should be replaced\n        const targetBlock = newBlocks[index];\n        const isEmptyPlaceholder = targetBlock.type === 'paragraph' &&\n          (!targetBlock.content || targetBlock.content.trim() === '' || targetBlock.content === '<br>');\n\n        if (isEmptyPlaceholder && targetBlockId) {\n          // Replace empty placeholder with image\n          newBlocks[index] = newBlock;\n        } else {\n          // Insert image AFTER the current block\n          newBlocks.splice(index + 1, 0, newBlock);\n        }\n      } else {\n        newBlocks.push(newBlock);\n      }\n    } else {\n      // No focused block - add at the end\n      newBlocks.push(newBlock);\n    }\n\n    // Update UI immediately with local preview\n    onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n\n    // 3. Upload in background\n    const formData = new FormData();\n    formData.append('file', file);\n\n    try {\n      const res = await fetch('/api/upload', {\n        method: 'POST',\n        body: formData\n      });\n      const data = await res.json();\n\n      if (data.url) {\n        // 4. Update block with real URL\n        // We need to find the block again in the *latest* state.\n        // Since we can't easily access the latest state here without a ref or functional update,\n        // we will do our best with the captured scope, but this is a known limitation without a refactor.\n        // Ideally, we would use a ref for activeNote.\n\n        // However, for the purpose of this task (performance), the optimistic UI is key.\n        // The risk of overwriting is low if the user isn't typing furiously *exactly* when the upload finishes.\n\n        const updatedBlocks = newBlocks.map(b =>\n          b.id === tempId ? { ...b, content: data.url } : b\n        );\n\n        onUpdateNote({ ...activeNote, blocks: updatedBlocks }, 'PUSH');\n      }\n    } catch (e) {\n      console.error('Upload failed', e);\n      // Optionally show error state on block\n    } finally {\n      URL.revokeObjectURL(objectUrl);\n    }\n  }, [activeNote, focusedBlockId, onUpdateNote]);\n\n  const handlePaste = (e: React.ClipboardEvent) => {\n    // Check for images first\n    if (e.clipboardData.files.length > 0) {\n      const files = Array.from(e.clipboardData.files).filter(f => f.type.startsWith('image/'));\n      if (files.length > 0) {\n        e.preventDefault();\n        // Don't pass focusedBlockId as targetBlockId - let it use focusedBlockId internally\n        // This ensures images are inserted AFTER current block, not replacing it\n        files.forEach(file => handleFileUpload(file));\n        return;\n      }\n    }\n\n    // Check for URL in pasted text\n    const text = e.clipboardData.getData('text/plain');\n    const urlRegex = /^(https?:\\/\\/[^\\s]+)$/i;\n\n    if (urlRegex.test(text.trim())) {\n      e.preventDefault();\n\n      let modalTop = 200;\n      let modalLeft = 400;\n\n      // Try to get position from selection\n      const selection = window.getSelection();\n      if (selection && selection.rangeCount > 0) {\n        const range = selection.getRangeAt(0);\n        const rect = range.getBoundingClientRect();\n\n        // Check if we got a valid position from the range\n        if (rect.top > 0 && rect.left > 0) {\n          modalTop = rect.bottom + 20;\n          modalLeft = rect.right + 30;\n        } else {\n          // Fallback 1: Try to use the active element (where cursor is)\n          const activeElement = document.activeElement;\n          if (activeElement && activeElement instanceof HTMLElement) {\n            const activeRect = activeElement.getBoundingClientRect();\n            if (activeRect.top > 0 && activeRect.left > 0) {\n              modalTop = activeRect.bottom + 20;\n              modalLeft = activeRect.right + 30;\n            }\n          }\n\n          // Fallback 2: If still no valid position, use anchor node's parent\n          if (modalTop === 200 && selection.anchorNode) {\n            const parentElement = selection.anchorNode.nodeType === Node.TEXT_NODE\n              ? selection.anchorNode.parentElement\n              : selection.anchorNode as HTMLElement;\n            if (parentElement) {\n              const parentRect = parentElement.getBoundingClientRect();\n              if (parentRect.top > 0 || parentRect.left > 0) {\n                modalTop = parentRect.bottom + 20;\n                modalLeft = parentRect.right + 30;\n              }\n            }\n          }\n        }\n      }\n\n      setLinkPasteModal({\n        url: text.trim(),\n        position: {\n          top: modalTop,\n          left: modalLeft\n        },\n        blockId: focusedBlockId || ''\n      });\n    }\n  };\n\n  // Handle link paste option selection\n  const handleLinkPasteOption = async (option: 'mention' | 'embed' | 'bookmark' | 'url') => {\n    if (!linkPasteModal || !activeNote) return;\n\n    const { url, blockId } = linkPasteModal;\n    let content = '';\n\n    // YouTube API key\n    const YOUTUBE_API_KEY = 'AIzaSyB2BmcpR3bhQGSlWZeYkDW5sfjPOSdVpUA';\n\n    // Helper to extract YouTube video ID from URL\n    const getYouTubeVideoId = (youtubeUrl: string): string | null => {\n      try {\n        const urlObj = new URL(youtubeUrl);\n        if (urlObj.hostname.includes('youtu.be')) {\n          return urlObj.pathname.slice(1);\n        }\n        if (urlObj.hostname.includes('youtube.com')) {\n          return urlObj.searchParams.get('v');\n        }\n      } catch { }\n      return null;\n    };\n\n    // Helper to fetch YouTube video title\n    const fetchYouTubeTitle = async (videoId: string): Promise<string> => {\n      try {\n        const response = await fetch(\n          `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${YOUTUBE_API_KEY}`\n        );\n        const data = await response.json();\n        if (data.items && data.items.length > 0) {\n          return data.items[0].snippet.title;\n        }\n      } catch (error) {\n        console.error('Failed to fetch YouTube title:', error);\n      }\n      return 'Video';\n    };\n\n    // Helper to extract Twitter/X username from URL\n    const getTwitterUsername = (twitterUrl: string): string | null => {\n      try {\n        const urlObj = new URL(twitterUrl);\n        const pathParts = urlObj.pathname.split('/').filter(Boolean);\n        if (pathParts.length > 0 && pathParts[0] !== 'status') {\n          return pathParts[0];\n        }\n      } catch { }\n      return null;\n    };\n\n    // Helper to get platform info from URL\n    const getPlatformInfo = async (linkUrl: string): Promise<{ logo: string; name: string; platform: string; cssClass: string }> => {\n      try {\n        const urlObj = new URL(linkUrl);\n        const hostname = urlObj.hostname.replace('www.', '');\n        const pathParts = urlObj.pathname.split('/').filter(Boolean);\n\n        // Platform SVG icons (inline, compact)\n        const icons = {\n          twitter: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\"/></svg>',\n          youtube: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#ff0000\"><path d=\"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z\"/></svg>',\n          instagram: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#E4405F\"><path d=\"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z\"/></svg>',\n          github: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"/></svg>',\n          linkedin: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#0A66C2\"><path d=\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\"/></svg>',\n          tiktok: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z\"/></svg>',\n          spotify: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#1DB954\"><path d=\"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z\"/></svg>',\n          reddit: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"#FF4500\"><path d=\"M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z\"/></svg>',\n          generic: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg>'\n        };\n\n        // Twitter/X\n        if (hostname.includes('twitter.com') || hostname.includes('x.com')) {\n          const username = pathParts.length > 0 && pathParts[0] !== 'status' ? pathParts[0] : 'post';\n          return { logo: icons.twitter, name: `@${username}`, platform: 'X', cssClass: 'twitter-mention-link' };\n        }\n\n        // YouTube - Fetch actual video title\n        if (hostname.includes('youtube.com') || hostname.includes('youtu.be')) {\n          const videoId = getYouTubeVideoId(linkUrl);\n          let videoTitle = 'Video';\n          if (videoId) {\n            videoTitle = await fetchYouTubeTitle(videoId);\n            // Truncate title if too long\n            if (videoTitle.length > 50) {\n              videoTitle = videoTitle.substring(0, 47) + '...';\n            }\n          } else if (pathParts[0] === 'channel' || pathParts[0] === 'c' || pathParts[0] === '@') {\n            videoTitle = pathParts[1] || pathParts[0];\n          }\n          return { logo: icons.youtube, name: videoTitle, platform: 'YouTube', cssClass: 'youtube-link' };\n        }\n\n        // Instagram\n        if (hostname.includes('instagram.com')) {\n          const username = pathParts[0] || 'post';\n          return { logo: icons.instagram, name: `@${username}`, platform: 'Instagram', cssClass: 'instagram-link' };\n        }\n\n        // GitHub\n        if (hostname.includes('github.com')) {\n          const repoName = pathParts.slice(0, 2).join('/') || 'repo';\n          return { logo: icons.github, name: repoName, platform: 'GitHub', cssClass: 'github-link' };\n        }\n\n        // LinkedIn\n        if (hostname.includes('linkedin.com')) {\n          return { logo: icons.linkedin, name: 'Post', platform: 'LinkedIn', cssClass: 'linkedin-link' };\n        }\n\n        // TikTok\n        if (hostname.includes('tiktok.com')) {\n          const username = pathParts[0]?.startsWith('@') ? pathParts[0] : `@${pathParts[0] || 'video'}`;\n          return { logo: icons.tiktok, name: username, platform: 'TikTok', cssClass: 'tiktok-link' };\n        }\n\n        // Spotify\n        if (hostname.includes('spotify.com')) {\n          return { logo: icons.spotify, name: 'Track', platform: 'Spotify', cssClass: 'spotify-link' };\n        }\n\n        // Reddit\n        if (hostname.includes('reddit.com')) {\n          const subreddit = pathParts[0] === 'r' ? `r/${pathParts[1]}` : pathParts[0] || 'post';\n          return { logo: icons.reddit, name: subreddit, platform: 'Reddit', cssClass: 'reddit-link' };\n        }\n\n        // Generic/default\n        return { logo: icons.generic, name: hostname, platform: 'Link', cssClass: 'generic-link' };\n      } catch {\n        const icons = { generic: '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"></path><path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"></path></svg>' };\n        return { logo: icons.generic, name: 'link', platform: 'Link', cssClass: 'generic-link' };\n      }\n    };\n\n    const platformInfo = await getPlatformInfo(url);\n\n    // Generate unique ID for the link\n    const linkId = crypto.randomUUID();\n\n    // Delete button SVG (X icon)\n    const deleteBtn = `<button class=\"atomic-link-delete\" data-link-id=\"${linkId}\" aria-label=\"Remover link\" title=\"Remover link\">Ã</button>`;\n\n    switch (option) {\n      case 'mention':\n      case 'embed':\n        // Clean format: [icon] name Â· platform - ATOMIC (non-editable)\n        content = `<span class=\"atomic-link-wrapper\" contenteditable=\"false\" data-link-block=\"true\" data-link-id=\"${linkId}\" data-url=\"${url}\">${deleteBtn}<a href=\"${url}\" class=\"${platformInfo.cssClass} atomic-link\" target=\"_blank\" rel=\"noopener noreferrer\"><span class=\"link-logo\">${platformInfo.logo}</span><span class=\"link-text\"><strong>${platformInfo.name}</strong><span class=\"link-separator\">Â·</span><span class=\"link-platform\">${platformInfo.platform}</span></span></a></span> `;\n        break;\n      case 'bookmark':\n        // Bookmark style - ATOMIC (non-editable)\n        content = `<span class=\"atomic-link-wrapper bookmark-style\" contenteditable=\"false\" data-link-block=\"true\" data-link-id=\"${linkId}\" data-url=\"${url}\">${deleteBtn}<a href=\"${url}\" class=\"${platformInfo.cssClass} atomic-link\" target=\"_blank\" rel=\"noopener noreferrer\"><span class=\"link-logo\">${platformInfo.logo}</span><span class=\"link-text\"><strong>${platformInfo.name}</strong><span class=\"link-separator\">Â·</span><span class=\"link-platform\">${platformInfo.platform}</span></span></a></span> `;\n        break;\n      case 'url':\n      default:\n        // Plain URL format - ATOMIC (non-editable)\n        content = `<span class=\"atomic-link-wrapper\" contenteditable=\"false\" data-link-block=\"true\" data-link-id=\"${linkId}\" data-url=\"${url}\">${deleteBtn}<a href=\"${url}\" class=\"${platformInfo.cssClass} atomic-link\" target=\"_blank\" rel=\"noopener noreferrer\"><span class=\"link-logo\">${platformInfo.logo}</span><span class=\"link-text\"><strong>${platformInfo.name}</strong><span class=\"link-separator\">Â·</span><span class=\"link-platform\">${platformInfo.platform}</span></span></a></span> `;\n        break;\n    }\n\n    // Insert content at cursor or append to block\n    const block = activeNote.blocks.find(b => b.id === blockId);\n    if (block) {\n      const newContent = block.content + content;\n      const newBlocks = activeNote.blocks.map(b =>\n        b.id === blockId ? { ...b, content: newContent } : b\n      );\n      onUpdateNote({ ...activeNote, blocks: newBlocks }, 'PUSH');\n    }\n\n    setLinkPasteModal(null);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    if (e.dataTransfer.files.length > 0) {\n      const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));\n      files.forEach(file => handleFileUpload(file));\n    }\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      handleFileUpload(e.target.files[0], slashBlockId || undefined);\n    }\n    // Reset input\n    if (fileInputRef.current) fileInputRef.current.value = '';\n  };\n\n  return (\n    <motion.div\n      ref={editorRef}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0 }}\n      className=\"max-w-3xl mx-auto pt-12 pb-32 px-8 relative text-foreground\"\n      onPaste={handlePaste}\n      onDrop={handleDrop}\n      onDragOver={(e) => e.preventDefault()}\n    >\n      <input\n        type=\"file\"\n        ref={fileInputRef}\n        className=\"hidden\"\n        accept=\"image/*\"\n        onChange={handleFileSelect}\n      />\n      {/* Header */}\n      <div className=\"flex items-start gap-4 mb-4 relative\">\n        <motion.div\n          initial={{ opacity: 0, y: 15 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.4, ease: \"easeOut\", delay: 0.1 }}\n          className=\"flex-1\"\n        >\n          <ContentBlock\n            id=\"note-title\"\n            html={activeNote.title}\n            tagName=\"h1\"\n            className=\"text-5xl font-black bg-transparent border-none outline-none placeholder-gray-300 dark:placeholder-neutral-700 empty:before:content-[attr(data-placeholder)] empty:before:text-gray-300 dark:empty:before:text-neutral-700 text-black dark:text-white\"\n            placeholder=\"Untitled\"\n            onChange={(id, html) => handleTitleChange(html)}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter') {\n                e.preventDefault();\n                document.getElementById(`block-${activeNote.blocks[0]?.id}`)?.focus();\n              }\n            }}\n          />\n        </motion.div>\n\n        {/* Header Actions (Always visible for better UX) */}\n        <div className=\"flex items-center gap-1\">\n          {/* Save Button with Success Animation */}\n          <motion.button\n            onClick={() => {\n              onSave();\n              setSaveSuccess(true);\n              setTimeout(() => setSaveSuccess(false), 1500);\n            }}\n            className={`relative p-2 rounded-md transition-all duration-300 overflow-hidden ${saveSuccess\n              ? 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/30'\n              : hasUnsavedChanges\n                ? 'bg-black dark:bg-white text-white dark:text-black shadow-lg'\n                : 'hover:bg-gray-100 dark:hover:bg-neutral-800 text-gray-500 dark:text-neutral-400'\n              }`}\n            title={hasUnsavedChanges ? \"Salvar AlteraÃ§Ãµes\" : \"Salvo\"}\n            whileTap={{ scale: 0.9 }}\n            animate={saveSuccess ? { scale: [1, 1.1, 1] } : {}}\n            transition={{ duration: 0.3 }}\n          >\n            <AnimatePresence mode=\"wait\">\n              {saveSuccess ? (\n                <motion.div\n                  key=\"check\"\n                  initial={{ scale: 0, rotate: -180 }}\n                  animate={{ scale: 1, rotate: 0 }}\n                  exit={{ scale: 0, opacity: 0 }}\n                  transition={{\n                    type: \"spring\",\n                    stiffness: 500,\n                    damping: 25\n                  }}\n                >\n                  <Check size={20} strokeWidth={3} />\n                </motion.div>\n              ) : (\n                <motion.div\n                  key=\"save\"\n                  initial={{ scale: 0 }}\n                  animate={{ scale: 1 }}\n                  exit={{ scale: 0, opacity: 0 }}\n                  transition={{ duration: 0.15 }}\n                >\n                  <Save size={20} className={hasUnsavedChanges ? \"animate-pulse\" : \"\"} />\n                </motion.div>\n              )}\n            </AnimatePresence>\n\n            {/* Success ripple effect */}\n            {saveSuccess && (\n              <motion.div\n                className=\"absolute inset-0 bg-white/30 rounded-md\"\n                initial={{ scale: 0, opacity: 1 }}\n                animate={{ scale: 2, opacity: 0 }}\n                transition={{ duration: 0.6, ease: \"easeOut\" }}\n              />\n            )}\n          </motion.button>\n\n          <div className=\"relative color-picker-container\">\n            <button\n              onClick={() => setColorPickerOpen(!colorPickerOpen)}\n              className={`p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded-md transition-colors ${activeNote.color && activeNote.color !== '#000000' ? 'ring-2 ring-offset-1 dark:ring-offset-neutral-900' : ''}`}\n              style={{ borderColor: activeNote.color || 'transparent' }}\n              title=\"Note Color\"\n            >\n              <Palette\n                size={20}\n                style={{ color: activeNote.color && activeNote.color !== '#000000' ? activeNote.color : 'currentColor' }}\n                className=\"text-gray-500 dark:text-neutral-400\"\n              />\n            </button>\n\n            <AnimatePresence>\n              {colorPickerOpen && (\n                <motion.div\n                  initial={{ opacity: 0, scale: 0.9, y: 10 }}\n                  animate={{ opacity: 1, scale: 1, y: 0 }}\n                  exit={{ opacity: 0, scale: 0.9, y: 10 }}\n                  className=\"absolute right-0 top-full mt-2 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 shadow-xl rounded-lg p-3 flex gap-2 z-50 w-48 flex-wrap\"\n                >\n                  {NOTE_COLORS.map((color) => (\n                    <button\n                      key={color.id}\n                      onClick={() => handleColorChange(color.value)}\n                      className={`w-8 h-8 rounded-full border border-gray-200 dark:border-neutral-600 transition-transform hover:scale-110 ${activeNote.color === color.value ? 'ring-2 ring-black dark:ring-white ring-offset-2 dark:ring-offset-neutral-900' : ''}`}\n                      style={{ backgroundColor: color.value }}\n                      title={color.label}\n                    />\n                  ))}\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n\n          <button\n            onClick={() => onDeleteNote(activeNote.id)}\n            className=\"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 text-gray-500 dark:text-neutral-400 rounded-md transition-colors\"\n            title=\"Delete Note\"\n          >\n            <Trash2 size={20} />\n          </button>\n        </div>\n      </div>\n\n      {/* Tag Section */}\n      <div className=\"mb-8 flex flex-wrap items-center gap-2 tag-container min-h-[28px]\">\n        <AnimatePresence>\n          {activeNote.tags?.map(tag => (\n            <motion.div\n              key={tag}\n              layout\n              initial={{ opacity: 0, scale: 0.8 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, scale: 0.8 }}\n              className=\"bg-gray-100 dark:bg-neutral-800 text-black dark:text-neutral-300 text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1 group border border-gray-200 dark:border-neutral-700\"\n            >\n              <span className=\"opacity-60\">#</span>\n              {tag}\n              <button\n                onClick={() => handleRemoveTag(tag)}\n                className=\"w-4 h-4 flex items-center justify-center rounded-full hover:bg-gray-300 dark:hover:bg-neutral-600 opacity-0 group-hover:opacity-100 transition-all ml-1\"\n              >\n                <X size={10} />\n              </button>\n            </motion.div>\n          ))}\n        </AnimatePresence>\n\n        <div className=\"relative flex items-center tag-selector-container\">\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsTagSelectorOpen(!isTagSelectorOpen);\n            }}\n            className=\"text-gray-400 dark:text-neutral-500 hover:text-black dark:hover:text-white hover:bg-gray-100 dark:hover:bg-neutral-800 transition-all text-xs font-bold flex items-center gap-1 py-1.5 px-2 rounded-lg\"\n          >\n            <Hash size={12} />\n            Add Tag\n          </button>\n\n          <AnimatePresence>\n            {isTagSelectorOpen && (\n              <motion.div\n                initial={{ opacity: 0, y: -10, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                exit={{ opacity: 0, y: -10, scale: 0.95 }}\n                transition={{ type: 'spring', stiffness: 400, damping: 25 }}\n                className=\"absolute top-full left-0 mt-2 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 rounded-xl shadow-2xl overflow-hidden z-50 min-w-[200px]\"\n              >\n                <div className=\"p-2 border-b border-gray-100 dark:border-neutral-800\">\n                  <p className=\"text-xs font-medium text-gray-400 dark:text-neutral-500\">Select a tag</p>\n                </div>\n                <div className=\"max-h-48 overflow-y-auto p-1\">\n                  {availableTags.filter(tag => !activeNote.tags?.includes(tag.name)).length === 0 ? (\n                    <div className=\"p-4 text-center\">\n                      <p className=\"text-xs text-gray-400 dark:text-neutral-500\">\n                        {availableTags.length === 0 ? 'No tags available' : 'All tags added'}\n                      </p>\n                      <p className=\"text-xs text-gray-300 dark:text-neutral-600 mt-1\">\n                        Create tags in Settings\n                      </p>\n                    </div>\n                  ) : (\n                    availableTags\n                      .filter(tag => !activeNote.tags?.includes(tag.name))\n                      .map(tag => (\n                        <motion.button\n                          key={tag.id}\n                          whileHover={{ x: 2 }}\n                          onClick={() => handleSelectTag(tag.name)}\n                          className=\"w-full flex items-center gap-3 px-3 py-2.5 hover:bg-gray-50 dark:hover:bg-neutral-800 rounded-lg transition-colors text-left\"\n                        >\n                          <div\n                            className=\"w-3 h-3 rounded-full flex-shrink-0\"\n                            style={{ backgroundColor: tag.color }}\n                          />\n                          <span className=\"text-sm font-medium text-black dark:text-white\">\n                            #{tag.name}\n                          </span>\n                        </motion.button>\n                      ))\n                  )}\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </div>\n\n      {/* Blocks */}\n      <div className=\"space-y-2 relative\" ref={blocksContainerRef}>\n        {/* Permanent Text Connection Lines */}\n        <TextConnectionLines\n          blocks={activeNote.blocks}\n          containerRef={blocksContainerRef}\n        />\n\n        <AnimatePresence initial={false}>\n          {activeNote.blocks.map((block) => {\n            const hasConnections = block.textConnections && block.textConnections.length > 0;\n\n            return (\n              <motion.div\n                key={block.id}\n                id={`block-${block.id}`}\n                initial={{ opacity: 0, x: -10 }}\n                animate={{ opacity: 1, x: 0 }}\n                className={`group flex items-start gap-2 relative\n                ${hasConnections ? 'block-has-connections' : ''}\n              `}\n                style={{\n                  '--connection-color': block.textConnections?.[0]?.color,\n                } as React.CSSProperties}\n              >\n                {/* Hover Handle */}\n                <div className=\"mt-2 opacity-0 group-hover:opacity-20 transition-opacity absolute -left-6 cursor-grab\">\n                  <div className=\"w-1.5 h-1.5 bg-black dark:bg-white rounded-full\" />\n                </div>\n\n                <div\n                  className=\"w-full relative group/content rounded-lg transition-all duration-200\"\n                  style={{\n                    backgroundColor: block.highlightColor || 'transparent',\n                  }}\n                >\n                  <div className={`flex items-start w-full ${block.type === 'bullet' ? 'gap-3' : 'gap-2'} ${block.highlightColor ? 'px-3 py-2' : ''}`}>\n                    {block.type === 'bullet' && (\n                      <span className=\"text-2xl leading-6 select-none dark:text-white\">â¢</span>\n                    )}\n                    {block.type === 'todo' && (\n                      <div\n                        className={`mt-1.5 w-5 h-5 border-2 border-black dark:border-white cursor-pointer transition-colors flex-shrink-0 rounded ${block.checked ? 'bg-black dark:bg-white' : 'bg-transparent'}`}\n                        contentEditable={false}\n                        onClick={() => {\n                          handleTextChange(note => ({\n                            ...note,\n                            blocks: note.blocks.map(b => b.id === block.id ? { ...b, checked: !b.checked } : b)\n                          }));\n                        }}\n                      />\n                    )}\n\n                    {block.type !== 'image' && (\n                      <ContentBlock\n                        id={block.id}\n                        html={block.content}\n                        tagName={block.type === 'heading' ? 'h1' : 'div'}\n                        className={`w-full outline-none resize-none overflow-hidden text-black dark:text-white transition-all\n                            ${block.type === 'heading' ? 'text-3xl font-bold mb-4 mt-6' : ''}\n                            ${block.type === 'paragraph' ? 'text-lg leading-relaxed mb-2' : ''}\n                            ${block.type === 'todo' ? (block.checked ? 'text-lg line-through text-gray-400 dark:text-neutral-600' : 'text-lg') : ''}\n                            ${block.type === 'bullet' ? 'text-lg leading-relaxed' : ''}\n                            ${block.type === 'blockquote' ? 'text-xl italic border-l-4 border-black dark:border-white pl-4 py-2 text-gray-600 dark:text-neutral-400 my-4' : ''}\n                            ${block.type === 'code' ? 'font-mono text-sm bg-gray-50 dark:bg-neutral-900 p-4 rounded-md text-gray-800 dark:text-neutral-200 my-2 whitespace-pre-wrap' : ''}\n`}\n                        placeholder={block.type === 'paragraph' ? \"Type '/' for commands\" : \"Type something...\"}\n                        onChange={updateBlockContent}\n                        onKeyDown={handleBlockKeyDown}\n                        autoFocus={focusedBlockId === block.id}\n                        onFocus={setFocusedBlockId}\n                      />\n                    )}\n                    {block.type === 'image' && (\n                      <ImageBlock\n                        id={block.id}\n                        src={block.content}\n                        onDelete={(id) => setImageToDelete(id)}\n                        className=\"w-full\"\n                      />\n                    )}\n                  </div>\n\n                  {/* Block Actions Container */}\n                  <div className=\"absolute -right-10 top-1/2 -translate-y-1/2 flex flex-col gap-1 opacity-0 group-hover/content:opacity-100 transition-all\">\n                    {/* Highlight Color Picker Button */}\n                    {block.type !== 'image' && block.type !== 'code' && (\n                      <div className=\"relative\">\n                        <button\n                          onClick={() => {\n                            setFocusedBlockId(block.id);\n                            setHighlightPickerOpen(highlightPickerOpen && focusedBlockId === block.id ? false : true);\n                          }}\n                          className={`p-1.5 rounded-md transition-colors ${block.highlightColor ? 'bg-gray-200 dark:bg-neutral-700' : 'hover:bg-gray-100 dark:hover:bg-neutral-800'}`}\n                          title=\"Highlight Color\"\n                          style={{ borderLeft: block.highlightColor ? `3px solid ${block.highlightColor.replace('0.15', '0.8').replace('0.2', '0.8')}` : undefined }}\n                        >\n                          <Highlighter size={14} className=\"text-gray-500 dark:text-neutral-400\" />\n                        </button>\n\n                        {/* Highlight Color Dropdown */}\n                        <AnimatePresence>\n                          {highlightPickerOpen && focusedBlockId === block.id && (\n                            <motion.div\n                              initial={{ opacity: 0, scale: 0.9, x: 10 }}\n                              animate={{ opacity: 1, scale: 1, x: 0 }}\n                              exit={{ opacity: 0, scale: 0.9, x: 10 }}\n                              className=\"absolute right-full mr-2 top-0 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 shadow-xl rounded-lg p-2 flex flex-wrap gap-1.5 z-50 w-32\"\n                            >\n                              {BLOCK_HIGHLIGHT_COLORS.map((color) => (\n                                <button\n                                  key={color.id}\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    handleBlockHighlightChange(block.id, color.value);\n                                  }}\n                                  className={`w-6 h-6 rounded-md border border-gray-300 dark:border-neutral-600 transition-transform hover:scale-110 ${block.highlightColor === color.value ? 'ring-2 ring-black dark:ring-white ring-offset-1 dark:ring-offset-neutral-900' : ''}`}\n                                  style={{ backgroundColor: color.id === 'none' ? 'transparent' : color.value.replace('0.15', '0.5').replace('0.2', '0.5') }}\n                                  title={color.label}\n                                >\n                                  {color.id === 'none' && <X size={12} className=\"mx-auto text-gray-400\" />}\n                                </button>\n                              ))}\n                            </motion.div>\n                          )}\n                        </AnimatePresence>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Copy Button for Code Blocks */}\n                  {block.type === 'code' && (\n                    <button\n                      onClick={() => handleCopyBlock(block.id, block.content)}\n                      className=\"absolute top-2 right-2 p-1.5 bg-gray-200 dark:bg-neutral-800 hover:bg-gray-300 dark:hover:bg-neutral-700 rounded text-gray-600 dark:text-neutral-300 transition-all opacity-0 group-hover/content:opacity-100\"\n                      title=\"Copy to clipboard\"\n                    >\n                      {copiedBlockId === block.id ? <Check size={14} className=\"text-green-600\" /> : <Copy size={14} />}\n                    </button>\n                  )}\n                </div>\n              </motion.div>\n            );\n          })}\n        </AnimatePresence>\n      </div>\n\n      {/* Bottom Controls */}\n      <div className=\"mt-8 flex gap-2 group opacity-50 hover:opacity-100 transition-opacity\">\n        <button onClick={() => addBlock(activeNote.blocks[activeNote.blocks.length - 1]?.id || '0')} className=\"flex items-center gap-2 text-sm font-medium hover:bg-muted dark:hover:bg-neutral-800 px-3 py-1.5 rounded-md transition-colors\">\n          <Plus size={16} /> Add Block\n        </button>\n        <button\n          onMouseDown={(e) => { e.preventDefault(); handleAiEnhance(); }}\n          disabled={isAiLoading}\n          className=\"flex items-center gap-2 text-sm font-medium hover:bg-muted dark:hover:bg-neutral-800 px-3 py-1.5 rounded-md transition-colors text-purple-900 dark:text-purple-300\"\n        >\n          <Sparkles size={16} className={isAiLoading ? \"animate-spin\" : \"\"} />\n          {isAiLoading ? \"Thinking...\" : \"Gemini Expand\"}\n        </button>\n      </div>\n\n      {/* Slash Menu */}\n      <AnimatePresence>\n        {slashMenuOpen && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.9 }}\n            style={{ top: slashMenuPosition.top, left: slashMenuPosition.left }}\n            className=\"absolute z-50 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-700 shadow-xl rounded-lg w-48 overflow-hidden flex flex-col py-1\"\n          >\n            <div className=\"px-3 py-2 text-xs font-bold text-gray-400 dark:text-neutral-500 uppercase tracking-wider border-b border-gray-100 dark:border-neutral-800\">\n              Basic Blocks\n            </div>\n            {[\n              { type: 'paragraph', label: 'Paragraph', icon: Type },\n              { type: 'heading', label: 'Heading 1', icon: Heading1 },\n              { type: 'bullet', label: 'Bulleted List', icon: List },\n              { type: 'todo', label: 'To-do List', icon: CheckSquare },\n              { type: 'blockquote', label: 'Quote', icon: Quote },\n              { type: 'code', label: 'Code Block', icon: Code },\n              { type: 'image', label: 'Image', icon: ImageIcon },\n            ].filter(item => item.label.toLowerCase().includes(slashFilter.toLowerCase())).map(item => (\n              <button\n                key={item.type}\n                onClick={(e) => {\n                  e.stopPropagation();\n                  if (item.type === 'image') {\n                    fileInputRef.current?.click();\n                    setSlashMenuOpen(false);\n                  } else if (slashBlockId) {\n                    updateBlockType(slashBlockId, item.type as any);\n                  }\n                }}\n                className=\"flex items-center gap-3 px-3 py-2 hover:bg-gray-50 dark:hover:bg-neutral-800 transition-colors text-left\"\n              >\n                <item.icon size={16} className=\"text-gray-500 dark:text-neutral-400\" />\n                <span className=\"text-sm font-medium text-black dark:text-neutral-200\">{item.label}</span>\n              </button>\n            ))}\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Formatting Toolbar - Portaled for z-index safety */}\n      {createPortal(\n        <AnimatePresence>\n          {formatToolbarPosition && (\n            <motion.div\n              key=\"format-toolbar\"\n              role=\"toolbar\"\n              aria-label=\"Text formatting\"\n              initial={{ opacity: 0, scale: 0.85, y: 15 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.85, y: 15 }}\n              transition={{ type: \"spring\", stiffness: 500, damping: 30, mass: 0.8 }}\n              style={{\n                top: formatToolbarPosition.top,\n                left: formatToolbarPosition.left,\n                translateX: \"-50%\"\n              }}\n              className=\"fixed z-[9999] bg-black/95 dark:bg-white/95 backdrop-blur-xl text-white dark:text-black rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0.4)] dark:shadow-[0_8px_32px_rgba(0,0,0,0.15)] px-2 py-2 flex items-center gap-1 border border-white/10 dark:border-black/10 pointer-events-auto\"\n            >\n              {/* Arrow pointer */}\n              <div className=\"absolute -bottom-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-black/95 dark:bg-white/95 rotate-45 border-r border-b border-white/10 dark:border-black/10\" />\n\n              {/* Text Style Group */}\n              <div className=\"flex items-center gap-0.5 bg-white/5 dark:bg-black/5 rounded-xl p-1\">\n                {/* Bold Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Bold\"\n                    aria-keyshortcuts=\"Meta+B Ctrl+B\"\n                    aria-pressed={activeFormats.bold}\n                    onMouseDown={(e) => { e.preventDefault(); formatText('bold'); }}\n                    className={`p-2 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none ${activeFormats.bold\n                      ? 'bg-white/30 dark:bg-black/30 text-blue-400 ring-1 ring-blue-400/50'\n                      : 'hover:bg-white/20 dark:hover:bg-black/15'\n                      }`}\n                  >\n                    <Bold size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Bold\n                    <span className=\"ml-1.5 text-gray-400 dark:text-gray-500\">âB</span>\n                  </div>\n                </div>\n\n                {/* Italic Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Italic\"\n                    aria-keyshortcuts=\"Meta+I Ctrl+I\"\n                    aria-pressed={activeFormats.italic}\n                    onMouseDown={(e) => { e.preventDefault(); formatText('italic'); }}\n                    className={`p-2 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none ${activeFormats.italic\n                      ? 'bg-white/30 dark:bg-black/30 text-blue-400 ring-1 ring-blue-400/50'\n                      : 'hover:bg-white/20 dark:hover:bg-black/15'\n                      }`}\n                  >\n                    <Italic size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Italic\n                    <span className=\"ml-1.5 text-gray-400 dark:text-gray-500\">âI</span>\n                  </div>\n                </div>\n\n                {/* Underline Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Underline\"\n                    aria-keyshortcuts=\"Meta+U Ctrl+U\"\n                    aria-pressed={activeFormats.underline}\n                    onMouseDown={(e) => { e.preventDefault(); formatText('underline'); }}\n                    className={`p-2 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none ${activeFormats.underline\n                      ? 'bg-white/30 dark:bg-black/30 text-blue-400 ring-1 ring-blue-400/50'\n                      : 'hover:bg-white/20 dark:hover:bg-black/15'\n                      }`}\n                  >\n                    <Underline size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Underline\n                    <span className=\"ml-1.5 text-gray-400 dark:text-gray-500\">âU</span>\n                  </div>\n                </div>\n\n                {/* Strikethrough Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Strikethrough\"\n                    aria-pressed={activeFormats.strikeThrough}\n                    onMouseDown={(e) => { e.preventDefault(); formatText('strikeThrough'); }}\n                    className={`p-2 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none ${activeFormats.strikeThrough\n                      ? 'bg-white/30 dark:bg-black/30 text-blue-400 ring-1 ring-blue-400/50'\n                      : 'hover:bg-white/20 dark:hover:bg-black/15'\n                      }`}\n                  >\n                    <Strikethrough size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Strikethrough\n                  </div>\n                </div>\n\n                {/* Inline Code Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Inline Code\"\n                    onMouseDown={(e) => {\n                      e.preventDefault();\n                      const selection = window.getSelection();\n                      if (!selection || selection.rangeCount === 0) return;\n\n                      const range = selection.getRangeAt(0);\n                      const selectedText = selection.toString();\n\n                      // Check if selection is inside a code element\n                      let parentCode: HTMLElement | null = null;\n                      let node: Node | null = range.commonAncestorContainer;\n\n                      while (node && node !== document.body) {\n                        if (node instanceof HTMLElement && node.tagName === 'CODE' && node.classList.contains('inline-code')) {\n                          parentCode = node;\n                          break;\n                        }\n                        node = node.parentNode;\n                      }\n\n                      if (parentCode) {\n                        // Check if selection covers the entire code content\n                        const codeContent = parentCode.textContent || '';\n                        const selectedContent = selectedText;\n\n                        if (selectedContent === codeContent || selectedContent.trim() === codeContent.trim()) {\n                          // Full selection - remove entire code element\n                          const parent = parentCode.parentNode;\n                          const textNode = document.createTextNode(codeContent);\n                          parent?.replaceChild(textNode, parentCode);\n\n                          requestAnimationFrame(() => {\n                            const freshSelection = window.getSelection();\n                            if (freshSelection && textNode.parentNode) {\n                              const newRange = document.createRange();\n                              newRange.selectNodeContents(textNode);\n                              freshSelection.removeAllRanges();\n                              freshSelection.addRange(newRange);\n                            }\n                            setActiveFormats(prev => ({ ...prev, inlineCode: false }));\n                          });\n                        } else {\n                          // Partial selection - split the code element\n                          const parent = parentCode.parentNode;\n                          if (!parent) return;\n\n                          // Find where in the code content the selection starts and ends\n                          const startOffset = codeContent.indexOf(selectedContent);\n                          const endOffset = startOffset + selectedContent.length;\n\n                          const beforeText = codeContent.substring(0, startOffset);\n                          const afterText = codeContent.substring(endOffset);\n\n                          // Create elements\n                          const fragment = document.createDocumentFragment();\n\n                          if (beforeText) {\n                            const beforeCode = document.createElement('code');\n                            beforeCode.className = 'inline-code';\n                            beforeCode.textContent = beforeText;\n                            fragment.appendChild(beforeCode);\n                          }\n\n                          // The selected text without formatting\n                          const plainText = document.createTextNode(selectedContent);\n                          fragment.appendChild(plainText);\n\n                          if (afterText) {\n                            const afterCode = document.createElement('code');\n                            afterCode.className = 'inline-code';\n                            afterCode.textContent = afterText;\n                            fragment.appendChild(afterCode);\n                          }\n\n                          parent.replaceChild(fragment, parentCode);\n\n                          requestAnimationFrame(() => {\n                            const freshSelection = window.getSelection();\n                            if (freshSelection) {\n                              const newRange = document.createRange();\n                              newRange.selectNodeContents(plainText);\n                              freshSelection.removeAllRanges();\n                              freshSelection.addRange(newRange);\n                            }\n                            setActiveFormats(prev => ({ ...prev, inlineCode: false }));\n                          });\n                        }\n                      } else if (selectedText) {\n                        // ADD code formatting - wrap in code element\n                        const codeEl = document.createElement('code');\n                        codeEl.className = 'inline-code';\n                        codeEl.textContent = selectedText;\n\n                        range.deleteContents();\n                        range.insertNode(codeEl);\n\n                        // Force selection update after DOM change\n                        requestAnimationFrame(() => {\n                          const freshSelection = window.getSelection();\n                          if (freshSelection) {\n                            const newRange = document.createRange();\n                            newRange.selectNodeContents(codeEl);\n                            freshSelection.removeAllRanges();\n                            freshSelection.addRange(newRange);\n                          }\n                          setActiveFormats(prev => ({ ...prev, inlineCode: true }));\n                        });\n                      }\n                    }}\n                    aria-pressed={activeFormats.inlineCode}\n                    className={`p-2 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none ${activeFormats.inlineCode\n                      ? 'bg-white/30 dark:bg-black/30 text-blue-400 ring-1 ring-blue-400/50'\n                      : 'hover:bg-white/20 dark:hover:bg-black/15'\n                      }`}\n                  >\n                    <Code size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    CÃ³digo\n                  </div>\n                </div>\n\n                {/* Uppercase Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Uppercase\"\n                    onMouseDown={(e) => {\n                      e.preventDefault();\n                      const selection = window.getSelection();\n                      if (!selection || selection.rangeCount === 0) return;\n\n                      const range = selection.getRangeAt(0);\n                      const selectedText = selection.toString();\n\n                      if (selectedText) {\n                        // Check if already uppercase, if so convert to lowercase\n                        const isUppercase = selectedText === selectedText.toUpperCase();\n                        const newText = isUppercase ? selectedText.toLowerCase() : selectedText.toUpperCase();\n\n                        const textNode = document.createTextNode(newText);\n                        range.deleteContents();\n                        range.insertNode(textNode);\n\n                        // Re-select the transformed text\n                        range.selectNode(textNode);\n                        selection.removeAllRanges();\n                        selection.addRange(range);\n                      }\n                    }}\n                    aria-pressed={activeFormats.uppercase}\n                    className={`p-2 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none ${activeFormats.uppercase\n                      ? 'bg-white/30 dark:bg-black/30 text-blue-400 ring-1 ring-blue-400/50'\n                      : 'hover:bg-white/20 dark:hover:bg-black/15'\n                      }`}\n                  >\n                    <CaseUpper size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    MAIÃSCULAS\n                  </div>\n                </div>\n\n                {/* Separator */}\n                <div className=\"w-px h-4 bg-white/20 dark:bg-black/20 mx-0.5\" />\n\n                {/* Link Button */}\n                <div className=\"relative group/btn\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Insert Link\"\n                    onMouseDown={(e) => {\n                      e.preventDefault();\n                      const selection = window.getSelection();\n                      const selectedText = selection?.toString() || '';\n                      const url = prompt('Enter URL:', selectedText.startsWith('http') ? selectedText : 'https://');\n                      if (url) {\n                        document.execCommand('createLink', false, url);\n                      }\n                    }}\n                    className=\"p-2 hover:bg-white/20 dark:hover:bg-black/15 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none\"\n                  >\n                    <LinkIcon size={16} strokeWidth={2.5} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    Insert Link\n                    <span className=\"ml-1.5 text-gray-400 dark:text-gray-500\">âK</span>\n                  </div>\n                </div>\n\n                {/* Font Selector */}\n                <div className=\"relative group/btn font-dropdown-container\">\n                  <button\n                    type=\"button\"\n                    aria-label=\"Change Font\"\n                    onMouseDown={(e) => {\n                      e.preventDefault();\n                      setFontDropdownOpen(!fontDropdownOpen);\n                    }}\n                    className={`p-2 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none flex items-center gap-1 ${activeFormats.currentFont &&\n                      !activeFormats.currentFont.includes('Inter') &&\n                      !activeFormats.inlineCode &&\n                      !activeFormats.currentFont.includes('JetBrains') &&\n                      !activeFormats.currentFont.includes('Fira') &&\n                      !activeFormats.currentFont.includes('Consolas') &&\n                      !activeFormats.currentFont.includes('Monaco') &&\n                      !activeFormats.currentFont.includes('monospace')\n                      ? 'bg-white/30 dark:bg-black/30 text-blue-400 ring-1 ring-blue-400/50'\n                      : 'hover:bg-white/20 dark:hover:bg-black/15'\n                      }`}\n                  >\n                    <Type size={16} strokeWidth={2.5} />\n                    <ChevronDown size={12} />\n                  </button>\n                  <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-lg\">\n                    {activeFormats.currentFont || 'Fonte'}\n                  </div>\n\n                  {/* Font Dropdown */}\n                  <AnimatePresence>\n                    {fontDropdownOpen && (\n                      <motion.div\n                        initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                        animate={{ opacity: 1, y: 0, scale: 1 }}\n                        exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                        transition={{ duration: 0.15 }}\n                        className=\"absolute top-full left-1/2 -translate-x-1/2 mt-2 bg-neutral-900 dark:bg-white border border-neutral-700 dark:border-neutral-300 rounded-xl shadow-2xl p-1 min-w-[160px] max-h-[250px] overflow-y-auto z-50 font-dropdown-container\"\n                      >\n                        {AVAILABLE_FONTS.map((font) => {\n                          const isActive = activeFormats.currentFont.includes(font.name) ||\n                            activeFormats.currentFont.includes(font.value.split(',')[0].replace(/['\"]/g, ''));\n                          return (\n                            <button\n                              key={font.name}\n                              onMouseDown={(e) => {\n                                e.preventDefault();\n                                e.stopPropagation();\n                                // Apply font to selected text\n                                const selection = window.getSelection();\n                                if (selection && selection.rangeCount > 0) {\n                                  const range = selection.getRangeAt(0);\n                                  if (!range.collapsed) {\n                                    const span = document.createElement('span');\n                                    span.style.fontFamily = font.value;\n                                    try {\n                                      range.surroundContents(span);\n                                    } catch {\n                                      // If surrounding fails (crosses element boundaries), use execCommand fallback\n                                      document.execCommand('fontName', false, font.value);\n                                    }\n                                  }\n                                }\n                                setFontDropdownOpen(false);\n                              }}\n                              className={`w-full px-3 py-2 text-left text-sm rounded-lg transition-colors flex items-center justify-between ${isActive\n                                ? 'bg-blue-500/20 text-blue-400 font-semibold'\n                                : 'text-white dark:text-black hover:bg-neutral-700 dark:hover:bg-neutral-200'\n                                }`}\n                              style={{ fontFamily: font.value }}\n                            >\n                              {font.name}\n                              {isActive && <Check size={14} className=\"text-blue-400\" />}\n                            </button>\n                          );\n                        })}\n                      </motion.div>\n                    )}\n                  </AnimatePresence>\n                </div>\n              </div>\n\n              <div className=\"w-px h-6 bg-white/20 dark:bg-black/20 mx-0.5\" role=\"separator\" aria-orientation=\"vertical\" />\n\n              {/* Text Highlight Colors - Dropdown */}\n              <div className=\"relative\">\n                <button\n                  type=\"button\"\n                  aria-label=\"Highlight Color\"\n                  onMouseDown={(e) => {\n                    e.preventDefault();\n                    setHighlightDropdownOpen(!highlightDropdownOpen);\n                    setTextColorDropdownOpen(false);\n                  }}\n                  className=\"p-2 hover:bg-white/20 dark:hover:bg-black/15 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none\"\n                >\n                  <Highlighter size={16} strokeWidth={2.5} />\n                </button>\n                <AnimatePresence>\n                  {highlightDropdownOpen && (\n                    <motion.div\n                      initial={{ opacity: 0, y: -5, scale: 0.95 }}\n                      animate={{ opacity: 1, y: 0, scale: 1 }}\n                      exit={{ opacity: 0, y: -5, scale: 0.95 }}\n                      transition={{ duration: 0.15 }}\n                      className=\"absolute top-full left-1/2 -translate-x-1/2 mt-2 bg-neutral-900 dark:bg-white border border-neutral-700 dark:border-neutral-300 rounded-xl shadow-2xl p-2 flex flex-wrap gap-1.5 z-50 w-[140px]\"\n                    >\n                      {[\n                        { color: '#facc15', label: 'Amarelo' },\n                        { color: '#4ade80', label: 'Verde' },\n                        { color: '#ff0000', label: 'Vermelho' },\n                        { color: '#60a5fa', label: 'Azul' },\n                        { color: '#f87171', label: 'Coral' },\n                        { color: '#c084fc', label: 'Roxo' },\n                      ].map((item) => (\n                        <button\n                          key={item.color}\n                          type=\"button\"\n                          title={item.label}\n                          onMouseDown={(e) => {\n                            e.preventDefault();\n                            document.execCommand('hiliteColor', false, item.color);\n                            setHighlightDropdownOpen(false);\n                          }}\n                          className=\"w-6 h-6 rounded-md border-2 border-white/20 hover:scale-110 active:scale-95 transition-all\"\n                          style={{ backgroundColor: item.color }}\n                        />\n                      ))}\n                      <button\n                        type=\"button\"\n                        title=\"Remover\"\n                        onMouseDown={(e) => {\n                          e.preventDefault();\n                          document.execCommand('hiliteColor', false, 'transparent');\n                          setHighlightDropdownOpen(false);\n                        }}\n                        className=\"w-6 h-6 rounded-md border-2 border-white/20 hover:scale-110 active:scale-95 transition-all flex items-center justify-center bg-gray-600\"\n                      >\n                        <X size={12} className=\"text-white\" />\n                      </button>\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n              </div>\n\n              {/* Text Foreground Colors - Dropdown */}\n              <div className=\"relative\">\n                <button\n                  type=\"button\"\n                  aria-label=\"Text Color\"\n                  onMouseDown={(e) => {\n                    e.preventDefault();\n                    setTextColorDropdownOpen(!textColorDropdownOpen);\n                    setHighlightDropdownOpen(false);\n                  }}\n                  className=\"p-2 hover:bg-white/20 dark:hover:bg-black/15 rounded-lg transition-all duration-150 hover:scale-110 active:scale-95 focus:outline-none\"\n                >\n                  <Paintbrush size={16} strokeWidth={2.5} />\n                </button>\n                <AnimatePresence>\n                  {textColorDropdownOpen && (\n                    <motion.div\n                      initial={{ opacity: 0, y: -5, scale: 0.95 }}\n                      animate={{ opacity: 1, y: 0, scale: 1 }}\n                      exit={{ opacity: 0, y: -5, scale: 0.95 }}\n                      transition={{ duration: 0.15 }}\n                      className=\"absolute top-full left-1/2 -translate-x-1/2 mt-2 bg-neutral-900 dark:bg-white border border-neutral-700 dark:border-neutral-300 rounded-xl shadow-2xl p-2 flex flex-wrap gap-1.5 z-50 w-[140px]\"\n                    >\n                      {[\n                        { color: '#000000', label: 'Preto' },\n                        { color: '#ffffff', label: 'Branco' },\n                        { color: '#ff0000', label: 'Vermelho' },\n                        { color: '#ff6b00', label: 'Laranja' },\n                        { color: '#facc15', label: 'Amarelo' },\n                        { color: '#4ade80', label: 'Verde' },\n                        { color: '#60a5fa', label: 'Azul' },\n                        { color: '#c084fc', label: 'Roxo' },\n                      ].map((item) => (\n                        <button\n                          key={`text-${item.color}`}\n                          type=\"button\"\n                          title={item.label}\n                          onMouseDown={(e) => {\n                            e.preventDefault();\n                            document.execCommand('foreColor', false, item.color);\n                            setTextColorDropdownOpen(false);\n                          }}\n                          className=\"w-6 h-6 rounded-md border-2 border-white/20 hover:scale-110 active:scale-95 transition-all flex items-center justify-center\"\n                          style={{ backgroundColor: item.color === '#ffffff' ? '#e5e5e5' : item.color }}\n                        >\n                          <span\n                            className=\"text-[10px] font-bold\"\n                            style={{ color: item.color === '#000000' || item.color === '#ff0000' ? '#fff' : '#000' }}\n                          >\n                            A\n                          </span>\n                        </button>\n                      ))}\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n              </div>\n\n              {/* Separator before connector */}\n              <div className=\"w-px h-4 bg-white/20 dark:bg-black/20 mx-1\" />\n\n              {/* Connect Text Button */}\n              <div className=\"relative group/btn\">\n                <button\n                  type=\"button\"\n                  aria-label=\"Connect Text\"\n                  onMouseDown={(e) => {\n                    e.preventDefault();\n                    handleStartTextLinking();\n                  }}\n                  className=\"w-6 h-6 rounded-lg border-2 border-white/30 dark:border-black/30 hover:scale-110 active:scale-95 transition-all flex items-center justify-center bg-gray-700 dark:bg-gray-400 hover:bg-gray-600 dark:hover:bg-gray-500\"\n                >\n                  <MoreVertical size={14} className=\"text-white dark:text-black\" />\n                </button>\n                <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2.5 px-2 py-1 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-[10px] font-semibold rounded-lg whitespace-nowrap opacity-0 group-hover/btn:opacity-100 transition-opacity pointer-events-none shadow-xl z-10\">\n                  Interligar\n                  <div className=\"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-800 dark:border-t-gray-200\" />\n                </div>\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>,\n        document.body\n      )}\n\n      <ConfirmationModal\n        isOpen={!!imageToDelete}\n        title=\"Delete Image?\"\n        message=\"Are you sure you want to delete this image? This action cannot be undone.\"\n        onConfirm={() => {\n          if (imageToDelete) {\n            deleteBlock(imageToDelete);\n            setImageToDelete(null);\n          }\n        }}\n        onCancel={() => setImageToDelete(null)}\n      />\n\n      {/* Link Paste Modal */}\n      <AnimatePresence>\n        {linkPasteModal && (\n          <motion.div\n            initial={{ opacity: 0, y: -10, scale: 0.95 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: -10, scale: 0.95 }}\n            transition={{ type: \"spring\", stiffness: 400, damping: 25 }}\n            style={{\n              position: 'fixed',\n              top: linkPasteModal.position.top,\n              left: linkPasteModal.position.left,\n              zIndex: 9999\n            }}\n            className=\"bg-neutral-900 dark:bg-neutral-800 rounded-xl shadow-2xl border border-neutral-700 overflow-hidden min-w-[200px]\"\n          >\n            {/* Header */}\n            <div className=\"px-4 py-2 border-b border-neutral-700 text-sm text-neutral-400 font-medium\">\n              Colar como\n            </div>\n\n            {/* Options */}\n            <div className=\"py-1\">\n              <button\n                onClick={() => handleLinkPasteOption('mention')}\n                className=\"w-full px-4 py-2.5 text-left text-white hover:bg-neutral-700 transition-colors flex items-center gap-3\"\n              >\n                <span className=\"text-blue-400\">@</span>\n                <span>MenÃ§Ã£o</span>\n              </button>\n\n              <button\n                onClick={() => handleLinkPasteOption('embed')}\n                className=\"w-full px-4 py-2.5 text-left text-white hover:bg-neutral-700 transition-colors flex items-center gap-3\"\n              >\n                <span className=\"text-purple-400\">â</span>\n                <span>Integrar tweet</span>\n              </button>\n\n              <button\n                onClick={() => handleLinkPasteOption('bookmark')}\n                className=\"w-full px-4 py-2.5 text-left text-white hover:bg-neutral-700 transition-colors flex items-center gap-3\"\n              >\n                <span className=\"text-yellow-400\">ð</span>\n                <span>Criar marcador</span>\n              </button>\n\n              <button\n                onClick={() => handleLinkPasteOption('url')}\n                className=\"w-full px-4 py-2.5 text-left text-white hover:bg-neutral-700 transition-colors flex items-center gap-3\"\n              >\n                <LinkIcon size={16} className=\"text-neutral-400\" />\n                <span>URL</span>\n              </button>\n            </div>\n\n            {/* URL Preview */}\n            <div className=\"px-4 py-2 border-t border-neutral-700 text-xs text-neutral-500 truncate max-w-[300px]\">\n              {linkPasteModal.url}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Click outside to close link paste modal */}\n      {\n        linkPasteModal && (\n          <div\n            className=\"fixed inset-0 z-[9998]\"\n            onClick={() => setLinkPasteModal(null)}\n          />\n        )\n      }\n\n      {/* Text Linking Mode Overlay */}\n      <TextLinkingMode\n        isActive={isTextLinkingMode}\n        sourceText={sourceTextForLinking}\n        sourceBlockId={sourceBlockIdForLinking}\n        currentColor={currentLinkColor}\n        onColorChange={setCurrentLinkColor}\n        onSelectTarget={handleConfirmTextConnection}\n        onCancel={handleCancelTextLinking}\n      />\n\n      {/* Link Delete Confirmation Modal */}\n      <AnimatePresence>\n        {linkDeleteModal && (\n          <>\n            {/* Backdrop */}\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"fixed inset-0 z-[9998]\"\n              onClick={() => setLinkDeleteModal(null)}\n            />\n\n            {/* Confirmation Popup */}\n            <motion.div\n              initial={{ opacity: 0, y: -10, scale: 0.9 }}\n              animate={{ opacity: 1, y: 0, scale: 1 }}\n              exit={{ opacity: 0, y: -10, scale: 0.9 }}\n              transition={{ type: \"spring\", stiffness: 500, damping: 30 }}\n              className=\"fixed z-[9999] p-1\"\n              style={{\n                left: linkDeleteModal.position.x,\n                top: linkDeleteModal.position.y,\n                transform: 'translateX(-50%)'\n              }}\n            >\n              <div className=\"bg-gradient-to-br from-slate-900 to-slate-800 dark:from-neutral-900 dark:to-neutral-800 rounded-xl shadow-2xl border border-white/10 overflow-hidden min-w-[200px]\">\n                {/* Header */}\n                <div className=\"px-4 py-3 border-b border-white/10 flex items-center gap-2\">\n                  <div className=\"w-8 h-8 rounded-lg bg-red-500/20 flex items-center justify-center\">\n                    <Trash2 size={16} className=\"text-red-400\" />\n                  </div>\n                  <div>\n                    <h4 className=\"text-sm font-semibold text-white\">Remover Link</h4>\n                    <p className=\"text-xs text-white/50 truncate max-w-[150px]\">{linkDeleteModal.linkName}</p>\n                  </div>\n                </div>\n\n                {/* Message */}\n                <div className=\"px-4 py-3\">\n                  <p className=\"text-xs text-white/60\">\n                    Esta aÃ§Ã£o nÃ£o pode ser desfeita.\n                  </p>\n                </div>\n\n                {/* Actions */}\n                <div className=\"px-3 py-2 flex items-center gap-2 border-t border-white/5 bg-black/20\">\n                  <motion.button\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    onClick={() => setLinkDeleteModal(null)}\n                    className=\"flex-1 px-3 py-2 rounded-lg text-xs font-medium text-white/70 hover:bg-white/10 transition-colors\"\n                  >\n                    Cancelar\n                  </motion.button>\n                  <motion.button\n                    whileHover={{ scale: 1.02 }}\n                    whileTap={{ scale: 0.98 }}\n                    onClick={handleConfirmLinkDelete}\n                    className=\"flex-1 px-3 py-2 rounded-lg text-xs font-semibold bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg shadow-red-500/25 hover:shadow-red-500/40 transition-all\"\n                  >\n                    Remover\n                  </motion.button>\n                </div>\n              </div>\n\n              {/* Arrow pointer */}\n              <div\n                className=\"absolute -top-2 left-1/2 -translate-x-1/2 w-0 h-0\"\n                style={{\n                  borderLeft: '8px solid transparent',\n                  borderRight: '8px solid transparent',\n                  borderBottom: '8px solid rgb(15 23 42)'\n                }}\n              />\n            </motion.div>\n          </>\n        )}\n      </AnimatePresence>\n    </motion.div >\n  );\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6597, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/canvas/CanvasView.tsx"],"sourcesContent":["import React, { useRef, useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Note, Tag } from '../../types';\nimport { StickyNote, MousePointer2, Link2, X, ExternalLink } from 'lucide-react';\nimport { NOTE_COLORS } from '../../constants';\n\n// SVG Noise Texture for paper feel\nconst PAPER_TEXTURE = `url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E\")`;\n\nconst NOTE_WIDTH = 256;\nconst NOTE_HEIGHT_ESTIMATE = 80; // Approximate center for connection anchor\n\n// LOD (Level of Detail) thresholds based on zoom\n// dot: pulsing circles only (overview)\n// minimal: small pill with title only  \n// compact: medium card with title + preview snippet\n// full: complete card with all content\ntype LODLevel = 'dot' | 'minimal' | 'compact' | 'full';\nconst getLODLevel = (zoom: number): LODLevel => {\n  if (zoom < 0.35) return 'dot';\n  if (zoom < 0.55) return 'minimal';\n  if (zoom < 0.85) return 'compact';\n  return 'full';\n};\n\ninterface CanvasViewProps {\n  notes: Note[];\n  onNoteSelect: (noteId: string) => void;\n  onNoteMove: (noteId: string, position: { x: number; y: number }) => void;\n  onConnectNotes: (sourceId: string, targetId: string) => void;\n  onDeleteNote: (noteId: string) => void;\n  isDarkMode: boolean;\n  tagsWithColors?: Tag[];\n  selectedNoteId?: string | null;\n}\n\ntype CanvasTool = 'SELECT' | 'CONNECT';\n\nexport const CanvasView: React.FC<CanvasViewProps> = ({\n  notes,\n  onNoteSelect,\n  onNoteMove,\n  onConnectNotes,\n  onDeleteNote,\n  isDarkMode,\n  tagsWithColors = [],\n  selectedNoteId\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Viewport State\n  const [pan, setPan] = useState({ x: 0, y: 0 });\n  const [zoom, setZoom] = useState(1);\n  const [isDraggingCanvas, setIsDraggingCanvas] = useState(false);\n\n  // LOD level based on zoom\n  const lodLevel = getLODLevel(zoom);\n\n  // Create a map of tag name to color for quick lookup\n  const tagColorMap = useMemo(() => {\n    const map = new Map<string, string>();\n    tagsWithColors.forEach(tag => {\n      map.set(tag.name, tag.color);\n    });\n    return map;\n  }, [tagsWithColors]);\n\n  const getTagColor = (tagName: string): string => {\n    return tagColorMap.get(tagName) || '#6b7280'; // Default gray if not found\n  };\n\n  // Tool State\n  const [activeTool, setActiveTool] = useState<CanvasTool>('SELECT');\n  const [connectionSourceId, setConnectionSourceId] = useState<string | null>(null);\n  const [mousePos, setMousePos] = useState({ x: 0, y: 0 });\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    const target = e.target as HTMLElement;\n    // Pan if clicking on background OR grid overlay OR pan layer (not on notes/cards)\n    const isBackground = target === containerRef.current ||\n      target.classList.contains('canvas-grid') ||\n      target.classList.contains('canvas-pan-layer') ||\n      target.tagName === 'svg';\n\n    if (isBackground && activeTool === 'SELECT') {\n      setIsDraggingCanvas(true);\n    }\n    // If clicking background in connect mode, cancel connection source but keep tool active\n    if (activeTool === 'CONNECT' && isBackground) {\n      setConnectionSourceId(null);\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    if (isDraggingCanvas) {\n      setPan(prev => ({ x: prev.x + e.movementX, y: prev.y + e.movementY }));\n    }\n\n    // Update mouse pos for drawing the temporary connection line\n    if (activeTool === 'CONNECT') {\n      // Calculate relative position inside the panned container\n      const rect = containerRef.current?.getBoundingClientRect();\n      if (rect) {\n        setMousePos({\n          x: e.clientX - rect.left - pan.x,\n          y: e.clientY - rect.top - pan.y\n        });\n      }\n    }\n  };\n\n  const handleMouseUp = () => {\n    setIsDraggingCanvas(false);\n  };\n\n  // Zoom with mouse wheel\n  const handleWheel = (e: React.WheelEvent) => {\n    e.preventDefault();\n    const delta = e.deltaY > 0 ? -0.1 : 0.1;\n    setZoom(prev => Math.min(Math.max(prev + delta, 0.2), 2));\n  };\n\n  const handleNoteInteraction = (noteId: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    if (activeTool === 'CONNECT') {\n      if (connectionSourceId === null) {\n        // Start connection\n        setConnectionSourceId(noteId);\n      } else {\n        // If clicking same node, toggle off selection\n        if (connectionSourceId === noteId) {\n          setConnectionSourceId(null);\n        } else {\n          // Complete connection\n          onConnectNotes(connectionSourceId, noteId);\n          setConnectionSourceId(null);\n        }\n      }\n    } else {\n      // Normal selection\n      onNoteSelect(noteId);\n    }\n  };\n\n  const toggleTool = (tool: CanvasTool) => {\n    if (activeTool === tool) {\n      // Toggle off if clicking same tool\n      if (tool === 'CONNECT') {\n        setActiveTool('SELECT');\n        setConnectionSourceId(null);\n      }\n    } else {\n      setActiveTool(tool);\n      setConnectionSourceId(null);\n    }\n  };\n\n  return (\n    <div\n      className={`w-full h-full bg-[#fcfcfc] dark:bg-[#0a0a0a] relative overflow-hidden transition-colors duration-300 ${activeTool === 'CONNECT' ? 'cursor-crosshair' : 'cursor-grab active:cursor-grabbing'}`}\n      ref={containerRef}\n      onMouseDown={handleMouseDown}\n      onMouseMove={handleMouseMove}\n      onMouseUp={handleMouseUp}\n      onMouseLeave={handleMouseUp}\n      onWheel={handleWheel}\n    >\n      {/* Zoom Indicator */}\n      <div className=\"absolute top-4 left-4 z-50 bg-white/80 dark:bg-black/80 backdrop-blur-sm px-3 py-1.5 rounded-lg text-xs font-mono font-bold text-gray-600 dark:text-neutral-400 border border-gray-200 dark:border-neutral-700\">\n        {Math.round(zoom * 100)}% â¢ {lodLevel.toUpperCase()}\n      </div>\n      {/* Toolbar */}\n      <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 z-50 bg-white dark:bg-neutral-900 border border-black dark:border-neutral-700 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] dark:shadow-[4px_4px_0px_0px_rgba(255,255,255,0.1)] px-2 py-2 rounded-full flex gap-2\">\n        <button\n          onClick={() => toggleTool('SELECT')}\n          className={`p-2 rounded-full transition-all ${activeTool === 'SELECT' ? 'bg-black text-white dark:bg-white dark:text-black' : 'hover:bg-gray-100 dark:hover:bg-neutral-800 text-black dark:text-white'}`}\n          title=\"Select / Move Tool\"\n        >\n          <MousePointer2 size={18} />\n        </button>\n        <button\n          onClick={() => toggleTool('CONNECT')}\n          className={`p-2 rounded-full transition-all ${activeTool === 'CONNECT' ? 'bg-black text-white dark:bg-white dark:text-black' : 'hover:bg-gray-100 dark:hover:bg-neutral-800 text-black dark:text-white'}`}\n          title=\"Connect Notes Tool\"\n        >\n          <Link2 size={18} />\n        </button>\n      </div>\n\n      {/* Invisible Pan Layer - for reliable panning */}\n      <div\n        className=\"absolute inset-0 z-0 canvas-pan-layer\"\n        style={{ cursor: activeTool === 'SELECT' ? 'grab' : 'crosshair' }}\n      />\n\n      {/* Grid Pattern - Infinite dots covering entire viewport */}\n      <div\n        className=\"absolute pointer-events-none opacity-10 dark:opacity-20\"\n        style={{\n          top: '-50%',\n          left: '-50%',\n          width: '200%',\n          height: '200%',\n          backgroundImage: `radial-gradient(${isDarkMode ? '#ffffff' : '#000000'} 1px, transparent 1px)`,\n          backgroundSize: `${24 * zoom}px ${24 * zoom}px`,\n          backgroundPosition: `${pan.x % (24 * zoom)}px ${pan.y % (24 * zoom)}px`\n        }}\n      />\n\n      <motion.div\n        className=\"absolute inset-0 origin-top-left\"\n        style={{ x: pan.x, y: pan.y, scale: zoom }}\n      >\n        {/* Connections Layer */}\n        <svg className=\"absolute top-0 left-0 w-[5000px] h-[5000px] pointer-events-none overflow-visible\">\n          <defs>\n            <marker id=\"arrowhead-pulse\" markerWidth=\"10\" markerHeight=\"7\" refX=\"10\" refY=\"3.5\" orient=\"auto\">\n              <polygon points=\"0 0, 10 3.5, 0 7\" fill={isDarkMode ? \"white\" : \"black\"} className=\"animate-pulse\" />\n            </marker>\n\n            {/* Dynamic Colored Arrowheads */}\n            {NOTE_COLORS.map(c => (\n              <marker\n                key={c.id}\n                id={`arrowhead-${c.value.replace('#', '')}`}\n                markerWidth=\"10\"\n                markerHeight=\"7\"\n                refX=\"10\"\n                refY=\"3.5\"\n                orient=\"auto\"\n              >\n                <polygon points=\"0 0, 10 3.5, 0 7\" fill={c.value} opacity=\"0.8\" />\n              </marker>\n            ))}\n\n            <style>\n              {`\n                    @keyframes flowAnimation {\n                        from { stroke-dashoffset: 16; }\n                        to { stroke-dashoffset: 0; }\n                    }\n                    .connection-line-animated {\n                        animation: flowAnimation 2s linear infinite;\n                    }\n                `}\n            </style>\n          </defs>\n\n          {/* Existing Connections - Smooth Bezier Curves */}\n          {notes.map(note =>\n            note.connections.map(targetId => {\n              const target = notes.find(n => n.id === targetId);\n              if (!target) return null;\n\n              const sourceColor = note.color || (isDarkMode ? '#ffffff' : '#000000');\n              const targetColor = target.color || (isDarkMode ? '#ffffff' : '#000000');\n              const targetColorClean = targetColor.replace('#', '');\n              const gradientId = `grad-${note.id}-${target.id}`;\n\n              const x1 = note.position.x + NOTE_WIDTH / 2;\n              const y1 = note.position.y + NOTE_HEIGHT_ESTIMATE;\n              const x2 = target.position.x + NOTE_WIDTH / 2;\n              const y2 = target.position.y + NOTE_HEIGHT_ESTIMATE;\n\n              // Calculate control points for smooth S-curve\n              const dx = x2 - x1;\n              const dy = y2 - y1;\n              const distance = Math.sqrt(dx * dx + dy * dy);\n\n              // Control point offset - creates the organic curve tension\n              const tension = Math.min(distance * 0.4, 150);\n\n              // Midpoint for the curve\n              const midX = (x1 + x2) / 2;\n              const midY = (y1 + y2) / 2;\n\n              // Control points perpendicular to the line for S-curve effect\n              const angle = Math.atan2(dy, dx);\n              const perpAngle = angle + Math.PI / 2;\n\n              // Create organic S-curve control points\n              const cp1x = x1 + Math.cos(angle) * tension;\n              const cp1y = y1 + Math.sin(angle) * tension + Math.sin(perpAngle) * (tension * 0.3);\n              const cp2x = x2 - Math.cos(angle) * tension;\n              const cp2y = y2 - Math.sin(angle) * tension - Math.sin(perpAngle) * (tension * 0.3);\n\n              // Cubic Bezier path\n              const pathD = `M ${x1} ${y1} C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${x2} ${y2}`;\n\n              return (\n                <React.Fragment key={`${note.id}-${target.id}`}>\n                  <defs>\n                    <linearGradient\n                      id={gradientId}\n                      gradientUnits=\"userSpaceOnUse\"\n                      x1={x1} y1={y1}\n                      x2={x2} y2={y2}\n                    >\n                      <stop offset=\"0%\" stopColor={sourceColor} stopOpacity=\"0.8\" />\n                      <stop offset=\"50%\" stopColor={sourceColor} stopOpacity=\"0.5\" />\n                      <stop offset=\"100%\" stopColor={targetColor} stopOpacity=\"0.8\" />\n                    </linearGradient>\n                  </defs>\n\n                  {/* Glow layer */}\n                  <path\n                    d={pathD}\n                    fill=\"none\"\n                    stroke={sourceColor}\n                    strokeWidth=\"6\"\n                    strokeOpacity=\"0.1\"\n                    strokeLinecap=\"round\"\n                  />\n\n                  {/* Main bezier curve */}\n                  <path\n                    d={pathD}\n                    fill=\"none\"\n                    stroke={`url(#${gradientId})`}\n                    strokeWidth=\"2\"\n                    strokeDasharray=\"12,6\"\n                    strokeLinecap=\"round\"\n                    className=\"connection-line-animated\"\n                    markerEnd={`url(#arrowhead-${targetColorClean})`}\n                  />\n                </React.Fragment>\n              )\n            })\n          )}\n\n          {/* Temporary Connection Line - Bezier */}\n          {activeTool === 'CONNECT' && connectionSourceId && (\n            (() => {\n              const source = notes.find(n => n.id === connectionSourceId);\n              if (!source) return null;\n              const sourceColor = source.color || (isDarkMode ? '#ffffff' : '#000000');\n\n              const x1 = source.position.x + NOTE_WIDTH / 2;\n              const y1 = source.position.y + NOTE_HEIGHT_ESTIMATE;\n              const x2 = mousePos.x;\n              const y2 = mousePos.y;\n\n              // Calculate bezier control points\n              const dx = x2 - x1;\n              const dy = y2 - y1;\n              const distance = Math.sqrt(dx * dx + dy * dy);\n              const tension = Math.min(distance * 0.4, 120);\n              const angle = Math.atan2(dy, dx);\n              const perpAngle = angle + Math.PI / 2;\n\n              const cp1x = x1 + Math.cos(angle) * tension;\n              const cp1y = y1 + Math.sin(angle) * tension + Math.sin(perpAngle) * (tension * 0.2);\n              const cp2x = x2 - Math.cos(angle) * tension;\n              const cp2y = y2 - Math.sin(angle) * tension - Math.sin(perpAngle) * (tension * 0.2);\n\n              const pathD = `M ${x1} ${y1} C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${x2} ${y2}`;\n\n              return (\n                <>\n                  {/* Glow */}\n                  <path\n                    d={pathD}\n                    fill=\"none\"\n                    stroke={sourceColor}\n                    strokeWidth=\"8\"\n                    strokeOpacity=\"0.15\"\n                    strokeLinecap=\"round\"\n                  />\n                  {/* Main line */}\n                  <path\n                    d={pathD}\n                    fill=\"none\"\n                    stroke={sourceColor}\n                    strokeWidth=\"2.5\"\n                    strokeDasharray=\"6,4\"\n                    strokeLinecap=\"round\"\n                    markerEnd=\"url(#arrowhead-pulse)\"\n                    className=\"animate-pulse\"\n                    style={{ opacity: 0.8 }}\n                  />\n                </>\n              )\n            })()\n          )}\n        </svg>\n\n        {notes.map((note) => (\n          <DraggableNote\n            key={note.id}\n            note={note}\n            activeTool={activeTool}\n            isConnectionSource={note.id === connectionSourceId}\n            isSelected={note.id === selectedNoteId}\n            onClick={(e) => handleNoteInteraction(note.id, e)}\n            onMove={(pos) => onNoteMove(note.id, pos)}\n            onDelete={() => onDeleteNote(note.id)}\n            isDarkMode={isDarkMode}\n            getTagColor={getTagColor}\n            lodLevel={lodLevel}\n          />\n        ))}\n      </motion.div>\n\n      {/* Mode Indicator */}\n      <AnimatePresence>\n        {activeTool === 'CONNECT' && (\n          <motion.div\n            initial={{ y: -20, opacity: 0 }}\n            animate={{ y: 0, opacity: 1 }}\n            exit={{ y: -20, opacity: 0 }}\n            className=\"absolute top-8 left-1/2 -translate-x-1/2 bg-black dark:bg-white text-white dark:text-black px-4 py-2 text-xs font-bold uppercase tracking-widest rounded shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)] pointer-events-none flex items-center gap-2\"\n          >\n            <Link2 size={12} />\n            {connectionSourceId ? \"Click target note\" : \"Select source note\"}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n\ninterface DraggableNoteProps {\n  note: Note;\n  activeTool: CanvasTool;\n  isConnectionSource: boolean;\n  isSelected: boolean;\n  onClick: (e: React.MouseEvent) => void;\n  onMove: (p: { x: number, y: number }) => void;\n  onDelete: () => void;\n  isDarkMode: boolean;\n  getTagColor: (tagName: string) => string;\n  lodLevel: LODLevel;\n}\n\nconst DraggableNote: React.FC<DraggableNoteProps> = ({\n  note,\n  activeTool,\n  isConnectionSource,\n  isSelected,\n  onClick,\n  onMove,\n  onDelete,\n  isDarkMode,\n  getTagColor,\n  lodLevel\n}) => {\n  // Safely parse HTML for preview\n  const stripHtml = (html: string) => {\n    const tmp = document.createElement(\"DIV\");\n    tmp.innerHTML = html;\n    return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  // Detect links\n  const linkData = useMemo(() => {\n    for (const block of note.blocks) {\n      const text = stripHtml(block.content);\n      const match = text.match(/(https?:\\/\\/[^\\s]+)/);\n      if (match) {\n        try {\n          const url = new URL(match[0]);\n          return { url: match[0], hostname: url.hostname };\n        } catch (e) { continue; }\n      }\n    }\n    return null;\n  }, [note.blocks]);\n\n  // Sticky Note Theme: Random rotation and imperfect edges (Sketchy Border)\n  const randomRotate = useMemo(() => (Math.random() * 2 - 1), []);\n  const organicRadius = useMemo(() => {\n    const v1 = 2 + Math.random() * 2;\n    const v2 = 2 + Math.random() * 3;\n    const v3 = 2 + Math.random() * 2;\n    const v4 = 2 + Math.random() * 3;\n    return `${v1}px ${v2}px ${v3}px ${v4}px`;\n  }, []);\n\n  const noteColor = note.color && note.color !== '#000000' ? note.color : null;\n\n  // Expanded Preview Logic\n  const previewText = useMemo(() => {\n    const segments: string[] = [];\n    let charCount = 0;\n\n    for (const block of note.blocks) {\n      if (charCount > 200) break; // Stop if we have enough text\n      if (block.type === 'image') {\n        segments.push('[Image]');\n        charCount += 7;\n        continue;\n      }\n\n      const text = stripHtml(block.content).trim();\n      if (!text) continue;\n\n      let formatted = text;\n      if (block.type === 'bullet') formatted = `â¢ ${text}`;\n      if (block.type === 'todo') formatted = `- ${text}`;\n\n      segments.push(formatted);\n      charCount += formatted.length;\n    }\n\n    return segments.join(' ');\n  }, [note.blocks]);\n\n  const selectionColor = noteColor || (isDarkMode ? '#60a5fa' : '#3b82f6');\n\n  const boxShadow = isConnectionSource\n    ? `0 0 0 4px ${noteColor || (isDarkMode ? '#fff' : '#000')}, 8px 8px 12px rgba(0,0,0,0.2)`\n    : isSelected\n      ? `0 0 0 3px ${selectionColor}, 0 0 20px ${selectionColor}40, 4px 6px 16px rgba(0,0,0,0.12)`\n      : \"2px 3px 12px rgba(0,0,0,0.06)\";\n\n  const stripHtmlForTitle = (html: string) => {\n    const tmp = document.createElement(\"DIV\");\n    tmp.innerHTML = html;\n    return tmp.textContent || tmp.innerText || \"Untitled\";\n  };\n\n  // LOD: DOT - Just a pulsing colored circle\n  if (lodLevel === 'dot') {\n    return (\n      <motion.div\n        drag={activeTool === 'SELECT'}\n        dragMomentum={false}\n        initial={{ x: note.position.x, y: note.position.y, opacity: 0, scale: 0 }}\n        animate={{\n          x: note.position.x + NOTE_WIDTH / 2 - 12,\n          y: note.position.y + 30,\n          opacity: 1,\n          scale: 1\n        }}\n        onDragEnd={(e, info) => {\n          onMove({ x: note.position.x + info.offset.x, y: note.position.y + info.offset.y });\n        }}\n        onClick={onClick}\n        whileHover={{ scale: 1.5 }}\n        transition={{ type: \"spring\", stiffness: 400, damping: 25 }}\n        className={`absolute w-6 h-6 rounded-full ${activeTool === 'CONNECT' ? 'cursor-crosshair' : 'cursor-pointer'}`}\n        style={{\n          backgroundColor: noteColor || (isDarkMode ? '#6b88ff' : '#3b5bdb'),\n          boxShadow: `0 0 12px ${noteColor || '#6b88ff'}60`\n        }}\n      >\n        <motion.div\n          className=\"absolute inset-0 rounded-full\"\n          style={{ backgroundColor: noteColor || (isDarkMode ? '#6b88ff' : '#3b5bdb') }}\n          animate={{ scale: [1, 1.3, 1], opacity: [0.6, 0, 0.6] }}\n          transition={{ duration: 2, repeat: Infinity, ease: \"easeInOut\" }}\n        />\n      </motion.div>\n    );\n  }\n\n  // LOD: MINIMAL - Small pill with just title\n  if (lodLevel === 'minimal') {\n    return (\n      <motion.div\n        drag={activeTool === 'SELECT'}\n        dragMomentum={false}\n        initial={{ x: note.position.x, y: note.position.y, opacity: 0, scale: 0.8 }}\n        animate={{\n          x: note.position.x,\n          y: note.position.y,\n          opacity: 1,\n          scale: isConnectionSource ? 1.05 : 1,\n          boxShadow\n        }}\n        onDragEnd={(e, info) => {\n          onMove({ x: note.position.x + info.offset.x, y: note.position.y + info.offset.y });\n        }}\n        onClick={onClick}\n        whileHover={{ scale: 1.08 }}\n        transition={{ type: \"spring\", stiffness: 400, damping: 25 }}\n        className={`group absolute ${activeTool === 'CONNECT' ? 'cursor-crosshair' : 'cursor-pointer'}`}\n        style={{\n          maxWidth: NOTE_WIDTH * 0.7,\n          backgroundColor: isDarkMode ? 'rgba(26,26,26,0.9)' : 'rgba(255,255,255,0.9)',\n          backdropFilter: 'blur(12px)',\n          WebkitBackdropFilter: 'blur(12px)',\n          borderRadius: '6px',\n          border: noteColor ? `2px solid ${noteColor}` : `1px solid ${isDarkMode ? 'rgba(255,255,255,0.15)' : 'rgba(0,0,0,0.1)'}`,\n          padding: '6px 10px'\n        }}\n      >\n        <div\n          className=\"font-bold text-[11px] truncate\"\n          style={{ color: noteColor || (isDarkMode ? '#fff' : '#000') }}\n        >\n          {stripHtmlForTitle(note.title)}\n        </div>\n      </motion.div>\n    );\n  }\n\n  // LOD: COMPACT - Medium card with title + short preview\n  if (lodLevel === 'compact') {\n    const shortPreview = previewText.slice(0, 80) + (previewText.length > 80 ? '...' : '');\n\n    return (\n      <motion.div\n        drag={activeTool === 'SELECT'}\n        dragMomentum={false}\n        initial={{ x: note.position.x, y: note.position.y, opacity: 0, scale: 0.8 }}\n        animate={{\n          x: note.position.x,\n          y: note.position.y,\n          opacity: 1,\n          rotate: isConnectionSource ? 0 : randomRotate * 0.5,\n          scale: isConnectionSource ? 1.05 : 1,\n          boxShadow\n        }}\n        onDragEnd={(e, info) => {\n          onMove({ x: note.position.x + info.offset.x, y: note.position.y + info.offset.y });\n        }}\n        onClick={onClick}\n        whileHover={{ scale: 1.05, rotate: 0 }}\n        transition={{ type: \"spring\", stiffness: 400, damping: 25 }}\n        className={`group absolute ${activeTool === 'CONNECT' ? 'cursor-crosshair' : 'cursor-pointer'}`}\n        style={{\n          width: NOTE_WIDTH * 0.85,\n          backgroundColor: isDarkMode ? 'rgba(26,26,26,0.8)' : 'rgba(255,255,255,0.85)',\n          backdropFilter: 'blur(14px)',\n          WebkitBackdropFilter: 'blur(14px)',\n          borderRadius: organicRadius,\n          border: noteColor ? `2px solid ${noteColor}` : `1px solid ${isDarkMode ? 'rgba(255,255,255,0.12)' : 'rgba(0,0,0,0.08)'}`,\n          padding: '10px 14px'\n        }}\n      >\n        <div className=\"flex items-center justify-between mb-1\">\n          <h3\n            className=\"font-bold text-xs truncate pr-2\"\n            style={{ color: noteColor || (isDarkMode ? '#fff' : '#000') }}\n          >\n            {stripHtmlForTitle(note.title)}\n          </h3>\n          <StickyNote size={12} className=\"text-gray-400 dark:text-neutral-600 flex-shrink-0\" style={{ color: noteColor || undefined }} />\n        </div>\n        {shortPreview && (\n          <p className=\"text-[10px] text-gray-500 dark:text-neutral-500 line-clamp-2 leading-relaxed\">\n            {shortPreview}\n          </p>\n        )}\n        {note.tags && note.tags.length > 0 && (\n          <div className=\"flex flex-wrap gap-1 mt-1.5\">\n            {note.tags.slice(0, 2).map(tag => {\n              const tagColor = getTagColor(tag);\n              return (\n                <span\n                  key={tag}\n                  className=\"text-[8px] font-bold px-1 py-0.5 rounded-sm\"\n                  style={{\n                    backgroundColor: `${tagColor}20`,\n                    color: tagColor,\n                  }}\n                >\n                  #{tag}\n                </span>\n              );\n            })}\n          </div>\n        )}\n      </motion.div>\n    );\n  }\n\n  // LOD: FULL - Complete card with glassmorphism\n  return (\n    <motion.div\n      drag={activeTool === 'SELECT'}\n      dragMomentum={false}\n      initial={{ x: note.position.x, y: note.position.y, opacity: 0, scale: 0.8 }}\n      animate={{\n        x: note.position.x,\n        y: note.position.y,\n        opacity: 1,\n        rotate: isConnectionSource ? 0 : randomRotate,\n        scale: isConnectionSource ? 1.05 : 1,\n        boxShadow,\n        borderColor: noteColor || (isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)')\n      }}\n      onDragEnd={(e, info) => {\n        onMove({ x: note.position.x + info.offset.x, y: note.position.y + info.offset.y });\n      }}\n      onClick={onClick}\n      whileHover={{\n        scale: 1.03,\n        rotate: 0,\n        boxShadow: \"4px 8px 16px rgba(0,0,0,0.12)\",\n        zIndex: 10\n      }}\n      transition={{ type: \"spring\", stiffness: 400, damping: 25 }}\n      className={`group absolute flex flex-col gap-2 ${activeTool === 'CONNECT' ? 'cursor-crosshair' : 'cursor-pointer'}`}\n      style={{\n        width: NOTE_WIDTH,\n        backgroundColor: isDarkMode ? 'rgba(26,26,26,0.75)' : 'rgba(255,255,255,0.8)',\n        backdropFilter: 'blur(16px)',\n        WebkitBackdropFilter: 'blur(16px)',\n        color: isDarkMode ? '#eee' : '#000',\n        borderRadius: organicRadius,\n        border: noteColor ? `2px solid ${noteColor}` : `1px solid ${isDarkMode ? 'rgba(255,255,255,0.12)' : 'rgba(0,0,0,0.08)'}`\n      }}\n    >\n      {activeTool === 'SELECT' && (\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            onDelete();\n          }}\n          className=\"absolute -top-2 -right-2 bg-white/90 dark:bg-neutral-800/90 backdrop-blur-sm border border-black/10 dark:border-neutral-600 rounded-full p-1 opacity-0 group-hover:opacity-100 transition-all duration-200 hover:bg-red-50 dark:hover:bg-red-900/30 hover:scale-110 z-10 shadow-sm text-black dark:text-white\"\n          title=\"Delete Note\"\n        >\n          <X size={12} />\n        </button>\n      )}\n\n      {/* Note Content Container */}\n      <div className=\"p-4 flex flex-col gap-2 pt-2\">\n        <div className=\"flex items-center justify-between border-b border-gray-100/30 dark:border-neutral-800/50 pb-2\">\n          <h3\n            className=\"font-bold text-sm truncate pr-4 text-black/90 dark:text-white/90\"\n            dangerouslySetInnerHTML={{ __html: note.title || \"Untitled\" }}\n          />\n          <StickyNote size={14} className=\"text-gray-400 dark:text-neutral-600 flex-shrink-0\" style={{ color: noteColor || undefined }} />\n        </div>\n        <p className=\"text-xs text-gray-600 dark:text-neutral-400 line-clamp-5 leading-relaxed min-h-[1.5em] font-medium\">\n          {previewText || (linkData ? \"\" : \"No content.\")}\n        </p>\n\n        {/* Tags */}\n        {note.tags && note.tags.length > 0 && (\n          <div className=\"flex flex-wrap gap-1 mt-1\">\n            {note.tags.slice(0, 3).map(tag => {\n              const tagColor = getTagColor(tag);\n              return (\n                <span\n                  key={tag}\n                  className=\"text-[10px] font-bold px-1.5 py-0.5 rounded-sm\"\n                  style={{\n                    backgroundColor: `${tagColor}20`,\n                    color: tagColor,\n                    border: `1px solid ${tagColor}40`\n                  }}\n                >\n                  #{tag}\n                </span>\n              );\n            })}\n            {note.tags.length > 3 && (\n              <span className=\"text-[10px] font-bold text-gray-400 dark:text-neutral-600\">+{note.tags.length - 3}</span>\n            )}\n          </div>\n        )}\n\n        {linkData && (\n          <div className=\"mt-2 flex items-center gap-2 bg-black/5 dark:bg-white/5 p-2 rounded border border-black/5 dark:border-white/5 hover:bg-black/10 dark:hover:bg-white/10 transition-colors\">\n            <img\n              src={`https://www.google.com/s2/favicons?domain=${linkData.hostname}&sz=32`}\n              alt=\"favicon\"\n              className=\"w-4 h-4 rounded-sm\"\n              onError={(e) => {\n                (e.target as HTMLImageElement).style.display = 'none';\n              }}\n            />\n            <span className=\"text-[10px] font-medium text-gray-700 dark:text-gray-300 truncate flex-1\">\n              {linkData.hostname}\n            </span>\n            <ExternalLink size={10} className=\"text-gray-500 dark:text-gray-400\" />\n          </div>\n        )}\n      </div>\n\n      {isConnectionSource && (\n        <motion.div\n          initial={{ opacity: 0, y: 5 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"absolute -bottom-8 left-1/2 -translate-x-1/2 text-[10px] font-bold bg-black dark:bg-white text-white dark:text-black px-2 py-0.5 rounded shadow-sm whitespace-nowrap\"\n          style={{ backgroundColor: noteColor || undefined }}\n        >\n          SOURCE SELECTED\n        </motion.div>\n      )}\n    </motion.div>\n  );\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7691, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/graph/GraphView.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback, useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { Note, GraphNode, GraphLink } from '../../types';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { Trash2 } from 'lucide-react';\n\ninterface GraphViewProps {\n  notes: Note[];\n  onNoteSelect: (noteId: string) => void;\n  onDeleteNote: (noteId: string) => void;\n  isDarkMode: boolean;\n}\n\ninterface ContextMenuState {\n  x: number;\n  y: number;\n  nodeId: string;\n}\n\ninterface ClusterCenter {\n  x: number;\n  y: number;\n  tag: string;\n  color: string;\n  nodeCount: number;\n}\n\ninterface EnhancedGraphNode extends GraphNode {\n  z: number;\n  breathPhase: number;\n  clusterId: string;\n  clusterX?: number;\n  clusterY?: number;\n  tags?: string[];\n  vx?: number;\n  vy?: number;\n  fx?: number | null;\n  fy?: number | null;\n}\n\n// Cluster colors palette\nconst CLUSTER_COLORS = [\n  '#ef4444', '#f97316', '#eab308', '#22c55e', '#06b6d4',\n  '#3b82f6', '#8b5cf6', '#ec4899', '#14b8a6', '#f43f5e'\n];\n\nexport const GraphView: React.FC<GraphViewProps> = ({ notes, onNoteSelect, onDeleteNote, isDarkMode }) => {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const animationRef = useRef<number | null>(null);\n  const simulationRef = useRef<d3.Simulation<EnhancedGraphNode, GraphLink> | null>(null);\n\n  const [contextMenu, setContextMenu] = useState<ContextMenuState | null>(null);\n  const [hoveredNodeId, setHoveredNodeId] = useState<string | null>(null);\n  const [hoveredCluster, setHoveredCluster] = useState<string | null>(null);\n\n  const stripHtml = (html: string) => {\n    const tmp = document.createElement(\"DIV\");\n    tmp.innerHTML = html;\n    return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  // Extract unique tags and create cluster mapping\n  const clusterData = useMemo(() => {\n    const tagMap = new Map<string, string[]>(); // tag -> noteIds\n\n    // Helper to clean tag text\n    const cleanTag = (tag: string): string => {\n      const tmp = document.createElement(\"DIV\");\n      tmp.innerHTML = tag;\n      return (tmp.textContent || tmp.innerText || tag).trim();\n    };\n\n    notes.forEach(note => {\n      if (note.tags && note.tags.length > 0) {\n        // Use first tag as primary cluster (cleaned)\n        const primaryTag = cleanTag(note.tags[0]);\n        if (primaryTag && !tagMap.has(primaryTag)) {\n          tagMap.set(primaryTag, []);\n        }\n        if (primaryTag) {\n          tagMap.get(primaryTag)!.push(note.id);\n        }\n      }\n    });\n\n    // Create cluster array with positions\n    const clusters: ClusterCenter[] = [];\n    const tagArray = Array.from(tagMap.keys());\n    const angleStep = (2 * Math.PI) / Math.max(tagArray.length, 1);\n\n    tagArray.forEach((tag, i) => {\n      clusters.push({\n        tag,\n        x: 0, // Will be set based on SVG dimensions\n        y: 0,\n        color: CLUSTER_COLORS[i % CLUSTER_COLORS.length],\n        nodeCount: tagMap.get(tag)!.length\n      });\n    });\n\n    return { tagMap, clusters };\n  }, [notes]);\n\n  // Get connected node IDs for hover effect\n  const getConnectedNodes = useCallback((nodeId: string): Set<string> => {\n    const connected = new Set<string>();\n    connected.add(nodeId);\n\n    notes.forEach(note => {\n      if (note.id === nodeId) {\n        note.connections.forEach(id => connected.add(id));\n      }\n      if (note.connections.includes(nodeId)) {\n        connected.add(note.id);\n      }\n    });\n\n    return connected;\n  }, [notes]);\n\n  useEffect(() => {\n    const handleClickOutside = () => setContextMenu(null);\n    window.addEventListener('click', handleClickOutside);\n    return () => window.removeEventListener('click', handleClickOutside);\n  }, []);\n\n  // Breathing animation loop\n  useEffect(() => {\n    let startTime = performance.now();\n\n    const animate = (currentTime: number) => {\n      animationRef.current = requestAnimationFrame(animate);\n    };\n\n    animationRef.current = requestAnimationFrame(animate);\n\n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!svgRef.current) return;\n\n    const width = svgRef.current.clientWidth;\n    const height = svgRef.current.clientHeight;\n    const centerX = width / 2;\n    const centerY = height / 2;\n\n    // Neural color palette\n    const bgColor = isDarkMode ? \"#050508\" : \"#fafafa\";\n\n    // Calculate cluster positions in a circle\n    const clusterRadius = Math.min(width, height) * 0.3;\n    const { clusters, tagMap } = clusterData;\n\n    clusters.forEach((cluster, i) => {\n      const angle = (i / clusters.length) * 2 * Math.PI - Math.PI / 2;\n      cluster.x = centerX + Math.cos(angle) * clusterRadius;\n      cluster.y = centerY + Math.sin(angle) * clusterRadius;\n    });\n\n    // Create cluster lookup\n    const clusterLookup = new Map<string, ClusterCenter>();\n    clusters.forEach(c => clusterLookup.set(c.tag, c));\n\n    // Helper to clean tag text\n    const cleanTag = (tag: string): string => {\n      const tmp = document.createElement(\"DIV\");\n      tmp.innerHTML = tag;\n      return (tmp.textContent || tmp.innerText || tag).trim();\n    };\n\n    // Transform notes to enhanced graph nodes\n    const nodes: EnhancedGraphNode[] = notes.map((n, i) => {\n      const rawTag = n.tags?.[0];\n      const primaryTag = rawTag ? cleanTag(rawTag) : 'uncategorized';\n      const cluster = clusterLookup.get(primaryTag);\n\n      return {\n        id: n.id,\n        title: n.title,\n        group: 1,\n        x: cluster ? cluster.x + (Math.random() - 0.5) * 80 : centerX + (Math.random() - 0.5) * 200,\n        y: cluster ? cluster.y + (Math.random() - 0.5) * 80 : centerY + (Math.random() - 0.5) * 200,\n        z: 0.3 + Math.random() * 0.7,\n        breathPhase: Math.random() * Math.PI * 2,\n        clusterId: primaryTag,\n        clusterX: cluster?.x || centerX,\n        clusterY: cluster?.y || centerY,\n        tags: n.tags,\n        color: n.color || cluster?.color\n      };\n    });\n\n    const links: GraphLink[] = [];\n    notes.forEach(source => {\n      source.connections.forEach(targetId => {\n        if (notes.find(n => n.id === targetId)) {\n          links.push({ source: source.id, target: targetId });\n        }\n      });\n    });\n\n    // Clear previous\n    d3.select(svgRef.current).selectAll(\"*\").remove();\n\n    const svg = d3.select(svgRef.current)\n      .attr(\"viewBox\", [0, 0, width, height])\n      .style(\"background\", `radial-gradient(ellipse at center, ${isDarkMode ? '#0a0a15' : '#f5f5ff'} 0%, ${bgColor} 100%)`);\n\n    // Defs for filters\n    const defs = svg.append(\"defs\");\n\n    // Glow filter for nodes\n    const glowFilter = defs.append(\"filter\")\n      .attr(\"id\", \"neural-glow\")\n      .attr(\"x\", \"-100%\")\n      .attr(\"y\", \"-100%\")\n      .attr(\"width\", \"300%\")\n      .attr(\"height\", \"300%\");\n\n    glowFilter.append(\"feGaussianBlur\")\n      .attr(\"stdDeviation\", \"4\")\n      .attr(\"result\", \"blur\");\n\n    glowFilter.append(\"feMerge\")\n      .selectAll(\"feMergeNode\")\n      .data([\"blur\", \"SourceGraphic\"])\n      .join(\"feMergeNode\")\n      .attr(\"in\", d => d);\n\n    // Cluster glow filter\n    const clusterFilter = defs.append(\"filter\")\n      .attr(\"id\", \"cluster-glow\")\n      .attr(\"x\", \"-50%\")\n      .attr(\"y\", \"-50%\")\n      .attr(\"width\", \"200%\")\n      .attr(\"height\", \"200%\");\n\n    clusterFilter.append(\"feGaussianBlur\")\n      .attr(\"stdDeviation\", \"20\")\n      .attr(\"result\", \"blur\");\n\n    // Synapse glow filter\n    const synapseFilter = defs.append(\"filter\")\n      .attr(\"id\", \"synapse-glow\")\n      .attr(\"x\", \"-50%\")\n      .attr(\"y\", \"-50%\")\n      .attr(\"width\", \"200%\")\n      .attr(\"height\", \"200%\");\n\n    synapseFilter.append(\"feGaussianBlur\")\n      .attr(\"stdDeviation\", \"2\")\n      .attr(\"result\", \"blur\");\n\n    synapseFilter.append(\"feMerge\")\n      .selectAll(\"feMergeNode\")\n      .data([\"blur\", \"SourceGraphic\"])\n      .join(\"feMergeNode\")\n      .attr(\"in\", d => d);\n\n    // Custom cluster force\n    const forceCluster = () => {\n      const strength = 0.15;\n\n      return (alpha: number) => {\n        nodes.forEach(node => {\n          if (node.clusterX !== undefined && node.clusterY !== undefined) {\n            node.vx = (node.vx || 0) + (node.clusterX - (node.x || 0)) * strength * alpha;\n            node.vy = (node.vy || 0) + (node.clusterY - (node.y || 0)) * strength * alpha;\n          }\n        });\n      };\n    };\n\n    // Simulation with organic physics + clustering\n    const simulation = d3.forceSimulation(nodes)\n      .force(\"link\", d3.forceLink(links).id((d: any) => d.id).distance(80).strength(0.4))\n      .force(\"charge\", d3.forceManyBody().strength(-150))\n      .force(\"center\", d3.forceCenter(centerX, centerY).strength(0.05))\n      .force(\"collide\", d3.forceCollide().radius(35))\n      .force(\"cluster\", forceCluster())\n      .velocityDecay(0.5)\n      .alphaDecay(0.015);\n\n    simulationRef.current = simulation;\n\n    // Draw cluster backgrounds first\n    const clusterGroup = svg.append(\"g\").attr(\"class\", \"clusters\");\n\n    clusters.forEach(cluster => {\n      // Cluster area glow\n      clusterGroup.append(\"circle\")\n        .attr(\"class\", \"cluster-bg\")\n        .attr(\"cx\", cluster.x)\n        .attr(\"cy\", cluster.y)\n        .attr(\"r\", 60 + cluster.nodeCount * 15)\n        .attr(\"fill\", cluster.color)\n        .attr(\"opacity\", 0.08)\n        .attr(\"filter\", \"url(#cluster-glow)\");\n\n      // Cluster label\n      clusterGroup.append(\"text\")\n        .attr(\"class\", \"cluster-label\")\n        .attr(\"x\", cluster.x)\n        .attr(\"y\", cluster.y - 70 - cluster.nodeCount * 10)\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"fill\", cluster.color)\n        .attr(\"opacity\", 0.6)\n        .style(\"font-family\", \"'Inter', sans-serif\")\n        .style(\"font-size\", \"11px\")\n        .style(\"font-weight\", \"700\")\n        .style(\"text-transform\", \"uppercase\")\n        .style(\"letter-spacing\", \"0.1em\")\n        .text(`#${cluster.tag}`);\n    });\n\n    // Connection lines group\n    const linksGroup = svg.append(\"g\").attr(\"class\", \"links\");\n\n    // Draw synapse lines\n    const link = linksGroup.selectAll(\"g\")\n      .data(links)\n      .join(\"g\")\n      .attr(\"class\", \"synapse\");\n\n    // Main connection line\n    const linkPath = link.append(\"line\")\n      .attr(\"stroke\", isDarkMode ? \"rgba(100, 150, 255, 0.4)\" : \"rgba(80, 120, 200, 0.3)\")\n      .attr(\"stroke-width\", 2)\n      .attr(\"filter\", \"url(#synapse-glow)\");\n\n    // Animated particles on connections\n    link.each(function () {\n      const g = d3.select(this);\n\n      g.append(\"line\")\n        .attr(\"class\", \"synapse-pulse\")\n        .attr(\"stroke\", isDarkMode ? \"rgba(150, 200, 255, 0.6)\" : \"rgba(100, 150, 255, 0.5)\")\n        .attr(\"stroke-width\", 1.5)\n        .attr(\"stroke-dasharray\", \"4,8\")\n        .style(\"animation\", `synapseFlow ${2 + Math.random()}s linear infinite`)\n        .style(\"animation-delay\", `${-Math.random() * 2}s`);\n    });\n\n    // Nodes group\n    const nodesGroup = svg.append(\"g\").attr(\"class\", \"nodes\");\n\n    // Draw nodes\n    const node = nodesGroup.selectAll(\"g\")\n      .data(nodes.sort((a, b) => a.z - b.z))\n      .join(\"g\")\n      .attr(\"cursor\", \"pointer\")\n      .attr(\"class\", \"neural-node\")\n      .call(d3.drag<SVGGElement, EnhancedGraphNode>()\n        .on(\"start\", dragstarted)\n        .on(\"drag\", dragged)\n        .on(\"end\", dragended) as any)\n      .on(\"click\", (event, d) => {\n        event.stopPropagation();\n        onNoteSelect(d.id);\n      })\n      .on(\"contextmenu\", (event, d) => {\n        event.preventDefault();\n        event.stopPropagation();\n        setContextMenu({\n          x: event.pageX,\n          y: event.pageY,\n          nodeId: d.id\n        });\n      })\n      .on(\"mouseenter\", (event, d) => {\n        setHoveredNodeId(d.id);\n        setHoveredCluster(d.clusterId);\n      })\n      .on(\"mouseleave\", () => {\n        setHoveredNodeId(null);\n        setHoveredCluster(null);\n      });\n\n    // Outer glow circle (breathing)\n    node.append(\"circle\")\n      .attr(\"class\", \"node-glow\")\n      .attr(\"r\", 20)\n      .attr(\"fill\", d => {\n        const clusterColor = clusterLookup.get(d.clusterId)?.color;\n        return d.color && d.color !== '#000000' ? d.color : (clusterColor || (isDarkMode ? '#6088ff' : '#4070e0'));\n      })\n      .attr(\"opacity\", 0.2)\n      .attr(\"filter\", \"url(#neural-glow)\");\n\n    // Main node circle\n    node.append(\"circle\")\n      .attr(\"class\", \"node-core\")\n      .attr(\"r\", d => 8 + d.z * 4)\n      .attr(\"fill\", d => {\n        const clusterColor = clusterLookup.get(d.clusterId)?.color;\n        return d.color && d.color !== '#000000' ? d.color : (clusterColor || (isDarkMode ? '#90b0ff' : '#4080e0'));\n      })\n      .attr(\"stroke\", isDarkMode ? \"rgba(255,255,255,0.3)\" : \"rgba(0,0,0,0.1)\")\n      .attr(\"stroke-width\", 1.5);\n\n    // Inner highlight\n    node.append(\"circle\")\n      .attr(\"class\", \"node-highlight\")\n      .attr(\"r\", d => 3 + d.z * 2)\n      .attr(\"cx\", -2)\n      .attr(\"cy\", -2)\n      .attr(\"fill\", \"rgba(255,255,255,0.4)\");\n\n    // Labels\n    node.append(\"text\")\n      .attr(\"x\", d => 12 + d.z * 4)\n      .attr(\"y\", 4)\n      .text(d => stripHtml(d.title || \"Untitled\"))\n      .style(\"font-family\", \"'Inter', sans-serif\")\n      .style(\"font-size\", d => `${10 + d.z * 3}px`)\n      .style(\"font-weight\", \"600\")\n      .style(\"letter-spacing\", \"0.02em\")\n      .attr(\"fill\", isDarkMode ? \"rgba(255,255,255,0.9)\" : \"rgba(0,0,0,0.85)\")\n      .style(\"filter\", d => `blur(${(1 - d.z) * 0.5}px)`)\n      .clone(true).lower()\n      .attr(\"fill\", \"none\")\n      .attr(\"stroke\", isDarkMode ? \"rgba(0,0,0,0.8)\" : \"rgba(255,255,255,0.9)\")\n      .attr(\"stroke-width\", 3)\n      .style(\"filter\", \"none\");\n\n    // Tick function with breathing animation\n    simulation.on(\"tick\", () => {\n      const t = performance.now() / 1000;\n\n      // Update links\n      linkPath\n        .attr(\"x1\", (d: any) => d.source.x)\n        .attr(\"y1\", (d: any) => d.source.y)\n        .attr(\"x2\", (d: any) => d.target.x)\n        .attr(\"y2\", (d: any) => d.target.y);\n\n      link.selectAll(\".synapse-pulse\")\n        .attr(\"x1\", (d: any) => d.source.x)\n        .attr(\"y1\", (d: any) => d.source.y)\n        .attr(\"x2\", (d: any) => d.target.x)\n        .attr(\"y2\", (d: any) => d.target.y);\n\n      // Update nodes with breathing effect\n      node.attr(\"transform\", (d: any) => {\n        const breathScale = 1 + Math.sin(t * 1.5 + d.breathPhase) * 0.08;\n        return `translate(${d.x},${d.y}) scale(${breathScale})`;\n      });\n\n      // Update glow intensity\n      node.selectAll(\".node-glow\")\n        .attr(\"opacity\", (d: any) => 0.15 + Math.sin(t * 1.5 + d.breathPhase) * 0.1);\n    });\n\n    function dragstarted(event: any, d: any) {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(event: any, d: any) {\n      d.fx = event.x;\n      d.fy = event.y;\n    }\n\n    function dragended(event: any, d: any) {\n      if (!event.active) simulation.alphaTarget(0.01);\n      d.fx = null;\n      d.fy = null;\n    }\n\n    return () => {\n      simulation.stop();\n    };\n  }, [notes, onNoteSelect, isDarkMode, clusterData]);\n\n  // Apply hover focus effect\n  useEffect(() => {\n    if (!svgRef.current) return;\n\n    const svg = d3.select(svgRef.current);\n    const connectedNodes = hoveredNodeId ? getConnectedNodes(hoveredNodeId) : null;\n\n    // Update node opacity based on focus\n    svg.selectAll(\".neural-node\")\n      .transition()\n      .duration(200)\n      .style(\"opacity\", (d: any) => {\n        if (!hoveredNodeId) return 1;\n        return connectedNodes?.has(d.id) ? 1 : 0.15;\n      });\n\n    // Update link opacity\n    svg.selectAll(\".synapse\")\n      .transition()\n      .duration(200)\n      .style(\"opacity\", (d: any) => {\n        if (!hoveredNodeId) return 1;\n        const sourceId = typeof d.source === 'object' ? d.source.id : d.source;\n        const targetId = typeof d.target === 'object' ? d.target.id : d.target;\n        return (sourceId === hoveredNodeId || targetId === hoveredNodeId) ? 1 : 0.1;\n      });\n\n    // Highlight cluster on hover\n    svg.selectAll(\".cluster-bg\")\n      .transition()\n      .duration(300)\n      .attr(\"opacity\", function (this: any) {\n        if (!hoveredCluster) return 0.08;\n        const circle = d3.select(this);\n        // Check if this cluster matches by comparing position\n        return 0.15;\n      });\n\n  }, [hoveredNodeId, hoveredCluster, getConnectedNodes]);\n\n  return (\n    <div ref={containerRef} className=\"w-full h-full relative overflow-hidden\">\n      {/* CSS for synapse animation */}\n      <style>{`\n        @keyframes synapseFlow {\n          from { stroke-dashoffset: 24; }\n          to { stroke-dashoffset: 0; }\n        }\n        \n        .neural-node {\n          transition: filter 0.3s ease;\n        }\n        \n        .neural-node:hover .node-core {\n          filter: brightness(1.3) drop-shadow(0 0 8px currentColor);\n        }\n        \n        .synapse-pulse {\n          pointer-events: none;\n        }\n        \n        .cluster-label {\n          pointer-events: none;\n          user-select: none;\n        }\n      `}</style>\n\n      <svg ref={svgRef} className=\"w-full h-full block\" />\n\n      {/* Legend */}\n      <motion.div\n        initial={{ opacity: 0, x: -20 }}\n        animate={{ opacity: 1, x: 0 }}\n        className=\"absolute top-24 left-28 bg-white/80 dark:bg-black/80 backdrop-blur-xl rounded-xl p-4 shadow-xl border border-gray-200/50 dark:border-neutral-700/50 max-w-[180px]\"\n      >\n        <h3 className=\"text-[10px] font-bold uppercase tracking-widest text-gray-500 dark:text-neutral-400 mb-3\">Clusters</h3>\n        <div className=\"flex flex-col gap-2\">\n          {clusterData.clusters.map(cluster => (\n            <div key={cluster.tag} className=\"flex items-center gap-2\">\n              <div\n                className=\"w-3 h-3 rounded-full\"\n                style={{ backgroundColor: cluster.color }}\n              />\n              <span className=\"text-xs font-medium text-gray-700 dark:text-neutral-300\">\n                #{cluster.tag}\n              </span>\n              <span className=\"text-[10px] text-gray-400 dark:text-neutral-500\">\n                ({cluster.nodeCount})\n              </span>\n            </div>\n          ))}\n          {clusterData.clusters.length === 0 && (\n            <span className=\"text-xs text-gray-400 dark:text-neutral-500 italic\">\n              No tags yet\n            </span>\n          )}\n        </div>\n      </motion.div>\n\n      {/* Label */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"absolute bottom-8 right-8 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-5 py-2.5 shadow-xl rounded-lg text-xs font-bold tracking-widest pointer-events-none uppercase\"\n      >\n        Neural Graph\n      </motion.div>\n\n      {/* Context Menu */}\n      <AnimatePresence>\n        {contextMenu && (\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9, y: -10 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.9 }}\n            style={{ top: contextMenu.y, left: contextMenu.x }}\n            className=\"fixed z-50 bg-white/95 dark:bg-neutral-900/95 backdrop-blur-xl border border-gray-200 dark:border-neutral-700 shadow-2xl rounded-xl p-1 min-w-[140px]\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <button\n              onClick={() => {\n                onDeleteNote(contextMenu.nodeId);\n                setContextMenu(null);\n              }}\n              className=\"w-full flex items-center gap-2 px-3 py-2.5 text-xs font-semibold text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors rounded-lg\"\n            >\n              <Trash2 size={14} />\n              Delete Note\n            </button>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8362, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/ui/UnsavedChangesModal.tsx"],"sourcesContent":["import React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { AlertTriangle, Save, X, Trash2 } from 'lucide-react';\r\n\r\ninterface UnsavedChangesModalProps {\r\n    isOpen: boolean;\r\n    onSaveAndLeave: () => void;\r\n    onDiscardAndLeave: () => void;\r\n    onCancel: () => void;\r\n}\r\n\r\nexport const UnsavedChangesModal: React.FC<UnsavedChangesModalProps> = ({\r\n    isOpen,\r\n    onSaveAndLeave,\r\n    onDiscardAndLeave,\r\n    onCancel\r\n}) => {\r\n    return (\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <>\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"fixed inset-0 bg-white/90 dark:bg-black/90 backdrop-blur-sm z-[100]\"\r\n                        onClick={onCancel}\r\n                    />\r\n                    <motion.div\r\n                        initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                        animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                        exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                        className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white dark:bg-neutral-900 border-2 border-black dark:border-neutral-600 p-8 z-[101] shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] dark:shadow-[8px_8px_0px_0px_rgba(255,255,255,0.1)]\"\r\n                    >\r\n                        <div className=\"flex justify-between items-start mb-6\">\r\n                            <div className=\"flex items-center gap-3 text-black dark:text-white\">\r\n                                <AlertTriangle size={24} strokeWidth={2} className=\"text-yellow-500\" />\r\n                                <h2 className=\"text-xl font-black uppercase tracking-wide\">Unsaved Changes</h2>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <p className=\"text-gray-600 dark:text-neutral-400 font-medium mb-10 leading-relaxed\">\r\n                            You have unsaved changes in this note. If you leave now, your changes will be lost.\r\n                        </p>\r\n\r\n                        <div className=\"flex flex-col gap-3\">\r\n                            <button\r\n                                onClick={onSaveAndLeave}\r\n                                className=\"w-full py-3 bg-black dark:bg-white text-white dark:text-black font-bold border-2 border-black dark:border-white hover:bg-gray-900 dark:hover:bg-gray-200 transition-colors text-sm uppercase tracking-wider flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Save size={16} />\r\n                                Save & Leave\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={onDiscardAndLeave}\r\n                                className=\"w-full py-3 border-2 border-red-500 text-red-600 dark:text-red-400 font-bold hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-sm uppercase tracking-wider flex items-center justify-center gap-2\"\r\n                            >\r\n                                <Trash2 size={16} />\r\n                                Discard Changes\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={onCancel}\r\n                                className=\"w-full py-3 text-gray-500 dark:text-neutral-500 font-bold hover:text-black dark:hover:text-white transition-colors text-sm uppercase tracking-wider flex items-center justify-center gap-2\"\r\n                            >\r\n                                <X size={16} />\r\n                                Cancel\r\n                            </button>\r\n                        </div>\r\n                    </motion.div>\r\n                </>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;AAAA;AACA;AAAA;AAAA;AAAA;;;;AASO,MAAM,sBAA0D,CAAC,EACpE,MAAM,EACN,cAAc,EACd,iBAAiB,EACjB,QAAQ,EACX;IACG,qBACI,6LAAC,+MAAe;kBACX,wBACG;;8BACI,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,SAAS;oBAAE;oBACtB,SAAS;wBAAE,SAAS;oBAAE;oBACtB,MAAM;wBAAE,SAAS;oBAAE;oBACnB,WAAU;oBACV,SAAS;;;;;;8BAEb,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBAC1C,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAG,GAAG;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBACvC,WAAU;;sCAEV,6LAAC;4BAAI,WAAU;sCACX,cAAA,6LAAC;gCAAI,WAAU;;kDACX,6LAAC,4OAAa;wCAAC,MAAM;wCAAI,aAAa;wCAAG,WAAU;;;;;;kDACnD,6LAAC;wCAAG,WAAU;kDAA6C;;;;;;;;;;;;;;;;;sCAInE,6LAAC;4BAAE,WAAU;sCAAwE;;;;;;sCAIrF,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCACG,SAAS;oCACT,WAAU;;sDAEV,6LAAC,6MAAI;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAItB,6LAAC;oCACG,SAAS;oCACT,WAAU;;sDAEV,6LAAC,uNAAM;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAIxB,6LAAC;oCACG,SAAS;oCACT,WAAU;;sDAEV,6LAAC,oMAAC;4CAAC,MAAM;;;;;;wCAAM;;;;;;;;;;;;;;;;;;;;;;;;;;AAS/C;KAhEa"}},
    {"offset": {"line": 8543, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/hooks/useHistory.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\n\nexport type HistoryMode = 'PUSH' | 'REPLACE';\n\ninterface HistoryState<T> {\n  past: T[];\n  present: T;\n  future: T[];\n}\n\nexport function useHistory<T>(initialPresent: T) {\n  const [state, setState] = useState<HistoryState<T>>({\n    past: [],\n    present: initialPresent,\n    future: [],\n  });\n\n  const canUndo = state.past.length > 0;\n  const canRedo = state.future.length > 0;\n\n  const undo = useCallback(() => {\n    setState((currentState) => {\n      if (currentState.past.length === 0) return currentState;\n\n      const previous = currentState.past[currentState.past.length - 1];\n      const newPast = currentState.past.slice(0, currentState.past.length - 1);\n\n      return {\n        past: newPast,\n        present: previous,\n        future: [currentState.present, ...currentState.future],\n      };\n    });\n  }, []);\n\n  const redo = useCallback(() => {\n    setState((currentState) => {\n      if (currentState.future.length === 0) return currentState;\n\n      const next = currentState.future[0];\n      const newFuture = currentState.future.slice(1);\n\n      return {\n        past: [...currentState.past, currentState.present],\n        present: next,\n        future: newFuture,\n      };\n    });\n  }, []);\n\n  const set = useCallback((newPresent: T, mode: HistoryMode = 'PUSH') => {\n    setState((currentState) => {\n      // Prevent pushing if state hasn't effectively changed, though strict equality might not be enough for objects\n      // We assume caller handles significant changes\n      if (mode === 'REPLACE') {\n        return { ...currentState, present: newPresent };\n      }\n      return {\n        past: [...currentState.past, currentState.present],\n        present: newPresent,\n        future: [],\n      };\n    });\n  }, []);\n\n  return { \n    state: state.present, \n    set, \n    undo, \n    redo, \n    canUndo, \n    canRedo \n  };\n}"],"names":[],"mappings":";;;;AAAA;;;AAUO,SAAS,WAAc,cAAiB;;IAC7C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAkB;QAClD,MAAM,EAAE;QACR,SAAS;QACT,QAAQ,EAAE;IACZ;IAEA,MAAM,UAAU,MAAM,IAAI,CAAC,MAAM,GAAG;IACpC,MAAM,UAAU,MAAM,MAAM,CAAC,MAAM,GAAG;IAEtC,MAAM,OAAO,IAAA,4KAAW;wCAAC;YACvB;gDAAS,CAAC;oBACR,IAAI,aAAa,IAAI,CAAC,MAAM,KAAK,GAAG,OAAO;oBAE3C,MAAM,WAAW,aAAa,IAAI,CAAC,aAAa,IAAI,CAAC,MAAM,GAAG,EAAE;oBAChE,MAAM,UAAU,aAAa,IAAI,CAAC,KAAK,CAAC,GAAG,aAAa,IAAI,CAAC,MAAM,GAAG;oBAEtE,OAAO;wBACL,MAAM;wBACN,SAAS;wBACT,QAAQ;4BAAC,aAAa,OAAO;+BAAK,aAAa,MAAM;yBAAC;oBACxD;gBACF;;QACF;uCAAG,EAAE;IAEL,MAAM,OAAO,IAAA,4KAAW;wCAAC;YACvB;gDAAS,CAAC;oBACR,IAAI,aAAa,MAAM,CAAC,MAAM,KAAK,GAAG,OAAO;oBAE7C,MAAM,OAAO,aAAa,MAAM,CAAC,EAAE;oBACnC,MAAM,YAAY,aAAa,MAAM,CAAC,KAAK,CAAC;oBAE5C,OAAO;wBACL,MAAM;+BAAI,aAAa,IAAI;4BAAE,aAAa,OAAO;yBAAC;wBAClD,SAAS;wBACT,QAAQ;oBACV;gBACF;;QACF;uCAAG,EAAE;IAEL,MAAM,MAAM,IAAA,4KAAW;uCAAC,CAAC,YAAe,OAAoB,MAAM;YAChE;+CAAS,CAAC;oBACR,8GAA8G;oBAC9G,+CAA+C;oBAC/C,IAAI,SAAS,WAAW;wBACtB,OAAO;4BAAE,GAAG,YAAY;4BAAE,SAAS;wBAAW;oBAChD;oBACA,OAAO;wBACL,MAAM;+BAAI,aAAa,IAAI;4BAAE,aAAa,OAAO;yBAAC;wBAClD,SAAS;wBACT,QAAQ,EAAE;oBACZ;gBACF;;QACF;sCAAG,EAAE;IAEL,OAAO;QACL,OAAO,MAAM,OAAO;QACpB;QACA;QACA;QACA;QACA;IACF;AACF;GA/DgB"}},
    {"offset": {"line": 8638, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/ui/SearchPalette.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Search, FileText, CornerDownLeft, X } from 'lucide-react';\nimport { Note } from '../../types';\n\ninterface SearchPaletteProps {\n  isOpen: boolean;\n  onClose: () => void;\n  notes: Note[];\n  onSelectNote: (noteId: string) => void;\n}\n\nexport const SearchPalette: React.FC<SearchPaletteProps> = ({\n  isOpen,\n  onClose,\n  notes,\n  onSelectNote\n}) => {\n  const [query, setQuery] = useState('');\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      setTimeout(() => inputRef.current?.focus(), 100);\n      setQuery('');\n      setSelectedIndex(0);\n    }\n  }, [isOpen]);\n\n  // Filtering Logic\n  const filteredNotes = notes.filter(note => {\n    if (!query) return true;\n    const lowerQuery = query.toLowerCase();\n    // Naive stripping for search comparison\n    const cleanTitle = (note.title || \"\").replace(/<[^>]*>?/gm, '').toLowerCase();\n    const tagsMatch = note.tags?.some(t => t.toLowerCase().includes(lowerQuery));\n    \n    return (\n      cleanTitle.includes(lowerQuery) ||\n      tagsMatch ||\n      note.blocks.some(b => b.content.toLowerCase().includes(lowerQuery))\n    );\n  }).slice(0, 5); // Limit to 5 results for clean UI\n\n  // Keyboard Navigation\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (!isOpen) return;\n\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSelectedIndex(prev => (prev + 1) % filteredNotes.length);\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSelectedIndex(prev => (prev - 1 + filteredNotes.length) % filteredNotes.length);\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        if (filteredNotes[selectedIndex]) {\n          onSelectNote(filteredNotes[selectedIndex].id);\n          onClose();\n        }\n      } else if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, filteredNotes, selectedIndex, onSelectNote, onClose]);\n\n  const stripHtml = (html: string) => {\n     const tmp = document.createElement(\"DIV\");\n     tmp.innerHTML = html;\n     return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 bg-white/80 dark:bg-black/80 backdrop-blur-sm z-[60]\"\n          />\n          \n          {/* Palette Container */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: -20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: -20 }}\n            transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n            className=\"fixed top-32 left-1/2 -translate-x-1/2 w-full max-w-xl z-[70] px-4 pointer-events-none\"\n          >\n             <div className=\"bg-white dark:bg-neutral-900 border-2 border-black dark:border-neutral-600 shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] dark:shadow-[8px_8px_0px_0px_rgba(255,255,255,0.1)] pointer-events-auto overflow-hidden flex flex-col\">\n                {/* Search Input */}\n                <div className=\"flex items-center border-b-2 border-black/5 dark:border-white/5 px-4 py-4\">\n                    <Search className=\"text-black dark:text-white w-5 h-5 mr-3\" strokeWidth={3} />\n                    <input\n                        ref={inputRef}\n                        type=\"text\"\n                        value={query}\n                        onChange={(e) => {\n                            setQuery(e.target.value);\n                            setSelectedIndex(0);\n                        }}\n                        placeholder=\"Search notes or #tags...\"\n                        className=\"flex-1 bg-transparent text-xl font-bold placeholder:text-gray-300 dark:placeholder:text-neutral-700 outline-none text-black dark:text-white\"\n                    />\n                    <button onClick={onClose} className=\"text-gray-400 dark:text-neutral-500 hover:text-black dark:hover:text-white transition-transform hover:scale-110\">\n                        <X size={20} />\n                    </button>\n                </div>\n\n                {/* Results List */}\n                <div className=\"max-h-[400px] overflow-y-auto custom-scrollbar p-2 space-y-1\">\n                    {filteredNotes.length === 0 ? (\n                         <div className=\"py-8 text-center text-gray-400 dark:text-neutral-600 font-medium\">\n                             No results found.\n                         </div>\n                    ) : (\n                        filteredNotes.map((note, index) => (\n                            <motion.div\n                                key={note.id}\n                                layout\n                                initial={{ opacity: 0, x: -10 }}\n                                animate={{ \n                                    opacity: 1, \n                                    x: index === selectedIndex ? 6 : 0,\n                                    scale: index === selectedIndex ? 1.02 : 1,\n                                    backgroundColor: index === selectedIndex ? '#000000' : 'transparent',\n                                    color: index === selectedIndex ? '#ffffff' : 'inherit'\n                                }}\n                                style={index !== selectedIndex ? { \n                                    backgroundColor: 'transparent',\n                                    color: 'inherit'\n                                } : undefined}\n                                whileHover={{ scale: 1.02, x: 6 }}\n                                transition={{ type: 'spring', stiffness: 400, damping: 25 }}\n                                onClick={() => {\n                                    onSelectNote(note.id);\n                                    onClose();\n                                }}\n                                onMouseEnter={() => setSelectedIndex(index)}\n                                className={`flex items-center justify-between p-3 rounded-lg cursor-pointer ${index === selectedIndex ? 'dark:bg-white dark:text-black' : 'text-black dark:text-neutral-300'}`}\n                            >\n                                <div className=\"flex items-center gap-3 overflow-hidden\">\n                                    <FileText size={18} className={`flex-shrink-0 transition-colors ${index === selectedIndex ? 'text-white dark:text-black' : 'text-gray-400 dark:text-neutral-600'}`} />\n                                    <div className=\"flex flex-col overflow-hidden\">\n                                        <div className=\"flex items-center gap-2\">\n                                            <span \n                                                className=\"font-bold truncate\"\n                                                dangerouslySetInnerHTML={{ __html: note.title || \"Untitled\" }}\n                                            />\n                                            {note.tags && note.tags.length > 0 && (\n                                                <div className=\"flex gap-1\">\n                                                    {note.tags.map(tag => (\n                                                        <span \n                                                            key={tag} \n                                                            className={`text-[9px] px-1.5 rounded-sm font-bold uppercase ${\n                                                                index === selectedIndex \n                                                                    ? 'bg-white/20 text-white dark:bg-black/20 dark:text-black' \n                                                                    : 'bg-gray-100 dark:bg-neutral-800 text-gray-500 dark:text-neutral-400'\n                                                            }`}\n                                                        >\n                                                            #{tag}\n                                                        </span>\n                                                    ))}\n                                                </div>\n                                            )}\n                                        </div>\n                                        <span className={`text-xs truncate transition-colors ${index === selectedIndex ? 'text-gray-400 dark:text-neutral-500' : 'text-gray-500 dark:text-neutral-500'}`}>\n                                            {stripHtml(note.blocks.find(b => b.content)?.content || \"\") || \"Empty note\"}\n                                        </span>\n                                    </div>\n                                </div>\n                                {index === selectedIndex && (\n                                    <motion.div\n                                        initial={{ opacity: 0, x: -5 }}\n                                        animate={{ opacity: 1, x: 0 }}\n                                    >\n                                        <CornerDownLeft size={16} className=\"text-gray-500 dark:text-neutral-400 flex-shrink-0\" />\n                                    </motion.div>\n                                )}\n                            </motion.div>\n                        ))\n                    )}\n                </div>\n                \n                {/* Footer */}\n                <div className=\"bg-gray-50 dark:bg-neutral-800 px-4 py-2 flex justify-between text-[10px] text-gray-400 dark:text-neutral-500 font-mono uppercase tracking-wider border-t border-black/5 dark:border-white/5\">\n                     <span>Pro Tip: Use arrow keys to navigate</span>\n                     <span>ESC to close</span>\n                </div>\n             </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9017, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/ui/AIMagicModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Sparkles, X, ArrowRight } from 'lucide-react';\n\ninterface AIMagicModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onGenerate: (prompt: string) => void;\n  isGenerating: boolean;\n}\n\nexport const AIMagicModal: React.FC<AIMagicModalProps> = ({\n  isOpen,\n  onClose,\n  onGenerate,\n  isGenerating\n}) => {\n  const [prompt, setPrompt] = useState('');\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      setTimeout(() => inputRef.current?.focus(), 100);\n      setPrompt('');\n    }\n  }, [isOpen]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (prompt.trim() && !isGenerating) {\n      onGenerate(prompt);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit(e);\n    }\n    if (e.key === 'Escape') {\n        onClose();\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={!isGenerating ? onClose : undefined}\n            className=\"fixed inset-0 bg-white/90 dark:bg-black/90 backdrop-blur-sm z-[100]\"\n          />\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg bg-white dark:bg-neutral-900 border-2 border-black dark:border-neutral-600 p-0 z-[101] shadow-[12px_12px_0px_0px_rgba(0,0,0,1)] dark:shadow-[12px_12px_0px_0px_rgba(255,255,255,0.1)]\"\n          >\n            <div className=\"bg-black dark:bg-white text-white dark:text-black p-4 flex justify-between items-center\">\n                <div className=\"flex items-center gap-2\">\n                    <Sparkles size={18} className=\"animate-pulse\" />\n                    <span className=\"font-bold tracking-wider text-sm uppercase\">Gemini Magic Create</span>\n                </div>\n                <button onClick={onClose} disabled={isGenerating} className=\"hover:text-gray-300 dark:hover:text-gray-600 disabled:opacity-50\">\n                    <X size={18} />\n                </button>\n            </div>\n\n            <div className=\"p-6\">\n                <p className=\"text-sm text-gray-500 dark:text-neutral-400 font-mono mb-4 uppercase tracking-wide\">\n                    Describe your thought, project, or idea...\n                </p>\n                \n                <textarea\n                    ref={inputRef}\n                    value={prompt}\n                    onChange={(e) => setPrompt(e.target.value)}\n                    onKeyDown={handleKeyDown}\n                    disabled={isGenerating}\n                    placeholder=\"e.g., A marketing plan for a coffee shop in Tokyo...\"\n                    className=\"w-full h-32 text-xl font-bold resize-none outline-none placeholder:text-gray-200 dark:placeholder:text-neutral-700 bg-transparent text-black dark:text-white\"\n                />\n\n                <div className=\"flex justify-end mt-6\">\n                    <button\n                        onClick={handleSubmit}\n                        disabled={!prompt.trim() || isGenerating}\n                        className=\"bg-black dark:bg-white text-white dark:text-black px-6 py-3 font-bold flex items-center gap-3 hover:bg-gray-800 dark:hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95\"\n                    >\n                        {isGenerating ? (\n                            <>\n                                <span className=\"w-4 h-4 border-2 border-white dark:border-black border-t-transparent rounded-full animate-spin\" />\n                                Creating...\n                            </>\n                        ) : (\n                            <>\n                                GENERATE\n                                <ArrowRight size={16} />\n                            </>\n                        )}\n                    </button>\n                </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;AAAA;AAAA;;;;;;AASO,MAAM,eAA4C,CAAC,EACxD,MAAM,EACN,OAAO,EACP,UAAU,EACV,YAAY,EACb;;IACC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,WAAW,IAAA,uKAAM,EAAsB;IAE7C,IAAA,0KAAS;kCAAC;YACR,IAAI,QAAQ;gBACV;8CAAW,IAAM,SAAS,OAAO,EAAE;6CAAS;gBAC5C,UAAU;YACZ;QACF;iCAAG;QAAC;KAAO;IAEX,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,IAAI,OAAO,IAAI,MAAM,CAAC,cAAc;YAClC,WAAW;QACb;IACF;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,QAAQ,EAAE;YACpC,EAAE,cAAc;YAChB,aAAa;QACf;QACA,IAAI,EAAE,GAAG,KAAK,UAAU;YACpB;QACJ;IACF;IAEA,qBACE,6LAAC,+MAAe;kBACb,wBACC;;8BACE,6LAAC,uMAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;oBAAE;oBACtB,SAAS;wBAAE,SAAS;oBAAE;oBACtB,MAAM;wBAAE,SAAS;oBAAE;oBACnB,SAAS,CAAC,eAAe,UAAU;oBACnC,WAAU;;;;;;8BAEZ,6LAAC,uMAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBAC1C,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAG,GAAG;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBACvC,WAAU;;sCAEV,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAI,WAAU;;sDACX,6LAAC,yNAAQ;4CAAC,MAAM;4CAAI,WAAU;;;;;;sDAC9B,6LAAC;4CAAK,WAAU;sDAA6C;;;;;;;;;;;;8CAEjE,6LAAC;oCAAO,SAAS;oCAAS,UAAU;oCAAc,WAAU;8CACxD,cAAA,6LAAC,oMAAC;wCAAC,MAAM;;;;;;;;;;;;;;;;;sCAIjB,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAE,WAAU;8CAAqF;;;;;;8CAIlG,6LAAC;oCACG,KAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;oCACzC,WAAW;oCACX,UAAU;oCACV,aAAY;oCACZ,WAAU;;;;;;8CAGd,6LAAC;oCAAI,WAAU;8CACX,cAAA,6LAAC;wCACG,SAAS;wCACT,UAAU,CAAC,OAAO,IAAI,MAAM;wCAC5B,WAAU;kDAET,6BACG;;8DACI,6LAAC;oDAAK,WAAU;;;;;;gDAAmG;;yEAIvH;;gDAAE;8DAEE,6LAAC,mOAAU;oDAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWlD;GApGa;KAAA"}},
    {"offset": {"line": 9246, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/services/geminiService.ts"],"sourcesContent":["'use server';\n\nimport { GoogleGenAI, Type } from \"@google/genai\";\n\nconst getClient = () => {\n  const apiKey = process.env.GEMINI_API_KEY;\n  if (!apiKey) {\n    console.warn(\"API Key not found\");\n    return null;\n  }\n  return new GoogleGenAI({ apiKey });\n};\n\nexport const expandNoteWithAI = async (currentContent: string): Promise<string> => {\n  const ai = getClient();\n  if (!ai) return \"Error: API Key missing.\";\n\n  try {\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-pro',\n      contents: `You are a minimalist productivity assistant. \n      Take the following note content and expand upon it with 3 actionable bullet points \n      or a brief summary paragraph. Keep the tone strict, professional, and concise.\n      \n      Input: \"${currentContent}\"`,\n    });\n\n    return response.text || \"No response generated.\";\n  } catch (error) {\n    console.error(\"Gemini API Error:\", error);\n    return \"Failed to generate insight.\";\n  }\n};\n\nexport const generateConnections = async (notes: { id: string, title: string }[]) => {\n  const ai = getClient();\n  if (!ai) return [];\n\n  try {\n    // Logic to suggest connections between notes based on titles\n    // Placeholder for advanced graph RAG\n    return [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport const generateNoteFromPrompt = async (prompt: string): Promise<{ title: string; content: string } | null> => {\n  const ai = getClient();\n  if (!ai) return null;\n\n  try {\n    const response = await ai.models.generateContent({\n      model: 'gemini-2.5-pro',\n      contents: `Generate a creative and structured note based on the following user prompt: \"${prompt}\". \n        The title should be concise and catchy. The content should be a well-structured starting point (e.g., a list, a summary, or a draft).`,\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: Type.OBJECT,\n          properties: {\n            title: { type: Type.STRING },\n            content: { type: Type.STRING }\n          },\n          required: [\"title\", \"content\"]\n        }\n      }\n    });\n\n    const text = response.text;\n    if (text) {\n      return JSON.parse(text);\n    }\n    return null;\n  } catch (e) {\n    console.error(\"Gemini Magic Create Error:\", e);\n    return null;\n  }\n}"],"names":[],"mappings":";;;;;;;IA+Ca,yBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 9261, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IAuJsB,WAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 9276, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IAsLsB,WAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 9291, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IA6NsB,mBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 9306, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IAkJsB,gBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 9321, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/app/actions.ts"],"sourcesContent":["'use server';\n\nimport pool from '../lib/db';\nimport { Note } from '../types';\nimport { z } from 'zod';\nimport bcrypt from 'bcryptjs';\nimport { signIn } from '../auth';\nimport { AuthError } from 'next-auth';\n\n// --- Zod Schemas ---\nconst UserRegistrationSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['USER', 'ADMIN']).optional(),\n});\n\nconst UserProfileSchema = z.object({\n  name: z.string().min(1).max(100),\n  image: z.string().optional(), // Allow empty string or null\n});\n\nconst NoteBlockSchema = z.object({\n  id: z.string(),\n  type: z.enum(['paragraph', 'heading', 'todo', 'bullet', 'blockquote', 'code', 'image']),\n  content: z.string(),\n  checked: z.boolean().optional(),\n});\n\nconst NoteSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  blocks: z.array(NoteBlockSchema),\n  position: z.object({ x: z.number(), y: z.number() }),\n  connections: z.array(z.string()),\n  tags: z.array(z.string()).optional(),\n  createdAt: z.number(),\n  color: z.string().optional(),\n});\n\n// --- Helper Functions ---\n\nasync function withRetry<T>(fn: () => Promise<T>, retries = 3, delay = 1000): Promise<T> {\n  try {\n    return await fn();\n  } catch (error) {\n    if (retries <= 0) throw error;\n    await new Promise(resolve => setTimeout(resolve, delay));\n    return withRetry(fn, retries - 1, delay * 2);\n  }\n}\n\nasync function ensureTable() {\n  try {\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS notes (\n        id TEXT PRIMARY KEY,\n        title TEXT,\n        data JSONB NOT NULL\n      );\n    `);\n\n    // Create Users Table\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        email TEXT UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT NOT NULL DEFAULT 'USER',\n        created_at BIGINT NOT NULL,\n        name TEXT,\n        image TEXT\n      );\n    `);\n\n    // Create Tags Table for global tag management\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS tags (\n        id TEXT PRIMARY KEY,\n        name TEXT UNIQUE NOT NULL,\n        color TEXT NOT NULL DEFAULT '#3b82f6',\n        created_at BIGINT NOT NULL\n      );\n    `);\n\n    // Add columns if they don't exist (migration)\n    try {\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS name TEXT;`);\n      await pool.query(`ALTER TABLE users ADD COLUMN IF NOT EXISTS image TEXT;`);\n    } catch (e) {\n      console.log(\"Columns might already exist\");\n    }\n\n  } catch (e) {\n    console.error(\"Failed to ensure tables exist:\", e);\n  }\n}\n\nasync function fixSchema() {\n  try {\n    await pool.query(`\n            ALTER TABLE notes ADD COLUMN IF NOT EXISTS data JSONB;\n        `);\n  } catch (e) {\n    console.error(\"Failed to fix schema:\", e);\n  }\n}\n\n// --- Actions ---\n\nexport async function updateUserProfile(name: string, image: string) {\n  const validation = UserProfileSchema.safeParse({ name, image });\n  if (!validation.success) {\n    return { error: 'Invalid profile data.' };\n  }\n\n  try {\n    const session = await import('../auth').then(mod => mod.auth());\n    if (!session?.user?.email) return { error: 'Not authenticated' };\n\n    await pool.query(\n      'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n      [name, image, session.user.email]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '42703') { // Undefined column\n      await ensureTable();\n      try {\n        const session = await import('../auth').then(mod => mod.auth());\n        if (!session?.user?.email) return { error: 'Not authenticated' };\n\n        await pool.query(\n          'UPDATE users SET name = $1, image = $2 WHERE email = $3',\n          [name, image, session.user.email]\n        );\n        return { success: true };\n      } catch (retryError) {\n        console.error('Failed to update profile after migration:', retryError);\n        return { error: 'Failed to update profile' };\n      }\n    }\n    console.error('Failed to update profile:', error);\n    return { error: 'Failed to update profile' };\n  }\n}\n\nexport async function signOutAction() {\n  const { signOut } = await import('../auth');\n  await signOut({ redirectTo: '/login' });\n}\n\nexport async function getNotes(): Promise<Note[]> {\n  try {\n    const result = await pool.query('SELECT data FROM notes');\n    return result.rows\n      .map(row => row.data)\n      .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n  } catch (e: any) {\n    // Handle case where table might not exist yet\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    // Handle case where column might not exist (schema mismatch)\n    if (e.code === '42703') {\n      await fixSchema();\n      // Retry fetch\n      try {\n        const retryResult = await pool.query('SELECT data FROM notes');\n        return retryResult.rows\n          .map(row => row.data)\n          .filter((n): n is Note => n !== null && typeof n === 'object' && 'id' in n);\n      } catch (retryError) {\n        console.error(\"Retry failed after schema fix:\", retryError);\n        return [];\n      }\n    }\n    console.error(\"Database Error:\", e);\n    return [];\n  }\n}\n\nexport async function saveNote(note: Note) {\n  // Validate Note Structure\n  const validation = NoteSchema.safeParse(note);\n  if (!validation.success) {\n    console.error(\"Invalid note data:\", validation.error);\n    throw new Error(\"Invalid note data\");\n  }\n\n  await withRetry(async () => {\n    try {\n      await pool.query(\n        `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n         ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n        [note.id, note.title || '', JSON.stringify(note)]\n      );\n    } catch (e: any) {\n      if (e.code === '42P01') {\n        await ensureTable();\n        // Retry once immediately after table creation\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else if (e.code === '42703') {\n        await fixSchema();\n        // Retry once immediately after schema fix\n        await pool.query(\n          `INSERT INTO notes (id, title, data) VALUES ($1, $2, $3) \n               ON CONFLICT (id) DO UPDATE SET title = $2, data = $3`,\n          [note.id, note.title || '', JSON.stringify(note)]\n        );\n      } else {\n        throw e;\n      }\n    }\n  });\n}\n\nexport async function deleteNoteAction(id: string) {\n  if (!id || typeof id !== 'string') return; // Basic validation\n  try {\n    await withRetry(async () => await pool.query('DELETE FROM notes WHERE id = $1', [id]));\n  } catch (e) {\n    console.error(\"Delete Error:\", e);\n  }\n}\n\nexport async function syncNotes(notes: Note[]) {\n  const validation = z.array(NoteSchema).safeParse(notes);\n  if (!validation.success) {\n    console.error(\"Invalid notes data for sync\");\n    return;\n  }\n\n  // Process in chunks or sequentially to avoid overwhelming the DB, but with retry per note\n  for (const note of notes) {\n    await saveNote(note);\n  }\n}\n\nexport async function registerUser(formData: FormData) {\n  const rawData = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n    role: formData.get('role') || 'USER',\n  };\n\n  const validation = UserRegistrationSchema.safeParse(rawData);\n\n  if (!validation.success) {\n    return { error: 'Invalid email or password (min 6 chars).' };\n  }\n\n  const { email, password, role } = validation.data;\n\n  // Ensure table exists before registering\n  await ensureTable();\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const id = crypto.randomUUID();\n\n  try {\n    await pool.query(\n      `INSERT INTO users (id, email, password_hash, role, created_at) VALUES ($1, $2, $3, $4, $5)`,\n      [id, email, hashedPassword, role, Date.now()]\n    );\n    return { success: true };\n  } catch (error: any) {\n    if (error.code === '23505') { // Unique violation\n      return { error: 'User already exists.' };\n    }\n    console.error('Registration error:', error);\n    return { error: 'Failed to register user.' };\n  }\n}\n\nexport async function authenticate(prevState: string | undefined, formData: FormData) {\n  try {\n    await signIn('credentials', {\n      ...Object.fromEntries(formData),\n      redirectTo: '/',\n    });\n  } catch (error) {\n    if (error instanceof AuthError) {\n      switch (error.type) {\n        case 'CredentialsSignin':\n          return 'Invalid credentials.';\n        default:\n          return 'Something went wrong.';\n      }\n    }\n    throw error;\n  }\n}\n\n// --- Tag Management Actions ---\n\nimport { Tag } from '../types';\n\nconst TagSchema = z.object({\n  id: z.string(),\n  name: z.string().min(1).max(50),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/),\n  createdAt: z.number(),\n});\n\nexport async function getTags(): Promise<Tag[]> {\n  try {\n    await ensureTable();\n    const result = await pool.query('SELECT id, name, color, created_at FROM tags ORDER BY name');\n    return result.rows.map(row => ({\n      id: row.id,\n      name: row.name,\n      color: row.color,\n      createdAt: Number(row.created_at),\n    }));\n  } catch (e: any) {\n    if (e.code === '42P01') {\n      await ensureTable();\n      return [];\n    }\n    console.error(\"Failed to get tags:\", e);\n    return [];\n  }\n}\n\nexport async function createTag(name: string, color: string): Promise<{ success?: boolean; error?: string; tag?: Tag }> {\n  const id = crypto.randomUUID();\n  const createdAt = Date.now();\n\n  const validation = TagSchema.safeParse({ id, name: name.trim().toLowerCase(), color, createdAt });\n  if (!validation.success) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await ensureTable();\n    await pool.query(\n      'INSERT INTO tags (id, name, color, created_at) VALUES ($1, $2, $3, $4)',\n      [id, name.trim().toLowerCase(), color, createdAt]\n    );\n    return { success: true, tag: { id, name: name.trim().toLowerCase(), color, createdAt } };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag already exists' };\n    }\n    console.error(\"Failed to create tag:\", e);\n    return { error: 'Failed to create tag' };\n  }\n}\n\nexport async function updateTag(id: string, name: string, color: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id || !name.trim()) {\n    return { error: 'Invalid tag data' };\n  }\n\n  try {\n    await pool.query(\n      'UPDATE tags SET name = $1, color = $2 WHERE id = $3',\n      [name.trim().toLowerCase(), color, id]\n    );\n    return { success: true };\n  } catch (e: any) {\n    if (e.code === '23505') {\n      return { error: 'Tag name already exists' };\n    }\n    console.error(\"Failed to update tag:\", e);\n    return { error: 'Failed to update tag' };\n  }\n}\n\nexport async function deleteTag(id: string, tagName: string): Promise<{ success?: boolean; error?: string }> {\n  if (!id) {\n    return { error: 'Invalid tag ID' };\n  }\n\n  try {\n    // Delete the tag from the tags table\n    await pool.query('DELETE FROM tags WHERE id = $1', [id]);\n\n    // Remove this tag from all notes that use it\n    const notesResult = await pool.query('SELECT id, data FROM notes');\n    for (const row of notesResult.rows) {\n      const note = row.data as Note;\n      if (note.tags && note.tags.includes(tagName)) {\n        const updatedTags = note.tags.filter(t => t !== tagName);\n        const updatedNote = { ...note, tags: updatedTags };\n        await pool.query(\n          'UPDATE notes SET data = $1 WHERE id = $2',\n          [JSON.stringify(updatedNote), note.id]\n        );\n      }\n    }\n\n    return { success: true };\n  } catch (e) {\n    console.error(\"Failed to delete tag:\", e);\n    return { error: 'Failed to delete tag' };\n  }\n}"],"names":[],"mappings":";;;;;;;IA6GsB,oBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 9336, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/auth/AvatarFrame.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface AvatarFrameProps {\r\n    role?: 'USER' | 'ADMIN';\r\n    children: React.ReactNode;\r\n    className?: string;\r\n}\r\n\r\nexport const AvatarFrame = ({ role = 'USER', children, className = '' }: AvatarFrameProps) => {\r\n    if (role === 'ADMIN') {\r\n        return (\r\n            <div className={`relative flex items-center justify-center ${className}`}>\r\n                {/* Admin: Cyber Shield / Glitch Core */}\r\n\r\n                {/* Rotating Outer Hexagon */}\r\n                <motion.div\r\n                    animate={{ rotate: 360 }}\r\n                    transition={{ duration: 20, repeat: Infinity, ease: \"linear\" }}\r\n                    className=\"absolute inset-[-8px] border-2 border-red-500/30 rounded-[30%] opacity-60\"\r\n                    style={{ clipPath: 'polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)' }}\r\n                />\r\n\r\n                {/* Counter-Rotating Inner Hexagon */}\r\n                <motion.div\r\n                    animate={{ rotate: -360 }}\r\n                    transition={{ duration: 15, repeat: Infinity, ease: \"linear\" }}\r\n                    className=\"absolute inset-[-4px] border border-yellow-500/40 rounded-[30%] opacity-80\"\r\n                    style={{ clipPath: 'polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)' }}\r\n                />\r\n\r\n                {/* Glitch Spikes */}\r\n                <motion.div\r\n                    animate={{\r\n                        scale: [1, 1.1, 1],\r\n                        opacity: [0.5, 0.8, 0.5],\r\n                        rotate: [0, 5, -5, 0]\r\n                    }}\r\n                    transition={{ duration: 0.2, repeat: Infinity, repeatDelay: 3 }}\r\n                    className=\"absolute inset-[-12px] border-t-2 border-b-2 border-red-600/60 rounded-full\"\r\n                />\r\n\r\n                {/* Core Glow */}\r\n                <div className=\"absolute inset-0 bg-red-500/10 blur-xl rounded-full\" />\r\n\r\n                {/* Content Container */}\r\n                <div className=\"relative z-10 w-full h-full rounded-full overflow-hidden border-2 border-red-500/50 shadow-[0_0_15px_rgba(239,68,68,0.4)] bg-black\">\r\n                    {children}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // User: Holographic Gyroscope\r\n    return (\r\n        <div className={`relative flex items-center justify-center ${className}`}>\r\n            {/* Outer Ring - Slow */}\r\n            <motion.div\r\n                animate={{ rotateX: 360, rotateY: 180 }}\r\n                transition={{ duration: 10, repeat: Infinity, ease: \"linear\" }}\r\n                className=\"absolute inset-[-8px] rounded-full border border-blue-400/30 border-dashed\"\r\n                style={{ perspective: 1000 }}\r\n            />\r\n\r\n            {/* Middle Ring - Medium */}\r\n            <motion.div\r\n                animate={{ rotateY: -360, rotateZ: 45 }}\r\n                transition={{ duration: 7, repeat: Infinity, ease: \"linear\" }}\r\n                className=\"absolute inset-[-4px] rounded-full border border-purple-400/40\"\r\n            />\r\n\r\n            {/* Inner Ring - Fast */}\r\n            <motion.div\r\n                animate={{ rotateZ: 360 }}\r\n                transition={{ duration: 4, repeat: Infinity, ease: \"linear\" }}\r\n                className=\"absolute inset-0 rounded-full border-t-2 border-b-2 border-cyan-400/60\"\r\n            />\r\n\r\n            {/* Ambient Glow */}\r\n            <div className=\"absolute inset-0 bg-blue-500/10 blur-lg rounded-full\" />\r\n\r\n            {/* Content Container */}\r\n            <div className=\"relative z-10 w-full h-full rounded-full overflow-hidden border border-white/10 shadow-[0_0_15px_rgba(59,130,246,0.3)] bg-black\">\r\n                {children}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAWO,MAAM,cAAc,CAAC,EAAE,OAAO,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAoB;IACrF,IAAI,SAAS,SAAS;QAClB,qBACI,6LAAC;YAAI,WAAW,CAAC,0CAA0C,EAAE,WAAW;;8BAIpE,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,QAAQ;oBAAI;oBACvB,YAAY;wBAAE,UAAU;wBAAI,QAAQ;wBAAU,MAAM;oBAAS;oBAC7D,WAAU;oBACV,OAAO;wBAAE,UAAU;oBAAgE;;;;;;8BAIvF,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,QAAQ,CAAC;oBAAI;oBACxB,YAAY;wBAAE,UAAU;wBAAI,QAAQ;wBAAU,MAAM;oBAAS;oBAC7D,WAAU;oBACV,OAAO;wBAAE,UAAU;oBAAgE;;;;;;8BAIvF,6LAAC,uMAAM,CAAC,GAAG;oBACP,SAAS;wBACL,OAAO;4BAAC;4BAAG;4BAAK;yBAAE;wBAClB,SAAS;4BAAC;4BAAK;4BAAK;yBAAI;wBACxB,QAAQ;4BAAC;4BAAG;4BAAG,CAAC;4BAAG;yBAAE;oBACzB;oBACA,YAAY;wBAAE,UAAU;wBAAK,QAAQ;wBAAU,aAAa;oBAAE;oBAC9D,WAAU;;;;;;8BAId,6LAAC;oBAAI,WAAU;;;;;;8BAGf,6LAAC;oBAAI,WAAU;8BACV;;;;;;;;;;;;IAIjB;IAEA,8BAA8B;IAC9B,qBACI,6LAAC;QAAI,WAAW,CAAC,0CAA0C,EAAE,WAAW;;0BAEpE,6LAAC,uMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS;oBAAK,SAAS;gBAAI;gBACtC,YAAY;oBAAE,UAAU;oBAAI,QAAQ;oBAAU,MAAM;gBAAS;gBAC7D,WAAU;gBACV,OAAO;oBAAE,aAAa;gBAAK;;;;;;0BAI/B,6LAAC,uMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS,CAAC;oBAAK,SAAS;gBAAG;gBACtC,YAAY;oBAAE,UAAU;oBAAG,QAAQ;oBAAU,MAAM;gBAAS;gBAC5D,WAAU;;;;;;0BAId,6LAAC,uMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS;gBAAI;gBACxB,YAAY;oBAAE,UAAU;oBAAG,QAAQ;oBAAU,MAAM;gBAAS;gBAC5D,WAAU;;;;;;0BAId,6LAAC;gBAAI,WAAU;;;;;;0BAGf,6LAAC;gBAAI,WAAU;0BACV;;;;;;;;;;;;AAIjB;KA9Ea"}},
    {"offset": {"line": 9524, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/auth/UserProfile.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { User, Settings, LogOut, Camera, X, Save, Shield, User as UserIcon, Check } from 'lucide-react';\r\nimport { signOutAction, updateUserProfile } from '../../app/actions';\r\nimport { useSession } from 'next-auth/react';\r\nimport { AvatarFrame } from './AvatarFrame';\r\n\r\ninterface UserProfileProps {\r\n    user: {\r\n        name?: string;\r\n        email?: string;\r\n        image?: string;\r\n        role?: 'USER' | 'ADMIN';\r\n    };\r\n}\r\n\r\nexport const UserProfile = ({ user }: UserProfileProps) => {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [name, setName] = useState(user.name || '');\r\n    const [image, setImage] = useState(user.image || '');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [showSuccessMessage, setShowSuccessMessage] = useState(false);\r\n    const { update } = useSession();\r\n    const menuRef = useRef<HTMLDivElement>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Close on click outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n                setIsEditing(false);\r\n                setShowSuccessMessage(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (file) {\r\n            if (file.size > 2 * 1024 * 1024) { // 2MB limit\r\n                alert(\"File size too large. Please upload an image smaller than 2MB.\");\r\n                return;\r\n            }\r\n\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => {\r\n                setImage(reader.result as string);\r\n            };\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setIsLoading(true);\r\n        const result = await updateUserProfile(name, image);\r\n        if (result.success) {\r\n            await update({ name, image });\r\n            setShowSuccessMessage(true);\r\n            setIsEditing(false);\r\n        }\r\n        setIsLoading(false);\r\n    };\r\n\r\n    const initials = user.name\r\n        ? user.name.substring(0, 2).toUpperCase()\r\n        : user.email?.substring(0, 2).toUpperCase() || 'U';\r\n\r\n    const renderMedia = (src: string, className: string) => {\r\n        const isVideo = src.startsWith('data:video') || src.endsWith('.mp4') || src.endsWith('.webm');\r\n        if (isVideo) {\r\n            return (\r\n                <video\r\n                    src={src}\r\n                    className={className}\r\n                    autoPlay\r\n                    loop\r\n                    muted\r\n                    playsInline\r\n                    style={{ objectFit: 'cover' }}\r\n                />\r\n            );\r\n        }\r\n        return <img src={src} alt=\"Profile\" className={className} />;\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed top-4 right-4 z-50\" ref={menuRef}>\r\n            {/* Trigger */}\r\n            <motion.button\r\n                whileHover={{ scale: 1.05 }}\r\n                whileTap={{ scale: 0.95 }}\r\n                onClick={() => setIsOpen(!isOpen)}\r\n                className=\"relative w-12 h-12 flex items-center justify-center group focus:outline-none\"\r\n            >\r\n                <AvatarFrame role={user.role} className=\"w-10 h-10\">\r\n                    {image ? (\r\n                        renderMedia(image, \"w-full h-full\")\r\n                    ) : (\r\n                        <div className=\"w-full h-full flex items-center justify-center bg-black\">\r\n                            <span className=\"text-xs font-bold text-white\">{initials}</span>\r\n                        </div>\r\n                    )}\r\n                </AvatarFrame>\r\n            </motion.button>\r\n\r\n            {/* Dropdown / Modal */}\r\n            <AnimatePresence>\r\n                {isOpen && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, y: -10, scale: 0.95 }}\r\n                        animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                        exit={{ opacity: 0, y: -10, scale: 0.95 }}\r\n                        transition={{ type: 'spring', duration: 0.3 }}\r\n                        className=\"absolute top-16 right-0 w-80 bg-[#0a0a0a]/90 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl overflow-hidden\"\r\n                    >\r\n                        {/* Header Background */}\r\n                        <div className=\"h-24 bg-gradient-to-r from-blue-600/20 to-purple-600/20 relative overflow-hidden\">\r\n                            <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20\" />\r\n                            {user.role === 'ADMIN' && (\r\n                                <div className=\"absolute top-2 right-2 px-2 py-1 bg-red-500/20 border border-red-500/30 rounded text-[10px] font-bold text-red-400 flex items-center gap-1\">\r\n                                    <Shield size={10} /> ADMIN\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Profile Content */}\r\n                        <div className=\"px-6 pb-6 -mt-12 relative flex flex-col items-center\">\r\n                            {/* Avatar */}\r\n                            <div className=\"mb-4 relative\">\r\n                                <AvatarFrame role={user.role} className=\"w-24 h-24\">\r\n                                    {image ? (\r\n                                        renderMedia(image, \"w-full h-full\")\r\n                                    ) : (\r\n                                        <div className=\"w-full h-full flex items-center justify-center bg-[#1a1a1a]\">\r\n                                            <span className=\"text-3xl font-bold text-gray-500\">{initials}</span>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {/* Edit Overlay */}\r\n                                    {(isEditing) && (\r\n                                        <button\r\n                                            onClick={() => fileInputRef.current?.click()}\r\n                                            className=\"absolute inset-0 bg-black/60 flex flex-col items-center justify-center gap-1 cursor-pointer hover:bg-black/70 transition-colors z-20\"\r\n                                        >\r\n                                            <Camera size={24} className=\"text-white/80\" />\r\n                                            <span className=\"text-[8px] text-white/60 uppercase font-bold tracking-wider\">Change</span>\r\n                                        </button>\r\n                                    )}\r\n\r\n                                    <input\r\n                                        type=\"file\"\r\n                                        ref={fileInputRef}\r\n                                        className=\"hidden\"\r\n                                        accept=\"image/*,video/mp4,video/webm\"\r\n                                        onChange={handleFileChange}\r\n                                    />\r\n                                </AvatarFrame>\r\n                            </div>\r\n\r\n                            {/* Success Message */}\r\n                            <AnimatePresence>\r\n                                {showSuccessMessage && (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0, height: 0, marginBottom: 0 }}\r\n                                        animate={{ opacity: 1, height: 'auto', marginBottom: 16 }}\r\n                                        exit={{ opacity: 0, height: 0, marginBottom: 0 }}\r\n                                        className=\"overflow-hidden w-full\"\r\n                                    >\r\n                                        <div className=\"bg-green-500/10 border border-green-500/30 rounded-xl p-3 flex flex-col gap-2\">\r\n                                            <div className=\"flex items-center gap-2 text-green-400 font-bold text-sm\">\r\n                                                <div className=\"p-1 bg-green-500/20 rounded-full\">\r\n                                                    <Check size={12} strokeWidth={3} />\r\n                                                </div>\r\n                                                PROFILE UPDATED\r\n                                            </div>\r\n                                            <p className=\"text-[10px] text-green-300/80 leading-relaxed\">\r\n                                                Your neural identity has been rewritten. <br />\r\n                                                <span className=\"text-white font-bold\">Please refresh the page</span> or <span className=\"text-white font-bold\">re-login</span> to see changes take full effect.\r\n                                            </p>\r\n                                        </div>\r\n                                    </motion.div>\r\n                                )}\r\n                            </AnimatePresence>\r\n\r\n                            {/* Info */}\r\n                            <div className=\"space-y-4 w-full\">\r\n                                {!isEditing ? (\r\n                                    <div className=\"text-center\">\r\n                                        <h3 className=\"text-lg font-bold text-white\">{user.name || 'User'}</h3>\r\n                                        <p className=\"text-xs text-gray-500\">{user.email}</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"space-y-3\">\r\n                                        <div className=\"space-y-1\">\r\n                                            <label className=\"text-[10px] font-bold text-gray-500 uppercase\">Display Name</label>\r\n                                            <input\r\n                                                value={name}\r\n                                                onChange={(e) => setName(e.target.value)}\r\n                                                className=\"w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-blue-500 transition-colors\"\r\n                                                placeholder=\"Your Name\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"space-y-1\">\r\n                                            <label className=\"text-[10px] font-bold text-gray-500 uppercase\">Avatar URL</label>\r\n                                            <input\r\n                                                value={image}\r\n                                                onChange={(e) => setImage(e.target.value)}\r\n                                                className=\"w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-blue-500 transition-colors\"\r\n                                                placeholder=\"https://...\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Actions */}\r\n                                <div className=\"pt-4 border-t border-white/5 space-y-2\">\r\n                                    {!isEditing ? (\r\n                                        <button\r\n                                            onClick={() => setIsEditing(true)}\r\n                                            className=\"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-400 hover:text-white hover:bg-white/5 transition-colors\"\r\n                                        >\r\n                                            <Settings size={16} /> Settings\r\n                                        </button>\r\n                                    ) : (\r\n                                        <div className=\"flex gap-2\">\r\n                                            <button\r\n                                                onClick={() => setIsEditing(false)}\r\n                                                className=\"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm text-gray-400 hover:text-white hover:bg-white/5 transition-colors\"\r\n                                            >\r\n                                                <X size={16} /> Cancel\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={handleSave}\r\n                                                disabled={isLoading}\r\n                                                className=\"flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm bg-blue-600 text-white hover:bg-blue-500 transition-colors disabled:opacity-50\"\r\n                                            >\r\n                                                {isLoading ? <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" /> : <Save size={16} />}\r\n                                                Save\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    <button\r\n                                        onClick={() => signOutAction()}\r\n                                        className=\"w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 transition-colors\"\r\n                                    >\r\n                                        <LogOut size={16} /> Sign Out\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10133, "column": 0}, "map": {"version":3,"sources":["file:///D:/ANALISE%20DE%20DADOS/notations/components/NotationsApp.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useCallback, useEffect, useMemo, useRef } from 'react';\nimport { Sidebar } from './layout/Sidebar';\nimport { EditorView } from './editor/EditorView';\nimport { CanvasView } from './canvas/CanvasView';\nimport { GraphView } from './graph/GraphView';\nimport { ViewMode, Note, Tag } from '../types';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { ConfirmationModal } from './ui/ConfirmationModal';\nimport { UnsavedChangesModal } from './ui/UnsavedChangesModal';\nimport { useHistory, HistoryMode } from '../hooks/useHistory';\nimport { SearchPalette } from './ui/SearchPalette';\nimport { AIMagicModal } from './ui/AIMagicModal';\nimport { generateNoteFromPrompt } from '../services/geminiService';\nimport { getNotes, saveNote, deleteNoteAction, getTags } from '../app/actions';\nimport { User } from '../types';\nimport { UserProfile } from './auth/UserProfile';\n\ninterface NotationsAppProps {\n  user?: Partial<User> | null;\n}\n\nconst NotationsApp: React.FC<NotationsAppProps> = ({ user }) => {\n  const [view, setView] = useState<ViewMode>(ViewMode.CANVAS);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Theme State\n  const [isDarkMode, setIsDarkMode] = useState(false);\n\n  // Replaced standard state with History Hook\n  const {\n    state: notes,\n    set: setNotes,\n    undo,\n    redo,\n    canUndo,\n    canRedo\n  } = useHistory<Note[]>([]);\n\n  const [activeNoteId, setActiveNoteId] = useState<string | null>(null);\n\n  // Unsaved Changes State\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n  const [pendingNavigation, setPendingNavigation] = useState<(() => void) | null>(null);\n  const [unsavedModalOpen, setUnsavedModalOpen] = useState(false);\n\n  // Filter State\n  const [selectedTag, setSelectedTag] = useState<string | null>(null);\n\n  // Delete Modal State\n  const [deleteModalOpen, setDeleteModalOpen] = useState(false);\n  const [noteToDelete, setNoteToDelete] = useState<string | null>(null);\n\n  // Search State\n  const [searchOpen, setSearchOpen] = useState(false);\n\n  // AI Magic Modal State\n  const [aiModalOpen, setAiModalOpen] = useState(false);\n  const [isAiGenerating, setIsAiGenerating] = useState(false);\n\n  // Load Notes from DB and Local Backup\n  useEffect(() => {\n    const loadNotes = async () => {\n      const fetchedNotes = await getNotes();\n\n      // Local Backup Check\n      const localBackup = localStorage.getItem('notations_backup');\n      if (localBackup) {\n        try {\n          const parsedBackup: Note[] = JSON.parse(localBackup);\n          // Simple conflict resolution: If local has more notes or different data, we could prompt.\n          // For now, we'll merge: if local has notes not in DB (offline created), add them.\n          // If DB is empty but local has data, restore local.\n\n          if (fetchedNotes.length === 0 && parsedBackup.length > 0) {\n            console.log(\"Restoring from local backup...\");\n            setNotes(parsedBackup, 'REPLACE');\n            // Trigger sync to server\n            parsedBackup.forEach(n => saveNote(n));\n            setIsLoading(false);\n            return;\n          }\n\n          // If both have data, we prefer server for now but could implement smarter merge.\n          // A simple \"Safety Net\" is: if server fails to load, use local.\n        } catch (e) {\n          console.error(\"Failed to parse local backup\", e);\n        }\n      }\n\n      setNotes(fetchedNotes, 'REPLACE');\n      if (fetchedNotes.length > 0 && !activeNoteId) {\n        // Don't auto-select first note to avoid confusion with navigation trap immediately\n        // setActiveNoteId(fetchedNotes[0].id);\n      }\n      setIsLoading(false);\n    };\n    loadNotes();\n  }, []);\n\n  // Local Backup Effect\n  useEffect(() => {\n    if (notes.length > 0) {\n      localStorage.setItem('notations_backup', JSON.stringify(notes));\n    }\n  }, [notes]);\n\n  // Initialize Theme\n  useEffect(() => {\n    const storedTheme = localStorage.getItem('theme');\n    if (storedTheme === 'dark') {\n      setIsDarkMode(true);\n      document.documentElement.classList.add('dark');\n    } else if (!storedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n      setIsDarkMode(true);\n      document.documentElement.classList.add('dark');\n    } else {\n      setIsDarkMode(false);\n      document.documentElement.classList.remove('dark');\n    }\n  }, []);\n\n  const toggleTheme = () => {\n    const newMode = !isDarkMode;\n    setIsDarkMode(newMode);\n    if (newMode) {\n      document.documentElement.classList.add('dark');\n      localStorage.setItem('theme', 'dark');\n    } else {\n      document.documentElement.classList.remove('dark');\n      localStorage.setItem('theme', 'light');\n    }\n  };\n\n  const activeNote = notes.find(n => n.id === activeNoteId) || null;\n\n  // Computed filtered notes\n  const filteredNotes = useMemo(() => {\n    if (!selectedTag) return notes;\n    return notes.filter(n => n.tags?.includes(selectedTag));\n  }, [notes, selectedTag]);\n\n  // Compute unique tags for Sidebar (from DB + notes)\n  const [globalTags, setGlobalTags] = useState<string[]>([]);\n  const [tagsWithColors, setTagsWithColors] = useState<Tag[]>([]);\n\n  useEffect(() => {\n    const loadGlobalTags = async () => {\n      const dbTags = await getTags();\n      setGlobalTags(dbTags.map(t => t.name));\n      setTagsWithColors(dbTags);\n    };\n    loadGlobalTags();\n  }, []);\n\n  const uniqueTags = useMemo(() => {\n    // Merge global tags from DB with tags from notes\n    const allTags = new Set<string>(globalTags);\n    notes.forEach(note => {\n      note.tags?.forEach(tag => allTags.add(tag));\n    });\n    return Array.from(allTags).sort();\n  }, [notes, globalTags]);\n\n  // Keyboard Shortcuts: Undo/Redo, Search, and Magic Create\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Undo: Cmd+Z / Ctrl+Z\n      if ((e.metaKey || e.ctrlKey) && e.key === 'z' && !e.shiftKey) {\n        e.preventDefault();\n        undo();\n      }\n      // Redo: Cmd+Shift+Z / Ctrl+Shift+Z / Ctrl+Y\n      if (\n        ((e.metaKey || e.ctrlKey) && e.shiftKey && e.key === 'z') ||\n        ((e.metaKey || e.ctrlKey) && e.key === 'y')\n      ) {\n        e.preventDefault();\n        redo();\n      }\n      // Search: Cmd+K / Ctrl+K\n      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {\n        e.preventDefault();\n        setSearchOpen(true);\n      }\n      // Save: Cmd+S / Ctrl+S\n      if ((e.metaKey || e.ctrlKey) && e.key === 's') {\n        e.preventDefault();\n        if (activeNoteId) handleManualSave();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [undo, redo, activeNoteId, notes]);\n\n\n  // --- SECURITY: Prevent Unsaved Data Loss (F5, Close, etc.) ---\n  useEffect(() => {\n    const handleBeforeUnload = (e: BeforeUnloadEvent) => {\n      if (hasUnsavedChanges) {\n        e.preventDefault();\n        e.returnValue = ''; // Chrome requires returnValue to be set\n      }\n    };\n\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\n  }, [hasUnsavedChanges]);\n\n  // --- Auto-Save Mechanism ---\n  useEffect(() => {\n    if (!hasUnsavedChanges || !activeNoteId) return;\n\n    const timeoutId = setTimeout(() => {\n      // console.log(\"Auto-saving...\");\n      handleManualSave();\n    }, 2000); // Auto-save after 2 seconds of inactivity\n\n    return () => clearTimeout(timeoutId);\n  }, [notes, hasUnsavedChanges, activeNoteId]);\n\n\n  const handleNoteUpdate = async (updatedNote: Note, mode: HistoryMode = 'PUSH') => {\n    const newNotes = notes.map(n => n.id === updatedNote.id ? updatedNote : n);\n    setNotes(newNotes, mode);\n    setHasUnsavedChanges(true);\n    // Removed auto-save: await saveNote(updatedNote);\n  };\n\n  const handleManualSave = async () => {\n    if (activeNote) {\n      await saveNote(activeNote);\n      setHasUnsavedChanges(false);\n    }\n  };\n\n  // Navigation Interception Logic\n  const attemptNavigation = (action: () => void) => {\n    if (hasUnsavedChanges) {\n      setPendingNavigation(() => action);\n      setUnsavedModalOpen(true);\n    } else {\n      action();\n    }\n  };\n\n  const handleSaveAndLeave = async () => {\n    await handleManualSave();\n    setUnsavedModalOpen(false);\n    if (pendingNavigation) {\n      pendingNavigation();\n      setPendingNavigation(null);\n    }\n  };\n\n  const handleDiscardAndLeave = async () => {\n    // Revert changes by reloading from DB or just proceeding (since we didn't save)\n    // Ideally we should revert local state to last saved state, but for now just proceeding\n    // effectively discards the changes since they weren't persisted to DB.\n    // However, local state 'notes' still has the changes. We should probably reload or revert.\n    // For simplicity in this step, we'll just proceed, but the in-memory notes will still be dirty\n    // until a refresh. To do it right, we should re-fetch or undo.\n    // Let's re-fetch this specific note or all notes to be safe.\n\n    const fetchedNotes = await getNotes();\n    setNotes(fetchedNotes, 'REPLACE');\n\n    setHasUnsavedChanges(false);\n    setUnsavedModalOpen(false);\n    if (pendingNavigation) {\n      pendingNavigation();\n      setPendingNavigation(null);\n    }\n  };\n\n  const handleCancelNavigation = () => {\n    setUnsavedModalOpen(false);\n    setPendingNavigation(null);\n  };\n\n\n  const handleNoteSelect = useCallback((id: string) => {\n    attemptNavigation(() => {\n      setActiveNoteId(id);\n      setView(ViewMode.EDITOR);\n    });\n  }, [hasUnsavedChanges]);\n\n  const handleCreateNote = async () => {\n    attemptNavigation(async () => {\n      const newNote: Note = {\n        id: crypto.randomUUID(),\n        title: '',\n        blocks: [{ id: '1', type: 'paragraph', content: '' }],\n        position: { x: Math.random() * 500, y: Math.random() * 500 },\n        connections: [],\n        tags: [],\n        createdAt: Date.now()\n      };\n      setNotes([...notes, newNote], 'PUSH');\n      setActiveNoteId(newNote.id);\n      setView(ViewMode.EDITOR);\n      await saveNote(newNote); // Initial save is fine\n      setHasUnsavedChanges(false);\n    });\n  };\n\n  const handleAiCreate = async (prompt: string) => {\n    setIsAiGenerating(true);\n    const result = await generateNoteFromPrompt(prompt);\n\n    if (result) {\n      const newNote: Note = {\n        id: crypto.randomUUID(),\n        title: result.title,\n        blocks: [{ id: '1', type: 'paragraph', content: result.content }],\n        position: { x: Math.random() * 500, y: Math.random() * 500 },\n        connections: [],\n        tags: [],\n        createdAt: Date.now()\n      };\n\n      attemptNavigation(async () => {\n        setNotes([...notes, newNote], 'PUSH');\n        setActiveNoteId(newNote.id);\n        setView(ViewMode.EDITOR);\n        setAiModalOpen(false);\n        await saveNote(newNote);\n        setHasUnsavedChanges(false);\n      });\n    }\n    setIsAiGenerating(false);\n  };\n\n  const handleNoteMove = async (id: string, pos: { x: number, y: number }) => {\n    const note = notes.find(n => n.id === id);\n    if (note) {\n      const updatedNote = { ...note, position: pos };\n      const newNotes = notes.map(n => n.id === id ? updatedNote : n);\n      setNotes(newNotes, 'PUSH');\n      await saveNote(updatedNote); // Canvas moves can still auto-save or be separate\n    }\n  };\n\n  const handleConnectNotes = async (sourceId: string, targetId: string) => {\n    if (sourceId === targetId) return;\n\n    const sourceNote = notes.find(n => n.id === sourceId);\n    if (!sourceNote) return;\n\n    if (sourceNote.connections.includes(targetId)) return;\n\n    const updatedSource = { ...sourceNote, connections: [...sourceNote.connections, targetId] };\n\n    const newNotes = notes.map(n =>\n      n.id === sourceId\n        ? updatedSource\n        : n\n    );\n\n    setNotes(newNotes, 'PUSH');\n    await saveNote(updatedSource);\n  };\n\n  const handleRequestDelete = (noteId: string) => {\n    setNoteToDelete(noteId);\n    setDeleteModalOpen(true);\n  };\n\n  const confirmDelete = async () => {\n    if (noteToDelete) {\n      const updatedNotes: Note[] = [];\n\n      const newNotes = notes\n        .filter(n => n.id !== noteToDelete)\n        .map(n => {\n          if (n.connections.includes(noteToDelete)) {\n            const updated = { ...n, connections: n.connections.filter(cId => cId !== noteToDelete) };\n            updatedNotes.push(updated);\n            return updated;\n          }\n          return n;\n        });\n\n      setNotes(newNotes, 'PUSH');\n\n      if (activeNoteId === noteToDelete) {\n        setActiveNoteId(null);\n        setView(ViewMode.CANVAS);\n        setHasUnsavedChanges(false); // Deleted note doesn't have unsaved changes\n      }\n      setNoteToDelete(null);\n\n      // DB Updates\n      await deleteNoteAction(noteToDelete);\n      for (const note of updatedNotes) {\n        await saveNote(note);\n      }\n    }\n    setDeleteModalOpen(false);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"h-screen w-screen flex items-center justify-center bg-white dark:bg-black transition-colors\">\n        <div className=\"flex flex-col items-center gap-4\">\n          <div className=\"w-8 h-8 border-2 border-black dark:border-white border-t-transparent rounded-full animate-spin\" />\n          <p className=\"text-xs font-bold uppercase tracking-widest animate-pulse text-black dark:text-white\">Connecting to Neural DB...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-screen w-screen bg-background text-foreground font-sans transition-colors duration-300\">\n      <Sidebar\n        currentView={view}\n        onViewChange={(newView) => attemptNavigation(() => setView(newView))}\n        onCreateNote={handleCreateNote}\n        onAiCreate={() => setAiModalOpen(true)}\n        onUndo={undo}\n        onRedo={redo}\n        canUndo={canUndo}\n        canRedo={canRedo}\n        onSearch={() => setSearchOpen(true)}\n        allTags={uniqueTags}\n        selectedTag={selectedTag}\n        onSelectTag={setSelectedTag}\n        isDarkMode={isDarkMode}\n        onToggleTheme={toggleTheme}\n      />\n\n      <main className=\"flex-1 ml-20 relative h-full overflow-hidden\">\n        <AnimatePresence mode=\"wait\">\n          {view === ViewMode.EDITOR && (\n            <motion.div\n              key=\"editor\"\n              initial={{ opacity: 0, filter: 'blur(10px)' }}\n              animate={{ opacity: 1, filter: 'blur(0px)' }}\n              exit={{ opacity: 0, filter: 'blur(10px)' }}\n              className=\"h-full overflow-y-auto custom-scrollbar bg-white dark:bg-[#0a0a0a]\"\n            >\n              <EditorView\n                activeNote={activeNote}\n                onUpdateNote={handleNoteUpdate}\n                onDeleteNote={handleRequestDelete}\n                hasUnsavedChanges={hasUnsavedChanges}\n                onSave={handleManualSave}\n              />\n            </motion.div>\n          )}\n\n          {view === ViewMode.CANVAS && (\n            <motion.div\n              key=\"canvas\"\n              initial={{ opacity: 0, scale: 0.95 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, scale: 1.05 }}\n              className=\"h-full w-full\"\n            >\n              <CanvasView\n                notes={filteredNotes}\n                onNoteSelect={handleNoteSelect}\n                onNoteMove={handleNoteMove}\n                onConnectNotes={handleConnectNotes}\n                onDeleteNote={handleRequestDelete}\n                isDarkMode={isDarkMode}\n                tagsWithColors={tagsWithColors}\n                selectedNoteId={activeNoteId}\n              />\n            </motion.div>\n          )}\n\n          {view === ViewMode.GRAPH && (\n            <motion.div\n              key=\"graph\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"h-full w-full\"\n            >\n              <GraphView\n                notes={filteredNotes}\n                onNoteSelect={handleNoteSelect}\n                onDeleteNote={handleRequestDelete}\n                isDarkMode={isDarkMode}\n              />\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {user && <UserProfile user={user} />}\n\n        {/* Context Indicator */}\n        <div className=\"fixed top-20 right-8 flex flex-col items-end pointer-events-none z-40\">\n          <h1 className=\"text-xs font-bold tracking-[0.3em] uppercase opacity-30 dark:text-white dark:opacity-20\">NOTATIONS v1.0</h1>\n          <div className=\"flex items-center gap-2 mt-1\">\n            {selectedTag && (\n              <span className=\"text-[10px] bg-black dark:bg-white text-white dark:text-black px-2 py-0.5 rounded-full font-bold\">\n                FILTER: #{selectedTag}\n              </span>\n            )}\n            <span className=\"text-[10px] text-gray-400 dark:text-gray-500 font-mono\">\n              {activeNoteId ? `ACTIVE: ${notes.find(n => n.id === activeNoteId)?.title || 'UNTITLED'}` : 'NO SELECTION'}\n            </span>\n          </div>\n        </div>\n      </main>\n\n      <ConfirmationModal\n        isOpen={deleteModalOpen}\n        title=\"Delete Note?\"\n        message=\"Are you sure you want to delete this note? This action cannot be undone.\"\n        onConfirm={confirmDelete}\n        onCancel={() => setDeleteModalOpen(false)}\n      />\n\n      <UnsavedChangesModal\n        isOpen={unsavedModalOpen}\n        onSaveAndLeave={handleSaveAndLeave}\n        onDiscardAndLeave={handleDiscardAndLeave}\n        onCancel={handleCancelNavigation}\n      />\n\n      <SearchPalette\n        isOpen={searchOpen}\n        onClose={() => setSearchOpen(false)}\n        notes={filteredNotes}\n        onSelectNote={handleNoteSelect}\n      />\n\n      <AIMagicModal\n        isOpen={aiModalOpen}\n        onClose={() => setAiModalOpen(false)}\n        onGenerate={handleAiCreate}\n        isGenerating={isAiGenerating}\n      />\n    </div>\n  );\n};\n\nexport default NotationsApp;"],"names":[],"mappings":"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"}}]
}